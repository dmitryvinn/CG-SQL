<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">guide | CG/SQL</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="guide | CG/SQL"><meta data-react-helmet="true" name="description" content="Chapter 1: Introduction"><meta data-react-helmet="true" property="og:description" content="Chapter 1: Introduction"><meta data-react-helmet="true" property="og:url" content="https://dmitryvinn.github.io/CG-SQL/cql-guide/generated/guide"><link data-react-helmet="true" rel="shortcut icon" href="/CG-SQL/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dmitryvinn.github.io/CG-SQL/cql-guide/generated/guide"><link rel="stylesheet" href="/CG-SQL/styles.d985c265.css">
<link rel="preload" href="/CG-SQL/styles.0609face.js" as="script">
<link rel="preload" href="/CG-SQL/runtime~main.a7b2fbca.js" as="script">
<link rel="preload" href="/CG-SQL/main.7fbcc296.js" as="script">
<link rel="preload" href="/CG-SQL/1.5652f5db.js" as="script">
<link rel="preload" href="/CG-SQL/2.26ec7d90.js" as="script">
<link rel="preload" href="/CG-SQL/3.ef8f5048.js" as="script">
<link rel="preload" href="/CG-SQL/1be78505.ea7a68b3.js" as="script">
<link rel="preload" href="/CG-SQL/46.b422d852.js" as="script">
<link rel="preload" href="/CG-SQL/5456faf3.d182cbac.js" as="script">
<link rel="preload" href="/CG-SQL/17896441.9a4ae369.js" as="script">
<link rel="preload" href="/CG-SQL/d6e99f23.3ae457e1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/CG-SQL/"><strong class="navbar__title">CQ/SQL</strong></a><a class="navbar__item navbar__link" href="/CG-SQL/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/CG-SQL/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/CG-SQL/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/CG-SQL/"><strong class="navbar__title">CQ/SQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/CG-SQL/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/CG-SQL/cql-guide/ch01">CQL Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/CG-SQL/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">guide</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-1-introduction"></a>Chapter 1: Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-1-introduction" title="Direct link to heading">#</a></h2><p>CQL was designed as a precompiled addition to the the SQLite runtime system.  SQLite lacks
stored procedures, but has a rich C runtime interface that allows you to create any kind
of control flow mixed with any SQL operations that you might need.  However, SQLite&#x27;s programming
interface is both verbose and error-prone in that small changes in SQL statements can require
significant swizzling of the C code that calls them. Additionally, many of the SQLite runtime functions have error codes
which must be strictly checked to ensure correct behavior.  In practice, it&#x27;s easy to get some or all of this wrong.</p><p>CQL simplifies this situation by providing a high level SQL language not unlike the stored procedure
forms that are available in client/server SQL solutions and lowering that language to &quot;The C you could
have written to do that job using the normal SQLite interfaces.&quot;</p><p>As a result, the C generated is generally very approachable but now the source language does not suffer from
brittleness due to query or table changes and CQL always generates correct column indices, nullability
checks, error checks, and the other miscellany needed to use SQLite correctly.</p><p>CQL is also strongly typed, whereas SQLite is very forgiving with regard to what operations
are allowed on which data.  Strict type checking is much more reasonable given CQL&#x27;s compiled programming model.</p><p>NOTE: CQL was created to help solve problems in the building of Facebook&#x27;s Messenger application, but this content is free from references to Messenger. The CQL code generation here is done in the simplest
mode with the fewest runtime dependencies allowed for illustration.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="getting-started"></a>Getting Started<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h3><p>The &quot;Hello World&quot; program rendered in CQL looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This very nearly works exactly as written but we&#x27;ll need a little bit of glue to wire it all up.
Let&#x27;s talk about that glue.</p><p>First, to build this example we&#x27;ll use cql in its simplest mode.  You may need to build the <code>cql</code> executable first.
From a source distribution you can run <code>make</code> in the <code>cql</code> directory to do the job.  You can get the binary from the <code>out</code> directory after the build.  Arrange for <code>cql</code> to be on your PATH.</p><p>With that done you should have the power to do this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in hello.sql --cg hello.h hello.c</span></div></div></div></div></div><p>This will produce the C output files <code>hello.c</code> and <code>hello.h</code> which can be readily compiled.</p><p>However, hello.c will not have a <code>main</code> -- rather it will have a function like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">void hello(void);</span></div></div></div></div></div><p>The declaration of this function can be found in <code>hello.h</code>.</p><p>That <code>hello</code> function is not quite adequate to do get a running program, which brings us to the next step in
getting things running.  Typically you have some kind of client program that will execute the procedures you
create in CQL.  Let&#x27;s create a simple one in a file we&#x27;ll creatively name <code>main.c</code>.</p><p>A very simple CQL main might look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;stdlib.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, char **argv)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   hello();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   return 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Now we should be able to get do the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Hello, world</span></div></div></div></div></div><p>NOTE: hello.c will attempt to <code>#include &quot;cqlrt.h&quot;</code> the declarations for CQL runtime functions.
You must make arrangements for the compiler to be able to find <code>cqlrt.h</code> either by adding it to an
<code>INCLUDE</code> path or by adding some -I options to help the compiler find the source.  For now you could
keep <code>cqlrt.h</code> in the same directory as the examples and avoid that complication.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-did-this-work"></a>Why did this work?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-did-this-work" title="Direct link to heading">#</a></h3><p>A number of things are going on even in this simple program that are worth discussing:</p><ul><li>the procedure <code>hello</code> had no arguments, and did not use the database<ul><li>therefore its type signature when compiled will be simply <code>void hello(void);</code> so we know how to call it</li><li>you can see the declaration for yourself by examining the <code>hello.c</code> or <code>hello.h</code></li></ul></li><li>since nobody used a database we didn&#x27;t need to initialize one.</li><li>since there are no actual uses of SQLite we didn&#x27;t need to provide that library</li><li>for the same reason we didn&#x27;t need to include a reference to the CQL runtime</li><li>the function <code>printf</code> was not declared, so attempting to <code>call</code> it creates a regular C call using whatever arguments are provided, in this case a string</li><li>the <code>printf</code> function is declared in <code>stdio.h</code> which is pulled in by <code>cqlrt.h</code>, which appears in <code>hello.c</code>, so it will be available to call</li><li>CQL allows string literal with double quotes, those literals may have most C escape sequences in them, so the &quot;\n&quot; bit works<ul><li>Normal SQL string literals (also supported) use single quotes and do not allow, or need escape characters other than <code>&#x27;&#x27;</code> to mean one single quote</li></ul></li></ul><p>All of these facts put together mean that the normal simple linkage rules result in an executable that prints
the string &quot;Hello, world&quot; and then a newline.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="variables-and-arithmetic"></a>Variables and Arithmetic<a aria-hidden="true" tabindex="-1" class="hash-link" href="#variables-and-arithmetic" title="Direct link to heading">#</a></h3><p>Borrowing once again from examples in &quot;The C Programming Language&quot;, it&#x27;s possible to do significant control flow in CQL without reference to databases.  The following program illustrates a variety of concepts:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- print a conversion table  for temperatures from 0 to 300</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> conversions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> lower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> upper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> step </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> lower :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* lower limit of range */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> upper :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">300</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* upper limit of range */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> step :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* step size */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> lower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> upper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> celsius :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d\t%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You may notice that both the SQL style <code>--</code> line prefix comments and the C style <code>/* */</code> forms
are acceptable comment forms. Indeed, it&#x27;s actually quite normal to pass CQL source through the C pre-processor before giving
it to the CQL compiler, thereby gaining <code>#define</code> and <code>#include</code> as well as other pre-processing options
like token pasting in addition to the other comment forms.  More on this later.</p><p>Like C, in CQL all variables must be declared before they are used.  They remain in scope until the end of the
procedure in which they are declared, or they are global scoped if they are declared outside of any procedure.  The
declarations announce the names and types of the local variables.   Importantly, variables stay in scope for the whole
procedure even if they are declared within a nested <code>begin</code> and <code>end</code> block.</p><p>The most basic types are the scalar or &quot;unitary&quot; types (as they are referred to in the compiler)</p><table><thead><tr><th>type</th><th>aliases</th><th>notes</th></tr></thead><tbody><tr><td><code>integer</code></td><td>int</td><td>a 32 bit integer</td></tr><tr><td><code>long</code> *</td><td>long integer</td><td>a 64 bit integer</td></tr><tr><td><code>bool</code></td><td>boolean</td><td>an 8 bit integer, normalized to 0/1</td></tr><tr><td><code>real</code></td><td>n/a</td><td>a C double</td></tr><tr><td><code>text</code></td><td>n/a</td><td>an immutable string reference</td></tr><tr><td><code>blob</code></td><td>n/a</td><td>an immutable blob reference</td></tr><tr><td><code>object</code></td><td>n/a</td><td>an object reference</td></tr><tr><td><code>object&lt;T&gt;</code></td><td>n/a</td><td>an object reference of type T</td></tr></tbody></table><p>* SQLite makes no distinction between integer storage and long integer storage, but the declaration
tells CQL whether it should use the SQLite methods for binding and reading 64 bit or 32 bit quantities
from the column.</p><p>There will be more notes on these types later, but importantly, all keywords and names in CQL
are case insensitive just like in the underlying SQL language.   Additionally all of the
above may be combined with <code>not null</code> to indicate that a <code>null</code> value may not be stored
in that variable (as in the example).  When generating the C code, the case used in the declaration
becomes the canonical case of the variable and all other cases are converted to that in the emitted
code.  As a result the C remains case sensitively correct.</p><p>The size of the reference types is machine dependent, whatever the local pointer size is.  The
non-reference types use machine independent declarations like <code>int32_t</code> to get exactly the desired
sizes in a portable fashion.</p><p>All reference types are initialized to <code>NULL</code> when they are declared.</p><p>The programs execution begins with three assignments:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> lower :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> upper :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">300</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> step :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This initializes the variables just like in the isomorphic C code.  Statements are seperated by semicolons,
just like in C.</p><p>The table is then printed using a <code>while</code> loop</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> upper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This has the usual meaning, with the statements in the <code>begin/end</code> block being executed repeatedly
until the condition becomes false.</p><p>The body of a <code>begin/end</code> block such as the one in the <code>while</code> statement can contain one or more statements.</p><p>The typical computation of Celsius temperature ensues with this code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> celsius :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d\t%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This computes the celsuis and then prints it out, moving on to the next entry in the table.</p><p>Importantly, the CQL compiler uses the normal SQLite order of operations, which is NOT the C order of operatations.
As a result, the compiler may need to add parentheses in the C output to get the correct order; or it may remove
some parentheses because they are not needed in the C order even though they were in the SQL order.</p><p>The <code>printf</code> call operates as before, with the <code>fahr</code> and <code>celsius</code> variables being passed on to the C runtime library
for formatting, unchanged.</p><p>NOTE: when calling unknown foreign functions like <code>printf</code> string literals are simply passed right through unchanged
as C string literals. No CQL string object is created.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="basic-conversion-rules"></a>Basic Conversion Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-conversion-rules" title="Direct link to heading">#</a></h3><p>As a rule, CQL does not perform its own conversions, leaving that instead to the C compiler.  An exception
to this is that boolean expressions are normalized to a 0 or 1 result before they are stored.</p><p>However, even with no explicit conversions, there are compatibility checks to ensure that letting the C compiler
do the conversions will result in something sensible.  The following list summarizes the essential facts/rules as
they might be applied when performing a <code>+</code> operation.</p><ul><li>the numeric types are bool, int, long, real</li><li>non-numeric types cannot be combined with numerics, e.g. 1 + &#x27;x&#x27; always yields an error</li><li>any numeric type combined with itself yields the same type</li><li>bool combined with int yields int</li><li>bool or int combined with long yields long</li><li>bool, int, or long combined with real yields real</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="preprocessing-features"></a>Preprocessing Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#preprocessing-features" title="Direct link to heading">#</a></h3><p>CQL does not include its own pre-processor but it is designed to consume the output the C pre-processor.  To do this, you can either write the output of the pre-processor to a temporary file and read it into CQL as usual or you can set up a pipeline something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cc -x c -E your_program.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg your_program.h your_program.c</span></div></div></div></div></div><p>The above causes the C compiler to invoke only the pre-processor <code>-E</code> and to treat the input as though it were C code <code>-x c</code> even though it is in a <code>.sql</code> file. Later examples will assume that you have configured CQL to be used with the C pre-processor as above.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-2-using-data"></a>Chapter 2: Using Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-2-using-data" title="Direct link to heading">#</a></h2><p>The point of using CQL is to facilitate access to a SQLite database so we&#x27;ll switch gears to a slightly more complicated setup.  We&#x27;ll
still keep things fairly simple but let&#x27;s start to use some database features.  Note: it is not the intent of this tutorial to also be
a primer for the SQLite programming language which is so ably documented on <a href="https://sqlite.org/" target="_blank" rel="noopener noreferrer">https://sqlite.org/</a>.  Please refer to that site for details
on the meaning of the SQL statements used here if you are new to SQL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="a-sample-program"></a>A Sample Program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#a-sample-program" title="Direct link to heading">#</a></h3><p>Suppose we have the following program:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>That looks like an interesting little baby program and it appears as though it would once again print that most famous of salutations, &quot;Hello, world&quot;.</p><p>Well, it doesn&#x27;t.  At least, not yet.  Let&#x27;s walk through the various things that are going to go wrong as this will teach us everything we need to know about activating CQL from some environment of your choice.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="providing-a-suitable-database"></a>Providing a Suitable Database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#providing-a-suitable-database" title="Direct link to heading">#</a></h3><p>CQL is just a compiler, it doesn&#x27;t know how the code it creates will be provisioned any more than say clang does.
It creates functions with predictable signatures so that they can be called from C just as easily as the SQLite API
itself, and using the same currency.  Our new version of <code>hello</code> now requires a database handle because it performs
database operations.  Also there are now opportunities for the database operations to fail, and so <code>hello</code> now provides a
return code.</p><p>A new minimal <code>main</code> program might look something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;stdlib.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;sqlite3.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, char **argv)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *db;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int rc = sqlite3_open(&quot;:memory:&quot;, &amp;db);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (rc != SQLITE_OK) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit(1); /* not exactly world class error handling but that isn&#x27;t the point */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rc = hello(db);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (rc != SQLITE_OK) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit(2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3_close(db);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>If we re-run CQL and look in the <code>hello.h</code> output file we&#x27;ll see that the declaration of the <code>hello</code> function is now:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_code hello(sqlite3 *_db_);</span></div></div></div></div></div><p>indicating that the database is used and a SQLite return code is provided.  We&#x27;re nearly there.  If you attempt
to build the program as before there will be several link-time errors due to missing functions.  Typically these
are resolved by providing the SQLite library to the command line and also adding the CQL runtime.
The new command line looks something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c cqlrt.c -lsqlite3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Hello, world</span></div></div></div></div></div><p>The cql runtime can be anywhere you want it to be, and of course the usual C seperate compilation methods
can be applied. More on that later.</p><p>But actually, that program doesn&#x27;t quite work yet.  If you run it, you&#x27;ll get an error result code, not the message
&quot;Hello, world&quot;.</p><p>Let&#x27;s talk about the final missing bit.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaring-schema"></a>Declaring Schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaring-schema" title="Direct link to heading">#</a></h3><p>In CQL a loose piece of Data Definition Language (henceforth DDL) does not actually create or drop anything.
In most CQL programs,  the normal situation is that &quot;something&quot; has already created the database and put some
data in it.  You need to tell the CQL compiler about the schema so that it knows what the tables are and what to
expect to find in those tables.  This is because typically you&#x27;re reconnecting to some sort of existing database.
So, in CQL, loose DDL simply <em>declares</em> schema, it does not create it.  To create schema you have to put the DDL
into a procedure you can run.  If you do that, then the DDL still serves a declaration, but also the schema will be
created when the procedure is executed.</p><p>We need to change our program a tiny bit.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>If we rebuild the program, it will now behave as expected.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="explaining-the-new-hello-world"></a>Explaining The New Hello World<a aria-hidden="true" tabindex="-1" class="hash-link" href="#explaining-the-new-hello-world" title="Direct link to heading">#</a></h3><p>Let&#x27;s go over every important line of the new program, starting from main.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int rc = sqlite3_open(&quot;:memory:&quot;, &amp;db);</span></div></div></div></div></div><p>This statement gives us an empty private in-memory only database to work with.  This is the simplest case
and it&#x27;s still very useful.  The <code>sqlite_open</code> and <code>sqlite_open_v2</code> functions can be used to create a variety of
databases per the SQLite documentation.</p><p>We&#x27;ll need such a database to use our procedure, and we use it in the call here:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rc = hello(db);</span></div></div></div></div></div><p>This provides a valid db handle to our procedure.  Note that the procedure doesn&#x27;t know what database it is
supposed to operate on, it expects to be handed a suitable database on a silver platter.  In fact any given proc
could be used with various databases at various times.  Just like SQLite, CQL does not enforce any particular
database setup;  it does what you tell it to.</p><p>When <code>hello</code> runs we begin with</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This will create the <code>my_data</code> table with a single column <code>t</code>, of type <code>text not null</code>.  That will work because
we know we&#x27;re going to be called with a fresh/empty database.  More typically you might do <code>create table if not exists ...</code> or otherwise have a general attach/create phase or something like that.  We&#x27;ll dispense with that here.</p><p>Next we&#x27;ll run the insert statement:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This will add a single row to the table.  Note that we have again used double quotes, meaning this is a C string literal.  This is highly convenient given the escape sequences.  Normally SQLite text has the newlines directly embedded in it; that practice isn&#x27;t very compiler friendly, hence the alternative.</p><p>Next we declare a local variable to hold our data.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is a simple string reference, it will be initialized to <code>NULL</code> by default.  That&#x27;s actually important;
even though the variable is <code>NOT NULL</code> there is no reasonable default value for it other than <code>NULL</code>.
The <code>NOT NULL</code> declaration will guard against <code>NULL</code> assignments but it will not prevent reference types
from beginning with <code>NULL</code> as their value.  Junk would be worse and some random initialized value
would create unnecessary cost.  This mirrors the choice the C language makes with its <code>_Nonnull</code> extensions.</p><p>At this point we can read back our data.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This form of database reading has very limited usability but it does work for this case and it is illustrative.
The presence of <code>(select ...)</code> indicates to the CQL compiler that parenthesized expression should be given to
SQLite for evaluation according to the SQLite rules.  The expression is statically checked at compile time to
ensure that it has exactly one result column. In this case the <code>*</code> is just column <code>t</code>, and actually it would have
be clearer to use <code>t</code> directly here but then there wouldn&#x27;t have a reason to talk about <code>*</code> and multiple columns.
At run time, the <code>select</code> query must return exactly one row or an error code will be returned.  It&#x27;s not uncommmon
to see <code>(select ... limit 1)</code> to force the issue.  But that still leaves the possibility of zero rows, which would be an error.  We&#x27;ll talk about more flexible ways to read from the database later.</p><p>At this point it seems wise to bring up the unusual expression evaluation properties of CQL.
CQL is by necessity a two-headed beast.  On the one side there is a rich expression evaluation language for
working with local variables. Those expressions are compiled into C logic that emulates the behavior of SQLite
on the data.  It provides complex expression constructs such <code>IN</code> and <code>CASE</code> but it is ultimately evaluated by C
execution.  Alternately, anything that is inside of a piece of SQL is necessarily evaluated by SQLite itself.  To make this clearer let&#x27;s change the example a little bit before we move on.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;__&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token number" style="color:rgb(247, 140, 108)">1.234</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is a somewhat silly example but it illustrates some important things:</p><ul><li>even though SQLite doesn&#x27;t support double quotes that&#x27;s no problem because CQL will convert the expression into single quotes with the correct escape values as a matter of course during compilation</li><li>the <code>||</code> concatenation operator is evaluated by SQLite</li><li>you can mix and match both kinds of string literals, they will be all be the single quote variety by the time SQLite sees them</li><li>the <code>||</code> operator has lots of complex formatting conversions (such as converting real values to strings)</li><li>in fact the conversions are so subtle as to be impossible to emulate in loose C code with any economy, so, like a few other operators, <code>||</code> is only supported in the SQLite context</li></ul><p>Returning now to our code as written, we see something very familiar:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Note we&#x27;ve used the single quote syntax here for no good reason other than illustration. There are no escape
sequences here so either form would the job. Importantly, the string literal will not create a string object as before
but the text variable <code>t</code> is of course a string reference.  Before it can be used in a call to an un-declared function it
must be converted into a temporary C string.  This might require allocation in general, that allocation is automatically
managed.  Note that by default CQL assumes that calls to unknown C functions should be emitted as written.  In this way you can use <code>printf</code> even though CQL knows nothing about it.</p><p>Lastly we have:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is not strictly necessary because the database is in memory anyway and the program is about to exit but there
it is for illustration.</p><p>Now the Data Manipulation Langauge (i.e. insert and select here; and henceforth DML) and the DDL might fail for various reasons.  If that happens the proc will <code>goto</code> a cleanup handler and return the failed return code instead of running the rest of the code.  Any temporary memory allocations will be freed and any pending
SQLite statements will be finalized.  More on that later when we discuss error handling.</p><p>With that we have a much more complicated program that prints &quot;Hello, world&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="introducing-cursors"></a>Introducing Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introducing-cursors" title="Direct link to heading">#</a></h3><p>In order to read data with reasonable flexibility, we need a more powerful construction.
Let&#x27;s change our example again and start using some database features.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pos </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    txt </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;There&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">close</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Reviewing the essential parts of the above.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pos </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    txt </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The table now includes a position column to give us some ordering.  That is the primary key.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The insert statements provide both columns, not in the printed order.  The insert form where the columns are not
specified indicates that all the columns will be present, in order, this is more economical to type.  CQL will generate errors at compile time if there are any missing columns or if any of the values are not type compatible with the indicated column.</p><p>The most important change is here:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>We&#x27;ve created a non-scalar variable <code>C</code>, a cursor over the indicated result set.  The results will be ordered by <code>pos</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This loop will run until there are no results left (it might not run at all if there are zero rows, that is not an error).  The <code>FETCH</code> construct allows you to specify target variables, but if you do not do so, then a synethetic structure is
automatically created to capture the projection of the <code>select</code>.  In this case the columns are <code>pos</code> and <code>txt</code>.
The automatically created storage exactly matches the type of the columns in the select list which could itself be tricky to calculate if the <code>select</code> is complex.  In this case the <code>select</code> is quite simple and the columns of the result directly match the schema for <code>my_data</code>.  An integer and a string reference.  Both not null.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The storage for the cursor is given the same names as the columns of the projection of the select, in this case the columns were not renamed so <code>pos</code> and <code>txt</code> are the fields in the cursor.
Double quotes were used in the format string to get the newline in there easily.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">close</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The cursor is automatically released at the end of the procedure but in this case we&#x27;d like to release it before the
<code>drop table</code> happens so there is an explicit <code>close</code>. This is frequently elided in favor of the automatic cleanup.
There is an <code>open</code> cursor statement as well but it doesn&#x27;t do anything.  It&#x27;s there because many systems have that
construct and it does balance the <code>close</code>.</p><p>If you compile and run this program  you&#x27;ll get this output.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -x c -E hello.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg hello.h hello.c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c cqlrt.c -lsqlite3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">: Hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: There</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">: World</span></div></div></div></div></div><p>So the data was inserted and then sorted.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="going-crazy"></a>Going Crazy<a aria-hidden="true" tabindex="-1" class="hash-link" href="#going-crazy" title="Direct link to heading">#</a></h3><p>We&#x27;ve only scratched the surface of what SQLite can do and most DML constructs are supported by CQL.
This includes common table expressions, and even recursive versions of the same. But remember, when it
comes to DML, the CQL compiler only has to validate the types and figure out what the result shape will be --
SQLite always does all the heavy lifting of evaluation. All of this means with remarkably little additional code,
the example below from the SQLite documentation can be turned into a CQL stored proc using the constructs
we have defined above.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> mandelbrot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is basically one giant select statement</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> recursive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- x from -2.0 to +1.2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      xaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.05</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xaxis </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y from -1.0 to +1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      yaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> yaxis </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- initial seed iteration count 0, at each of the points in the above grid</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> yaxis</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the next point is always iter +1, same (x,y) and the next iteration of z^2 + c</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> iter</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">y</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> cx x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> cy y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- stop condition, the point has escaped OR iteration count &gt; 28</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4.0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> iter </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      m2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- find the last iteration for any given point to get that count</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- convert the iteration count to a printable character, grouping by line</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> group_concat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot; .+*#&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m2 </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> cy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- group all the lines together</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> rtrim</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> line </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- slurp out the data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This code uses all kinds of SQLite features to produce this text:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#*..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####....   +</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##+*##########+.++++</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          .+.</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##################+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">###################+.+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#.....*#####################+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#######++#######################.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+*</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">################################.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#############################################...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+*</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">################################.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#######++#######################.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#.....*#####################+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">###################+.+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          .+.</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##################+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##+*##########+.++++</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####....   +</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####+.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#*..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    +.</span></div></div></div></div></div><p>Which probably doesn&#x27;t come up very often but it does illustrate several things:</p><ul><li><code>WITH RECURSIVE</code> actually provides a full lambda calculus so arbitrary computation is possible</li><li>You can use <code>WITH RECURSIVE</code> to create table expressions that are sequences of numbers easily, with no reference to any real data</li><li>You can announce SQLite builtin functions other than the most standard ones, or SQLite user defined functions with <code>DECLARE SELECT FUNCTION</code> -- this creates a function whose type is known and is only useable inside of SQL evaluation contexts (just like the <code>||</code> operator)<ul><li>in general CQL doesn&#x27;t know what these declared functions do, so it cannot emulate them</li><li>some would be very hard to emulate correctly under the best of circumstances</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-3-expressions-literals-nullability-sensitivity"></a>Chapter 3: Expressions, Literals, Nullability, Sensitivity<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-3-expressions-literals-nullability-sensitivity" title="Direct link to heading">#</a></h2><p>Until this point we&#x27;ve only discussed simple kinds of expressions and as well as variables and table columns marked with <code>NOT NULL</code> . These are indeed the easiest types for CQL to work with as they tend to correspond most directly to the types known to C.  However
SQL provides for many more types of expressions as well as nullable types and these require handling in any language that purports to be like SQL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="expression-examples"></a>Expression Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#expression-examples" title="Direct link to heading">#</a></h3><p>The usual arithmetic operators apply in CQL:</p><p>Example expressions (these are all true)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(1 + 2) * 3 == 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 + 2 * 3 == 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6 / 3 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 - 5 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6 % 5 == 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5 / 2.5 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 &amp; 3 == 2 | 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 &lt;&lt; 2 == 4</span></div></div></div></div></div><p>However, before going any further it&#x27;s important to note that CQL is inherently a two-headed beast.  Expressions are either evaluated by transpiling to C (like the predicate of an IF statement, or a variable assignment) or by sending them to SQLIte for evaluation (like expressions inside a <code>SELECT</code> statement or the <code>WHERE</code> part of a <code>DELETE</code>).</p><p>CQL evaluation rules are designed to be as similar as possible but some variance is inevitable because evaluation is done in two fundamentally different way.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="order-of-evaluation"></a>Order of Evaluation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#order-of-evaluation" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ASSIGNMENT:    :=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_OR:    OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_AND:   AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EQUALITY:      = == != &lt;&gt; IS, IS NOT, IN, NOT IN, LIKE, GLOB, MATCH, REGEXP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INEQUALITY:    &lt;   &lt;=  &gt;   &gt;=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_NOT:   NOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BINARY:        &lt;&lt; &gt;&gt; &amp; |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BETWEEN:       BETWEEN  NOT BETWEEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ADDITION:      + -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MULIPLICATION: * / %</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BINARY_NOT:    ~</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CONCAT:        ||</span></div></div></div></div></div><p>NOTE: the above is NOT the C binding order (!!!)  The Sqlite binding order is used in the language and parens are added in the C output as needed to force that order.   CQL&#x27;s rewriting emits minimal parens in all outputs.  Different parens are often needed for SQL output.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nullability"></a>Nullability<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nullability" title="Direct link to heading">#</a></h3><p>Just as in SQL the absence of <code>NOT NULL</code> implies that <code>NULL</code> is a legal value. Consider this example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> mixed_nulls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  i1 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b1 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  l1 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  r1 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  t1 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bl1 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> b2 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> l2 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> r2 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> bl2 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>ALL of <code>i1</code>, <code>i2</code>, <code>b1</code>, <code>b2</code>, <code>l1</code>, <code>l2</code>, <code>r1</code>, <code>r2</code>, <code>t1</code>, <code>t2</code>, and <code>bl1</code>, <code>bl2</code> are nullable. In some sense variables and columns declared nullable
(by virtual of the missing <code>NOT NULL</code>) are the root sources of nullability in the SQL language.  That and the <code>NULL</code> literal.  Though there are other sources
as we will see.</p><p>In the context of computing the types of expressions, CQL is statically typed and so it must make a decision about the type of any expression based on the type information at hand at compile time.  As a result it handles the static type of an expression conservatively.  If the result might be null then the expression is of a nullable type and the compiled code will include an affordance for the possibility of a null value at runtime.</p><p>The generated code for nullable types is considerably less efficient and so it should be avoided if that is reasonably possible.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="types-of-literals"></a>Types of Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#types-of-literals" title="Direct link to heading">#</a></h3><p>There are a number of literal objects that may be expressed in CQL.  These are as follows:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="string-literals"></a>String Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#string-literals" title="Direct link to heading">#</a></h4><ul><li>A double quoted string is a C style string literal<ul><li>the usual simple C escape sequences are supported, however</li><li>the \xNN form is not supported, nor is the \0NNN octal form supported<ul><li>these are actually invaluable and likely to be supported in the near future</li></ul></li></ul></li><li>a single quoted string is a SQL style string literal<ul><li>No escape sequences are supported other than <code>&#x27;&#x27;</code> to indicate a single quote character</li></ul></li><li>The sequence @FILE(&quot;some_string&quot;) is a special string literal<ul><li>the value of this literal is the path of the current compiland starting at the letters in <code>some_string</code>, or</li><li>the entire path of the current compiland if <code>some_string</code> does not occur in the path</li><li>the purpose of the <code>@FILE</code> construct is to provide a partial path to a file for diagnostics that is consistent even if the file is built in various different root paths on different build machines</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="blob-literals"></a>Blob Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#blob-literals" title="Direct link to heading">#</a></h4><ul><li>SQLite Blob literals are supported in SQL contexts (i.e. where they will be processed by SQLite), CQL produces an error if you attempt to use a blob literal in a loose expression</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="numeric-literals"></a>Numeric Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#numeric-literals" title="Direct link to heading">#</a></h4><ul><li>All numeric literals are considered to be positive; negative numbers are actually a positive literal combined with unary minus (the negation operator)</li><li>Only base 10 literals are supported</li><li>Literals with a decimal point are of type <code>REAL</code> and stored as the C type <code>double</code></li><li>Literals that can fit in a signed integer without loss, and do not end in the letter <code>L</code> are integer literals</li><li>Larger literals, or those ending with the letter <code>L</code> are long integer literals.</li></ul><p>Examples:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.3            -- real</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  2L             -- long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  123456789123   -- long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  123            -- integer</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-null-literal"></a>The NULL literal<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-null-literal" title="Direct link to heading">#</a></h4><p>The use of <code>NULL</code> always gives a nullable result however this literal is special in that it has no storage class. <code>NULL</code> is not numeric, or string but rather mutates into
whatever it is first combined with.   For instance <code>NULL + 1</code> results in a nullable integer.  Because <code>NULL</code> has no primitive type in some cases where type knowledge
is required you might have to use the CAST() function to cast the NULL to a specific type such as <code>CAST(NULL as TEXT)</code>.   This construct guarantees type consistence in cases like <code>SELECT</code> from different sources combined with <code>UNION ALL</code></p><p>Note:  constructs like <code>CAST(NULL as TEXT)</code> are always rewritten to just <code>NULL</code> before going to SQLite as the cast is uninteresting except for the type information which SQLite doesn&#x27;t need/use anyway.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="other-considerations"></a>Other Considerations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#other-considerations" title="Direct link to heading">#</a></h4><p>There are no boolean literals other than the integers <code>0</code> and <code>1</code>.</p><p>The C pre-processor is often combined with CQL in which case the <code>_FILE_</code> and <code>_LINE_</code> directives may be used to create literals; they will be preprocessed into normal literals.</p><p>The use of <code>_FILE_</code> can give surprising results in the presence of build systems, hence the existence of <code>@FILE(...)</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nullability-rules"></a>Nullability Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nullability-rules" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="general-rule"></a>General Rule<a aria-hidden="true" tabindex="-1" class="hash-link" href="#general-rule" title="Direct link to heading">#</a></h4><p>Except as noted in the exceptions below, the result of an operator is nullable if and only if any of its operands
are nullable. This applies no matter the number of operands the operator requires.</p><p>Note: CQL does not do constant folding or other inferencing, it only uses the types of the values</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="identifiers-and-literals"></a>Identifiers and Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#identifiers-and-literals" title="Direct link to heading">#</a></h4><p>Nullable variables and columns are always nullable.  The <code>NULL</code> literal is nullable.  Other literals are not nullable.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="is-and-is-not"></a>IS and IS NOT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#is-and-is-not" title="Direct link to heading">#</a></h4><p>These operators always return a non-null boolean.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="in-and-not-in"></a>IN and NOT IN<a aria-hidden="true" tabindex="-1" class="hash-link" href="#in-and-not-in" title="Direct link to heading">#</a></h4><p>In an expression like <code>needle IN (haystack)</code> the result is always a boolean. The boolean is nullable if and only if <code>needle</code> is nullable. The presence of nulls in the the haystack is irrelevant.</p><p>NOTE: SQLite has slightly different nullability rules for <code>IN</code> and <code>NOT IN</code> q.v.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-when-then-else-end"></a>CASE ..WHEN ..THEN.. ELSE.. END<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-when-then-else-end" title="Direct link to heading">#</a></h4><p>The following rules apply when considering nullability of a <code>CASE</code> expression.</p><ul><li>if there is no <code>ELSE</code> clause, the result is nullable.</li><li>if any of the output values (i.e. any <code>THEN</code> or <code>ELSE</code> values) are nullable, the result is nullable</li><li>otherwise the result is not nullable</li></ul><p>The SQL <code>CASE</code> construct is quite powerful and unlike the C <code>switch</code> statement it is actually an expression.  So it&#x27;s rather more like a highly generalized ternary <code>a ? b : c</code> operator rather than the switch statement.   There can be
arbitrarily many conditions specified each with their own result and the conditions need not be constants and
typically are not.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-ifnull-and-coalesce-functions"></a>The IFNULL and COALESCE Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-ifnull-and-coalesce-functions" title="Direct link to heading">#</a></h4><p>These functions are nullable or non-nullable based on their arguments. If the <code>IFNULL</code> or <code>COALESCE</code> call has
at least one non-nullable argument then the result is non-nullable.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="left-and-right-outer-joins"></a>LEFT and RIGHT OUTER JOINS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#left-and-right-outer-joins" title="Direct link to heading">#</a></h4><p>In most join operations the nullability of each column participating in the join is preserved.  However in a
<code>LEFT OUTER</code> join the columns on the right side of the join are always considered nullable and in a
<code>RIGHT OUTER</code> join the columns on the left side of the join are considered nullable.</p><p>NOTE: CQL does not use constraints in the <code>WHERE</code>, <code>ON</code>, or <code>HAVING</code> clause to infer non-null status even where this would be possible.  CQL does no data-flow at all.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="expression-types"></a>Expression Types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#expression-types" title="Direct link to heading">#</a></h3><p>CQL supports a variety of expressions, nearly everything from the SQLite world.  The following are the various supported operators, they are presented in order from the weakest binding strength to the strongest.
Note that the binding order is NOT the same as C, in some cases it is radically different (e.g. boolean math)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="union-and-union-all"></a>UNION and UNION ALL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#union-and-union-all" title="Direct link to heading">#</a></h4><p>These appear only in the context of <code>SELECT</code> statements.  The arms of a compound select may include <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>WINDOW</code>.  If <code>ORDER BY</code> or <code>LIMIT ... OFFSET</code> are present, these apply to the entire UNION.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>WHERE</code> applies only to the second select in the union.  And each <code>SELECT</code> is evaluated before the the <code>UNION ALL</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>ORDER BY</code> applies to the result of the union, so any results from the 2nd branch will sort before any results from the first branch (because <code>x</code> is constrained in both).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="assignment"></a>Assignment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#assignment" title="Direct link to heading">#</a></h4><p>Assignment only occurs in the <code>UPDATE</code> statement or in the <code>SET</code> statement.  In both cases the left side
is a simple target and the right side is a general expression.  The expression is evaluated before the assignment.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + before AND then :=</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-or"></a>Logical OR<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-or" title="Direct link to heading">#</a></h4><p>The logical <code>OR</code> operator does shortcut evaluation, much like the C <code>||</code> operator (not to be confused with SQL&#x27;s concatenation operator with the same lexeme).</p><p>The truth table for logical <code>OR</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A OR B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-and"></a>Logical AND<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-and" title="Direct link to heading">#</a></h4><p>The logical <code>AND</code> operator does shortcut evaluation, much like the C <code>&amp;&amp;</code> operator, so if the left side is zero the result is 0 and the right side is not evaluated.</p><p>The truth table for logical <code>AND</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A AND B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="between-and-not-between"></a>BETWEEN and NOT BETWEEN<a aria-hidden="true" tabindex="-1" class="hash-link" href="#between-and-not-between" title="Direct link to heading">#</a></h4><p>These are a ternary type operation.  The general forms are:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span></div></div></div></div></div><p>Note that there is an inherent ambiguity in the language because <code>expr2</code> or <code>expr3</code> could be logical expressions that include <code>AND</code>. CQL resolves this ambiguity by insisting that <code>expr2</code> and <code>expr3</code> be &quot;math expressions&quot; in the grammar.</p><p>&quot;Math expressions&quot; consist of:</p><ul><li>bitwise <code>&amp;</code> and <code>|</code></li><li>bitwise left shift or right shift (<code>&lt;&lt;</code> and <code>&gt;&gt;</code>)</li><li>addition (<code>+</code>)</li><li>subtraction (<code>-</code>)</li><li>multiplication (<code>*</code>)</li><li>division (<code>/</code>)</li><li>modulus (<code>%</code>)</li><li>unary negation (<code>-</code>)</li><li>literals</li><li>any parenthesized expression</li></ul><p>Hence:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- oh hell no (syntax error)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all ok</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>These considerations force the grammar to contain special rules for expressions after <code>BETWEEN</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-not"></a>Logical NOT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-not" title="Direct link to heading">#</a></h4><p>The one operand of logical not must be a numeric.  <code>NOT &#x27;x&#x27;</code> is illegal.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="non-ordering-tests-----like-glob-match-in-not-in-is-is-not"></a>Non-ordering tests <code>!=</code>, <code>&lt;&gt;</code>, <code>=</code>, <code>==</code>, <code>LIKE</code>, <code>GLOB</code>, <code>MATCH</code>, <code>IN</code>, <code>NOT IN</code>, <code>IS</code>, <code>IS NOT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#non-ordering-tests-----like-glob-match-in-not-in-is-is-not" title="Direct link to heading">#</a></h4><p>These operations do some non-ordered comparison of their two operands.</p><ul><li><code>IS</code> and <code>IS NOT</code> never return <code>NULL</code>,  So for instance <code>X IS NOT NULL</code> gives the natural answer.  <code>x IS y</code> is true if and only if: 1. both <code>x</code> and <code>y</code> are <code>NULL</code> or 2. if they are equal.</li><li>The other operators return <code>NULL</code> if either operand is <code>NULL</code> and otherwise perform their usual test to produce a boolean</li><li><code>!=</code> and <code>&lt;&gt;</code> are equivalent as are <code>=</code> and <code>==</code></li><li>strings and blobs compare equal based on their value, not their identity (i.e. not the string/blob pointer)</li><li>objects compare equal based on their address, not their content (i.e. reference equality)</li><li><code>MATCH</code> and <code>GLOB</code> only valid in SQL contexts, <code>LIKE</code> can be used in any context (a helper method to do <code>LIKE</code> in C is provided by SQLite, but not the others)</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL == NULL is not 1, it&#x27;s NULL.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL != NULL is not 0, it&#x27;s also NULL.</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ordering-comparisons----"></a>Ordering comparisons &lt;, &gt;, &lt;=, &gt;=<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ordering-comparisons----" title="Direct link to heading">#</a></h4><p>These operators do the usual order comparison of their two operands.</p><ul><li>If either operand is <code>NULL</code> the result is <code>NULL</code></li><li>Objects and Blobs may not be compared with these operands</li><li>Strings are compared based on their value (as with other comparisons) not their address</li><li>Numerics are compared as usual with the usual promotion rules</li></ul><p>NOTE: CQL uses <code>strcmp</code> for string comparison. In SQL expressions the comparison happens in whatever way SQLite has been configured. Typically general purpose string comparison should be done with helper functions that deal with collation and other considerations.  This is a very complex topic and CQL is largely silent on it.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bitwise-operators----"></a>Bitwise operators &lt;&lt;, &gt;&gt;, &amp;, |<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bitwise-operators----" title="Direct link to heading">#</a></h4><p>These are the bit-manipulation operations.  Their binding strength is VERY different than C so beware.
And notably the <code>&amp;</code> operator has the same binding strength as the <code>|</code> operator so they bind left to right,
this is utterly unlike most systems.  Many parenthesis are likely to be needed to get the usual &quot;or of ands&quot; patterns codified correctly.  Likewise the shift operators <code>&lt;&lt;</code> and <code>&gt;&gt;</code> are the same strength as <code>&amp;</code> and <code>|</code> which is very atypical. Consider:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably doesn&#x27;t mean what you think (this is not ambigous, it&#x27;s well defined, but unlike C)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- means the same as the above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably what you intended</span></div></div></div></div></div><p>Note that these operators only work on integer and long integer data.  If any operand is <code>NULL</code> the result is `NULL.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="addition-and-subtraction---"></a>Addition and Subtraction +, -<a aria-hidden="true" tabindex="-1" class="hash-link" href="#addition-and-subtraction---" title="Direct link to heading">#</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type involved as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no adding strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="multiplication-division-modulus---"></a>Multiplication, Division, Modulus *, /, %<a aria-hidden="true" tabindex="-1" class="hash-link" href="#multiplication-division-modulus---" title="Direct link to heading">#</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no multiplying strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><p>EXCEPTION: the <code>%</code> operator doesn&#x27;t make sense on real values, so real values produces an error.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="unary-operators---"></a>Unary operators -, ~<a aria-hidden="true" tabindex="-1" class="hash-link" href="#unary-operators---" title="Direct link to heading">#</a></h4><p>Unary negation (<code>-</code>) and bitwise invert (<code>~</code>) are the strongest binding operators.</p><ul><li>The <code>~</code> operator only works on integer types (not text, not real)</li><li>the usual promotion rules otherwise apply</li><li>if the operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-expressions"></a>CASE Expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-expressions" title="Direct link to heading">#</a></h3><p>The <code>case</code> expression has two major forms and provides a great deal of flexibility in an expression.  You can kind of think of it as the C <code>?:</code> operator on steroids.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this form the expression in the case <code>x</code> here is evaluated exactly once and then compared against each <code>when</code> clause, they must be type compatible with the expression.  The <code>then</code> expression that corresponds is evaluated and becomes the result, or the <code>else</code> expression if present and no <code>when</code> matches.  If there is no else and no match the result is <code>null</code>.</p><p>If that&#x27;s not general enough, there is an alternate form:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;yy&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> z :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The second form, where there is no value before the first <code>when</code> keyword, each <code>when</code> expression is a separate independent boolean expression.  The first one that evaluates to true causes the corresponding <code>then</code> to be evaluated and that becomes the result.  If there are no matches the result is the <code>else</code> expression, or <code>null</code> if there is no <code>else</code>.</p><p>The result types must be compatible and the best type to hold the answer is selected with the usual promotion rules.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="marking-data-as-sensitive"></a>Marking Data as Sensitive<a aria-hidden="true" tabindex="-1" class="hash-link" href="#marking-data-as-sensitive" title="Direct link to heading">#</a></h3><p>CQL supports the notion of &#x27;sensitive&#x27; data in a first class way.  You can think of it as very much like nullability;  It largely begins by tagging data columns with <code>@sensitive</code></p><p>Rather than go through the whole calculus, it&#x27;s easier to understand by a series of examples.  So let&#x27;s start with a table with some sensitive data.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The most obvious thing you might do at this point is create a stored proc that would read data out of that table.  Maybe something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>So looking at that procedure we can see that it&#x27;s reading sensitive data, the result will have some sensitive columns in it.</p><ul><li>the &quot;id&quot; is not sensitive (at least not in this example)</li><li>sens + 1 is sensitive, math on a sensitive field leaves it sensitive</li><li>name is sensitive, it began that way and is unchanged</li><li>&#x27;x&#x27; is just a string literal, it&#x27;s not sensitive</li><li>-sens is sensitive, that&#x27;s more math</li><li>and the between expression is also sensitive</li></ul><p>Generally sensitivity is &quot;radioactive&quot; anything it touches becomes sensitive.  This is very important because even a simple looking boolean expression like <code>is_gay IS NOT NULL</code> must lead to a sensitive result or the whole process would be largely useless.  It has to be basically impossible to wash away sensitivity.</p><p>These rules apply to normal expressions as well as expressions in the context of SQL.  Accordingly:</p><p>Sensitive variables can be declared:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Simple operations on the variables are sensitive</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is sensitive (and the same would be true for any other math)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>IN</code> expression gives you sensitive results if anything about it is sensitive</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Similarly sensitive constructs in <code>CASE</code> expressions result in a sensitive output</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Cast operations preserve sensitivity</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive result</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Aggregate functions likewise preserve sensitivity</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">AVG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>There are many operators that get similar treatment such as <code>COALESCE</code>, <code>IFNULL</code>, <code>IS</code> and <code>IS NOT</code>.</p><p>Things get more interesting when we come to the <code>EXISTS</code> operator:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive if and only if any selected column is sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive because &quot;info&quot; is sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> info </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive because &quot;id&quot; is not sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>If this is making you nervous, it probably should, we need a little more protection because of the way EXISTS is typically used.  The predicates matter, consider the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- id is now sensitive because the predicate of the where clause was sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this expression is now sensitive because id is sensitive in this context</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>In general: if the predicate of a <code>WHERE</code> or <code>HAVING</code> clause is sensitive then all columns in the result become sensitive.</p><p>Similarly when performing joins, if the column specified in the <code>USING</code> clause is sensitive or the predicate of the <code>ON</code> clause is sensitive then the result of the join is considered to be all sensitive columns (even if the columns were not sensitive in the schema).</p><p>Likewise a sensitive expression in <code>LIMIT</code> or <code>OFFSET</code> will result in 100% sensitive columns as these can be used in a <code>WHERE</code>-ish way.  There is no reasonble defense against using <code>LIMIT</code> and testing for the presence or absence of a row as a way to wash away sensitivity so that is a weakness, but the rules that are present are likely to be very helpful.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with ON</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>All of these expression and join propagations are designed to make it impossible to simply wash-away sensitivity with a little bit of math.</p><p>Now we come to enforcement, which boils down to what assignments or &quot;assignment-like&quot; operations we allow.</p><p>If we have these:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare sens integer @sensitive;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare not_sens integer;</span></div></div></div></div></div><p>We can use those as stand-ins for lots of expressions, but the essential calculus goes like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- assigning a sensitive to a sensitive is ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set sens := sens + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- assigning not sensitive data to a sensitive is ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this is needed so you can (e.g.) initialize to zero</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set sens := not_sens;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- not ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set not_sens := sens;</span></div></div></div></div></div><p>Now these &quot;assignments&quot; can happen in a variety of ways:</p><ul><li>you can set an out parameter of your procedure</li><li>when calling a function or procedure, we require:<ul><li>any IN parameters of the target be &quot;assignable&quot; from the value of the argument expression</li><li>any OUT parameters of the target be &quot;assignable&quot; from the procedures type to the argument variable</li><li>any IN/OUT parameters require both the above</li></ul></li></ul><p>Now it&#x27;s possible to write a procedure that accepts sensitive things and returns non-sensitive things.  This is fundamentally necessary because the proc must be able return (e.g.) a success code, or encrypted data, that is not sensitive.  However, if you write the procedure in CQL it, too, will have to follow the assignment rules and so cheating will be quite hard.  The idea here is to make it easy to do handle sensitive data well and make typical mistakes trigger errors.</p><p>With these rules  it&#x27;s possible to compute the the type of procedure result sets and also to enforce IN/OUT parameters.  Since the signature of procedures is conveniently generated with --generate_exports good practices are fairly easy to follow and sensitivity checks flow well into your programs.</p><p>This is a brief summary of CQL semantics for reference types -- those types that are ref counted by the runtime.</p><p>The three reference types are:</p><ul><li>TEXT</li><li>OBJECT</li><li>BLOB</li></ul><p>Each of these has their own macro for <code>retain</code> and <code>release</code> though all three actually turn into the exact same code in all the cu rrent CQL runtime implementations.  In all cases the object is expected to be promptly freed when the reference count falls to zero.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reference-semantics"></a>Reference Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reference-semantics" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stored-procedure-arguments"></a>Stored Procedure Arguments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stored-procedure-arguments" title="Direct link to heading">#</a></h4><ul><li><code>in</code> and <code>inout</code> arguments are not retained on entry to a stored proc</li><li><code>out</code> arguments are assumed to contain garbage and are nulled without retaining on entry</li><li>if your <code>out</code> argument doesn&#x27;t have garbage in it, then it is up to you do <code>release</code> it before you make a call</li><li>When calling a proc with an <code>out</code> argument CQL will <code>release</code> the argument variable before the call site, obeying its own contract</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="local-variables"></a>Local Variables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#local-variables" title="Direct link to heading">#</a></h4><ul><li>assigning to a local variable <code>retains</code> the object, and then does a <code>release</code> on the previous object</li><li>this order is important, all assignments are done in this way in case of aliasing (<code>release</code> first might accidentally free too soon)</li><li>CQL calls <code>release</code> on all local variable when the method exits</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="assigning-to-an-out-parameter-or-a-global-variable"></a>Assigning to an <code>out</code> parameter or a global variable<a aria-hidden="true" tabindex="-1" class="hash-link" href="#assigning-to-an-out-parameter-or-a-global-variable" title="Direct link to heading">#</a></h4><ul><li><code>out,</code>inout<code>parameters, and global variables work just like local variables except that CQL does not call</code>release` at the end of the procedure</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-return-values"></a>Function Return Values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-return-values" title="Direct link to heading">#</a></h3><p>Stored procedures do not return values, they only have <code>out</code> arguments and those are well defined as above.  Functions however are also supported and they can have either <code>get</code> or <code>create</code> semantics</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="get-semantics"></a>Get Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-semantics" title="Direct link to heading">#</a></h4><p>If you declare a function like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare function Getter() object;</span></div></div></div></div></div><p>Then CQL assumes that the returned object should follow the normal rules above, retain/release will balance by the end of the procedure for locals and globals or <code>out</code> arguments could retain the object.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-semantics"></a>Create Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-semantics" title="Direct link to heading">#</a></h4><p>If you declare a function like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare function Getter() create text;</span></div></div></div></div></div><p>Then CQL assumes that the function created a new result which it is now responsible for releasing.  In short the returned object is assumed to arrive with a retain count of 1 already on it.  When CQL stores this return value it will:</p><ul><li>release the object that was present at the storage location (if any)</li><li>copy the returned pointer without further retaining it this one time</li></ul><p>As a result if you store the returned value in a local variable it will be released when the procedure exits (as usual) or if you instead store the result in a global or an out parameter the result will survive to be used later.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="comparison"></a>Comparison<a aria-hidden="true" tabindex="-1" class="hash-link" href="#comparison" title="Direct link to heading">#</a></h3><p>CQL tries to adhere to normal SQL comparison rules but with a C twist.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="blob-and-object"></a><code>BLOB</code> and <code>OBJECT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#blob-and-object" title="Direct link to heading">#</a></h3><p>These types have no value based comparison, so there is no <code>&lt;</code>, <code>&gt;</code> and so forth.</p><p>The following table is useful.  Let&#x27;s suppose there are exactly two objects &#x27;X&#x27; and &#x27;Y&#x27;</p><p>true expressions: <code>X = X</code>   <code>X &lt;&gt; Y</code> <code>Y = Y</code>   <code>Y &lt;&gt; X</code></p><p>false expressions: <code>X = Y</code>  <code>X &lt;&gt; X</code> <code>Y = X</code>  <code>Y &lt;&gt; Y</code></p><p>null expressions: <code>null = null</code>  <code> X &lt;&gt; null</code>   <code>x = null</code> <code>null &lt;&gt; null</code>  <code>Y &lt;&gt; null</code>   <code>y = null</code></p><p><code>null = null</code> resulting in <code>null</code> is particular surprising but consistent with the usual SQL rules.  And again, as in SQL, the <code>IS</code> operator returns true for <code>X IS Y</code> even if both are <code>null</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="text"></a><code>TEXT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#text" title="Direct link to heading">#</a></h3><p>Text has value comparison semantics but normal string comparison is done only with <code>strcmp</code> which is of limited value.  Typically you&#x27;ll want to either delegate the comparison to Sqlite (with <code>(select x &lt; y)</code>) or else use a helper function with a suitable comparison mechanism.</p><p>For text comparisons including equality:</p><p>true:   if and only if both operands are not null and the comparison matches (using strcmp)
false:  if and only if  both operands are not null and the comparison does not match (using strcmp)
null:   if and only if at least one operand is null</p><p>EXAMPLE: <code>&#x27;x&#x27; &lt; &#x27;y&#x27;</code>  is true because <code>strcmp(&quot;x&quot;, &quot;y&quot;) &lt; 0</code></p><p>The <code>IS</code> and <code>IS NOT</code> operators behave similarly to equality and inequality, but never return <code>null</code>.  If <code>X</code> is some value that doesn&#x27;t happen to be <code>null</code> then we have the following:</p><p>true:  <code>null is null</code> <code>X is X</code> <code>X is not null</code> <code>null is not X</code>
false: <code>null is not null</code> <code>X is not X</code> <code>X is null</code> <code>null  is X</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sample-code"></a>Sample Code<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sample-code" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="out-argument-semantics"></a>Out Argument Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-argument-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROC foo_user (OUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *(void **)baz = NULL; // set out arg to non-garbage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(baz, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-with-create-semantics"></a>Function with Create Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-with-create-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() CREATE OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE foo_user (INOUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DECLARE x OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET x := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  x = foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(*baz);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *baz = foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-with-get-semantics"></a>Function with Get Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-with-get-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE foo_user (INOUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DECLARE x OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET x := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(&amp;x, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(baz, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-4-procedures-functions-and-control-flow"></a>Chapter 4: Procedures, Functions, and Control Flow<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-4-procedures-functions-and-control-flow" title="Direct link to heading">#</a></h2><p>All kinds of control flow happens in the context of some procedure, though we&#x27;ve already introduced examples of procedures let&#x27;s
now go over some of the additional aspects we have not yet illustrated.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="out-parameters"></a>Out Parameters<a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-parameters" title="Direct link to heading">#</a></h3><p>Consider this procedure:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> echo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg1 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> arg2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> arg2 :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arg1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here <code>arg2</code> has been declared <code>out</code>.  CQL out parameters are very similar to &quot;by reference&quot; arguments in other langauges and
indeed they compile into a simple pointer reference in the generated C code.  One notable difference is that, in CQL, <code>out</code> parameters
for reference types and nullable types are always set to NULL by default.  This is another way that an otherwise non-null reference
variable can end up with a null in it.</p><p>Looking at the one line in the body of this procedure:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> arg2 :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arg1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The input argument <code>arg1</code> is unconditionally stored in the output.  Note that the <code>in</code> keyword is entirely optional and does
nothing other than perhaps add some clarity.  CQL also supports <code>inout</code> arguments which are expected to contain non-garbage values on
entry.  If the procedure is called from CQL, the compiler will arrange for this to be true.</p><ul><li><code>in</code> arguments contain a valid value</li><li><code>out</code> arguments are assumed to contain garbage and are aggressively cleared on entry</li><li><code>inout</code> arguments contain a valid value</li></ul><p>These invariants are very important when considering how reference types are handled.</p><ul><li><code>in</code> reference arguments are borrowed, CQL will not further retain unless they are stored elsewhere</li><li><code>out</code> reference arguments are assumed to be garbage, they are not released on entry, but instead set to NULL</li><li><code>inout</code> reference arguments are assumed valid at entry</li></ul><p>If CQL changes an <code>out</code> or <code>inout</code> value it first releases the existing value and then retains the new value.
In all cases the caller will ultimately release any non-null out reference either because it was borrowed (<code>in</code>) or
the caller now/still owns it (<code>inout</code> or <code>in</code>).</p><p>Aggressively putting <code>NULL</code> into <code>out</code> argumetns normalizes pointer handling for all <code>out</code> types.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedure-calls"></a>Procedure Calls<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedure-calls" title="Direct link to heading">#</a></h3><p>The usual <code>call</code> syntax is used to invoke a procedure.  It returns no value but it can have any number of <code>out</code> arguments.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  declare scratch integer not null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  call echo(12, scratch);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  scratch == 12; -- true</span></div></div></div></div></div><p>The let&#x27;s go over the most essential bits of control flow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-if-statement"></a>The IF statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-if-statement" title="Direct link to heading">#</a></h3><p>The CQL <code>IF</code> statement has no syntatic ambiguities at the expense of being somewhat more verbose than many other languages.
In CQL the <code>ELSE IF</code> portion is baked into the <code>IF</code> statement, so what you see below is logically a single statement.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> checker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-while-statement"></a>The WHILE statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-while-statement" title="Direct link to heading">#</a></h3><p>What follows is a simple procedure that counts down its input argument.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> looper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>WHILE</code> loop has additional keywords that can be used within it to better control the loop.  A more general
loop might look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> looper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">leave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">continue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Let&#x27;s go over this peculiar loop:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is an immediate sign that there will be an unusual exit condition.  The loop will never end without one because <code>1</code> will never be false.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">leave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now here we&#x27;ve encoded our exit condition a bit strangely we might have done the equivalent job with a normal conditionn in the predicate
part of the <code>while</code> statement but for illustration anyway, when x becomes negative <code>leave</code> will cause us to exit the loop.  This is like
<code>break</code> in C.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">continue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This bit says that on every 100th iteration we go back to the start of the loop.  So the next bit will not run, which is the printing.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Finishing up the control flow, on every 10th iteration we print the value of the loop variable.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-try-catch-and-throw-statements"></a>The TRY, CATCH, and THROW Statements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-try-catch-and-throw-statements" title="Direct link to heading">#</a></h3><p>This example illustrates catching an error from some DML, and recovering rather than letting the error cascade up.
This is the common &quot;upsert&quot; pattern (insert or update)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> upsert_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error!\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Once again, let&#x27;s go over this section by section:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Normally if the <code>insert</code> statement fails, the procedure will exit with a failure result code.  Here, instead,
we prepare to catch that error.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now, having failed to insert, presumably because a row with the provided <code>id</code> already exists, we try to update
that row instead.  However that might also fail, so we  wrap it in another try.  If the update fails, then there is a final catch block:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error!\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here we print a diagnostic message and then use the <code>throw</code> keyword to rethrow the previous failure.  Throw will create a failure in
the current block using the most recent result code from SQLite if it is an error, or else the general <code>SQLITE_ERROR</code> result code
if there is no such error.  In this case the failure code for the <code>update</code> statement will become the result code of the current procedure.</p><p>This leaves only the closing markers:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>If control flow reaches the normal end of the procedure it will return <code>SQLITE_OK</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-as-functions-motivation-and-example"></a>Procedures as Functions: Motivation and Example<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-as-functions-motivation-and-example" title="Direct link to heading">#</a></h3><p>The calling convention for CQL stored procedures often (usually) requires that the procedure returns a result code from SQLite.
This makes it impossible to write a procedure that returns a result like a function, the result position is already used for
the error code.  You can get around this problem by using <code>out</code> arguments as your return codes.  So for instance, this version
of the Fibonacci function is possible.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this works, but it is awkward</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> fib </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The above works, but the notation is very awkward.</p><p>CQL has a &quot;procedures as functions&quot; feature that tries to make this more pleasant by making it possible to use function call notation
on a procedure whose last argument is an <code>out</code> variable.  You simply call the procedure like it was a function and omit the last argument in the call.
A temporary variable is automatically created to hold the result and that temporary becomes the logical return of the function.
For semantic analysis, the result type of the function becomes the type of the <code>out</code> argument.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- rewritten with function call syntax</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> fib </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This form is allowed when:</p><ul><li>all but the last argument of the procedure was specified</li><li>the formal parameter for that last argument was marked with <code>out</code> (neither <code>in</code> nor <code>inout</code> are acceptable)</li><li>the procedure did not also be returning a result set using a <code>select</code> statement or <code>out</code> statement (more on these later)</li></ul><p>If the procedure in question uses SQLite, or calls something that uses SQLite, then it might fail.
If that happens the result code will propagate just like it would have with a the usual <code>call</code> form.
Any failures can be caught with <code>try/catch</code> as usual.
This feature is really only syntatic sugar for the &quot;awkward&quot; form above, but it does allow for slightly better generated C code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-5-types-of-cursors-out-and-out-union-and-fetch-flavors"></a>Chapter 5: Types of Cursors, OUT and OUT UNION, and FETCH flavors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-5-types-of-cursors-out-and-out-union-and-fetch-flavors" title="Direct link to heading">#</a></h2><p>In the previous chapters we have used cursor variables without fully discussing them.
Most of the uses are fairly self-evident but a more exhaustive discussion is also useful.</p><p>First there are three types of cursors, as we will see below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="statement-cursors"></a>Statement Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#statement-cursors" title="Direct link to heading">#</a></h3><p>A statement cursor is based on a SQL <code>SELECT</code> statement.  A full example might look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- elsewhere</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>When compiled, this will result in creating a SQLite statement object (type <code>sqlite_stmt*</code>)
and storing it in a variable called <code>C</code>.  This statement can then be used later in various ways.</p><p>Here&#x27;s perhaps the simplest way to use a cursor:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y  </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This will have the effect of reading one row from the results of the query into
the local variables <code>x</code> and <code>y</code>.</p><p>These variables might then be used to create some output such as</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* note use of double quotes so that \n is legal */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Or any other use.</p><p>More generally, there may or may not be a fetched value.  The cursor variable <code>C</code>
can be used by itself as a virtual boolean indicating the presence of a row.
So a more complete example might be</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nada\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span></div></div></div></div></div><p>And even more generally</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here we read all the rows out and print them.</p><p>Now if the table <code>xy_table</code> had instead had dozens of columns those declarations
would be very verbose and error prone.  And frankly annoying, especially if
the table definition was changing over time.</p><p>To make this a little easier, there are also so-called &#x27;automatic&#x27; cursors.  These
happen implicitly and include all the necessary storage to exactly match
the rows in their statement.  Using the automatic syntax for the above we might get</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>or the equivalent loop form:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>All the necessary local state is automatically created hence &quot;automatic&quot; cursor.
This pattern is generally preferred but the loose variables pattern is in
some sense more general.</p><p>In all the cases if the number or type of variables do not match the select statement,
semantic errors are produced.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="value-cursors"></a>Value Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#value-cursors" title="Direct link to heading">#</a></h3><p>The purpose of value cursors is to make it possible for a stored procedure to
work with structures as a unit rather than field by field.  SQL doesn&#x27;t have
the notion of structure types but structures actually appear pretty directly
in many places:</p><ul><li>the columns of a table are a structure</li><li>the projection of a <code>SELECT</code> statement is a structure</li><li>other things directly derived from the above  (like the columns of a statement cursor)
are likewise structures</li></ul><p>Let&#x27;s first start by how you declare a value cursor.  It is by analogy to one of the structure types above.</p><p>So:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x&#x27;</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_other_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_previously_declared_stored_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Any of those forms define a valid set of columns.  Note that the <code>select</code> example in no way causes the query provided to run. Instead, the select statement is analyzed and the column names and types are computed.  The cursor get the same field names and types.  Nothing happens at run time.
The last example assumes that there is a stored procedure defined somewhere earlier in this translation unit and that procedure returns a result set. The cursor declaration makes a cursor that could receive the result of that procedure.  We&#x27;ll cover
that particular case in more detail below when we deal with the <code>OUT</code> statement.</p><p>Now once we have declared the cursor we can load it with values using <code>fetch</code> in the value form.</p><p>You can load up a cursor from values.  The values must be type-compatible of course.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You can call a procedure that returns a single row:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> my_previously_declared_stored_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You can fetch a cursor from another cursor:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this case D must be an &#x27;automatic&#x27; cursor but it could be coming from a statement.
This lets you copy a row and save it for later.  E.g. you could copy the current max-valued
row into a value cursor and use it after the loop.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">other_stuff</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">somewhere</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">conditions</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">999</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">max </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this could print &lt;other stuff&gt; too</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id:%d value:%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Value cursors are always &#x27;automatic&#x27; -- they have their own storage.</p><p>Value cursors also may or may not be holding a row.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;this will always be true because it starts empty\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>When you call a procedure you may or may not get a row as we&#x27;ll see below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="out-statement"></a>OUT Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-statement" title="Direct link to heading">#</a></h3><p>Value cursors were initially designed to create a convenient way for
a procedure to return a single row from a complex query
without having a crazy number of <code>OUT</code> parameters.  It&#x27;s easiest
to illustrate this with an example.</p><p>The older verbose pattern looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> got_row </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> w </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> got_row :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now you can imagine this gets very annoying if <code>get_a_row</code> has to produce
a couple dozen column values.  And of course you have to get the types
exactly right.  And they might evolve over time.  Joy.</p><p>On the receiving side you get to do something just as annoying:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> w </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> got_row </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> got_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Using the <code>out</code> statement we get the equivalent functionality with a much simplified pattern. It looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>To use it you simply do this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In fact originally the above was the only way to load a value cursor, before
the calculus was generalized. The original form still works, and does both
things in one step:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>OUT</code> statement lets you return a single row economically and
lets you then test if there actually was a row and read the columns.
It infers all the various column names and types so it is resilient
to schema change and generally a lot less error prone than having a
large number of <code>out</code> arguments to your procedure.</p><p>Once you have the result in a value cursor you can do the usual
cursor operations to move it around or otherwise work with it.</p><p>The use of the <code>LIKE</code> keyword to refer to the types of complex entities spread to other
places in CQL as a very useful construct, but it began here with the
need to describe a cursor shape economically, by reference.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="out-union-statement"></a>OUT UNION Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-union-statement" title="Direct link to heading">#</a></h3><p>The semantics of the <code>out</code> statement are that it always producesone row
of output (a procedure can produce no row if an <code>out</code> never actually ran but the procedure does use <code>out</code>).
If an <code>out</code> statement runs more than once the most recent row becomes the result.  So the <code>out</code> statement really does
mirror having one <code>out</code> variable for each column.  This was its intent and procedures
that return at most, or exactly, one row are very common.  However, in general, one row results
do not suffice; you might want to produce a result set from various sources
with maybe arbitary compution in there as well.  For that you need to be able to emit multiple
rows from a computed source.  This is exactly what <code>out union</code> provides.</p><p>Here&#x27;s a (somewhat contrived) example of the kind of thing you can do with this form:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- emit one row for every integer</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In <code>foo</code> above, we make an entire result set out of thin air.  It isn&#x27;t very
interesting but of course any computation would have been possible.</p><p>This pattern is very flexibe as we see below in <code>bar</code> where
we&#x27;re going to merge two different data streams.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stuff </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">other things too</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stuff </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">other things too</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- we&#x27;re going to merge these two queries</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- if both have a row pick the smaller id</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- only C has a row, emit that</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- only D has a row, emit that</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Just like <code>foo</code>, in <code>bar</code>, each time <code>out union</code> runs a new row is accumulated.  Now, if you build
a procedure that ends with a <code>select</code> statement CQL automatically creates a fetcher function
that does exactly the same thing -- it loops over the SQLite statement for the select and fetches
each row, materializing a result.  With <code>out union</code> you take manual control of this process, allowing you
to build arbitrary result sets.  Note that either of <code>C</code> or <code>D</code> above could have been modified, replaced, skipped,
normalized, etc. with any kind of computation.  Even entirely synthetic rows can be computed
and inserted into the output as we saw in <code>foo</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="result-set-cursors"></a>Result Set Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#result-set-cursors" title="Direct link to heading">#</a></h3><p>So <code>OUT UNION</code> makes it possible to create arbitrary result sets using a mix of sources and filtering.  Unfortunately this result type is not a simple row, nor is it a SQLite statement and so while it can produce ordinary result sets for CQL callers, CQL could not itself consume that result type.</p><p>To address this hole, and thereby make it a lot easier to test these result sets (which really is the most interesting use case for re-consuming a a result set) we need an additional cursor type.  The syntax is exactly the same as the statement cursor cases described above but, instead of holding a SQLite statement, the cursor holds a result set pointer and the current/max row numbers.  Stepping through it simply increments the row number and fetches the next row out of the rowset instead of from SQLite.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- reading the above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> reader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or whatever</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>If <code>bar</code> had been created with a <code>select union</code> and <code>order by</code> to merge the results, the above would have worked with <code>C</code> being a standard statement cursor, iterating over the union.   Since <code>foo</code> produces a result set, CQL transparently produces a suitable cursor implementation behind the scenes but otherwise the usage is the same.</p><p>Note this is a lousy way to iterate over rows; you have to materialize the entire result set so that you can just step over it.  Re-consuming like this is not recommended at all for production code but it is ideal for testing result sets that were made with <code>out union</code> which otherwise would require C/C++ to test.  Testing CQL with CQL is generally a lot easier.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reshaping-data-cursor-like-forms"></a>Reshaping Data, Cursor <code>LIKE</code> forms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reshaping-data-cursor-like-forms" title="Direct link to heading">#</a></h3><p>There are lots of cases where you have big rows with many columns and there are various manipulations you need to do.  Some of these choices are emitting extra, related, rows, some of them are altering some of the columns before emitting the rows into the result set for use by some client.</p><p>What follows is a set of useful syntactic sugar constructs that simplify handling complex rows.  The idea is that pretty much anywhere you can specify a list of columns you can instead use the <code>LIKE x</code> construct to get the columns as the appear in object <code>x</code> -- which is usually a cursor.  It’s a lot easier to illustrate with examples, even though these are, again, a bit contrived.</p><p>First we need some table with lots of columns usually the column names are much bigger which makes it all the more important to not have to type them over and over.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> big </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unique</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  c </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  d </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  e </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>We&#x27;re going to emit two rows as the result of this proc.  Easy enough...</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is the shape of the result we want, it&#x27;s some of the columns of &quot;big&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note this query doesn&#x27;t run, we just use it&#x27;s shape to create a cursor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- with those columns.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- fetch the main row, specified by id_</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> main_row </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- now fetch the result columns out of the main row</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- like result means &quot;the column names found in &#x27;result&#x27;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is our first result row</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- now we want the related row, but we only need 2 columns</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> alt_row </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- update some of the fields of the result from the alt result</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- and emit that row</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now let&#x27;s briefly discuss what is above.  The two essential parts are:</p><p><code>fetch result from cursor main_row(like result);</code></p><p>and</p><p><code>update cursor result(like alt_row) from cursor alt_row;</code></p><p>In the first case what we&#x27;re saying is that we want to load the columns of <code>result</code> from <code>main_row</code>
but we only want to take the columns that are actually present in <code>result</code>.  So this is a narrowing
of a wide row into a smaller row.  In this case the smaller row, <code>result</code> is what we want to emit.
We needed the other columns to compute <code>alt_row</code>.</p><p>The second case, what we&#x27;re saying is that we want update <code>result</code> by replacing the columns
found in <code>alt_row</code> with the values in <code>alt_row</code>.   So in this case we&#x27;re writing a smaller cursor
into part of a wider cursor.  Note that we used the <code>update</code> form here becuase it preserves
all other columns.  If we used <code>fetch</code> we would be rewriting the entire row contents, using <code>NULL</code>
if necessary, not desired here.</p><p>Here is the rewritten version of the above procedure; this is what ultimately gets compiled into C.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> main_row </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> alt_row </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Of course you could have typed all that before but when there’s 50 odd columns it gets old fast and it’s very error prone.  The sugar form is going to be 100% correct and much less typing.</p><p>Finally, while I&#x27;ve shown both <code>LIKE</code> forms seperately they can also be used together.  For instance</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The above would mean, &quot;move the columns that are found in <code>X</code> from cursor <code>D</code> to cursor <code>C</code>&quot;, presumably <code>X</code> has columns common to both.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fetch-statement-specifics"></a>Fetch Statement Specifics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetch-statement-specifics" title="Direct link to heading">#</a></h3><p>Many of the examples used the <code>FETCH</code> statement in a sort of demonstrative way that is hopefully self-evident but the statement has many forms and so it&#x27;s wroth going over them specifically.  Below we&#x27;ll use the letters <code>C</code> and <code>D</code> for the names of cursors.  Usually <code>C</code>;</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="for-statement-or-result-set-cursors"></a>For Statement or Result Set Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#for-statement-or-result-set-cursors" title="Direct link to heading">#</a></h4><p>A cursor declared in one of these forms:</p><ul><li><code>declare C for select * from foo;</code></li><li><code>declare C for call foo();</code>  (foo might end with a <code>select</code> or use <code>out union</code>)</li></ul><p>Is either a statement cursor or a result set cursor.  In either case it moves through the results.  You load the next row with</p><ul><li><code>FETCH C</code>, or</li><li><code>FETCH C into x, y, z;</code></li></ul><p>In the first form <code>C</code> is said to be <em>automatic</em> in that it automatically declares the storage needed to hold all its columns.  As mentioned above automatic cursors have storage for their row.</p><p>Having done this fetch you can use C as a scalar variable to see if it holds a row, e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">limit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bingo we have a row</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">whatever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span></div></div></div></div></div><p> You can easily iterate, e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- one time for every row</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">whatever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p> Automatic cursors are so much easier to use than explicit storage that explicit storage is rarely seen.  Storing to <code>out</code> parameters is a case where explicit is ok, the <code>out</code> parameters have to be declared anyway.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="for-value-cursors"></a>For Value Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#for-value-cursors" title="Direct link to heading">#</a></h4><p> A cursor declared in one of these forms:</p><ul><li><p><code>declare C cursor fetch from call foo(args)</code></p><ul><li><code>foo</code> must be a procedure that returns one row with <code>OUT</code></li></ul></li><li><p>`declare C cursor like select 1 id, &quot;x&quot; name;</p></li><li><p><code>declare C cursor like X;</code></p><ul><li>where X is the name of a table, a view, another cursor, or a procedure that returns a structured result</li></ul><p>Is a value cursor.  A value cursor is always <em>automatic</em>, it&#x27;s purpose is to hold a row.  It doesn&#x27;t iterate over anything but it can be re-loaded in a loop.</p></li><li><p><code>fetch C</code> or <code>fetch C into ...</code> is not valid on such a cursor, it doesn&#x27;t have a source to step through</p><p>The canonical ways to load such a cursor is:</p></li><li><p><code>fetch C from call foo(args);</code></p><ul><li><code>foo</code> must be a procedure that returns one row with <code>OUT</code></li></ul></li><li><p><code>fetch C(a,b,c...) from values(x, y, z);</code></p></li></ul><p>The first form is in some sense the origin of value cursor.  Value cursors were added to the language initially to have a way to capture the single row <code>out</code> statement results, much like result set cursors were added to capture procedure results from <code>out union</code>.  In the first form the cursor storage (a C struct) is provided by reference as a hidden out parameter to procedure and the procedure fills it in.  The procedure may or may not use the <code>out</code> statement in its control flow the the cursor might not hold a row.  You can use <code>if C then ...</code> as before to test for a row.</p><p>The second form is more interesting as it allows the cursor to be loaded from arbitary expressions subject to some rules:</p><ul><li>you should think of the cursor as a logical row, it&#x27;s fully loaded or not, therefore you must specify enough columns in the column list to ensure that all <code>NOT NULL</code> columns will get a value</li><li>if not mentioned in the list, NULL will be loaded if possible</li><li>if insufficient columns are named, an error is generated</li><li>if the value types specified are not compatible with the column types mentioned, an error is generated</li></ul><p>With this form, any possible valid cursor values could be set, but many forms of updates that are common would be awkward. So there are various forms of syntatic sugar that are automatically rewitten into the canonical form.  Several standard rewrites happen.</p><ul><li><p><code>fetch C from values(x, y, z)</code></p><ul><li>if no columns are specified this is the same as naming all the columns, in order</li></ul></li><li><p><code>fetch C from arguments</code></p><ul><li>the arguments to the procedure in which this statement appears are used, in order, as the values</li><li>in this case <code>C</code> is also rewritten into <code>C(a,b,c,..)</code></li></ul></li><li><p><code>fetch C from arguments like C</code></p><ul><li>the arguments to the procedure in which this statement appears are used, by name, as the values</li><li>the order in which the arguments appeared no longer matters, the names that match the columsn of C are used if present</li><li>the formal parameter name may have a single trailing underscore (this is what <code>like C</code> would generate)</li><li>e.g. if <code>C</code> has columns <code>a</code> and <code>b</code> then there must exist formals named <code>a</code> or <code>a_</code> and <code>b</code> or <code>b_</code> in any position</li></ul></li><li><p><code>fetch C(a,b) from cursor D(a,b)</code></p><ul><li>the named columns of D are used as the values</li><li>in this case it becomes: `fetch C(a,b) from values(D.a, D.b);</li></ul></li></ul><p>That most recent form does seem like it saves much but recall the first rewrite:</p><ul><li><p><code>fetch C from cursor D</code></p><ul><li>both cursors are expanded into all their columns, creating a copy from one to the other</li><li><code>fetch C from D</code> can be used  if the cursors have the exact same column names and types; it also generates slightly better code and is a common case</li></ul><p>It is very normal to want to use some of the columns of a cursor in a standard way, these <code>like</code> forms do that job.</p></li><li><p><code>fetch C from cursor D(like C)</code></p><ul><li>here <code>D</code> is presumed to be &quot;bigger&quot; than <code>C</code>, in that it has all of the <code>C</code> columns and maybe more.  The <code>like C</code> expands into the names of the <code>C</code> columns so <code>C</code> is loaded from the <code>C</code> part of <code>D</code></li><li>the expansion might be <code>fetch C(a, b, g) from values (D.a, D.b, D.g)</code></li><li><code>D</code> might have had fields <code>c, d, e, f</code> which were not used because they are not in <code>C</code>.</li></ul><p>The symmetric operation, loading some of the columns of a wider cursor can be expressed neatly:</p></li><li><p><code>fetch C(like D) from cursor D</code></p><ul><li>the <code>like D</code> expands into the columns of <code>D</code> causing the cursor to be loaded with what&#x27;s in <code>D</code> and <code>NULL</code> (if needed)</li><li>this might look like <code>fetch C(d1, d2) from values(D.d1, D.d2)</code></li></ul></li></ul><p>Like can be used in both places, for instance suppose <code>E</code> is a cursor that has a subset of the rows of both <code>C</code> and <code>D</code>.  Without ever loading this cursor, just by defining its type you can write a form like this:</p><ul><li><p><code>fetch C(like E) from cursor D(like E)</code></p><ul><li>this means take the column names found in <code>E</code> and copy them from D to C.</li><li>the usual type checking is done of course but the types of the columns in <code>E</code> won&#x27;t matter, only those in <code>C</code> and <code>D</code></li></ul><p>As is mentioned above, the <code>fetch</code> form means to load an entire row into the cursor.  This is important because &quot;half loaded&quot; cursors would be semantically problematic.  However there are many cases where you might like to amend the values of an already loaded cursor.  You can do this with the <code>update</code> form.</p></li><li><p>`update cursor C(a,b,..) from values(1,2,..);</p><ul><li>the update form is a no-op if the cursor is not already loaded with values (!!)</li><li>the columns and values are type checked so a valid row is ensured (or no row)</li><li>all the re-writes above are legal so <code>update cursor C(like D) from D</code> is possible, it is in fact the use-case for which this was designed.</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="calling-procedures-with-bulk-arguments"></a>Calling Procedures with Bulk Arguments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#calling-procedures-with-bulk-arguments" title="Direct link to heading">#</a></h3><p>It&#x27;s often desireable to treat bundles of arguments as a unit, or cursors as a unit, especially calling other procedures.  The patterns above
are very helpful for moving data between cursors, arguments, and the database.  These can be rounded out with similar constructs for
procedure calls as follows.</p><p>First we&#x27;ll define some shapes to use in the examples.  Note that we made <code>U</code> using <code>T</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  z </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As we&#x27;ve seen, we can do this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %d %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>But the following is also possible. It isn&#x27;t an especially fabulous example but of course
it generalizes. The arguments will be <code>x_</code>, <code>y_</code>, and <code>z_</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %d %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now we might want to chain these things together.  This next example uses a cursor to
call <code>p1</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* this is the same as call p(C.x, C.y, C.z) */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>like</code> construct allows you to select some of the arguments, or
some of a cursor to use as arguments.  This next procedure has more arguments
than just <code>T</code>. The arguments will be <code>x_</code>, <code>y_</code>, <code>z_</code>, <code>a_</code>, <code>b_</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* just the args that match T: so this is still call p(x_, y_, z_) */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Or similarly. using a cursor.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* just the columns that match T so this is still call p(C.x, C.y, C.z) */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Note that the <code>from</code> argument forms do not have to be all the arguments.  For instance
you can get columns from two cursors like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>All the varieties can be combined but of course the procedure signature must match.  And
all these forms work in function expressions as well as procedure calls.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a_function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Since these forms are simply syntatic sugar, they can also appear inside of functions in
SQL statements. The variables mentioned will be expanded and become bound variables just
like any other variable that appears in a SQL statement.</p><p>Note the form  x IN (from arguments) is not supported at this time, though this is a realitively
easy addition.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="missing-data-columns-nulls-and-dummy-data"></a>Missing Data Columns, Nulls and Dummy Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#missing-data-columns-nulls-and-dummy-data" title="Direct link to heading">#</a></h3><p>What follows are the rules for columns that are missing.  This are also done by rewriting the AST. There are several options, with the dummy data choices (see below) being really only interesting in test code.  None of what follows applies to the <code>update cursor</code> statement because its purpose is to do partial updates.</p><ul><li>When fetching a row all the columns must come from somewhere, if the column is mentioned or mentioned by rewrite then it must have a value mentioned, or mentioned by rewrite</li><li>For columns that are not mentioned, a NULL value is used if it is legal<ul><li><code>fetch C(a) from values(1)</code> might turn into <code>fetch C(a,b,c,d) from values (1, NULL, NULL, NULL)</code></li></ul></li></ul><p>In addition to the automatic NULL you may add the annotation <code>@dummy_seed([long integer expression])</code>, if present</p><ul><li>the expression is evaluated and stored in the hidden variable <em>seed</em></li><li>all integers, and long integers get <em>seed</em> as their value (possibly truncated)</li><li>booleans get 1 if and only if <em>seed</em> is non-zero</li><li>strings get the name of the string column an underscore and the value as text (e.g.   &quot;myText<em>7&quot; if _seed</em> is 7)</li><li>blobs are not currently supported for dummy data (CQL is missing blob conversions which are needed first)</li></ul><p>This construct is hugely powerful in a loop to create many complete rows with very little effort, even if the schema change over time.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_table </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Now in this example we don&#x27;t need to know anything about <code>my_table</code> other than that it has a column named <code>id</code>.  As the example shows several things.</p><ul><li>we got the shape of the cursor from the table we were inserting into</li><li>you can do your own computation for some of the columns (those named) and leave the unnamed values to be defaulted</li><li>the rewrites mentioned above work for the <code>insert</code> statement as well as <code>fetch</code></li><li>in fact <code>insert into my_table(id) values(i+10000) @dummy_seed(i)</code> would have worked too with no cursor at all<ul><li>bonus, dummy blob data does work in insert statements because SQLite can do the string conversion easily</li><li>the dummy value for a blob is a blob that holds the text of the column name and the text of the seed just like a string column</li></ul></li></ul><p>The <code>@dummy_seed</code> form can be modified with <code>@dummy_nullables</code>, this indicates that rather than using NULL for any nullable value that is missing, CQL should use the seed value.  This overrides the default behavior of using NULL where columns are needed.  Note the NULL filling works a little differently on insert statements.  Since SQLite will provide a NULL if one is legal the column doesn&#x27;t have to be added to the list with a NULL value during rewriting, it can simply be omitted, making the statement smaller.</p><p>Finally for <code>insert</code> statement only, SQLite will normally use the default value of a column if it has one, so there is no need to add missing columsn with default values to the insert statement.  However if you specify <code>@dummy_defaults</code> then columns with a default value will instead be rewritten and they will get <code>_seed_</code> as their value.</p><p>Some examples.  Suppose columns a, b, c are not null;  m, n are nullable; and x, y have defaults.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c) values(7, 1000, 1000);</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000) @dummy_nullables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c, m, n) values(7, 1000, 1000, 1000, 1000);</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000) @dummy_nullables @dummy_defaults</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c, m, n, x, y) values(7, 1000, 1000, 1000, 1000, 1000, 1000);</span></div></div></div></div></div><p>The sugar features on <code>fetch</code>, <code>insert</code>, and <code>update cursor</code> are as symmetric as possible, but again, dummy data is generally only interesting in test code. Dummy  data will continue to give you valid test rows even if columns are added or removed from the tables in question.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-6-calling-procedures-defined-elsewhere"></a>Chapter 6: Calling Procedures Defined Elsewhere<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-6-calling-procedures-defined-elsewhere" title="Direct link to heading">#</a></h2><p>CQL generally doesn&#x27;t see the whole world in one compilation.
In this way it&#x27;s a lot more like say the C compiler than it is like say Java
or C# or something like that.  This means several things:</p><ul><li>You don&#x27;t have to tell CQL about all your schema in all your files,
so particular stored procs can be more encapsulated</li><li>You can have different databases mounted in different places and CQL
won&#x27;t care; you provide the database connection to the stored procedures when you call them, and that database is assumed to have the tables declared in this translation unit</li><li>Several different schema can be maintained by CQL,
even in the same database, and they won&#x27;t know about each other</li></ul><p>To make this possible there are a few interesting features</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaring-procedures-defined-elsewhere"></a>Declaring Procedures Defined Elsewhere<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaring-procedures-defined-elsewhere" title="Direct link to heading">#</a></h3><p>Stored procedures defined in another file can be declared to CQL in various
ways for each major type of stored procedure.  These are covered in
the sections below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="simple-procedures-database-free"></a>Simple Procedures (database free):<a aria-hidden="true" tabindex="-1" class="hash-link" href="#simple-procedures-database-free" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This introduces the symbol name without providing the body.
This has important variations.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-that-use-the-database"></a>Procedures that use the database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-that-use-the-database" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Most procedures you write will use SQLite in some fashion,
maybe a <code>select</code> or something.  The <code>USING TRANSACTION</code> annotation indicates that
the proc in question uses the database and therefore the generated code
will need a database connection in-argument and it will return a SQLite error code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-that-create-a-result-set"></a>Procedures that create a result set<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-that-create-a-result-set" title="Direct link to heading">#</a></h3><p>If the procedure in question is going to use <code>select</code> or <code>call</code> to create a result set,
the type of that result set has to be declared.  An example might look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This says that the procedure takes no arguments (other than the implicit database
connection) and it has an implicit out-argument that can be read to get a result
set with the indicated columns: id, name, rate, type, and size.
This form implies <code>USING TRANSACTION</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-that-return-a-single-row-with-a-value-cursor"></a>Procedures that return a single row with a value cursor<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-that-return-a-single-row-with-a-value-cursor" title="Direct link to heading">#</a></h3><p>If the procedure emits a cursor with the <code>OUT</code> statement to produce a single
row then it can be declared as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This form can have <code>USING TRANSACTION</code>  or not, since it is possible to emit a row with a value cursor and never use the database.  See the previous chapter for details on the <code>OUT</code> statement.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-that-return-a-full-result-set"></a>Procedures that return a full result set<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-that-return-a-full-result-set" title="Direct link to heading">#</a></h3><p>If the procedure emits many rows with the <code>OUT UNION</code> statement to produce a full result set
then it can be declared as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This form can have <code>USING TRANSACTION</code>  or not, since it is possible to emit a rows with a value cursor and never use the database.  See the previous chapter for details on the <code>OUT UNION</code> statement.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="exporting-declared-symbols-automatically"></a>Exporting Declared Symbols Automatically<a aria-hidden="true" tabindex="-1" class="hash-link" href="#exporting-declared-symbols-automatically" title="Direct link to heading">#</a></h3><p>To avoid errors, the declarations for any given file can be automatically created
by adding something like <code>--generate_exports</code> to the command line. This will require an additonal file name to be passed in the <code>--cg</code> portion to capture the exports.</p><p>That file can then be used with <code>#include</code> when you combine the C pre-processor
with CQL as is normally done.</p><p>Nomenclature is perhaps a bit weird here.  You use <code>--generate_exports</code> to export
the stored procedure declarations from the translation units.  Of course those
exported symbols are what you then import in some other module.  Sometimes this
output file is called <code>foo_imports.sql</code> because those exports are of course exactly
what you need to import <code>foo</code>.  You can use whatever convention you like of course,
CQL doesn&#x27;t care.  The full command line might look something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in foo.sql --cg foo.h foo.c foo_imports.sql --generate_exports</span></div></div></div></div></div><p>Using the pre-processor you can get declarations from elsewhere with
a directive like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;foo_imports.sql&quot;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaration-examples"></a>Declaration Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaration-examples" title="Direct link to heading">#</a></h3><p>Here are some more examples directly from the CQL test cases; these are all
auto-generated with <code>--generate_exports</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> out_test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> ii </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outparm_test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_from_view </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> make_view </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> copy_int </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> complex_return </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bool </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   _integer </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   _longint LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   _real </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   _text </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   _nullable_bool </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outint_nullable </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> output </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outint_notnull </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> output </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> obj_proc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> an_object OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_values </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>So far we&#x27;ve avoided discussing the generated C code in any details but here
it seems helpful to show exactly what these declarations correspond to in the
generated C to demystify all this.  There is a very straightforward conversion.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">void test(cql_int32 i);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void out_test(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 *_Nonnull i,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 *_Nonnull ii);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code outparm_test(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 *_Nonnull foo);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code select_from_view_fetch_results(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_from_view_result_set_ref _Nullable *_Nonnull result_set);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code make_view(sqlite3 *_Nonnull _db_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void copy_int(cql_nullable_int32 a, cql_nullable_int32 *_Nonnull b);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code complex_return_fetch_results(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  complex_return_result_set_ref _Nullable *_Nonnull result_set);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code outint_nullable(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 *_Nonnull output,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_bool *_Nonnull result);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code outint_notnull(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 *_Nonnull output,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_bool *_Nonnull result);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void obj_proc(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref _Nullable *_Nonnull an_object);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code insert_values(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 type_);</span></div></div></div></div></div><p>As you can see, these declarations use exactly the normal SQLite
types and so it is very easy to declare a procedure in CQL and then implement it
yourself in straight C, simply by conforming to the contract.</p><p>Importantly, SQLite does not know anything about CQL stored procedures, or anything at all about CQL
really so CQL stored procedure names cannot be used in any way in SQL statements.  CQL
control flow like the <code>call</code> statement can be used to invoke other procedures and
results can be captured by combing the <code>OUT</code> statement and a <code>DECLARE CURSOR</code> construct
but SQLite is not involved in those things.  This is another place where the inherent
two-headed nature of CQL leaks out.</p><p>Finally, this is a good place to reinforce that procedures with any of the structured
result types (<code>select</code>, <code>out</code>, <code>out union</code>) can be used with a suitable cursor.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Can be used two interesting ways:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> meta_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">meta </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> meta </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_other_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Assuming that <code>get_stuff</code> and <code>get_other_stuff</code> have the same shape, then
this procedure simply passes on one or the other&#x27;s result set unmodified
as its own return value.</p><p>But you could do more than simply pass on the result.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> meta_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">meta </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or get_meta_stuff(...)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- do stuff with C</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- may be out union some of the rows after adjustment even</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here we can see that we used the procedure to get the results and then
process them directly somehow.</p><p>And of course the result of an <code>OUT</code> can similarly be processed using
a value cursor as we previously saw.</p><p>These combinations allow for pretty general composition of stored procedures
as long as they are not recombined with SQLite statements.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-7-cql-result-sets"></a>Chapter 7: CQL Result Sets<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-7-cql-result-sets" title="Direct link to heading">#</a></h2><p>Most of this tutorial is about the CQL language itself but here we must diverge a bit.  The purpose of the
result set features of CQL is to create a C interface to SQLite data.  Because of this
there are a lot of essential details that require looking carefully at the generated C code.  Appendix 2
covers this code in even more detail but here it makes sense to at least talk about the interface.</p><p>If we have this simple stored procedure:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> read_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>We&#x27;ve created a simple data reader, this CQL code will cause the compiler to
generated helper functions to read the data and materialize a result set.</p><p>Let&#x27;s look at the public interface of that result set now considering the most essential pieces.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* this is almost everything in the generated header file */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_data_types_count 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_result_set_type_decl(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set, \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_int32 read_foo_get_id(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_bool read_foo_get_b_is_null(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_bool read_foo_get_b_value(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_string_ref _Nullable read_foo_get_t(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   read_foo_result_set_ref  _Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_int32 read_foo_result_count(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_code read_foo_fetch_results(sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable *_Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_row_hash(result_set, row) \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_result_set_get_meta((cql_result_set_ref)(result_set))-&gt;\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rowHash((cql_result_set_ref)(result_set), row)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_row_equal(rs1, row1, rs2, row2) \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_result_set_get_meta((cql_result_set_ref)(rs1)) \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> -&gt;rowsEqual( \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (cql_result_set_ref)(rs1),  row1,  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (cql_result_set_ref)(rs2),  row2)</span></div></div></div></div></div><p>Let&#x27;s consider some of these individually now</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_result_set_type_decl(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref);</span></div></div></div></div></div><p>This declares the data type for <code>read_foo_result_set</code> and the associated object reference <code>read_foo_result_set_ref</code>.
As it turns out the underlying data type for all result sets is the same, only the shape of the data varies.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_code read_foo_fetch_results(sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable *_Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_);</span></div></div></div></div></div><p>The result set fetcher method gives you a <code>read_foo_result_set_ref</code> if it succeeds.  It accepts the <code>id_</code> argument which it
will internally pass along to <code>read_foo(...)</code>.  The latter function provides a <code>sqlite3_stmt*</code> which can then be iterated in the fetcher.
This method is the main public entry point for result sets.</p><p>Once you have a result set, you can read values out of it.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_int32 read_foo_result_count(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set);</span></div></div></div></div></div><p>That function tells you how many rows are in the result set.</p><p>For each row you can use any of the row readers:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_int32 read_foo_get_id(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_bool read_foo_get_b_is_null(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_bool read_foo_get_b_value(read_foo_result_set_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set, cql_int32 row);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern cql_string_ref _Nullable read_foo_get_t(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   read_foo_result_set_ref  _Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   cql_int32 row);</span></div></div></div></div></div><p>These let you read the <code>id</code> of a particular row, and get a <code>cql_int32</code> or you can read the nullable boolean,
using the <code>read_foo_get_b_is_null</code> function first to see if the boolean is null and then <code>read_foo_get_b_value</code>
to get the value.  Finally the string can be accessed with <code>read_foo_get_t</code>.  As you can see there is a
simple naming convention for each of the field readers.</p><p>Note:  The compiler has runtime arrays that control naming conventions as well as using CamelCasing.  Additional customizations may be created by adding new runtime arrays into the CQL compiler.</p><p>Finally, also part of the public interface, are these macros:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_row_hash(result_set, row)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_row_equal(rs1, row1, rs2, row2)</span></div></div></div></div></div><p>These use the CQL runtime to hash a row or compare two rows from identical result
set types.  Metadata included in the result set allows general purpose code to work for
every result set.  Based on configuration, result set copying methods can also
be generated.   When you&#x27;re done with a result set you can use the <code>cql_release(...)</code>
method to free the memory.</p><p>Importantly, all of the rows from the query in the stored procedure are materialized
immediately and become part of the result set.  Potentially large amounts of memory can
be used if a lot of rows are generated.</p><p>The code that actually creates the result set starting from the prepared statement is always the same.
The essential parts are:</p><p>First, a constant array that holds the data types for each column.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t read_foo_data_types[read_foo_data_types_count] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_INT32 | CQL_DATA_TYPE_NOT_NULL, // id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_BOOL, // b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_STRING, // t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><p>All references are stored together at the end of the row, so we only need the count
of references and the offset of the first one to do operations like <code>cql_retain</code> or <code>cql_release</code>
on the row.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_refs_offset cql_offsetof(read_foo_row, t) // count = 1</span></div></div></div></div></div><p>Lastly we need metadata to tell us count of columns and the offset of each column within the row.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">static cql_uint16 read_foo_col_offsets[] = { 3,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, id),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, b),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, t)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><p>Using the above we can now write this fetcher</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">read_foo_fetch_results(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable *_Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3_stmt *stmt = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_profile_start(CRC_read_foo, &amp;read_foo_perf_index);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // we call the original procedure, it gives us a prepared statement</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_code rc = read_foo(_db_, &amp;stmt, id_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // this is everything you need to know to fetch the result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_fetch_info info = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .rc = rc,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .db = _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .stmt = stmt,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .data_types = read_foo_data_types,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .col_offsets = read_foo_col_offsets,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .refs_count = 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .refs_offset = read_foo_refs_offset,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .rowsize = sizeof(read_foo_row),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .crc = CRC_read_foo,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .perf_index = &amp;read_foo_perf_index,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // this function does all the work, it cleans up if .rc is an error code.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return cql_fetch_all_results(&amp;info, (cql_result_set_ref *)result_set);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="results-sets-from-out-union"></a>Results Sets From <code>OUT UNION</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#results-sets-from-out-union" title="Direct link to heading">#</a></h3><p>The <code>out</code> keyword was added for writing procedures that produce a single row result set.  With that, it became possible to make any single row result you wanted, assembling it from whatever sources you needed.  That is an important
case as single row results happen frequently and they are comparatively easy to create and pass around using C
structures for the backing store.  However, it&#x27;s not everything, there are also cases where full flexibility is needed
while producing a standard many-row result set.  For this we have <code>out union</code> which was dicussed fully in Chapter 5.  Here we&#x27;ll discuss the code generation behind that.</p><p>Here’s an example from the CQL tests:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> some_integers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">start</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stop </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> v_squared</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xx&quot;</span><span class="token plain"> some_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> stop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v_squared</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> junk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this example the entire result set is made up out of thin air.  Of course any combination of this computation or data-access is possible, so you can ultimately make any rows you want in any order using SQLite to help you as much or as little as you need.</p><p>Virtually all the code pieces to do this already exist for normal result sets.  The important parts of the output code look like this in your generated C.</p><p>We need a buffer to hold the rows we are going to accumulate;  We use <code>cql_bytebuf</code> just like the normal fetcher above.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// This bit creates a growable buffer to hold the rows</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// This is how we do all the other result sets, too</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_bytebuf _rows_;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_bytebuf_open(&amp;_rows_);</span></div></div></div></div></div><p>We need to be able to copy the cursor into the buffer and retain any internal references</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// This bit is what you get when you &quot;out union&quot; a cursor &quot;C&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// first we +1 any references in the cursor then we copy its bits</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_retain_row(C_);   // a no-op if there is no row in the cursor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (C_._has_row_) cql_bytebuf_append(&amp;_rows_, (const void *)&amp;C_, sizeof(C_));</span></div></div></div></div></div><p>Finally, we make the rowset when the procedure exits. If the procedure is returning with no errors the result set is created, otherwise the buffer is released.  The global <code>some_integers_info</code> has constants that describe the shape produced by this procedure just like the other cases that produce a result set.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_results_from_data(_rc_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      &amp;_rows_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      &amp;some_integers_info,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      (cql_result_set_ref *)_result_set_);</span></div></div></div></div></div><p>The operations here are basically the same ones that will happen inside of the standard helper
<code>cql_fetch_all_results</code>, the difference is of course that you write the loop manually and therefore have
full control of the rows as they go in to the result set.</p><p>In short, the overhead is pretty low.  What you’re left with is pretty much the base cost of your algorithm.  The cost here is very similar to what it would be for any other thing that make rows.</p><p>Of course, if you make a million rows, well, that would burn a lot of memory.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-8-functions"></a>Chapter 8: Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-8-functions" title="Direct link to heading">#</a></h2><p>CQL stored procs have a very simple contract so it is easy to declare procedures and then implement them in regular C, the C functions just have to conform to the contract.  However, there is no notion of functions at all and this makes it very inconvenient to use some external code and is not doing database things and wants to return values.  Even a random number generator or something would be difficult to use because it could not be called in the context of an expression.  To allow for this CQL adds declared functions</p><p>In an other example of the two-headed nature of CQL, there are two ways to declare functions.  As we have already
seen you can make function-like procedures and call them like functions simply by making a procedure with an <code>out</code> parameter. However, there are also cases where it is reasonable to make function calls to external functions of other kinds.  There are three major types of functions you might wish to call.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ordinary-scalar-functions"></a>Ordinary Scalar Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ordinary-scalar-functions" title="Direct link to heading">#</a></h4><p>These functions are written in regular C and provide for the ability to do operations on in-memory objects.  For instance,
you could create functions that allow you to read and write from a dictionary.  You can declare these functions like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Such a function is not known to SQLite and therefore cannot appear in SQL statements.  CQL will enforce this.</p><p>The above function returns a text reference, and, importantly, this is a borrowed reference.  The dictionary
is presumably holding on to the reference and as long as it is not mutated the reference is valid.  CQL will
retain this reference as soon as it is stored and release it automatically when it is out of scope.  So, in
this case, the dictionary continues to own the object.</p><p>It is also possible to declare functions that create objects.  Such as this example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This declaration tells CQL that the function will create a new object for our use.  CQL does not retain the
provided object, rather assuming ownership of the presumably one reference count the object already has.
When the object goes out of scope it is release as usual.</p><p>If we also declare this procedure:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Then with this family of declarations we could write something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> create_and_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> dict :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dict_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict_get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dict__get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k2)) then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    call printf(&quot;</span><span class="token plain">insanity has ensued\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Note: Ordinary scalar functions may not use the database in any way, when they are invoked they will not
be provided with the database pointer and so they will be unable to do any database operations.  To do
database operations use regular procedures.  You can create a function-like-procedure using the <code>out</code> convention
discussed previously.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sql-scalar-functions"></a>SQL Scalar Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sql-scalar-functions" title="Direct link to heading">#</a></h4><p>SQLite includes the ability to add new functions to its expressions using <code>sqlite3_create_function</code>.  In
order to use this function in CQL, you must also provide its prototype definition to the compiler.  You
can do so like in this example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> strencode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This introduces the function <code>strencode</code> to the compiler for use in SQL constructs.  With this done you
could write a procedure something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> strencode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This presumably returns the &quot;encoded&quot; text, whatever that might be.  Note that if <code>sqlite3_create_function</code>
is not called before this code runs, a run-time error will ensue.  Just as CQL must assume that declared
tables really are created, it also assumes that declared function really are created.  This is another case
of telling the compiler in advance what the situation will be at runtime.</p><p>SQLite allows for many flexible kinds of user defined functions.  CQL doesn&#x27;t concern itself with the details of the implementation of the function, it only needs the signature so that it can validate calls.</p><p>See <a href="https://www.sqlite.org/c3ref/create_function.html" target="_blank" rel="noopener noreferrer">Create Or Redefine SQL Functions</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sql-table-valued-functions"></a>SQL Table Valued Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sql-table-valued-functions" title="Direct link to heading">#</a></h4><p>More recent versions of SQLite also include the ability to add table-valued functions to statements in place of actual tables. These functions can use their arguments to create a &quot;virtual table&quot; value for use in place of a table.  For this
to work, again SQLite must be told of the existence of the table.  There are a series of steps to make this happen
beginning with <code>sqlite3_create_module</code> which are described in the SQLite documents under &quot;The Virtual Table Mechanism Of SQLite.&quot;</p><p>Once that has been done, a table-valued function can be defined for most object types.  For instance it is possible to
create a table-valued function like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">k </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is just like the previous type of select function but the return type is a table shape.  Once the above has been done you can legally write something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> read_dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> pattern </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> pattern </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">k </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This construct is very general indeed but the runtime set up for it is much more complicated than scalar functions
and only more modern versions of SQLite even support it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="notes-on-builtin-functions"></a>Notes on Builtin Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes-on-builtin-functions" title="Direct link to heading">#</a></h3><p>Some of the SQLite builtin functions are hard-coded,  these are the functions that have semantics that are not readily captured with a simple prototype.  Other SQLite functions can be declared wtih <code>declare select funtion ...</code> and then used.</p><p>CQL&#x27;s hard-coded builtin list includes:</p><p><em>Aggregate Functions</em></p><ul><li>count</li><li>max</li><li>min</li><li>sum</li><li>total</li><li>avg</li><li>average</li><li>group_concat</li></ul><p><em>Scalar Functions</em></p><ul><li>ifnull</li><li>nullif</li><li>upper</li><li>char</li><li>abs</li><li>instr</li><li>coalesce</li><li>last_insert_rowid</li><li>printf</li><li>strftime</li><li>date</li><li>time</li><li>datetime</li><li>julianday</li><li>substr</li><li>trim</li><li>ltrim</li><li>rtrim</li></ul><p><em>Window Functions</em></p><ul><li>row_number</li><li>rank</li><li>dense_rank</li><li>percent_rank</li><li>cume_dist</li><li>ntile</li><li>lag</li><li>lead</li><li>first_value</li><li>last_value</li><li>nth_value</li></ul><p>Special Functions</p><ul><li>nullable</li><li>ptr</li></ul><p><code>Nullable</code> casts an operand to the nullable version of its type and otherwise does nothing.  This cast might be useful if you need an exact type match in a situation.  It is stripped from any generated SQL and generated C so it has no runtime effect at all other than the indirect consequences of changing the storage class of its operand.</p><p><code>Ptr</code> is used to cause a reference type variable to be bound as a long integer to SQLite. This is a way of giving object pointers to SQLite UDFs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-9-statements-summary-and-error-checking"></a>Chapter 9: Statements Summary and Error Checking<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-9-statements-summary-and-error-checking" title="Direct link to heading">#</a></h2><p>The following is a brief discussion of the major statement types and the semantic rules that CQL enforces for each of the statements.  A detailed discussion of SQL statements (the bulk of these) is beyond the scope of this document and you should refer to the SQLite documentation for most details.  However, in many cases CQL does provide additional enforcement and it is helpful to describe the basic checking that happens for each fragment of CQL.  A much
more authoritative list of the things CQL checks for can be inferred from the error documentation.  &quot;Tricky&quot; errors have examples and suggested remediation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-primary-sql-statements"></a>The Primary SQL Statements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-primary-sql-statements" title="Direct link to heading">#</a></h3><p>These are roughly, the statements that involve the database.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-select-statement"></a>The <code>SELECT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-select-statement" title="Direct link to heading">#</a></h4><p>Top level statement list processing for select.  This is easily the hardest
statement to process. Each clause has its own set of complex rules and
the result of previous clauses constrains the next in a complex fashion.
Among the things that are verified:</p><ul><li>the mentioned tables exist and have the mentioned columns</li><li>the columns are type compatible in their context</li><li>any variables in the expressions are compatible</li><li>aggregate functions are used only in places where aggregation makes sense</li><li>column and table names are unambiguous, especially when self-joins are involved</li><li>compound selects (e.g. with UNION) are type-consistent in all the fragments</li><li>the projection of a select has unique column labels if they are used</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-select--statement"></a>The <code>SELECT *</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-select--statement" title="Direct link to heading">#</a></h4><p>Select <em> is special in that it creates its own struct type by assembling
all the columns of all the tables in the selects join result.  CQL rewrites these statement into
a select with the specific columns explicitly listed.  While this makes the program
slightly bigger it means that logically deleted columns are never present in results
because `SELECT </em>` won&#x27;t select them and attempting to use a logically deleted
column results in an error.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-create-table-statement"></a>The <code>CREATE TABLE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-create-table-statement" title="Direct link to heading">#</a></h4><p>Unlike the other parts of DDL we actually deeply care about the tables.
We have to grab all the columns and column types out of it and create
the appropriate structure type for the table.
Along the way we validate a bunch of stuff like:</p><ul><li>verify unique table name</li><li>no duplicate column names</li><li>recursive correctness of constraints (see constraints discussion below)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-create-index-statement"></a>The <code>CREATE INDEX</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-create-index-statement" title="Direct link to heading">#</a></h4><p>CQL doesn&#x27;t really do anything with indices but we do validate that they make sense (so we lookup all the names of all the columns and so forth).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-create-view-statement"></a>The <code>CREATE VIEW</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-create-view-statement" title="Direct link to heading">#</a></h4><p>Create view analysis is very simple because the <code>select</code> analysis does the heavy lifting.  All we
have to do is validate that the view is unique, then validate the select statement.</p><p>Additionally, views must not be allowed to have any NULL type columns, all nulls must be converted to
some type with a CAST.   e.g. <code>create view foo as select NULL n</code> is not valid.  NULL is not a real storage type.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-create-trigger-statement"></a>The <code>CREATE TRIGGER</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-create-trigger-statement" title="Direct link to heading">#</a></h4><p>The create trigger statement is quite a beast, validations include:</p><ul><li>the trigger name must be unique</li><li>For <code>insert</code> the &quot;new.*&quot; table is available in expressions/statement</li><li>For <code>delete</code> the &quot;old.*&quot; table is available in expressions/statements</li><li>For <code>update</code> both are available<ul><li>If optional columns present in the <code>update</code>, they must be unique/valid</li></ul></li><li>The <code>when</code> expression must evaluate to a numeric</li><li>The statement list must be error free with the usual rules plus new/old</li><li>The <code>raise</code> function may be used inside a trigger (NYI)</li><li>The table name must be a table (not a view) UNLESS the trigger type is <code>INSTEAD OF</code></li><li>select statements inside the statement block do not count as returns for the procedure that includes the create trigger</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-drop-table-statement"></a>The <code>DROP TABLE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-drop-table-statement" title="Direct link to heading">#</a></h4><p>This is the basic checking for the drop table statement:</p><ul><li>the table must exist in some version</li><li>it has to be a table and not a view</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-drop-view-statement"></a>The <code>DROP VIEW</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-drop-view-statement" title="Direct link to heading">#</a></h4><p>This is the basic checking for the drop view statement:</p><ul><li>the view must exist in some version</li><li>it has to be a view and not a table</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-drop-index-statement"></a>The <code>DROP INDEX</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-drop-index-statement" title="Direct link to heading">#</a></h4><p>This is the basic checking for the drop index statement:</p><ul><li>the index must exist in some version</li><li>it could be deleted now, that&#x27;s ok, but the name has to be valid</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-drop-trigger-statement"></a>The <code>DROP TRIGGER</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-drop-trigger-statement" title="Direct link to heading">#</a></h4><p>This is the basic checking for the drop trigger statement</p><ul><li>the trigger  must exist in some version</li><li>it could be deleted now, that&#x27;s ok, but the name has to be valid</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-unique-key-clause"></a>The <code>UNIQUE KEY</code> Clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-unique-key-clause" title="Direct link to heading">#</a></h4><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again we use the usual helpers
for name lookup within the context of the table that contains the constraint.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-foreign-key-clause"></a>The <code>FOREIGN KEY</code> Clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-foreign-key-clause" title="Direct link to heading">#</a></h4><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again we use the usual helpers
for name lookup within the context of the table with the foreign key.
Note that the foreign has to be validated against two tables to fully validate it.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-primary-key-clause"></a>The <code>PRIMARY KEY</code> Clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-primary-key-clause" title="Direct link to heading">#</a></h4><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again we use the usual helpers
for name lookup within the context of the table with the primary key.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-raise-statement"></a>The <code>RAISE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-raise-statement" title="Direct link to heading">#</a></h4><p>CQL validates that <code>RAISE</code> is being used in the context of a trigger and that
it has the correct arguments.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-alter-table-add-column-statement"></a>The <code>ALTER TABLE ADD COLUMN</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-alter-table-add-column-statement" title="Direct link to heading">#</a></h4><p>To validate <code>alter table add column</code> we check the following:</p><ul><li>the table must exist and not be a view (in any version)</li><li>the column definition of the new column must be self-consistent</li><li>no auto increment columns may be added</li><li>added columns must be either nullable or have a default value</li></ul><p>Note: Alter statements are typically used in the context of migration so it&#x27;s
possible the table that is mentioned is condemned in a future version.  We still have to run
the intervening upgrade steps so basically DDL gets to ignore the current deadness
of the table as in context it&#x27;s might be &quot;not dead yet&quot;.  This will be more obvious
in the context of the schema maintenance features. (q.v.)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-delete-statement"></a>The <code>DELETE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-delete-statement" title="Direct link to heading">#</a></h4><p>The delete analyzer sets up a scope for the table being
deleted and the validates the WHERE clause if present against that scope.
Additionally we verify that the table actually was defined and is not a view.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-update-statement"></a>The <code>UPDATE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-update-statement" title="Direct link to heading">#</a></h4><p>The update analyzer sets up the scope for the table(s) being updated.  If there are
optional clauses (e.g. <code>LIMIT</code>) they are evaluated just like in a select statement
with those same helper methods.  Expression fragments are evaluated just as
in a select statement.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-insert-statement"></a>The <code>INSERT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-insert-statement" title="Direct link to heading">#</a></h4><p>We check that the table exists and then we walk the columns and the value list
to make sure they are valid for the table. Also we cannot insert into a view.</p><p>Details:</p><ul><li>The column list specifies the columns we will provide, they must exist and be unique.</li><li>The columns specified must suffice to insert a row (all not nulls and not default present)</li><li>The insert list specifies the values that are to be inserted.</li><li>The type of each value must match the type of the column.</li><li>Autoinc columns may be specified as NULL.</li><li>If there are too many or too few columns, that is an error.</li><li>If no columns are specified that is the same as if all columns had been specified, in table order</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-throw-statement"></a>The <code>THROW</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-throw-statement" title="Direct link to heading">#</a></h4><p>Throw can literally go anywhere, so it&#x27;s always ok.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-begin-transaction-statement"></a>The <code>BEGIN TRANSACTION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-begin-transaction-statement" title="Direct link to heading">#</a></h4><p>Begin transaction can go anywhere, it&#x27;s always ok.</p><p>The sqlite documentation can be helpful (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-commit-transaction-statement"></a>The <code>COMMIT TRANSACTION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-commit-transaction-statement" title="Direct link to heading">#</a></h4><p>Commit transaction can go anywhere, it&#x27;s always ok.</p><p>The sqlite documentation can be helpful (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-rollback-transaction-statement"></a>The <code>ROLLBACK TRANSACTION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-rollback-transaction-statement" title="Direct link to heading">#</a></h4><p>Rollback trans can go anywhere but if you&#x27;re using the format
where you rollback to a particular save point then we must have
seen that name in a <code>savepoint</code> statement previously or it&#x27;s an error.</p><p>The sqlite documentation can be helpful (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-savepoint-statement"></a>The <code>SAVEPOINT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-savepoint-statement" title="Direct link to heading">#</a></h4><p>The <code>savepoint</code> statement can go anywhere but we do record this savepoint name
as having been seen so we can verify it in rollback.  So this is sort of a weak declaration of the savepoint name.</p><p>The sqlite documentation can be helpful (CQL syntax is a subset).  <a href="https://www.sqlite.org/lang_savepoint.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_savepoint.html</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-release-savepoint-statement"></a>The <code>RELEASE SAVEPOINT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-release-savepoint-statement" title="Direct link to heading">#</a></h4><p>Release savepoint can go anywhere but we must have
seen that name in a previous <code>savepoint</code> statement or it&#x27;s an error.</p><p>The sqlite documentation can be helpful (CQL syntax is a subset). <a href="https://www.sqlite.org/lang_savepoint.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_savepoint.html</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-primary-procedure-statements"></a>The Primary Procedure Statements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-primary-procedure-statements" title="Direct link to heading">#</a></h3><p>These are the statements which form the language of procedures, and do not involve the database.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-create-procedure-statement"></a>The <code>CREATE PROCEDURE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-create-procedure-statement" title="Direct link to heading">#</a></h4><p>Semantic analysis of stored procedures is fairly easy at the core:</p><ul><li>check for duplicate names</li><li>validate the parameters are well formed</li><li>set the current proc in flight (this not allowed to nest)</li><li>recurse on the statement list and prop errors</li><li>record the name of the procedure for callers
In addition, while processing the statement:</li><li>we determine if it uses the database, this will change the emitted signature of the proc to include a <code>sqlite3 *db</code>
input argument and it will return a sqlite error code (e.g. <code>SQLITE_OK</code>)</li><li>select statements that are loose in the proc represent the &quot;return&quot; of that
select;  this changes the signature to include a <code>sqlite3_stmt **pstmt</code> parameter corresponding to the returned statement</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-if-statement-1"></a>The <code>IF</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-if-statement-1" title="Direct link to heading">#</a></h4><p>The top level if node links the initial condition with a possible
series of else_if nodes and then the else node.  Each condition is
checked for validity. The conditions must be valid expressions that
can be converted to a boolean.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-set-statement"></a>The <code>SET</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-set-statement" title="Direct link to heading">#</a></h4><p>The set statement is for variable assignment.  We just validate
that the target exists and is compatible with the source.
Cursor variables cannot be set with simple assignment and CQL generates
errors if you attempt to do so.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare-procedure-statement"></a>The <code>DECLARE PROCEDURE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare-procedure-statement" title="Direct link to heading">#</a></h4><p>There are three forms of this declaration:</p><ul><li>a regular procedure with no DML<ul><li>e.g. <code>declare proc X(id integer);</code></li></ul></li><li>a regular procedure that uses DML (it will need a db parameter and returns a result code)<ul><li>e.g. <code>declare proc X(id integer) using transaction;</code></li></ul></li><li>a procedure that returns a result set, you provide the result columns<ul><li>e.g. <code>declare proc X(id integer) : (A bool not null, B text);</code>
The main validations here are that there are no duplicate parameter names, or return value columns.</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare-function-statement"></a>The <code>DECLARE FUNCTION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare-function-statement" title="Direct link to heading">#</a></h4><p>Function declarations are similar to than procedures; there must be a return type
(use proc if there is none).  The <code>DECLARE SELECT FUNCTION</code> form indicates a function
visible to SQLite, other functions are usable in the <code>call</code> statement.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare-variable-statement"></a>The <code>DECLARE</code> Variable Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare-variable-statement" title="Direct link to heading">#</a></h4><p>This declares a new local or global variable that is not a cursor.
The type is computed with the same helper that is used for analyzing
column definitions.  Once we have the type we walk the list of variable
names, check them for duplicates and such (see above) and assign their type.  The canonical
name of the variable is defined here, if it is later used with a different casing the output
will always be as declared.   e.g. <code>declare Foo integer;  set foo = 1;</code> is legal but the output
will always contain the variable written as <code>Foo</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare-cursor-statement"></a>The <code>DECLARE</code> Cursor Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare-cursor-statement" title="Direct link to heading">#</a></h4><p>There are two forms of the declare cursor, both of which allow CQL to infer the exact type of the cursor.</p><ul><li><code>declare foo cursor for select etc.</code><ul><li>the type of the cursor is the net struct type of the select list</li></ul></li><li><code>declare foo cursor for call proc();</code><ul><li>proc must be statement that produces a result set via select (see above)</li><li>the type of the cursor is the struct of the select returned by the proc</li><li>note if there is more than one loose select in the proc they must match exactly</li></ul></li><li>cursor names have the same rules duplicates as other variables
With this in mind, both cases simply recurse on either the select or the call
and then pull out the structure type of that thing and use it for the cursor&#x27;s shape.  If the
<code>call</code> is not semantically valid according to the rules for calls or the <code>select</code> is not semantically valid,
then of course this declaration will generate errors.</li></ul><p>[marker: initial proof reading ended here, what follows is much rougher]</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare-value-cursor-statement"></a>The <code>DECLARE</code> Value Cursor Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare-value-cursor-statement" title="Direct link to heading">#</a></h4><p>This statement declares a cursor that will be based on the return type of a procedure
when using this form the cursor is also fetched, hence the name.  The fetch result of
the stored proc will be used for the value.  At this point we use its type only.</p><ul><li>the call must be semantically valid</li><li>the procedure must return an OUT parameter (not a result set)</li><li>the cursor name must be unique</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-while-statement-1"></a>The <code>WHILE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-while-statement-1" title="Direct link to heading">#</a></h4><p>While semantic analysis is super simple.</p><ul><li>the condition must be numeric</li><li>the statement list must be error-free</li><li>loop_depth is increased allowing the use of interior leave/continue</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-loop-statement"></a>The <code>LOOP</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-loop-statement" title="Direct link to heading">#</a></h4><p>Loop analysis is just as simple as &quot;while&quot; -- because the loop_stmt
literally has an embedded fetch, you simply use the fetch helper to
validate that the fetch is good and then visit the statement list.
Loop depth is increased as with while.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-call-statement"></a>The <code>CALL</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-call-statement" title="Direct link to heading">#</a></h4><p>There are three ways that a call can happen:</p><ul><li>signatures of procedures that we know in full:<ul><li>call foo();</li><li>declare cursor for call foo();</li></ul></li><li>some external call to some outside function we don&#x27;t known<ul><li>e.g. call printf(&#x27;hello, world\n&#x27;);</li></ul></li></ul><p>The cursor form can be used if and only if the procedure has a loose select
or a call to a procedure with a loose select. In that case the procedure will
have a structure type, rather than just &quot;ok&quot; (the normal signature for a proc).
If the user is attempting to do the second case, cursor_name will be set and
the appropriate verification happens here.</p><p>Note:  Recursively calling fetch cursor is not really doable in general
because at the point of the call we might not yet know that the method
does in fact return a select.  You could make it work if you put the select
before the recursive call.</p><p>Semantic rules:</p><ul><li>for all cases each argument must be error-free (no internal type conflicts)</li><li>for known procs<ul><li>the call has to have the correct number of arguments</li><li>if the formal is an out parameter the argument must be a variable<ul><li>the type of the variable must be an exact type match for the formal</li></ul></li><li>non-out parameters must be type-compatable, but exact match is not required</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-fetch-statement"></a>The <code>FETCH</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-fetch-statement" title="Direct link to heading">#</a></h4><p>The fetch statement has two forms:</p><ul><li>fetch C into var1, var2, var3 etc.</li><li>fetch C;
The second form is called the auto_cursor.
In the first form the variables of the cursor must be assignment compatable
with declared structure type of the cursor and the count must be correct.
In the second form, the codegen will implicitly create local variables that
are exactly the correct type, but that&#x27;s later.  Since no semantic error is
possible in that case we simply record that this is an auto_cursor and then
later we will allow the use of C.field during analysis.
Of course &quot;C&quot; must be a valid cursor.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-continue-statement"></a>The <code>CONTINUE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-continue-statement" title="Direct link to heading">#</a></h4><p>We just need to ensure that continue is inside a loop.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-leave-statement"></a>The <code>LEAVE</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-leave-statement" title="Direct link to heading">#</a></h4><p>We just need to ensure that leave is inside a loop.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-trycatch-statements"></a>The <code>TRY/CATCH</code> Statements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-trycatch-statements" title="Direct link to heading">#</a></h4><p>No analysis needed here other than that the two statement lists are ok.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-open-cursor-statement"></a>The <code>OPEN</code> CURSOR Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-open-cursor-statement" title="Direct link to heading">#</a></h4><p>For open [cursor], we just validate that the name is in fact a cursor.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-close-cursor-statement"></a>The <code>CLOSE</code> CURSOR Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-close-cursor-statement" title="Direct link to heading">#</a></h4><p>For close [cursor], we just validate that the name is in fact a cursor.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-out-cursor-statement"></a>The <code>OUT</code> CURSOR Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-out-cursor-statement" title="Direct link to heading">#</a></h4><p>For out [cursor], we first validate that the name is a cursor
then we set the output type of the procedure we&#x27;re in accordingly</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-meta-statements"></a>The &quot;Meta&quot; Statements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-meta-statements" title="Direct link to heading">#</a></h3><p>The programs control the overall meaning the program or give the compiler specific directives
as to how the program should be compiled.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-echo-statement"></a>The <code>@ECHO</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-echo-statement" title="Direct link to heading">#</a></h4><p>echo is valid in any top level contexts</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-previous-schema-statement"></a>The <code>@PREVIOUS SCHEMA</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-previous-schema-statement" title="Direct link to heading">#</a></h4><p>Begins the region where previous schema will be compared against what has been
declared before this directive for alterations that could not be upgraded.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-schema_upgrade_script-statement"></a>The <code>@SCHEMA_UPGRADE_SCRIPT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-schema_upgrade_script-statement" title="Direct link to heading">#</a></h4><p>When upgrading the DDL it&#x27;s necessary to emit create table statements
for the original version of the schema.  These create statements conflict
with the current version of the schema.  This attribute tells CQL to
1) ignore DDL in stored procedures for declaration purposes; only DDL outside of a proc counts
2) do not make any columns &quot;hidden&quot; thereby allowing all annotations to be present
so they can be used to validate other aspects of the migration script.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-schema_upgrade_version-statement"></a>The <code>@SCHEMA_UPGRADE_VERSION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-schema_upgrade_version-statement" title="Direct link to heading">#</a></h4><p>For sql stored procedures that are supposed to update previous schema versions
you can use this attribute to put CQL into that mindset.  This will make
the columns hidden for the version in question rather than the current version.
This is important because older schema migration procedures might still refer to
old columns.  Those columns truly exist at that schema version.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-enforce_strict-statement"></a>The <code>@ENFORCE_STRICT</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-enforce_strict-statement" title="Direct link to heading">#</a></h4><p>Switch to strict mode.  Presently this is only supported for <code>FOREIGN KEY</code> verification.  In strict mode every foreign key must have some delete/update policy such as <code>ON DELETE CASCADE</code>.  Any policy suffices.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-enforce_normal-statement"></a>The <code>@ENFORCE_NORMAL</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-enforce_normal-statement" title="Direct link to heading">#</a></h4><p>Turn off strict enforcement (currently only affects <code>FOREIGN KEY</code> clauses).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-declare_schema_region-statement"></a>The <code>@DECLARE_SCHEMA_REGION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-declare_schema_region-statement" title="Direct link to heading">#</a></h4><p>A schema region is an partitioning of the schema such that it
only uses objects in the same partition or one of its declared
dependencies.  One schema region may be upgraded independently
from any others (assuming they happen such that dependents are done first).
Here we validate:</p><ul><li>the region name is unique</li><li>the dependencies (if any) are unique and exist</li><li>the directive is not inside a procedure</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-begin_schema_region-statement"></a>The <code>@BEGIN_SCHEMA_REGION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-begin_schema_region-statement" title="Direct link to heading">#</a></h4><p>Entering a schema region makes all the objects that follow part of that
region.  It also means that all the contained objects must refer to
only pieces of schema that are in the same region or a dependent region.
Here we validate that region we are entering is in fact a valid region
and that there isn&#x27;t already a schema region.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-end_schema_region-statement"></a>The <code>@END_SCHEMA_REGION</code> Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-end_schema_region-statement" title="Direct link to heading">#</a></h4><p>Leaving a schema region puts you back in the default region.
Here we check that we are in a schema region.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="important-program-fragments"></a>Important Program Fragments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#important-program-fragments" title="Direct link to heading">#</a></h3><p>These items appear in a variety of places and are worth of discussion.  They are generally handled uniformly.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="argument-lists"></a>Argument Lists<a aria-hidden="true" tabindex="-1" class="hash-link" href="#argument-lists" title="Direct link to heading">#</a></h4><p>Walk an entire argument list and do the type inference on each argument.
Not that this happens in the context of a function call and depending
on what the function is, there may be rules for compatibility of the
arguments with the function and each other.  That doesn&#x27;t happen here.
This just gets the type of each arg and makes sure independently they are
not bogus.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="procedures-that-return-a-result-set"></a>Procedures that return a Result Set<a aria-hidden="true" tabindex="-1" class="hash-link" href="#procedures-that-return-a-result-set" title="Direct link to heading">#</a></h4><p>If a procedure is returning a select statement then we need to attach that
type to the procedures semantic info.  We have to do some extra validation
at this point, especially if the proc already has some other select return.
This is where we make sure all the kinds of selects that might be returned
are 100% compatible.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="general-name-lookups"></a>General Name Lookups<a aria-hidden="true" tabindex="-1" class="hash-link" href="#general-name-lookups" title="Direct link to heading">#</a></h4><p>Try to look up a [possibly] scoped name in one of the places:</p><ol><li>a column in the current join if any (this must not conflict with #2)</li><li>a local or global variable</li><li>a field in an open cursor
otherwise, name not found.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="object-types-with-a-discriminator"></a>Object Types with a Discriminator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#object-types-with-a-discriminator" title="Direct link to heading">#</a></h4><p>We check that <code>object&lt;Foo&gt;</code> only combines with <code>object&lt;Foo&gt;</code> or <code>object</code> in lists of objects (like IN)</p><ul><li>If there is a current object type, then the next item in the expression or must match</li><li>If there is no such type, then an object type that arrives becomes the required type</li><li>If they ever don&#x27;t match record an error</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-case-expression"></a>The <code>CASE</code> Expression<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-case-expression" title="Direct link to heading">#</a></h4><p>There are two parts to this, the &quot;when&quot; expression and the &quot;then&quot; expression.
We compute the aggregate type of the when expressions as we go, promoting it
up to a larger type if needed (e.g. if one when is an int and the other is
a real then the result is a real).   Likewise nullability is computed as
the aggregate.  Note that if nothing matches the result is null, so we always
get a nullable result unless there is an &quot;else&quot; expression.
If we started with case expr then each when expression must be comparable
to the case expression.  If we started with case when xx then yy;  then
each case expression must be numeric (typically boolean).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-between-expressions"></a>The <code>BETWEEN</code> EXPRESSIONS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-between-expressions" title="Direct link to heading">#</a></h4><p>Between requires type compatibility between all three of its arguments.
Nullability follows the usual rules, if any might be null then the result
type might be null.  In any case the result&#x27;s core type is BOOL.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-cast-expression"></a>The <code>CAST</code> Expression<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-cast-expression" title="Direct link to heading">#</a></h4><p>For cast expressions we use the type provided for the semantic type
the only trick is that we preserve the combined_flags of the input argument.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-coalesce-function"></a>The <code>COALESCE</code> Function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-coalesce-function" title="Direct link to heading">#</a></h4><p>Coalesce requires type compatibility between all of its arguments.  The result
is a not null type if we find a not null item in the list.  There should be
nothing after that item.  Note that ifnull and coalesce are really the same thing
except ifnull must have exactly two arguments.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-in-and-not-in-expressions"></a>The <code>IN</code> AND <code>NOT IN</code> Expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-in-and-not-in-expressions" title="Direct link to heading">#</a></h4><p>The in predicate is like many of the other multi-argument operators.  All the
items must be type compatible.  Note that in this case the nullablity of
the items does not matter, only the nullability of the item being tested.
Note that null in (null) is null, not true.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="aggregate-functions"></a>Aggregate Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#aggregate-functions" title="Direct link to heading">#</a></h4><p>Aggregate functions can only be used in certain places.  For instance
they may not appear in a <code>WHERE</code> clause.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="user-defined-functions"></a>User Defined Functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#user-defined-functions" title="Direct link to heading">#</a></h4><p>User defined function, this is an external function
There are a few things to check:</p><ul><li>If this is declared without the select keyword then<ul><li>we can&#x27;t use these in SQL, so this has to be a loose expression</li></ul></li><li>If this is declared with the select keyword then<ul><li>we can ONLY use these in SQL, not in a loose expression</li></ul></li><li>args have to be compatible with formals</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="calling-a-procedure-as-a-function"></a>Calling a procedure as a function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#calling-a-procedure-as-a-function" title="Direct link to heading">#</a></h4><p>There are a few things to check:</p><ul><li>we can&#x27;t use these in SQL, so this has to be a loose expression</li><li>args have to be compatible with formals, except</li><li>the last formal must be an OUT arg and it must be a scalar type</li><li>that out arg will be treated as the return value of the &quot;function&quot;</li><li>in code-gen we will create a temporary for it, semantic analysis doesn&#x27;t care</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="root-expressions"></a>Root Expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#root-expressions" title="Direct link to heading">#</a></h4><p>A top level expression defines the context for that evaluation.  Different expressions
can have constraints.  e.g. aggregate functions may not appear in the <code>WHERE</code> clause of a statement.  There are cases where expression nesting can happen, this nesting changes the evaluation context accordingly, e.g. you can put a nested select in a where clause and that
nested select could legally have aggregates.  Root expressions keep a stack of nested contexts to facilitate the changes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="table-factors"></a>Table Factors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#table-factors" title="Direct link to heading">#</a></h4><p>A table factor is one of three things:</p><ul><li>a table name (a string)  select * from X</li><li>a select subquery (select X,Y from..) as T2</li><li>a list of table references select * from (X, Y, Z)
Here we dispatch to the appropriate helper for each case.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="joining-with-the-using-clause"></a>Joining with the <code>USING</code> Clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#joining-with-the-using-clause" title="Direct link to heading">#</a></h4><p>When specifying joins, one of the alternatives is to give the shared
columns in the join e.g. select * from X inner join Y using (a,b).
This method validates that all the columns are present on both sides of the
join, that they are unique, and they are comparable.
The return code tells us if any columns had SENSITIVE data.   See Special Note on JOIN...USING below</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="join-with-the-on-clause"></a>JOIN WITH THE <code>ON</code> Clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#join-with-the-on-clause" title="Direct link to heading">#</a></h4><p>The most explicit join condition is a full expression in an ON clause
this is like <code>select a,b from X inner join Y on X.id = Y.id;</code>
The on expression should be something that can be used as a bool
so any numeric will do.
The return code tells us if the ON condition used SENSITIVE data.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="table-valued-functions"></a>TABLE VALUED FUNCTIONS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#table-valued-functions" title="Direct link to heading">#</a></h4><p>Table valued functions can appear anywhere a table is allowed.
The validation rules are:</p><ul><li><p>must be a valid function</p></li><li><p>must return a struct type (i.e. a table-valued-function)</p></li><li><p>must have valid arg expressions</p></li><li><p>arg expressions must match formal parameters
The name of the resulting table is the name of the function</p></li><li><p>but it can be aliased later with &quot;AS&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="special-note-on-the-select--and-select-t-forms"></a>Special Note on the <code>select *</code> and <code>select T.*</code> forms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#special-note-on-the-select--and-select-t-forms" title="Direct link to heading">#</a></h3><p>The <code>select *</code> construct is very popular in many codebases but it can be unsafe to use in production code because, if the schema changes, the code might get columns it does not expect.  Note the extra columns could have appeared anywhere in the result set because the <code>*</code> applies to the entire result of the <code>FROM</code> clause, joins and all,  so extra columns are not necessarily at the end and column ordinals are not preserved.  CQL mitigates this situation somewhat with some useful constraints/features:</p></li><li><p>in a <code>select *</code>, and indeed in any query, the column names of the select must be unique, this is because:</p><ul><li>they could form the field names of an automatically generated cursor (see the section on cursors)</li><li>they could form the field names in a CQL result set (see section on result sets)</li><li>it&#x27;s weird/confusing to not have unique names generally</li></ul></li><li><p>when issuing a <code>select *</code> or a <code>select T.*</code> CQL will automatically expand the <code>*</code> into the actual logical columns that exist in the schema at the time the code was compiled</p><ul><li>this is important because if a column had been logically deleted from a table it would be unexpected in the result set even though it is still present in the database and would throw everything off</li><li>likewise if the schema were to change without updating the code, the code will still get the columns it was compiled with, not new columns</li></ul></li></ul><p>Expanding the <code>*</code> at compile time means Sqlite cannot see anything that might tempt it to include different columns in the result.</p><p>With this done we just have to look at the places a <code>select *</code> might appear so we can see if it is safe to use <code>*</code> and, by extension of the same argument, <code>T.*</code>, or at least reasonably safe.</p><p><em>In an <code>EXISTS</code> or <code>NOT EXISTS</code> clause like `where not exists (select </em> from x)`*</p><ul><li>this is perfectly safe, the particular columns do not matter, <code>select *</code> is not even expanded in this case.</li></ul><p><em>In a statement that produces a result set like `select </em> from table_or_view`*</p><ul><li>binding to a CQL result set is done by column name and we know those names are unique</li><li>we won&#x27;t include any columns that are logically deleted, so if you try to use a deleted column you&#x27;ll get a compile time error</li></ul><p>In a cursor statement like <code>declare C cursor for select * from table_or_view</code> there are two cases here</p><p><em>Automatic Fetch  <code>fetch C;</code></em></p><ul><li>in this case you don&#x27;t specify the column names yourself, they are inferred</li><li>you are therefore binding to the columns by name, so new columns in the cursor would be unused (until you choose to start using them)</li><li>if you try to access a deleted column you get a compile-time error</li></ul><p><em>Manual Fetch:  <code>fetch C into a, b, c;</code></em></p><ul><li>In this case the number and type of the columns must match exactly with the specified variables</li><li>If new columns are added, deleted, or changed, the above code will not compile</li></ul><p>So consdering these cases above we can conclude that auto expanding the <code>*</code> into the exact columns present in the compile-time schema version ensures that any incompatible changes result in compile time errors. Adding columns to tables does not cause problems even if the code is not recompiled. This makes the <code>*</code> construct much safer, if not perfect, but no semantic would be safe from arbitary schema changes without recompilation.  At the very least here we can expect a meaningful runtime error rather than silently fetching the wrong columns.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="special-note-on-the-joinusing-form"></a>Special Note on the JOIN...USING form<a aria-hidden="true" tabindex="-1" class="hash-link" href="#special-note-on-the-joinusing-form" title="Direct link to heading">#</a></h3><p>CQL varies slightly from SQLite in terms of the expected results for joins if the USING syntax is employed.  This is not the most common syntax (typically an ON clause is used) but Sqlite has special rules for this kind of join.</p><p>Let&#x27;s take a quick look.  First some sample data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table A( id integer, a text, b text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table B( id integer, c text, d text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into A values(1, &#x27;a1&#x27;, &#x27;b1&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into B values(1, &#x27;c1&#x27;, &#x27;d1&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into A values(2, &#x27;a2&#x27;, &#x27;b2&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into B values(2, &#x27;c2&#x27;, &#x27;d2&#x27;);</span></div></div></div></div></div><p>Now let&#x27;s look at the normal join, this is our reference:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from A T1 inner join B T2 on T1.id = T2.id;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|1|c1|d1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|2|c2|d2</span></div></div></div></div></div><p>As expected, you get all the columns of A, and all the columns of B.  The &#x27;id&#x27; column appears twice.</p><p>However with the <code>USING</code> syntax:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * T1 inner join B T2 using (id);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|c1|d1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|c2|d2</span></div></div></div></div></div><p>The <code>id</code> column is now appearing exactly once.  However, the situation is not so simple as that.  It seems that what hapened was that the <code>*</code> expansion has not included two copies of the <code>id</code>.  The following cases show that both copies of <code>id</code> are still logically in the join.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select T1.*, &#x27;xxx&#x27;, T2.* from A T1 inner join B T2 using (id);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|xxx|1|c1|d1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|xxx|2|c2|d2</span></div></div></div></div></div><p>The <code>T2.id</code> column is part of the join, it just wasn&#x27;t part of the <code>*</code></p><p>In fact, looking further:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select T1.id, T1.a, T1.b, &#x27;xxx&#x27;, T2.id, T2.c, T2.d from A T1 inner join B T2 using (id);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|xxx|1|c1|d1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|xxx|2|c2|d2</span></div></div></div></div></div><p>There is no doubt, <code>T2.id</code> is a valid column and can be used in expressions freely. That means the column cannot be removed from the type calculus.</p><p>Now in CQL, the <code>*</code> and <code>T.*</code> forms are automatically expanded, SQLite doesn&#x27;t see the <code>*</code>.  This is done so that if any columns have been logically deleted they can be elided from the result set.  Given that this happens, the <code>*</code> operator will expand to ALL the columns.  Just the same as if you did <code>T1.*</code> and <code>T2.*</code>.</p><p><em>As a result, in CQL, there is no difference between  the <code>USING</code> form of a join and the <code>ON</code> form of a join.</em></p><p>In fact, only the <code>select *</code> form could possibly be different, so in most cases this ends up being moot anyway.  Typically you don&#x27;t to use <code>*</code> in the presence of joins because of name duplication and ambiguity of the column names of the result set.  CQL&#x27;s automatic expansion means you have a much better idea exactly what columns you will get -- those that were present in the schema you declared.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-10-schema-management-features"></a>Chapter 10: Schema Management Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-10-schema-management-features" title="Direct link to heading">#</a></h2><p>CQL has a lot of schema knowledge already and so it&#x27;s well positioned to think about schema upgrades and versioning.</p><p>It seemed essential to be able to record changes to the schema over time so CQL got an understanding of versioning.  This lets you do things like:</p><ul><li>ensure columns are only added where they should be</li><li>generate compiler errors if you try to access columns that are deprecated</li><li>move from one version to another tracking schema facets that have to be added</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="annotations"></a>Annotations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#annotations" title="Direct link to heading">#</a></h3><p>There are three basic flavors of annotation</p><ul><li><code>@create(version [, migration proc])</code></li><li><code>@delete(version [, migration proc])</code></li><li><code>@recreate</code></li></ul><p>They have various constraints:</p><ul><li><code>@create</code> and <code>@delete</code> can only be applied to tables and columns</li><li><code>@recreate</code> can only be applied to tables (nothing else needs it anyway)</li><li><code>@recreate</code> cannot mix with <code>@create</code> or <code>@delete</code></li><li><code>@recreate</code> can include a group name as in <code>@recreate(musketeers)</code>, if a group name is specified then all the tables in that group are recreated if any of them change</li></ul><p>Indices, Views, and Triggers are always &quot;recreated&quot; (just like tables can be) and so neither the <code>@recreate</code> nor the <code>@create</code> annotations are needed (or allowed).  However when an Index, View, or Trigger is retired it must be marked with <code>@delete</code> so that it isn&#x27;t totally forgotten but can be deleted anywhere it might still exist.  Note that when one of these items is deleted the definition is not used as it will only be dropped anyway, the simplest creation of the object with the correct name will do the job as a tombstone.</p><p>e.g. <code>create view used_to_be_fabulous as select 1 x @delete(12);</code>  suffices to drop the <code>used_to_be_fabulous</code> view in version 12 no matter how complicated it used to be.  It&#x27;s <code>CREATE VIEW</code> will not be emitted into the upgrade procedure in any case.  Similarly trivial indices and triggers of the correct name can be used for the tombstone.</p><p>In addition, if there is some data migration that needs to happen at a particular schema version that isn&#x27;t associated with any particular change in schema, you can run an <em>ad hoc</em> migrator at any time.  The syntax for that is<code>@schema_ad_hoc_migration(version, migration proc);</code>  Ad hoc migrations are the last to run in any given schema version, they happen after table drop migrations.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="semantics"></a>Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#semantics" title="Direct link to heading">#</a></h3><p><code>@create</code> declares that the annotated object first appeared in the indicated version, and at that time the migration proc needs to be executed to fill in default values, denormalize values, or whatever the case may be.</p><p><code>@delete</code> declares that the annotated object disappeared in the indicated version, and at that time the migration proc needs to be executed to clean up the contents, or potentially move them elsewhere.</p><p><code>@recreate</code> declares that the annotated object can be dropped and recreated when it changes, there is no need to preserve its contents during an upgrade. Such objects may be changed arbitrarily from version to version</p><ul><li>no columns in a <code>@recreate</code> table may have <code>@create</code> or <code>@delete</code> (it isn&#x27;t needed anyway)<ul><li>therefore tables with <code>@recreate</code> never have deprecated columns (since <code>@delete</code> isn&#x27;t allowed on their columns)</li></ul></li></ul><p>NOTE: all annotations are suppressed from generated SQL.  SQLite never sees them.</p><p>NOTE: looking at the annotations it is possible to compute the logical schema at any version, especially the original schema -- it&#x27;s what you get if you disregard all <code>@delete</code> entirely (don&#x27;t delete) and then remove anything marked with <code>@create</code> directives.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="allowable-changes"></a>Allowable changes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#allowable-changes" title="Direct link to heading">#</a></h3><p>Not all migrations are possible in a sensible fashion, therefore CQL enforces certain limitations:</p><ul><li>the &quot;original&quot; schema has no annotations or just delete annotations</li><li>new tables may be added (with <code>@create</code>)</li><li>tables may be deleted (with <code>@delete</code>)</li><li>columns may be added to a table, but only at the end of the table</li><li>added columns must be nullable or have a default value (otherwise all existing insert statements would break for sure)</li><li>columns may not be renamed</li><li>columns may be deleted but this is only a logical delete, SQLite has no primitive to remove columns; once deleted you may not longer refer to that column in queries</li><li>deleted columns must be nullable or have a default value (otherwise all existing and future insert statements would break for sure, the column isn&#x27;t really gone)</li><li>views, indices, and triggers may be added (no annotation required) and removed (with <code>@delete</code>) like tables</li><li>views, indices, and triggers may be altered completely from version to version</li><li>no normal code is allowed to refer to deleted columns, tables, etc.  this includes views, indices, and triggers</li><li>schema migration stored procs see the schema as it existed in their annotation (so an older version), they are also forbidden from using views (see below)</li><li>recreated objects (tables marked with @recreate, views, tables, and indices) have no change restrictions</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prosecution"></a>Prosecution<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prosecution" title="Direct link to heading">#</a></h3><p>Moving from one schema version to another is done in an orderly fashion with the migration proc taking these essential steps in this order</p><ul><li><p>the <code>cql_schema_facets</code> table is created if needed, this records the current state of the schema</p></li><li><p>the last known schema hash is read from the <code>cql_schema_facets</code> tables (it&#x27;s zero by default)</p></li><li><p>if the overall schema hash code matches what is stored processing stops, otherwise an upgrade ensues</p></li><li><p>all known views are dropped (hence migration procs won&#x27;t see them!)</p></li><li><p>any index that needs to change is dropped (this includes items marked <code>@delete</code> or indices that are different than before)</p><ul><li>change is detect by hash (crc64) of the previous index definition vs. the current</li></ul></li><li><p>all known triggers are dropped (hence they will not fire during migration!)</p></li><li><p>the current schema version is extracted from <code>cql_schema_facets</code> (it&#x27;s zero by default)</p></li><li><p>if the current schema version is 0 then the original version of all the tables are created</p></li><li><p>if the current schema version is &lt;= 1 then</p><ul><li>any tables that need to be created at schema version 1 are created as they exist at schema version 1</li><li>any columns that need to be created at schema version 1 are created as they exist at schema version 1</li><li>migration procedures schema version 1 are run in this order:<ul><li>create table migration</li><li>create column migration</li><li>delete trigger migration (these are super rare and supported for uniformity)</li><li>delete index migration (these are super rare and supported for uniformity)</li><li>delete view migration  (these are super rare and supported for uniformity)</li><li>delete column migration</li><li>delete table migration</li><li>ad hoc migration</li><li>each proc is run exactly one time</li></ul></li><li>any tables that need to be dropped at schema version 1 are dropped</li><li>the schema version is marked as 1 in <code>cql_schema_facets</code></li><li>each sub-step in the above is recorded in <code>cql_schema_facets</code> as it happens so it is not repeated<ul><li>all that checking not shown for brevity</li></ul></li></ul></li><li><p>the above process is repeated for all schema versions up to the current version</p></li><li><p>all tables that are marked with <code>@recreate</code> are re-created if necessary</p><ul><li>i.e. if the checksum of the table definition has changed for any  table (or group) then <code>drop</code> it and create the new version.</li></ul></li><li><p>all indices that changed and were not marked with <code>@delete</code> are re-created</p></li><li><p>all views not marked with <code>@delete</code> are recreated</p></li><li><p>all triggers not marked with <code>@delete</code> are re-installed</p></li><li><p>the current schema hash is written to the <code>cql_schema_facets</code> table</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example-migration"></a>Example Migration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-migration" title="Direct link to heading">#</a></h3><p>Here&#x27;s an example of a schema directly from the test cases:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- crazy amount of versioning here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table foo(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long integer @delete(5),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long integer @delete(4, DeleteRate2Proc),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 integer default 12345 @create(4, CreateId2Proc),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name text @create(5),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 text @create(6)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- much simpler table, lots of stuff added in v2.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- note v1 is the first new version and v0 is base version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table table2(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 text @create(2, CreateName1Proc),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 text @create(2, CreateName2Proc),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name3 text @create(2), -- no proc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name4 text @create(2) -- no proc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table added_table(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 text,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 text @create(4)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) @create(3) @delete(5);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is present in the output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create view live_view as select * from foo;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is also present in the output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create view another_live_view as select * from foo;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is not present in the output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create view dead_view as select * from foo @delete(2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this index is present</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create index index_still_present on table2(name1, name2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this index is going away</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create index index_going_away on table2(name3) @delete(3);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this is a simple trigger, it&#x27;s a bit silly but that doesn&#x27;t matter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create trigger trigger_one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  after insert on foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from table2 where table2.id = new.id;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><p>This schema has a LOT of versioning... you can see tables and columns appearing in versions 2 through 6.  There is a lot of error checking happening.</p><ul><li>things with no create annotation were present in the base schema</li><li>only things with no delete annotation are visible to normal code</li><li>created columns have to be at the end of their table (required by SQLite)</li><li>they have to be in ascending  schema version order (but you can add several columns in one version)</li><li>there may or may not be a proc to run to populate data in that column when it&#x27;s added or removed data when it&#x27;s deleted<ul><li>proc names must be unique</li></ul></li><li>you can&#x27;t delete a table or column in a version before it was created</li><li>you can&#x27;t delete a column in a table in a version before the table was created</li><li>you can&#x27;t create a column in a table in a version after the table was deleted</li><li>there&#x27;s probably more I forgot...</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sample-upgrade-script"></a>Sample Upgrade Script<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sample-upgrade-script" title="Direct link to heading">#</a></h3><p>With just those annotations you can automatically create the following upgrade script which is itself CQL (and hence has to be compiled). This code is totally readable!</p><p>I&#x27;ve split the script into logical pieces to explain what&#x27;s going on.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="preamble"></a>Preamble<a aria-hidden="true" tabindex="-1" class="hash-link" href="#preamble" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ...copyright notice... possibly generated source tag... elided to avoid confusion</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no columns will be considered hidden in this script</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- DDL in procs will not count as declarations</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@SCHEMA_UPGRADE_SCRIPT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Schema upgrade scripts need to see all the columns even the ones that would be logically deleted in normal mode.  This is so that things like <code>alter table add column</code> can refer to real columns and <code>drop table</code> can refer to a table that shouldn&#x27;t even be visible.  Remember in CQL the declarations tell you the logical state of the universe and DLL mutations are expected to create that condition, so you should be dropping tables that are marked with <code>@delete</code>
CQL stores the current state of the universe in this table.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- schema crc -7714030317354747478</span></div></div></div></div></div><p>The schema crc is computed by hashing all the schema declarations in canonical form.  That&#x27;s everything in this next section.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaration-section"></a>Declaration Section<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaration-section" title="Direct link to heading">#</a></h4><p>Wherein all the necessary objects are declared...</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declare sqlite_master --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> sqlite_master </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tbl_name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rootpage </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>sqlite_master</code> table is built-in but it has to be introduced to CQL so that we can query it. Like all the other loose DDL declarations here there is no code generated for this.  We are simply declaring tables.  To create code you have to put the DDL in a proc.  Normally DDL in procs also declares the table but since we may need the original version of a table created and the final version declared we have <code>@schema_upgrade_script</code> to help avoid name conflicts.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declare full schema of tables and views to be upgraded --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate LONG </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 LONG </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12345</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name3 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name4 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>NOTE: all the tables are emitted including all the annotations.  This lets us do the maximum validation when we compile this script.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> another_live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> dead_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>These view declarations do very little.  We only need the view names so we can legally drop the views.  We create the views elsewhere.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_still_present </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_going_away </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Just like views, these declarations introduce the index names and nothing else.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> trigger_one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">AFTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>We have only the one trigger, we declare it here.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- facets table declaration --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is where we will store everything we know about the current state of the schema.  Below we define a few helper procs for reading and writing that table and reading <code>sqlite_master</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- saved facets table declaration --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>We will snapshot the facets table at the start of the run so that we can produce a summary of the changes
at the end of the run.  This table will hold that snapshot.</p><p>NOTE: the prefix &quot;test&quot; was specified when this file was built so all the methods and tables begin with <code>test_</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="helper-procedures"></a>Helper Procedures<a aria-hidden="true" tabindex="-1" class="hash-link" href="#helper-procedures" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for testing for the presence of a column/type</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">table_name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          decl </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> present </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> present :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sqlite_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> tbl_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> table_name </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> GLOB decl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p><code>check_column_exists</code> inspects <code>sqlite_master</code> and returns true if a column matching <code>decl</code> exists.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for creating the schema version table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_create_cql_schema_facets_if_needed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here we actually create the <code>cql_schema_facets</code> table with DDL inside a proc.  In a non-schema-upgrade script the above would give a name conflict.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for saving the schema version table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_save_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets_saved</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>save_sql_schema_facets</code> procedure simply makes a snapshot of the current facets table.  Later we use
this snapshot to report the differences by joining these tables.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for setting the schema version of a facet</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                            _version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for getting the schema version of a facet</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                            </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> _version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> TRY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _version :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_cql_schema_facets</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> facet </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> _facet </span><span class="token keyword" style="font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> TRY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> CATCH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _version :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> CATCH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The two procs <code>cql_get_facet_version</code> and <code>cql_set_facet_version</code> do just what you would expect.  Note the use of <code>try</code> and <code>catch</code> to return a default value if the select fails.</p><p>There are two additional helper procedures that do essentially the same thing using a schema version index.  These two methods exist only to avoid unnecessary repeated string literals in the output file which cause bloat.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for getting the schema version CRC for a version index</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_v </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> _crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> TRY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _crc :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_cql_schema_facets</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> facet </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_v&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">_v </span><span class="token keyword" style="font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> TRY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> CATCH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _crc :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> CATCH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for setting the schema version CRC for a version index</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_v </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          _crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_v&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">_v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As you can see, these procedures are effectively specializations of <code>cql_get_facet_version</code> and <code>cql_set_facet_version</code> where the facet name is computed from the integer.</p><p>Triggers require some special processing.  There are so-called &quot;legacy&quot; triggers that crept into the system.  These
begin with <code>tr__</code> and they do not have proper tombstones.  In fact some are from early versions of CQL before
they were properly tracked.  To fix any old databases that have these in them, we delete all triggers that start with <code>tr__</code>.
Note we have to use the <code>GLOB</code> operator to do this, because <code>_</code> is the <code>LIKE</code> wildcard.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc to reset any triggers that are on the old plan --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> cql_exec_internal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_legacy_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> sqlite_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;trigger&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> name GLOB </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;tr__*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> cql_exec_internal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DROP TRIGGER %s;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="baseline-schema"></a>Baseline Schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#baseline-schema" title="Direct link to heading">#</a></h4><p>The &#x27;baseline&#x27; or &#x27;v0&#x27; schema is unannotated (no <code>@create</code> or <code>@recreate</code>).    The first real schema
management procedures are for creating and dropping these tables.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_install_baseline_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    rate LONG_INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    rate_2 LONG_INT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for dropping baseline tables before installing the baseline schema</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_baseline_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="migration-procedures"></a>Migration Procedures<a aria-hidden="true" tabindex="-1" class="hash-link" href="#migration-procedures" title="Direct link to heading">#</a></h4><p>The next section declares the migration procedures that were in the schema.  These are expected to be
defined elsewhere.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declared upgrade procedures if any</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The code below will refer to these migration procedures.  We emit a declaration so that we can use the names in context.
NOTE: <code>USING TRANSACTION</code> when applied to a proc declaration simply means the proc will access the database so it needs to be provided with a <code>sqlite3 *db</code> parameter.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="views"></a>Views<a aria-hidden="true" tabindex="-1" class="hash-link" href="#views" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- drop all the views we know</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE test_cql_drop_all_views()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DROP VIEW IF EXISTS live_view;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DROP VIEW IF EXISTS another_live_view;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DROP VIEW IF EXISTS dead_view;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- create all the views we know</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE test_cql_create_all_views()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CREATE VIEW live_view AS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECT *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    FROM foo;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CREATE VIEW another_live_view AS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECT *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    FROM foo;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div></div></div></div></div><p>View migration is done by dropping all views and putting all views back.</p><p>NOTE: <code>dead_view</code> was not created, but we did try to drop it if it existed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="indices"></a>Indices<a aria-hidden="true" tabindex="-1" class="hash-link" href="#indices" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- drop all the indices that are deleted or changing</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> index_crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> index_crc </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> index_still_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> index_going_away</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create all the indices we need</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_create_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> index_crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> index_crc </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_still_present </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Indices are processed similarly to views, however we do not want to drop indices that are not changing.  Therefore we compute the CRC of the index definition.  At the start of the script any indices that are condemned (e.g. <code>index_going_away</code>) are dropped as well as any that have a new CRC. At the end of migration, changed or new indices are (re)created using <code>cql_create_indices</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="triggers"></a>Triggers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#triggers" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> the triggers we know</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_legacy_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger_one</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create all the triggers we know</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_create_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> trigger_one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">AFTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Triggers are always dropped before migration begins and are re-instated quite late in the processing
as we will see below.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="main-migration-script"></a>Main Migration Script<a aria-hidden="true" tabindex="-1" class="hash-link" href="#main-migration-script" title="Direct link to heading">#</a></h4><p>The main script orchestrates everything.  There are inline comments for all of it.  The general order of events is:</p><ul><li>create schema facets table if needed</li><li>check main schema crc, if it matches we&#x27;re done here, otherwise continue...</li></ul><p>These operations are done in <code>test_perform_needed_upgrades</code></p><ul><li>drop all views</li><li>drop condemned indices</li><li>fetch the current schema version</li><li>if version 0 then install the baseline schema (see below)</li><li>for each schema version with changes do the following:<ul><li>create any tables that need to be created in this version</li><li>add any columns that need to be added in this version</li><li>run migration procs in this order:<ul><li>create table</li><li>create column</li><li>delete trigger</li><li>delete view</li><li>delete index</li><li>delete column</li><li>delete table</li></ul></li><li>drop any tables that need to be dropped in this version</li><li>mark schema upgraded to the current version so far, proceed to the next version</li><li>each partial step is also marked as completed so it can be skipped if the script is run again</li></ul></li><li>create all the views</li><li>(re)create any indices that changed and are not dead</li><li>set the schema CRC to the current CRC</li></ul><p>That&#x27;s it... the details are below.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_perform_needed_upgrades</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> facet_version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> schema_version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- save the current facets so we can diff them later --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_save_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping all views --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping condemned or changing indices --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping condemned or changing triggers --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- fetch current schema version --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_version&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- install baseline schema if needed ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_baseline_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_install_baseline_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_version&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 2 ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5380988243166701961</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name1 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name1 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name2 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name3 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name3 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name3 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name4 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name4 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name4 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- data migration procedures</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName1Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> facet_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName1Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> facet_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5380988243166701961</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 3 ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1945462407517765645</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- creating table added_table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1945462407517765645</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 4 ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4889894059346952297</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table added_table to add column name2 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;added_table&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> added_table </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column id2 INTEGER;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]id2 INTEGER*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12345</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- logical delete of column rate_2 from foo; -- no ddl</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- data migration procedures</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateId2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> facet_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateId2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DeleteRate2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> facet_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DeleteRate2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4889894059346952297</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 5 ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5720357430811880771</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column name TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- logical delete of column rate from foo; -- no ddl</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping table added_table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5720357430811880771</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 6 ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3572608284749506390</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column name_2 TEXT;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name_2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name_2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3572608284749506390</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_version&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">7714030317354747478</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- finally produce the list of differences</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test_cql_schema_facets T1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> test_cql_schema_facets_saved T2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">version </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This is the main function for upgrades, it checks only the master schema version.
This function is separate so that the normal startup path doesn&#x27;t have to have
the code for the full upgrade case in it.  This lets linker order files do a superior job
(since full upgrade is the rare case).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> schema_crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create schema facets information table --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_create_cql_schema_facets_if_needed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- fetch the last known schema crc, if it&#x27;s different do the upgrade --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_crc </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">7714030317354747478</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- save the current facets so we can diff them later --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_perform_needed_upgrades</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- some canonical result for no differences --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;no differences&#x27;</span><span class="token plain"> facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="temp-tables"></a>Temp Tables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#temp-tables" title="Direct link to heading">#</a></h4><p>We had no temporary tables in this schema, but if there were some they get added
to the schema after the upgrade check.</p><p>A procedure like this one is generated:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_install_temp_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> tempy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This entry point can be used any time you need the temp tables.  But normally it is
automatically invoked.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- install temp schema after upgrade is complete ----</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_install_temp_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>That logic is emitted at the end of the test procedure.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="schema-regions"></a>Schema Regions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#schema-regions" title="Direct link to heading">#</a></h3><p>Schema Regions are designed to let you declare your schema in logical regions whose dependencies are specified.  It enforces the dependencies you specify creating errors if you attempt to break the declared rules.  Schema regions allow you to generate upgrade scripts for parts of your schema that can compose and be guaranteed to remain self-consistent.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="details"></a>Details<a aria-hidden="true" tabindex="-1" class="hash-link" href="#details" title="Direct link to heading">#</a></h4><p>In many cases schema can be factored into logical and independent islands.  This is desireable for a number of reasons:</p><ul><li>so that the schema can go into different databases</li><li>so that the schema can be upgraded on a different schedule</li><li>so that &quot;not relevant&quot; schema can be omitted from distributions</li><li>so that parts of your schema that have no business knowing about each other can be prevented from taking dependencies on each other</li></ul><p>These all have very real applications:</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="eg-your-application-has-an-on-disk-and-an-in-memory-database"></a>E.g. Your Application has an on-disk and an in-memory database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#eg-your-application-has-an-on-disk-and-an-in-memory-database" title="Direct link to heading">#</a></h5><p>This creates basically three schema regions:</p><ol><li>on disk: which cannot refer to the in-memory at all</li><li>in-memory: which cannot refer to the on-disk schema at all</li><li>cross-db: which refers to both, also in memory (optional)</li></ol><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="your-application-needs-to-upgrade-each-of-the-above"></a>Your Application Needs To Upgrade Each of the Above<a aria-hidden="true" tabindex="-1" class="hash-link" href="#your-application-needs-to-upgrade-each-of-the-above" title="Direct link to heading">#</a></h5><p>There must be a separate upgrade script for both the island databases and yet a different one for the &quot;cross-db&quot; database</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="your-customer-doesnt-want-the-kitchen-sink-of-schema"></a>Your Customer Doesn&#x27;t Want The Kitchen Sink of Schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#your-customer-doesnt-want-the-kitchen-sink-of-schema" title="Direct link to heading">#</a></h5><p>If you&#x27;re making a library with database support, your customers likely want to be able to create databases that have only features they want; you will want logical parts within your schema that can be separated for cleanliness and distribution.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaring-regions-and-dependencies"></a>Declaring Regions and Dependencies<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaring-regions-and-dependencies" title="Direct link to heading">#</a></h4><p>Schema Regions let you create logical groupings, you simply declare the regions you want and then start putting things into those regions.  The regions form a directed acyclic graph -- just like C++ base classes.  You create regions like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> extra </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The above simply declares the region, it doesn&#x27;t put anything into them.  In this case we now have a <code>root</code> region and an <code>extra</code> region.  The <code>root</code> schema items will not be allowed to refer to anything in <code>extra</code>.</p><p>Without regions, you could also ensure that the above is true by putting all the <code>extra</code> items afer the <code>root</code> in the input file but things can get more complicated than that in general, and the schema might also be in several files, complicating ordering as the option.  Also relying on order could be problematic as it is quite easy to put things in the wrong place (e.g. add a new <code>root</code> item after the <code>extra</code> items).  Making this a bit more complicated, we could have:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> feature1 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> feature2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> everything </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> feature1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> feature2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>And now there are many paths to <code>root</code> from the <code>everything</code> region;  that&#x27;s ok but certainly it will be tricky to do all that with ordering.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-regions"></a>Using Regions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-regions" title="Direct link to heading">#</a></h4><p>An illustrative example, using the regions defined above:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> names </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> main </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   details </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_detail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> details T1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> main T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> feature1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> f1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   f1_info </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_detail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f1_info </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> details T1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> f T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> f1 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> f1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> feature2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- you can use details, and main but not f1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>With the structure above specified, even if a new contribution to the <code>root</code> schema appears later, the rules enforce that this region cannot refer to anything other other things in <code>root</code>.  This can be very important if schema is being included via <code>#include</code> and might get pulled into the compilation in various orders.  A feature area might also have a named public region that others things can depend on (e.g. some views) and private regions (e.g. some tables, or whatever).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="region-visibility"></a>Region Visibility<a aria-hidden="true" tabindex="-1" class="hash-link" href="#region-visibility" title="Direct link to heading">#</a></h4><p>Schema region do not provide additional name spaces, the names of objects should be unique across all regions.  i.e. regions do not hide or scope entity names, rather they create errors if inappropriate names are used.</p><p>Case 1: The second line will fail semantic validation because table <code>A</code> already exists</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- obvious standard name conflict</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Case 2: This fails for the same reason as case #1. Table <code>A</code> already exists</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- table A is in no region</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this table A is in the root region, still an error</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Case 3: Again fails for the same reason as case #1. Table <code>A</code> already exist in region <code>extra</code>, you can not define another table with the same name in another region.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- so far so good</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no joy, this A conflicts with the previous A</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Really the visibility rules couldn&#x27;t be anything other than the above, SQLite has no knowledge of regions at all and so any exotic name resolution would just doom SQLite statements to fail when they finally run.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="exception-for--like-table-statement"></a>Exception for <code>&quot;... LIKE &lt;table&gt;&quot;</code> statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#exception-for--like-table-statement" title="Direct link to heading">#</a></h5><p>The rules above are enforced for all constructs except for where the syntactic sugar <code>... LIKE &lt;table&gt;</code> forms, which can happen in a variety of statement. This form doesn&#x27;t create a dependence on the table (but does create a dependence on its shape). When CQL generates output the <code>LIKE</code> construct is replaced with the actual names of columns it refers to.  But these are independent columns, so this is simply a typing-saver.  The table (or view, cursor, etc.) reference will be gone.</p><p>These cases below will succeed.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> B </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> C {</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> CC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Note: this exception may end up causing maintenance problems and so it might be revisited in the future.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="maintaining-schema-in-pieces"></a>Maintaining Schema in Pieces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#maintaining-schema-in-pieces" title="Direct link to heading">#</a></h4><p>When creating upgrade scripts using the <code>--rt schema_upgrade</code> flags you can add region options <code>--include_regions a b c</code> and <code>--exclude_regions d e f</code> per the following:</p><p>Included regions:</p><ul><li>included regions must be valid region names, the base types are walked to compute all the regions that are &quot;in&quot;</li><li>declarations are emitted in the upgrade for all of the &quot;in&quot; objects, &quot;exclude&quot; does not affect the declarations</li></ul><p>Excluded regions:</p><ul><li>excluded regions must be valid region names and indicate parts of schema that are upgraded elsewhere, perhaps with a seperate CQL run, a different automatic upgrade, or even a manual mechanism</li><li>upgrade code will be generated for all the included schema, but not for the excluded regions and their contents</li></ul><p>Example: Referring to the regions above you might do something like this</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># All of these also need a --global_proc param for the entry point but that&#x27;s not relevant here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg shared.sql --rt schema_upgrade  --include_regions extra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg f1.cql --rt schema_upgrade --include_regions feature1 --exclude_regions extra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg f2.cql --rt schema_upgrade --include_regions feature2 --exclude_regions extra</span></div></div></div></div></div><p>The first command generates all the shared schema for regions <code>root</code> and <code>extra</code> because <code>extra</code> contains <code>root</code></p><p>The second command declares all of <code>root</code> and <code>extra</code> so that the <code>feature1</code> things can refer to them, however the upgrade code for these shared regions is not emitted.  Only the upgrade for schema in <code>feature1</code> is emitted.  <code>feature2</code> is completely absent.  This will be ok because we know <code>feature1</code> cannot depend on <code>feature2</code> and <code>extra</code> is assumed to be upgraded elsewhere (such as in the previous line).</p><p>The third command declares all of <code>root</code> and <code>extra</code> so that the <code>feature2</code> things can refer to them, however the upgrade code for these shared regions is not emitted.  Only the upgrade for schema in <code>feature2</code> is emitted.  <code>feature1</code> is completely absent.</p><p>Note that in the above examples CQL is generating more CQL to be compiled again (a common pattern).  The CQL upgrade scripts need to be compiled as usual to produce executable code.  Thus the output of this form includes the schema declarations and executable DDL.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="schema-not-in-any-region"></a>Schema Not In Any Region<a aria-hidden="true" tabindex="-1" class="hash-link" href="#schema-not-in-any-region" title="Direct link to heading">#</a></h5><p>For schema that is not in any region you might imagine that it is a special region <code>&lt;none&gt;</code> that depends on everything.  So basically you can put anything there.  Schema that is in any region cannot ever refer to schema that is in <code>&lt;none&gt;</code>.</p><p>When upgrading, if any include regions are specified then <code>&lt;none&gt;</code> will not be emitted at all.  If you want an upgrader for just <code>&lt;none&gt;</code> this is possible with an assortment of exclusions.  You can always create arbitrary grouping regions to make this easier. A region named <code>any</code> that uses all other regions would make this simple.</p><p>In general, best practice is that there is no schema in <code>&lt;none&gt;</code>, but since most SQL code has no regions some sensible meaning has to be given to DDL before it gets region encodings.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deployable-regions"></a>Deployable Regions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deployable-regions" title="Direct link to heading">#</a></h4><p>Given the above we note that some schema regions correspond to the way that we will deploy the schema, we want those bundles to be safe to deploy but to so we need a new notion -- a deployable region.  To make this possible CQL includes the following:</p><ul><li>You can declare a region as deployable using <code>@declare_deployable_region</code></li><li>CQL computes the covering of a deployable region: its transitive closure up to but not including any deployable regions it references</li><li>No region is allowed to depend on a region that is within the interior of a different deployable region, but you can depend on the deployable region itself</li></ul><p>Because of the above, each deployable region is in fact a well defined root for the regions it contains.  The deployable region becomes the canonical way in which a bundle of regions (and their content) is deployed and any given schema item can be in only one deployable region.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="motivation-and-examples"></a>Motivation and Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#motivation-and-examples" title="Direct link to heading">#</a></h5><p>As we saw above, regions are logical groupings of tables/views/etc such that if an entity is in some region <code>R</code> then it is allowed to only refer to the things that <code>R</code> declared as dependencies <code>D1</code>, <code>D2</code>, etc. and their transitive closure.  You can make as many logical regions as you like and you can make them as razor thin as you like; they have no physical reality but they let you make as many logical groups of things as you might want.</p><p>Additionally, when we’re deploying schema you generally need to do it in several pieces. E.g. if we have tables that go in an in-memory database then defining a region that holds all the in-memory tables makes it easy to say put all those in memory tables into a particular deployment script.</p><p>Now we come to the reason for deployable regions. From CQL’s perspective all regions are simply logical groups, some grouping that is meaningful to programmers but has no physical reality. This means you’re free to reorganize tables etc. as you see fit into new or different regions when things should move. Only that’s not quite true. The fact that we deploy our schema in certain ways means while most logical moves are totally fine, if you were to move a table from say the main database region to the in-memory region you would be causing a major problem.  Some installations may already have the table in the main area and there would be nothing left in the schema to tell CQL to drop the table from the main database -- the best you can hope for is the new location gets a copy of the table the old location keeps it and now there are name conflicts forever.</p><p>So, the crux of the problem is this. We want to let you move schema freely between logical regions however it makes sense to you but once you pick the region you are going to be deployed in, you can’t change that.</p><p>To do this, CQL needs to know that some of the regions are deployable regions and there have to be rules so that it all makes sense.  Importantly, every region has to be contained in at most one deployable region.</p><p>Since the regions form a DAG we must create an error if any region could ever roll up to two different deployable regions. The easiest way to describe this rule is “no peeking” – the contents of a deployable region are “private” they can refer to each other in any dag shape but outside of the deployable region you can only refer to its root. So you can still compose them but each deployable region owns a well defined covering. Note you can make as many fine-grained deployable regions as you want, you don’t actually have to deploy them separately, but you get stronger rules about the sharing.</p><p>Here’s an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Master Deployment 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 1 (Deployable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Core (Deployable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      logical regions for core</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 2 (Deployable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Core</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Master Deployment 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 1 (Deployable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 3 (Deployable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 3</span></div></div></div></div></div><p>In the above:</p><ul><li>none of the logical regions for feature 1, 2, 3 are allowed to refer to logical regions in any other feature, any of them could refer to Core (but not directly to what is inside Core)</li><li>within those regions you can make any set of groupings that makes sense and change them over time as you see fit</li><li>any such regions are not allowed to move to a different Feature group (because those are deployment regions)</li><li>the Master Deployment regions just group features in ways we’d like to deploy them, in this case there are two deployments one that includes Feature 1 &amp; 2 and another that includes Feature 1 &amp; 3</li><li>the deployable region boundaries are preventing Feature 1 regions from using Feature 2 regions in an ad hoc way (i.e. you can&#x27;t cheat by taking a direct dependency on something inside a different feature), but both Features can use Core</li><li>Feature 3 doesn’t use Core but Core will still be in Master Deployment 2 due to Feature 1</li></ul><p>Note that the deployable regions for Feature 1, 2, and 3 aren&#x27;t actually deployed alone, but they are adding enforcement that makes the features cleaner</p><p>Because of how upgrades work, “Core” could have its own upgrader. Then when you create the upgrader for Master Deployment 1 and 2 you can specify “exclude Core” in which case those tables are assumed to be updated independently. You could create as many or as few independently upgrade-able things with this pattern. Because regions are not allowed to &quot;peek&quot; inside of a deployable region, you can reorganize your logical regions without breaking other parts of the schema.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="private-regions"></a>Private Regions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#private-regions" title="Direct link to heading">#</a></h4><p>The above constructs create a good basis for creating and composing regions, but a key missing aspect is the ability to hide internal details in the logical groups.  This becomes increasingly important as your desire to modularize schema grows; you will want to have certain parts that can change without worrying about breaking others and without fear that there are foreign keys and so forth to them.</p><p>To accomplish this CQL provides the ability to compose schema regions with the optional <code>private</code> keyword.  In the following example there will be three regions creatively named <code>r1</code>, <code>r2</code>, and <code>r3</code>.  Region <code>r2</code> consumes <code>r1</code> privately and therefore <code>r3</code> is not allowed to use things in <code>r1</code> even though it consumes <code>r2</code>.  When creating an upgrade script for <code>r3</code> you will still need (and will get) all of <code>r2</code> and <code>r1</code>, but from a visibility perspective <code>r3</code> can only directly depend on <code>r2</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> r1 private</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r3 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r2_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is OK</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r3_table_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r2_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is an error, no peeking into r1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r3_table_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As expected <code>r2</code> is still allowed to use <code>r1</code> because your private regions are not private from yourself.  So you may think it’s easy to work around this privacy by simply declaring a direct dependency on r1 wherever you need it.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@declare_schema_region my_sneaky_region using r1, other_stuff_I_need;</span></div></div></div></div></div><p>That would seem to make it all moot.  However, this is where deployable regions come in.  Once you bundle your logical regions in a deployable region there’s no more peeking inside the the deployable region.  So we could strengthen the above to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@declare_deployable_region r2 using r1 private;</span></div></div></div></div></div><p>Once this is done it becomes an error to try to make new regions that peek into <code>r2</code>; you have to take all of <code>r2</code> or none of it -- and you can’t see the private parts.  Of course you can do region wrapping at any level so you can have as many subgroups as you like, whatever is useful. You can even add additional deployable regions that aren’t actually deployed to get the &quot;hardened&quot; grouping at no cost.</p><p>So, in summary, to get true privacy first make whatever logical regions you like that are helpful.  Put privacy where you need/want it.  Import logical regions as much as you want in your own bundle of regions.  Then wrap that bundle up in a deployable region (they nest) and then your private regions are safe from unwanted usage.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-11-previous-schema-validation"></a>Chapter 11: Previous Schema Validation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-11-previous-schema-validation" title="Direct link to heading">#</a></h2><p>As we saw in the previous chapter, CQL includes powerful schema management tools for creating automatic
upgrade scripts for your databases.  However, not all schema alterations are possible after-the-fact
and so CQL also includes schema comparison tools to help you avoid problems as you version your schema over time.</p><p>You can compare the previous version of a schema with the current version to do additional checks such as:</p><ul><li>the data type of a column may not change</li><li>the attributes of a column (e.g. nullable, default value) may not change</li><li>columns can&#x27;t be renamed</li><li>columns can&#x27;t be removed, only marked delete</li><li>new columns must be at the end of the table and marked with create</li><li>created columns have to be created in a schema version &gt;= any that previously existed (no creating columns in the past)</li><li>nothing other than new columns at the end may be added to a table (e.g. new PK/UK is right out)</li><li>new tables must be marked create, deleted tables must be marked delete</li><li>new views must be marked create, deleted views must be marked delete</li><li>new indices must be marked create, deleted indices must be marked delete</li><li>an item that was previously a table/view cannot turn into the other one</li><li>version numbers in the annotations may not ever change</li><li>if any annotation has a migration proc associated with it, it cannot change to a different proc later</li><li>created tables, views, indices have to be created in a schema version &gt;= any that previously existed (no creating tables in the past)</li><li>there&#x27;s probably more I forgot :D</li></ul><p>When checking <code>@recreate</code> tables against the previous schema version for errors, these checks are done:</p><ul><li>suppress checking of any table facet changes in previous schema on recreate tables, you can do anything you want</li><li>allow new <code>@recreate</code> tables to appear with no <code>@create</code> needed</li><li>allow a table to go from &quot;original schema&quot; (no annotation) to <code>@recreate</code> but not back</li><li>allow a table to go from <code>@recreate</code> to <code>@create</code> at the current schema version</li><li>allow a table to go from recreate directly to <code>@delete</code> at the current schema version</li><li>do not allow a table to go from <code>@create</code> or <code>@delete</code> state to <code>@recreate</code></li></ul><p>All of these are statically checked.</p><p>To use these tools, you must run CQL in a mode where it has both the proposed and existing schema in its input stream,
then it can provide suitable errors if any unsupported change is about to happen.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="basic-usage"></a>Basic Usage<a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-usage" title="Direct link to heading">#</a></h3><p>The normal way that you do previous schema validation is to create an input file that provides both schema.</p><p>This file looks maybe something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- prev_check.sql</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  new_field </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>So here the old version of <code>foo</code> will be validated against the new version and all is well.  A new nullable text field was added at the end.</p><p>In practice these comparisons are liklely to be done in a somewhat more maintainable way, like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- prev_check.sql</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table1.sql&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table2.sql&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table3.sql&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;previous.sql&quot;</span></div></div></div></div></div><p>Now importantly in this configuration, everything that follows the <code>@previous_schema</code> directive does not actually contribute to
the declared schema.  Which means the <code>--rt schema</code> result type will not see it.   Because of this you can do your checking
operation like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cc -E -x c prev_check.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg new_previous_schema.sql --rt schema</span></div></div></div></div></div><p>The above command will generate the schema in new_previous_schema and, if this command succeeds, it&#x27;s safe to replace the existing
<code>previous.sql</code> with <code>new_previous_schema</code>.</p><p>NOTE: you can bootstrap the above by leaving off the <code>@previous_schema</code> and what follows to get your first previous schema from the command above.</p><p>Now as, you can imagine, comparing against the previous schema allows many more kinds of errors to be discovered.
What follows is a large chuck of the CQL tests for this area taken from the test files themselves.
For easy visibility I have brought each fragment of current and previous schema close to each other
and I show the errors that are reported.  We start with a valid fragment and go from there.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-1--no-problemo"></a>Case 1 : No problemo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-1--no-problemo" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deletor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deletor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The table <code>foo</code> is the same!  Doesn&#x27;t get any easier than that.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-2--table-create-version-changed"></a>Case 2 : table create version changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-2--table-create-version-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_create_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_create_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_create_verison_changed&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the version a table was created in.  Here the new schema says it appeared in version 1.  The old schema says 2.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-3--table-delete-version-changed"></a>Case 3 : table delete version changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-3--table-delete-version-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_delete_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_delete_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_delete_verison_changed&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the version a table was deleted in.  Here the new schema says it was gone in version 1.  The old schema says 2.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-4--table-not-present-in-new-schema"></a>Case 4 : table not present in new schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-4--table-not-present-in-new-schema" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- t_not_present_in_new_schema is gone</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_not_present_in_new_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">176</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> was present but now it</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">does </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_not_present_in_new_schema&#x27;</span></div></div></div></div></div><p>So here <code>t_not_present_in_new_schema</code> was removed, it should have been marked with <code>@delete</code>.  You don&#x27;t remove tables.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-5--table-is-now-a-view"></a>Case 5 : table is now a view<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-5--table-is-now-a-view" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> t_became_a_view </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_became_a_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : object was a </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> but </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> now a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_became_a_view&#x27;</span></div></div></div></div></div><p>Tables can&#x27;t become views...</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-6--table-was-in-base-schema-now-created"></a>Case 6 : table was in base schema, now created<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-6--table-was-in-base-schema-now-created" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_created_in_wrong_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_created_in_wrong_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">27</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_created_in_wrong_version&#x27;</span></div></div></div></div></div><p>Here a version annotation is added after the fact.  This item was already in the base schema.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-7-table-was-in-base-schema-now-deleted-ok"></a>Case 7: table was in base schema, now deleted (ok)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-7-table-was-in-base-schema-now-deleted-ok" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_was_correctly_deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_was_correctly_deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>No errors here, regular delete.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-8-column-name-changed"></a>Case 8: column name changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-8-column-name-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_name_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_name_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">33</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id_&#x27;</span></div></div></div></div></div><p>You can&#x27;t rename columns.  We could support this but it&#x27;s a bit of maintenance nightmare and logical renames are possible easily without doing physical renames.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-9--column-type-changed"></a>Case 9 : column type changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-9--column-type-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_type_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_type_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">36</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id&#x27;</span></div></div></div></div></div><p>Can&#x27;t change the type of a column.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-10--column-attribute-changed"></a>Case 10 : column attribute changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-10--column-attribute-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_attribute_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_attribute_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">39</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id&#x27;</span></div></div></div></div></div><p>Change of column attributes counts as a change of type.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-11-column-version-changed-for-delete"></a>Case 11: column version changed for delete<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-11-column-version-changed-for-delete" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_delete_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_delete_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the delete version after it has been set.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-12--column-version-changed-for-create"></a>Case 12 : column version changed for create<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-12--column-version-changed-for-create" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_create_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_create_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">45</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the create version after it has been set.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-13--column-default-value-changed"></a>Case 13 : column default value changed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-13--column-default-value-changed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">48</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the default value after the fact.  There&#x27;s no alter statement that would allow this even though it makes some logical sense.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-14--column-default-value-did-not-change-ok"></a>Case 14 : column default value did not change (ok)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-14--column-default-value-did-not-change-ok" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>No change. No error here.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-15--create-table-with-additional-attribute-present-and-matching-ok"></a>Case 15 : create table with additional attribute present and matching (ok)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-15--create-table-with-additional-attribute-present-and-matching-ok" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>No change. No error here.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-16--create-table-with-additional-attribute-doesnt-match"></a>Case 16 : create table with additional attribute (doesn&#x27;t match)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-16--create-table-with-additional-attribute-doesnt-match" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_mismatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_mismatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">57</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> pk_def : a </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> facet </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> the previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-17--column-removed"></a>Case 17 : column removed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-17--column-removed" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_columns_removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_columns_removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">255</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : items have been removed </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> the </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rather than marked </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_columns_removed&#x27;</span></div></div></div></div></div><p>You can&#x27;t remove columns from tables.  You have to mark them with <code>@delete</code> instead.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-18--create-table-with-added-facet-not-present-in-the-previous"></a>Case 18 : create table with added facet not present in the previous<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-18--create-table-with-added-facet-not-present-in-the-previous" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_attribute_added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_attribute_added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">63</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> pk_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has a facet that </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_attribute_added&#x27;</span></div></div></div></div></div><p>Table facets like primary keys cannot be added after the fact. There is no way to do this in sqlite.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-19--create-table-with-additional-column-and-no-create"></a>Case 19 : create table with additional column and no <code>@create</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-19--create-table-with-additional-column-and-no-create" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">66</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has </span><span class="token keyword" style="font-style:italic">columns</span><span class="token plain"> added without marking</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">them </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_additional_column&#x27;</span></div></div></div></div></div><p>If you add a new column like <code>b</code> above you have to mark it with <code>@create</code> in a suitable version.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-20--create-table-with-additional-column-and-create-ok"></a>Case 20 : create table with additional column and `<code>@create</code> (ok)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-20--create-table-with-additional-column-and-create-ok" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Column properly created.  No errors here.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-21--create-table-with-different-flags-like-temp"></a>Case 21 : create table with different flags (like TEMP)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-21--create-table-with-different-flags-like-temp" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_becomes_temp_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_becomes_temp_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">72</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> statement attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">different than previous version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_becomes_temp_table&#x27;</span></div></div></div></div></div><p>Table became a TEMP table, there is no way to generate an alter statement for that.  Not allowed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-22--create-table-and-apply-annotation-ok"></a>Case 22 : create table and apply annotation (ok)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-22--create-table-and-apply-annotation-ok" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span></div></div></div></div></div><p>No errors here, properly created new table.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-23--create-new-table-without-annotation-error"></a>Case 23 : create new table without annotation (error)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-23--create-new-table-without-annotation-error" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_no_annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">85</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : new </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_no_annotation&#x27;</span></div></div></div></div></div><p>This table was added with no annotation.  It has to have an @create and be at least version 6, the current largest.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-24--create-new-table-stale-annotation-error"></a>Case 24 : create new table stale annotation (error)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-24--create-new-table-stale-annotation-error" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_stale_annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">91</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : new </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_stale_annotation&#x27;</span></div></div></div></div></div><p>The schema is already up to version 6.  You can&#x27;t then add a table in the past at version 2.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-25--add-columns-to-table-marked-create-and-delete"></a>Case 25 : add columns to table, marked <code>@create</code> and <code>@delete</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-25--add-columns-to-table-marked-create-and-delete" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_create_and_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_create_and_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">96</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has newly added </span><span class="token keyword" style="font-style:italic">columns</span><span class="token plain"> that are</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">marked both </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_create_and_delete&#x27;</span></div></div></div></div></div><p>Adding a column in the new version and marking it both create and delete is ... weird... don&#x27;t do that.  You can do it but you have to do it one step at a time.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-26--add-columns-to-table-marked-create-correctly"></a>Case 26 : add columns to table, marked <code>@create</code> correctly<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-26--add-columns-to-table-marked-create-correctly" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_legit_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_legit_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>No errors here, new column added in legit version.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-27--create-table-with-a-create-migration-proc-where-there-was-none"></a>Case 27 : create table with a create migration proc where there was none<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-27--create-table-with-a-create-migration-proc-where-there-was-none" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ACreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">104</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_create_migrator&#x27;</span></div></div></div></div></div><p>You can&#x27;t add a create migration proc after the fact.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-28--create-table-with-a-different-create-migration-proc"></a>Case 28 : create table with a different create migration proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-28--create-table-with-a-different-create-migration-proc" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ACreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADifferentCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">104</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_create_migrator&#x27;</span></div></div></div></div></div><p>You can&#x27;t change a create migration proc after the fact.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-29--create-table-with-a-delete-migration-proc-where-there-was-none"></a>Case 29 : create table with a delete migration proc where there was none<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-29--create-table-with-a-delete-migration-proc-where-there-was-none" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">107</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_delete_migrator&#x27;</span></div></div></div></div></div><p>You can&#x27;t add a delete migration proc after the fact.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-30--create-table-with-a-different-delete-migration-proc"></a>Case 30 : create table with a different delete migration proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-30--create-table-with-a-different-delete-migration-proc" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADifferentDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">107</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_delete_migrator&#x27;</span></div></div></div></div></div><p>You can&#x27;t change a delete migration proc after the fact.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-31--create-a-table-which-was-a-view-in-the-previous-schema"></a>Case 31 : create a table which was a view in the previous schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-31--create-a-table-which-was-a-view-in-the-previous-schema" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> view_becomes_a_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_becomes_a_table </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">110</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : object was a </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> but </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> now a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_becomes_a_table&#x27;</span></div></div></div></div></div><p>Converting views to tables is not allowed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-32--delete-a-view-without-marking-it-deleted"></a>Case 32 : delete a view without marking it deleted<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-32--delete-a-view-without-marking-it-deleted" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- no matching view in current schema</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_zomg_deleted </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">333</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> was present but now it does</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_was_zomg_deleted&#x27;</span></div></div></div></div></div><p>Here the view was deleted rather than marking it with <code>@delete</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-33--create-a-new-version-of-this-view-that-is-not-temp"></a>Case 33 : create a new version of this view that is not temp<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-33--create-a-new-version-of-this-view-that-is-not-temp" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_temp_but_now_it_is_not </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">temp</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_temp_but_now_it_is_not </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">339</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> property changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> new</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_was_temp_but_now_it_is_not&#x27;</span></div></div></div></div></div><p>A temp view became a view.  This flag is not allowed to change.  Side note: temp views are weird.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-34--create-a-new-version-of-this-view-that-was-created-in-a-different-version"></a>Case 34 : create a new version of this view that was created in a different version<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-34--create-a-new-version-of-this-view-that-was-created-in-a-different-version" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_with_different_create_version </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_with_different_create_version </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">116</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_with_different_create_version&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the create version of a view after the fact.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-35--create-an-index-that-is-now-totally-gone-in-the-new-schema"></a>Case 35 : create an index that is now totally gone in the new schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-35--create-an-index-that-is-now-totally-gone-in-the-new-schema" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- no matching index in current schema</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_was_deleted_with_no_annotation </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">349</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_index_stmt : </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> was present but now it</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">does </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_was_deleted_with_no_annotation&#x27;</span></div></div></div></div></div><p>You have to use <code>@delete</code> on indices to remove them correctly.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-36--create-a-view-with-no-annotation-that-is-not-in-the-previous-schema"></a>Case 36 : create a view with no annotation that is not in the previous schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-36--create-a-view-with-no-annotation-that-is-not-in-the-previous-schema" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_created_with_no_annotation </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- there is no previous version</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">122</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : new </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_created_with_no_annotation&#x27;</span></div></div></div></div></div><p>You have to use <code>@create</code> on views to create them correctly.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-37--index-created-in-different-version"></a>Case 37 : index created in different version<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-37--index-created-in-different-version" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_has_a_changed_attribute </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_has_a_changed_attribute </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">125</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_has_a_changed_attribute&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the <code>@create</code> version of an index.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-38--create-a-new-index-but-with-no-create-annotation"></a>Case 38 : create a new index but with no <code>@create</code> annotation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-38--create-a-new-index-but-with-no-create-annotation" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_was_created_with_no_annotation </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- there is no previous version</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">130</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_index_stmt : new </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_was_created_with_no_annotation&#x27;</span></div></div></div></div></div><p>You have to use <code>@create</code> on indices to make new ones.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-39--create-a-table-with-a-column-def-that-has-a-different-create-migrator-proc"></a>Case 39 : create a table with a column def that has a different create migrator proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-39--create-a-table-with-a-column-def-that-has-a-different-create-migrator-proc" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> create_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ChangedColumnCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> create_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PreviousColumnCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">136</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the <code>@create</code> migration stored proc on columns.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-40--create-a-table-with-a-column-def-that-has-a-different-delete-migrator-proc"></a>Case 40 : create a table with a column def that has a different delete migrator proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-40--create-a-table-with-a-column-def-that-has-a-different-delete-migrator-proc" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> delete_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ChangedColumnDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> delete_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PreviousColumnDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">142</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span></div></div></div></div></div><p>You can&#x27;t change the <code>@delete</code> migration stored proc on columns.</p><p>NOTE: in addition to these errors, there are many more that do not require the previous schema which are also checked (not shown here).  These comprise things like making sure the delete version is greater than the create version on any item.  There is a lot of sensibility checking that can happen without reference to the previous schema.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-12-testability-features"></a>Chapter 12: Testability Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-12-testability-features" title="Direct link to heading">#</a></h2><p>CQL includes a number of features to make it easier to create what you might call &quot;Test&quot; procedures.  These primarily are concerned with loading up the database with dummy data, and/or validating the result of normal procedures that query the database.  There are several interesting language features in these dimensions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dummy-data"></a>Dummy Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dummy-data" title="Direct link to heading">#</a></h3><p>Test code can be needlessly brittle, especially when creating dummy data; any column changes typically cause all sorts of data insertion code to need to be repaired.
In many cases the actual data values are completely uninteresting to the test -- any values would do.  There are several strategies you can use to get good dummy data into your database in a more maintainable way.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="simple-inserts-with-dummy-data"></a>Simple Inserts With Dummy Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#simple-inserts-with-dummy-data" title="Direct link to heading">#</a></h4><p>The simplest form uses a variant of the insert statement that fills in any missing columns with a seed value.  An example might be something like the below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> dummy_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> users </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This statement causes all values including columns that are nullable or have a default value to get the value <code>123</code> for any numeric type and
<code>&#x27;column_name_123&#x27;</code> for any text.</p><p>If you omit the <code>@dummy_nullables</code> then any nullable fields will be null as usual.  And likewise if you omit <code>@dummy_defaults</code> then any fields with a default value will use thatt value as usual.  You might want any combination of those for your tests (null values are handy in your tests and default behavior is also handy).</p><p>The <code>@dummy_seed</code> expression provided can be anything that resolves to a non-null integer value, so it can be pretty flexible.  You might use a <code>while</code> loop to insert a bunch of
rows with the seed value being computed from the <code>while</code> loop variable.</p><p>The form above is sort of like <code>insert * into table</code> in that it is giving dummy values for all columns but you can also specify some of the columns while using the seed value for others.  Importantly, you can specify values you particularly want to control either for purposes of creating a more tailored test or because you need them
to match existing or created rows in a table referenced by a foreign key.</p><p>As an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> users </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1234</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Will provide dummy values for everything but the <code>id</code> column.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-with-recursive"></a>Using <code>WITH RECURSIVE</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-with-recursive" title="Direct link to heading">#</a></h4><p>Sometimes what you want to do is create a dummy result set without necessarly popuplating the database at all.  If you have code
that consumes a result set of a particular shape it&#x27;s easy enough to create a fake result set with a pattern something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> dummy_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lim </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> RECURSIVE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> lim</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    x id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> is_cool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    x </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    x etc1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    x etc2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The first part of the above creates a series of numbers from 1 to <code>lim</code>.  The second uses those values to create dummy columns.
Any result shape can be generated in this fashion.</p><p>You get data like this from the above:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1|name_1|1|1.3|1|1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2|name_2|0|2.6|2|2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3|name_3|1|3.9|3|3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">4|name_4|0|5.2|4|4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5|name_5|1|6.5|5|5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6|name_6|0|7.8|6|6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7|name_7|1|9.1|7|7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">8|name_8|0|10.4|8|8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">9|name_9|1|11.7|9|9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">10|name_10|0|13.0|10|10</span></div></div></div></div></div><p>The result of the select statement is itself quite flexible and if more dummy data is what you wanted, this form can be combined with
<code>INSERT ... FROM SELECT...</code> to create dummy data in real tables.   And of course once you have a core query you could use it in a variety of ways
combined with cursors or any other strategy to <code>select</code> out pieces and <code>insert</code> them into various tables.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-temporary-tables"></a>Using Temporary Tables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-temporary-tables" title="Direct link to heading">#</a></h4><p>If you need an API to create very flexible dummy data with values of your choice you can use temporary tables and a series of helper procedures.</p><p>First, create a table to hold the results. You can of course make this table however you need to but the <code>like</code> construct in the table creation
is especially helpful; it creates columns in the table that match the name and type of the named object.  For instance <code>like my_proc</code> is shorthand for the column names ands of the shape that <code>my_proc</code> returns.  This is perfect for
emulating the results of <code>my_proc</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> begin_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">exists</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the shape of my_dummy_data matches the columns</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- returned by proc_I_want_to_emulate</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">temp</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> proc_I_want_to_emulate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Next, you will need a procedure that accepts and writes a single row to your temp table.  You can of course write this all explicitly but the testing
support features provide more support to make things easier; In this example, arguments  of the procedure will exactly match the output of the procedure we emulating,
one argument for each column the proc returns. The <code>insert</code> statement gets its values from the arguments.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> add_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> proc_I_want_to_emulate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_dummy_data </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This allows you to create the necessary helper methods automatically even if the procedure changes over time.</p><p>Next we need a procedure to get our result set.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>And finally, some cleanup.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> cleanup_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">exists</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Again the temp table could be combined with <code>INSERT INTO ...FROM SELECT...</code> to create dummy data in real tables.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="other-considerations-1"></a>Other Considerations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#other-considerations-1" title="Direct link to heading">#</a></h4><p>Wrapping your <code>insert</code> statements in <code>try/catch</code> can be very useful if there may be dummy data conflicts.  In test code searching for a new suitable seed is pretty easy.  Alternatively</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> seed :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Could be very useful.  Many alternatives are possible.</p><p>The dummy data features are not suitable for use in production code, only tests.  But the LIKE features are generally useful for creating contract-like behavior in procs and there
are reasonable uses for them in production code.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="complex-result-set-example"></a>Complex Result Set Example<a aria-hidden="true" tabindex="-1" class="hash-link" href="#complex-result-set-example" title="Direct link to heading">#</a></h4><p>Here&#x27;s a more complicated example that can be easily rewritten using the sugar features.  This method is designed to
return a single-row result set that can be used to mock a method.  I&#x27;ve replaced the real fields with &#x27;f1, &#x27;f2&#x27; etc.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f1_ LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f2_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f3_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f4_ LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f5_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f6_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f7_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f8_ </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f9_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  f10_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> data_cursor </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> data_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">f1_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f2_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f3_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f4_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f5_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f6_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f7_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f8_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f9_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> data_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This can be written much more maintainably as:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Naturally real columns have much longer names and there are often a lot more than 10.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="autotest-attributes"></a>Autotest Attributes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#autotest-attributes" title="Direct link to heading">#</a></h3><p>Some of the patterns described above are so common that CQL offers a mechanism to automatically generate those test procedures.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="temporary-table-pattern"></a>Temporary Table Pattern<a aria-hidden="true" tabindex="-1" class="hash-link" href="#temporary-table-pattern" title="Direct link to heading">#</a></h4><p>The attributes dummy_table, dummy_insert, and dummy_select can be used together to create and populate temp tables.</p><p>Example:</p><p>To create a dummy row set for <code>sample_proc</code>, add the cql:autotest attribute with dummy_table, dummy_insert, and dummy_select values.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:autotest</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dummy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dummy_insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dummy_select</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p><code>dummy_table</code> generates procedures for creating and dropping a temp table with the same shape as <code>sample_proc</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> open_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> close_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>dummy_insert</code> attribute generates a procedure for inserting into the temp table.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_sample_proc </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>dummy_select</code> attribute generates procedures for selecting from the temp table.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>It&#x27;s interesting to note that the generated test code does not ever
need to mention the exact columns it is emulating because it can always use <code>like</code>, <code>*</code>, and <code>from arguments</code> in a generic way.</p><p>When compiled, the above will create C methods that can create, drop, insert, and select from the temp table.  They will have the following signatures:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code open_sample_proc(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code close_sample_proc(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code insert_sample_proc(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_string_ref _Nonnull name_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code select_sample_proc_fetch_results(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_sample_proc_result_set_ref _Nullable *_Nonnull result_set);</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="single-row-resultset"></a>Single Row ResultSet<a aria-hidden="true" tabindex="-1" class="hash-link" href="#single-row-resultset" title="Direct link to heading">#</a></h4><p>In some cases, using four APIs to generate fake data can be verbose.
In the case that only a single row of data needs to be faked, the dummy_result_set attribute can be more convenient.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:autotest</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dummy_result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Will generate the following procedure</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> generate_sample_proc_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> curs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Which generates this C API:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">void generate_sample_proc_row_fetch_results(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    generate_sample_proc_row_rowset_ref _Nullable *_Nonnull result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    string_ref _Nonnull foo_,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int64_t bar_);</span></div></div></div></div></div><p>These few test helpers are useful in a variety of scenarios and can save you a lot of typing and maintenance.  They evolve automatically as the code
changes, always matching the signature of the attributed procedure.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="generalized-dummy-test-pattern"></a>Generalized Dummy Test Pattern<a aria-hidden="true" tabindex="-1" class="hash-link" href="#generalized-dummy-test-pattern" title="Direct link to heading">#</a></h4><p>The most flexible test helper is the <code>dummy_test</code> form.  This is far more advanced than the simple helpers above.  While the choices above were designed to help you create fake result sets pretty easily, <code>dummy_test</code> goes much further letting you set up arbitrary schema and data so that you can run your procedure on actual data.  The <code>dummy_test</code> code generator uses the features above to do its job and like the other autotest options, it works by automatically generating CQL code from your procedure definition.  However, you get a lot more code in this mode.  It&#x27;s easiest to study an example so let&#x27;s begin there.</p><p>To understand <code>dummy_test</code> we&#x27;ll need a more complete example, so let&#x27;s start with this simple two-table schema with a trigger and some indices. To this we add a very small procedure that we might want to test.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table foo(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer not null primary key,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> name text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table bar(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer not null primary key references foo(id),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> data text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create index foo_index on foo(name);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create index bar_index on bar(data);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create temp trigger if not exists trigger1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  before delete on foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from foo where name = &#x27;this is so bogus&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:autotest=(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_table,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_insert,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_select,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_result_set,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (dummy_test, (bar, (data), (&#x27;plugh&#x27;))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc the_subject()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from bar;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><p>As you can see, we have two tables <code>foo</code> and <code>bar</code>; the <code>foo</code> table has a trigger;  both <code>foo</code> and <code>bar</code> have indices.  This schema is very simple, but of course it could be a lot more complicated, and real cases typically are.</p><p>The procedure we want to test is creatively called <code>the_subject</code>.  It has lots of test attributes on it.  We&#x27;ve already discussed <code>dummy_table</code>, <code>dummy_insert</code>, <code>dummy_select</code>, and <code>dummy_result_set</code> above but as you can see they can be mixed in with <code>dummy_test</code>.  Now let&#x27;s talk about <code>dummy_test</code>.  First you&#x27;ll notice that annotation has additional sub-attributes;  The attribute grammar is sufficiently flexible that,  in principle, you could represent an arbitary LISP program, so the instructions can be very detailed.  In this case the attribute provides table and column names, as well as sample data.  We&#x27;ll discuss that when we get to the population code.</p><p>First let&#x27;s dispense with the attributes we already discussed -- since we had all the attributes, the output will include those helpers, too.  Here they are again:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note that the code does not actually call the test subject</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this declaration is used so that CQL will know the shape of the result</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> the_subject </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> open_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> close_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_the_subject </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> generate_the_subject_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> curs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>That covers what we had before, so, what&#x27;s new?  Actually quite a bit.  We&#x27;ll begin with the easiest:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REFERENCES</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Probably the most important of all the helpers, <code>test_the_subject_create_tables</code> will create all the tables you need to run the procedure.  Note that in this case, even though the subject code only references <code>bar</code>, CQL determined that <code>foo</code> is also needed because of the foreign key.</p><p>The symmetric drop procedure is also generated:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Additionally, in this case there were triggers and indices.  This caused the creation of helpers for those aspects.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> bar_index </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> bar </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> foo_index </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEFORE </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this is so bogus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>If there are no triggers or indices the corresponding create/drop methods will not be generated.</p><p>With these helpers available, when writing test code you can then choose if you want to create just the tables, or the tables and indices, or tables and indices and triggers by invoking the appropriate combination of helper methods.  Since all the implicated triggers and indices are automatically included, even if they change over time, maintenance is greatly simplified.</p><p>Note that in this case the code simply reads from one of the tables but in general the procedure under test might make modifications as well.  Test code frequently has to read back the contents of the tables to verify that they were modified correctly.  So these additional helper methods are also included:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_read_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_read_bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Those procedures will allow you to easily create result sets with data from the relevant tables which can then be verified for correctness.  Of course if more tables were implicated those would have been included as well.</p><p>As you can see the naming always follows the convention <code>test_[YOUR_PROCEDURE]_[helper_type]</code></p><p>Finally, the most complicated helper is the one that used that large annotation.  Recall that we provided the fragment <code>(dummy_test, (bar, (data), (&#x27;plugh&#x27;))))</code> to the compiler.  This fragment helped to produce this last helper function:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_populate_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;plugh&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">125</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">126</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In general the <code>populate_tables</code> helper will fill all implicated tables with at least two rows of data.  It uses the dummy data features discussed earlier to generate the items using a seed.  Recall that if <code>@dummy_seed</code> is present in an <code>insert</code> statement then any missing columns are generated using that value, either as a string, or as an integer (or true/false for a boolean).   Note that the second of the two rows that is generated also specifies <code>@dummy_nullables</code> and <code>@dummy_defaults</code>.  This means that even nullable columns, and columns with a default value will get the non-null seed instead.  So you get a mix of null/default/explicit values loaded into your tables.</p><p>Of course blindly inserting data doesn&#x27;t quite work.  As you can see, the insert code used the foreign key references in the schema to figure out the necessary insert order and the primary key values for <code>foo</code> were automatically specified so that they could then be used again in <code>bar</code>.</p><p>Lastly, the autotest attribute included explicit test values for the table <code>bar</code>, and  in particular the <code>data</code> column has the value <code>&#x27;plugh&#x27;</code>.  So the first row of data for table <code>bar</code> did not use dummy data for the <code>data</code> column but rather used <code>&#x27;plugh&#x27;</code>.</p><p>In general, the <code>dummy_test</code> annotation can include any number of tables, for each table you can specify any of the columns and you can have any number of tuples of values for those columns.</p><p>NOTE: if you include primary key and/or foreign key columns among the explicit values it&#x27;s up to you to ensure that they are valid combinations.  SQLite will complain as usual if they are not, but the CQL compiler will simply emit the data you asked for.</p><p>Generalizing the example a little bit, we could use the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(dummy_test, (foo, (name), (&#x27;fred&#x27;), (&#x27;barney&#x27;), (&#x27;wilma&#x27;), (&#x27;betty&#x27;)),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        (bar, (id, data), (1, &#x27;dino&#x27;), (2, &#x27;hopparoo&#x27;))))</span></div></div></div></div></div><p>to generate this population:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROC test_the_subject_populate_tables()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;fred&#x27;, 1) @dummy_seed(123);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;barney&#x27;, 2) @dummy_seed(124)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;wilma&#x27;, 3) @dummy_seed(125);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;betty&#x27;, 4) @dummy_seed(126)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO bar(id, data) VALUES(1, &#x27;dino&#x27;) @dummy_seed(127);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO bar(id, data) VALUES(2, &#x27;hopparoo&#x27;) @dummy_seed(128)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div></div></div></div></div><p>And of course if the annotation is not flexible enough, you can write your own data population as usual.</p><p>The CQL above results in the usual C signatures.  For instance:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-C codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code test_the_subject_populate_tables(sqlite3 *_Nonnull _db_);</span></div></div></div></div></div><p>So it&#x27;s fairly easy to call from C/C++ test code or from CQL test code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-13-json-output"></a>Chapter 13: JSON Output<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-13-json-output" title="Direct link to heading">#</a></h2><p>To help facilitate additional tools that might want to depend on CQL input files further down the toolchain CQL includes a JSON output format for SQL DDL as well as stored procedure information, including special information for a single-statement DML.  &quot;Single-statement DML&quot; refers to those stored procedures that that consist of a single <code>insert</code>, <code>select</code>, <code>update</code>, or <code>delete</code>.   Even though such procedures are just one statement, good argument binding can create very powerful DML fragments that are re-usable.  Many CQL stored procedures are of this form (in practice maybe 95% are just one statement).</p><p>Below are some examples of the JSON output taken from a CQL test file.  Note that the JSON has free text inserted into it as part of the test output, that obviously doesn&#x27;t appear in the final output but it is especially illustrative here.  This example illustrates almost all the possible JSON fragments.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tables&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Each table appears fully formed in its own JSON hunk as below.  <code>isAdded</code> and <code>isDeleted</code> correspond to the presence of an <code>@create</code> or <code>@delete</code> annotation respectively.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE Foo(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER NOT NULL,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name TEXT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;temp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;withoutRowid&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;uniqueKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;indices&quot; : [ &quot;region_0_index&quot;, &quot;MyIndex&quot;, &quot;MyOtherIndex&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Here we introduce a primary key and its JSON.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T2(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER PRIMARY KEY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;temp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;withoutRowid&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [ &quot;id&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>General purpose column information is also present.  Again a fragment for brevity.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T3(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER UNIQUE AUTOINCREMENT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Columns and tables can have flexible attributes which are used downstream.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @ATTRIBUTE(foo=bar)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T4(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @ATTRIBUTE(cool)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T4&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;attributes&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;name&quot; : &quot;cool&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;value&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;attributes&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;value&quot; : &quot;bar&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Here&#x27;s an example with revision marks</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T8(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ) @CREATE(1) @DELETE(3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T8&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;temp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;withoutRowid&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isAdded&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isDeleted&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The usual constraints are also recorded.   This example has a unqiue key on a column and foreign keys.  Note that the unique key is reported the same as if it had been declared in a standalone fashion.  There is a lot of stuff in this table...</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T10(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id1 INTEGER UNIQUE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id2 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id3 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id4 INTEGER UNIQUE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      PRIMARY KEY (id1, id2),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id1, id2) REFERENCES T9 (id2, id1),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      CONSTRAINT uk1 UNIQUE (id2, id3),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      CONSTRAINT uk2 UNIQUE (id3, id4)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T10&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id4&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [ &quot;id1&quot;, &quot;id2&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot;, &quot;id2&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T9&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id2&quot;, &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;uniqueKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id1_uk&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id4_uk&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id4&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;uk1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id2&quot;, &quot;id3&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;uk2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id3&quot;, &quot;id4&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Foreign keys can include the full set of actions.  Here are a couple of examples:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T11(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id1 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id2 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id3 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id1) REFERENCES T9 (id1) ON DELETE CASCADE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id1) REFERENCES T9 (id1) ON UPDATE SET NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T11&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T9&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;CASCADE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T9&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;SET NULL&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Deferred FK actions can also be specified.  Note: per the SQLite documentation, the norm is immediate on everything except <code>deferrable initially deferred</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE T12(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id1 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id2 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id3 INTEGER,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id1) REFERENCES T9 (id1) ON DELETE SET DEFAULT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       DEFERRABLE INITIALLY DEFERRED,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id2) REFERENCES T9 (id1) ON UPDATE NO ACTION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;T12&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T9&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;SET DEFAULT&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id2&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T9&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Just like unique keys, foreign keys on the columns are moved down as though they had been independently declared.  There are 3 foreign keys below.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE with_fk_on_columns(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id1 INTEGER NOT NULL REFERENCES T2 (id) ON UPDATE CASCADE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        DEFERRABLE INITIALLY DEFERRED,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id2 INTEGER NOT NULL REFERENCES T10 (id4) ON DELETE CASCADE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FOREIGN KEY (id1, id2) REFERENCES T10 (id3, id4)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;with_fk_on_columns&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;temp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;withoutRowid&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T2&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;CASCADE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id2&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T10&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id4&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;CASCADE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;columns&quot; : [ &quot;id1&quot;, &quot;id2&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceTable&quot; : &quot;T10&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;referenceColumns&quot; : [ &quot;id3&quot;, &quot;id4&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onUpdate&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;onDelete&quot; : &quot;NO ACTION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeferred&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;uniqueKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><p>Columns can be marked with <code>@sensitive</code> for privacy reasons.  This declaration flows to the column description as <code>isSensitive</code>.  For economy, <code>isSenstive</code> is only emitted when true.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE TABLE radioactive(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id INTEGER NOT NULL,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      danger TEXT @SENSITIVE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;radioactive&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isTemp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;withoutRowid&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isRecreated&quot;: 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;danger&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isSensitive&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAdded&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isDeleted&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isPrimaryKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isUniqueKey&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isAutoIncrement&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;primaryKey&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;foreignKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;uniqueKeys&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div></div></div></div></div><p>The next major section is the views.  Each view includes its projection (that is the net columns it creates from the select clause) and its general statement information.  One example tells the story pretty clearly.  Views don&#x27;t have arguments in any supported cases but the arguments are included for symmetry with the other forms.  Note: projection columns can be sensitive and will be so-marked if they are.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;views&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE VIEW MyView AS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FROM Foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;MyView&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;temp&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;projection&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;select&quot; : &quot;SELECT id, name FROM Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;selectArgs&quot; : [  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Likewise indices contain the table and indexed columns.  This one example illustrates things fairly clearly.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;indices&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE UNIQUE INDEX IF NOT EXISTS MyIndex ON Foo (name DESC, id ASC)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;MyIndex&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;isUnique&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;ifNotExists&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [ &quot;name&quot;, &quot;id&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;sortOrders&quot; : [ &quot;desc&quot;, &quot;asc&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div></div></div></div></div><p>The top level attributes go, by convention, on a the global variable named <code>database</code> of type <code>object</code>.  These attributes move into the JSON.  Other globals are ignored.</p><p>NOTE: attributes are very flexible, allowing nesting of arrays.  Attributes values can either be any literal, or a name, or an array of values, recursively.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @ATTRIBUTE(my_other_attribute=(&#x27;any&#x27;, (&#x27;tree&#x27;, &#x27;of&#x27;), &#x27;values&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @ATTRIBUTE(dbname=&#x27;fred.sql&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @ATTRIBUTE(dbfile=&#x27;cg_test_mlite_query.sql&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DECLARE database OBJECT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;attributes&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;my_other_attribute&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;value&quot; : [&quot;any&quot;, [&quot;tree&quot;, &quot;of&quot;], &quot;values&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;dbname&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;value&quot; : &quot;fred.sql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;dbfile&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;value&quot; : &quot;cg_test_mlite_query.sql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The queries section corresponds to the stored procedures with a SELECT statement.  There is significant data provided about each one.</p><ul><li>the name of the procedure</li><li>the number and type of arguments</li><li>the set of tables used anywhere in the query (for dependencies)<ul><li>this includes tables used within views that were used</li></ul></li><li>the query projection (aka the result shape of the select)</li><li>the full SQL statement and the arguments that should be bound to each <code>?</code></li></ul><p>There are two examples below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;queries&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC a_query (pattern TEXT NOT NULL, reject TEXT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FROM Foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHERE name LIKE pattern AND name &lt;&gt; reject;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;a_query&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;pattern&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;reject&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;projection&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;SELECT id FROM Foo WHERE name LIKE ? AND name &lt;&gt; ?&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;pattern&quot;, &quot;reject&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC bigger_query (pattern TEXT NOT NULL, reject TEXT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT DISTINCT *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FROM Foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHERE name LIKE pattern AND name &lt;&gt; reject</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      GROUP BY name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      HAVING name &gt; reject</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ORDER BY pattern</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      LIMIT 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      OFFSET 3;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;bigger_query&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;pattern&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;reject&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;projection&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;SELECT DISTINCT id, name FROM Foo WHERE name LIKE ? AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name &lt;&gt; ? GROUP BY name HAVING name &gt; ? ORDER BY ?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          LIMIT 1 OFFSET 3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;pattern&quot;, &quot;reject&quot;, &quot;reject&quot;, &quot;pattern&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The section on insert statements is very similar in shape.  Again the fields are:</p><ul><li>the name of the procedure</li><li>the arguments and argument types</li><li>the tables used by the insert statement (usually just the one but value expressions can be select statements so it can be more)</li><li>the table we are inserting into (certainly present in <code>usesTables</code>)</li><li>the overall statement and its arguments (easiest form to use)</li><li>the statement type (e.g. <code>INSERT</code> or <code>INSERT OR REPLACE</code>)</li><li>the inserted columns<ul><li>present even if the <code>insert into table values (...)</code> form was used</li></ul></li><li>the array of value expressions and arguments, one for each value</li></ul><p>Again, simple insert forms are readily recognized and complex forms are supported.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;inserts&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    The statement ending at line 277</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC insert_proc (id_ INTEGER NOT NULL, name_ TEXT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    INSERT OR REPLACE INTO Foo (id, name) VALUES (id_, name_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;insert_proc&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;INSERT OR REPLACE INTO Foo (id, name) VALUES (?, ?)&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;id_&quot;, &quot;name_&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementType&quot; : &quot;INSERT OR REPLACE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [ &quot;id&quot;, &quot;name&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;values&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;value&quot; : &quot;?&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;valueArgs&quot; : [ &quot;id_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;value&quot; : &quot;?&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;valueArgs&quot; : [ &quot;name_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>As another example, this fairly easy to write CQL transparently creates dummy values.  Great for use in testing.  The JSON shows the net insert created from the original source below.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC dummy_insert_proc (seed_ INTEGER NOT NULL)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    INSERT INTO Foo () VALUES () @DUMMY_SEED(seed_) @DUMMY_NULLABLES;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;dummy_insert_proc&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;seed_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;INSERT INTO Foo (id, name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            VALUES (?, printf(&#x27;name_%d&#x27;, ?))&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;_seed_&quot;, &quot;_seed_&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementType&quot; : &quot;INSERT&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [ &quot;id&quot;, &quot;name&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;values&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;value&quot; : &quot;?&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;valueArgs&quot; : [ &quot;_seed_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;value&quot; : &quot;printf(&#x27;name_%d&#x27;, ?)&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;valueArgs&quot; : [ &quot;_seed_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The above form can capture the simplest of the insert statements allowed in SQLite.  This is especially
interesting because the JSON above can cleanly capture each value and the only place where there might be
references to the procedure arguments is in the <code>valueArgs</code> portion. There is simply no room for any other
kind of variability.   As a result, it&#x27;s actually possible to take this type of insert and potentially
re-codegen it into an upsert or something else starting from the JSON.  This is isn&#x27;t in general possible
with the other forms of insert.  More compilicated forms of insert go into a section called &quot;generalInesrts&quot;
this includes any other single insert statement such as these forms:</p><ul><li>insert from multiple value rows</li><li>insert from a select statement</li><li>insert using a <code>WITH</code> clause</li><li>insert using the upsert clause</li></ul><p>The &quot;generalInserts&quot; section looks exactly like the &quot;inserts&quot; section except that it does not include &quot;values&quot;.</p><p>Here&#x27;s an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;generalInserts&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   CREATE PROC insert_compound ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    INSERT INTO T3(id) VALUES(1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    UNION ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT 1 AS column1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;insert_compound&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;definedInFile&quot; : &quot;cg_test_json_schema.sql&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;insertTables&quot; : [ &quot;T3&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;T3&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;T3&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;INSERT INTO T3(id) VALUES(1) UNION ALL SELECT 1 AS column1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementType&quot; : &quot;INSERT&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;columns&quot; : [ &quot;id&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div></div></div></div></div><p>Update statements are handled very much like the others, but there are no statement fragments.  You get these pieces:</p><ul><li>the name of the procedure and its arguments</li><li>dependency information</li><li>the statement text and its arguments</li></ul><p>This is the minimum information needed to bind and run the statement.  Note that arguments can be in any part of the update.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;updates&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    The statement ending at line 306</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC update_proc (id_ INTEGER NOT NULL, name_ TEXT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    UPDATE Foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET name = name_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHERE id = id_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ORDER BY name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      LIMIT 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;update_proc&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;id_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;UPDATE Foo SET name = ?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              WHERE id = ? ORDER BY name LIMIT 1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;name_&quot;, &quot;id_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The delete section looks exactly like the update section.</p><ul><li>procedure name and arguments</li><li>dependency information</li><li>statement and arguments</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;deletes&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    The statement ending at line 297</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC delete_proc (name_ TEXT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DELETE FROM Foo WHERE name LIKE name_;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;delete_proc&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;name_&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [ &quot;Foo&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;table&quot; : &quot;Foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statement&quot; : &quot;DELETE FROM Foo WHERE name LIKE ?&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;statementArgs&quot; : [ &quot;name_&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>And finally the section for procedures that were encountered that are not one of the simple prepared statement forms.  The principle reasons for being in this category are:</p><ul><li>the procedure has out arguments</li><li>the procedure uses something other than a single DML statement</li><li>the procedure has no projection (no result of any type)</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;general&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC with_complex_args (OUT pattern TEXT NOT NULL, INOUT arg REAL)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SELECT 1 AS a;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;with_complex_args&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;pattern&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;text&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;binding&quot; : &quot;out&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;arg&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;real&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;binding&quot; : &quot;inout&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;hasSelectResult&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;projection&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;a&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesDatabase&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC atypical_noreturn ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      DECLARE C CURSOR LIKE SELECT 1 AS A;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;atypical_noreturn&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesDatabase&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CREATE PROC typical_outresult ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      DECLARE C CURSOR LIKE SELECT 1 AS A;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      FETCH C (A) FROM VALUES (7);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      OUT C;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    END</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot; : &quot;typical_outresult&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;args&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesTables&quot; : [  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;hasOutResult&quot; : 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;projection&quot; : [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot; : &quot;A&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;type&quot; : &quot;integer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;isNotNull&quot; : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;usesDatabase&quot; : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Some additional properties not mentioned above that are worth noting:</p><ul><li>where <code>usesTables</code> appears there will also be more detailed information about how the tables were used<ul><li>the <code>insertTables</code> key will give you an array of the tables that were used as the target of an <code>insert</code> statement</li><li>the <code>updateTables</code> key will give you an array of the tables that were used as the target of an <code>update</code> statement</li><li>the <code>deleteTables</code> key will give you an array of the tables that were used as the target of an <code>delete</code> statement</li><li>the <code>fromTables</code> key will give you an array of tables that were used the the <code>from</code> clause of a select or some other <code>select</code>-ish context in which you only read from the table</li></ul></li><li>the <code>usesProcedures</code> key for a given proc has an array of the procedures it calls, this allows for complete dependency analysis if needed</li></ul><p>To use cql in this fashion:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in input.sql --rt json_schema --cg out.json</span></div></div></div></div></div><p>NOTE: <code>@ATTRIBUTE</code> can be applied any number of times to the entities here, including the procedures (i.e. immediately before the <code>CREATE PROCEDURE</code>) .  Those attributes appear in the JSON in an optional <code>attributes</code> chunk.  Attributes are quite flexible (you can easily encode a lisp program in attributes if you were so inclined) so you can use them very effectively to annotate your CQL entities as needed for downstream tools.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-14-cql-query-fragments"></a>Chapter 14: CQL Query Fragments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-14-cql-query-fragments" title="Direct link to heading">#</a></h2><p>CQL Query fragments are the most sophisticated rewrite CQL offers for productivity.  The idea is that a very large query
can be represented in &quot;fragments&quot; that add columns or add rows based on the original &quot;core&quot; query.  The final query
will be an assembled rewrite of all the fragments chained together.  Specifically, the motivation for this is that you
can have a &quot;core&quot; query that fetches the essential columns for some UI design and then you can add query extension
fragments that add new/additional columns for some new set of features.  The core and extended columns can be in their
own fragment and they can be compiled independently.  The result of this is that any errors are in much smaller
and easier to understand fragments rather than in some monster &quot;fetch everything&quot; query;  any given extension does not
have to know all the details of all the other extensions and can take a limited dependency on even the core query.</p><p>It&#x27;s easiest to illustrate this with an example so let&#x27;s begin there.</p><p>Let&#x27;s first start with this very simple schema.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table my_table(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer primary key,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> name text not null,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> rate real not null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table added_rows(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> like my_table -- sugar to duplicate the columns of my_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table added_columns(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer references my_table(id),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> data text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Typically there would be a lot more columns but where you see <code>flag1</code> and <code>flag2</code> appear in fragments you can imagine any number
of additional columns of any type.  So we can keep the examples simple.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="base-query-fragments"></a>Base Query Fragments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#base-query-fragments" title="Direct link to heading">#</a></h3><p>The base fragment might look something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:base_fragment=base_frag)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc base_frag_template(id_ integer not null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  with</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag(*) as (select * from my_table where my_table.id = id_)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    select * from base_frag;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><p>Here are the essential aspects:</p><ul><li>the base fragment is given a name, it can be anything, probably something that describes the purpose of the fragments</li><li>the procedure name can be anything at all</li><li>the procedure must consiste of exactly one <code>with...select</code> statement</li><li>the fragment name must be the one and only CTE in the select statement</li><li>you must select all the columns from the CTE</li></ul><p>Note the syntax helper <code>base_frag(*)</code> is just shorthand to avoid retyping all the column names of <code>my_table</code>.</p><p>The interesting part is <code>(select * from my_table where my_table.id = id_)</code> which could have been any select statement
of your choice. Everything else in the procedure must follow the designated format, and the format is enforced due to
the presence of <code>@attribute(cql:base_fragment=base_frag)</code>.</p><p>The point of putting everything on rails like this is that all base fragments will look the same and it will be clear how to transform any base fragment into the final query when it is assembled with its extensions.</p><p>Note: the base fragment produces no codegen at all.  There is no <code>base_frag_template</code> procedure in the output.  This is just a template.  Also, the name of the procedure cannot be <code>base_frag</code> this name will be used by the assembly fragment later.  Really any descriptive unique name will do since the name does not appear in the output at all.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="extension-query-fragments"></a>Extension Query Fragments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#extension-query-fragments" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adding-columns"></a>Adding Columns<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-columns" title="Direct link to heading">#</a></h4><p>The most common thing that an extension might want to do is add columns to the result.  There can be any number of such extensions in the final assembly.  Here&#x27;s a simple example that adds one column.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> adds_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> added_columns </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Again there are some important features to this extension and they are largely completely constrained, i.e. you must follow the pattern.</p><ul><li>the attribute indicates <code>extension_fragment</code> and the name (here <code>base_frag</code>) must have been previously declared in a <code>base_fragment</code></li><li>the procedure name can be any unique name other than <code>base_frag</code>, it corresponds to this particular extension&#x27;s purpose</li><li>the procedure arguments must be identical to those in the base fragment</li><li>the first CTE must match the <code>base_fragment</code> attribute value, <code>base_frag</code> in this case</li><li>you do not need to repeat the full select statement for <code>base_frag</code>, any surrogate with the same column names and types will do<ul><li>the base fragment code might include a #define to make this easier<ul><li>e.g. <code>#define base_frags_core as base_frag(*) as (select 1 id, &quot;name&quot; name, 1.0 rate)</code></li></ul></li><li>doing so will make maintenance easier if new columns are added to the base fragment</li></ul></li><li>there must be exactly one additional CTE<ul><li>it may have any unique descriptive name you like</li><li>it must begin with <code>select base_frags.*</code> with the appropriate CTE name matching the base fragment CTE</li><li>it must add at least one column (or it would be uninteresting)</li><li>it may not have any clause other than the first <code>from</code> (e.g. no <code>where</code>, <code>having</code>, <code>limit</code> etc.)<ul><li>if any of these were allowed they would remove or re-order rows in the base query which is not allowed</li><li>the <code>from</code> clause often includes nested selects which have no restrictions</li></ul></li><li>it must select from the base fragment name and left outer join to whereever it likes to get optional additional columns<ul><li>because of this the additional column(s) will certainly be a nullable type in the projection</li></ul></li></ul></li><li>the final select must be of the form <code>select * from col_adder_frag</code> with the appropriate name</li><li>keeping all this in mind, the interesting bit happens here:  <code>left outer join added_columns on base_frag.id = added_columns.id</code><ul><li>this is where you get the data for your additional column using values in the core columns</li></ul></li></ul><p>This fragment can be (and should be) compiled in its own compiland while using <code>#include</code> to get the base fragment only.  This will result in code gen for the accessor functions for a piece of the overall query -- the part this extension knows about.  Importantly code that uses this extension&#x27;s data does not need or want to know about any other extensions that may be present, thereby keeping
dependencies under control.</p><p>The C signatures generated would look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Even if there were dozens of other extensions, the functions for reading those columns would not be declared in the header for
this extension.  Any given extension &quot;sees&quot; only the core columns plus any columns it added.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adding-rows"></a>Adding Rows<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-rows" title="Direct link to heading">#</a></h4><p>Query extensions also frequently want to add additional rows to the main result set, based on the data that is already present.</p><p>The second form of extension allows for this, it is similarly locked in form.  Here is an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> adds_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> added_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Let&#x27;s review the features of this second template form:</p><ul><li>there is a surrogate for the core query</li><li>there is a manatory second CTE</li><li>the second CTE is a compound query with any number of branches, all <code>union all</code></li><li>the first branch must be <code>select * from base_frag</code> (the base fragment) to ensure that the original rows remain<ul><li>this is also why all the branches must be <code>union all</code></li></ul></li><li>this form cannot add new columns</li><li>the extension CTE may not include <code>order by</code> or <code>limit</code> because that might reorder or remove rows of the base</li><li>any extensions of this form must come before those of the <code>left outer join</code> form for a given base fragment<ul><li>which ironically means <code>row_adder_frag</code> has to come before <code>col_adder_frag</code></li></ul></li><li>the usual restrictions on compound selects (same type and number of columns) ensure a consistent result</li><li>the final select after the CTE section must exactly in the form <code>select * from row_adder_frag</code> which is the name of the one and only additional CTE with no other clauses or options<ul><li>in practice only the CTE will be used to create the final assembly so even if you did change the final select to something else it would be moot</li></ul></li></ul><p>The signatures generated for this will look something like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Which gives you access to the core columns.  Again this fragment can and should be compiled standalone with only the declaration
for the base fragment in the same translation unit to get the cleanest possible output.  This is so that consumers of this
extension do not &quot;see&quot; other extensions which may or may not be related and may or may not always be present.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="assembling-the-fragments"></a>Assembling the Fragments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#assembling-the-fragments" title="Direct link to heading">#</a></h4><p>With all the fragments independently declared they need to be unified to create one final query. This is where the
major rewriting happens.  The <code>assembly_fragment</code> looks something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>It will always be as simple as this, all the complexity is in the fragments.</p><ul><li>the <code>assembly_fragment</code> name must match the core fragment name</li><li>the procedure arguments must be identical to the base fragment arguments</li><li>the  procedure must have the same name as the assembly fragment (<code>base_frag</code> in this case)<ul><li>the code that was generated for the previous fragments anticipates this and makes reference to what will be generated here</li><li>this is enforced</li></ul></li><li>the assembled query is what you run to get the result set, this has real code behind it<ul><li>the other fragments only produce result set readers that call into the helper meethods to get columns</li></ul></li><li>there is a surrogate for the core fragment as usual</li><li>all of CTE section will ultimately be replaced with the fragments chained together</li><li>the final select should be of the form <code>select * from your_frags</code> but it can include ordering and/or filtering, this statement will be present in final codegen, the final order is usually defined here</li></ul><p>When compiling the assembly fragment, you should include the base, and all the other fragments, and the assembly template.  The presence of the assembly_fragment will cause codegen for the extension fragments to be suppressed. The assembly translation unit only contains the assembly query as formed from the fragments.</p><p>Now let&#x27;s look at how the query is rewritten, the process is pretty methodical.</p><p>After rewriting the assembly looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> base_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> my_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  row_adder_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> base_frag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> added_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  col_adder_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> row_adder_frag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> added_columns </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Let&#x27;s dissect this part by part, each CTE serves a purpose.</p><ul><li>the core CTE was replaced by the CTE in the base_fragment, it appears directly</li><li>next the first extension was added as a CTE referring to the base fragment just as before<ul><li>recall that the first extension has to be <code>row_adder_frag</code>, as that type must come first</li><li>looking at the chain you can see why it would be hard to write a correct fragment if it came after columns were added</li></ul></li><li>next the second extension was added as a CTE<ul><li>all references to the base fragment were replaced with references to row_adder_frag</li><li>the extra column names in the CTE were added such that all previous column names are introduced</li></ul></li><li>this process continues until all extensions are exhausted</li><li>the final select statement reads all the columns from the last extension CTE and includes and ordering and so forth that was present in the assembly query</li></ul><p>The result of all this is a single query that gets all the various columns that were requested in all the extensions
and all the <code>union all</code> operations play out as written.  The extensions are emitted in the order that they appear
in the translation unit with the assembly, which again must have the row adding extensions first.</p><p>This facility provides considerable ability to compose a large query, but each fragment can be independently checked for errors
so that nobody ever has to debug the (possibly monstrous) overall result.  Fragments can be removed simply by
excluding them from the final assembly (with e.g. #ifdefs, or build rules)</p><p>With the rewrite of the assembly_fragment complete, the codegen for that procedure is the normal codegen for a procedure with a single select.</p><p>As always, Java and Objective C codegen on these pieces will produce suitable wrappers for the C.</p><p>The output code for the assembly fragment generates these reading functions:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// used by adds_columns_get_data() to read its data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token function" style="color:rgb(130, 170, 255)">__PRIVATE__base_frag_get_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>These are exactly what you would get for a normal query except that the pieces that came from extensions are marked <code>PRIVATE</code>.  Those methods should not be used directly but instead the methods generated for each extension proc should be used.</p><p>Additionally, to create the result set, as usual.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> CQL_WARN_UNUSED cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>With the combined set of methods you can create a variety of assembled queries from extensions in a fairly straightforward way.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appendix-1-command-line-options"></a>Appendix 1: Command Line Options<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-1-command-line-options" title="Direct link to heading">#</a></h2><p>CQL has a variety of command line options but many of them are only interesting for cql development.  Nonetheless this is a comprehensive list:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="with-no-options"></a>With No Options<a aria-hidden="true" tabindex="-1" class="hash-link" href="#with-no-options" title="Direct link to heading">#</a></h3><ul><li>CQL reads its input and echos it back as normalized SQL</li><li>this only validates that the input can be parsed</li><li>note CQL is often used after the c pre-processor is run so this kind of invocation is typical:</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cc -E -x c foo.sql | cql [args]</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--in-file"></a>--in file<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--in-file" title="Direct link to heading">#</a></h3><ul><li>reads the given file for the input instead of stdin</li><li>the input should probably have already been run through the C pre-processor as above</li><li>returns non-zero if the file fails to parse</li></ul><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in test.sql</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--sem"></a>--sem<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--sem" title="Direct link to heading">#</a></h3><ul><li>performs semantic analysis on the input file ONLY</li><li>the return code is zero if there are no errors</li></ul><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in sem_test.sql --sem</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--print"></a>--print<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--print" title="Direct link to heading">#</a></h3><ul><li>may be combined with --sem (semantic info will be included)</li><li>prints the internal AST to stdout instead of echoing the inputs
Example</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in sem_test.sql --sem --print &gt;sem_ast.out</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--dot"></a>--dot<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--dot" title="Direct link to heading">#</a></h3><ul><li>prints the internal AST to stdout in DOT format for graph visualization</li><li>this is really only interesting for small graphs for discussion as it rapidly gets insane</li></ul><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --dot --in dottest.sql</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--cg-output1-output2-"></a>--cg output1 output2 ...<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--cg-output1-output2-" title="Direct link to heading">#</a></h3><ul><li>any number of output files may be needed for a particular result type, two is common</li><li>the return code is zero if there are no errors</li><li>any --cg option implies --sem</li></ul><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in foo.sql --cg foo.h foo.c</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--global_proc-name"></a>--global_proc name<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--global_proc-name" title="Direct link to heading">#</a></h3><ul><li>any loose SQL statements not in a stored proc are gathered and put into a procedure of the given name</li><li>when generating a schema migrate script the global proc name is used as a prefix on all of the artifacts so that there can be several independent migrations linked into a single executable</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--compress"></a>--compress<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--compress" title="Direct link to heading">#</a></h3><ul><li>for use with the C result type, (or any similar types added to the runtime array in your compiler)</li><li>string literals for the SQL are broken into &quot;fragments&quot; the DML is then represented by an array of fragments</li><li>since DML is often very similar there is a lot of token sharing possible</li><li>the original string is recreated at runtime from the fragments and then executed</li><li>comments show the original string inline for easier debugging and searching</li></ul><p>NOTE: different result types require a different number of output files with different meanings</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--test"></a>--test<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--test" title="Direct link to heading">#</a></h3><ul><li>some of the output types can include extra diagnostics if <code>--test</code> is included</li><li>that often makes the outputs badly formed so this is generally good for humans only</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--java_package_name"></a>--java_package_name<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--java_package_name" title="Direct link to heading">#</a></h3><ul><li>used by java code generators when they output a class. Allows to specify the name of package the class will be a part of</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--c_include_namespace"></a>--c_include_namespace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--c_include_namespace" title="Direct link to heading">#</a></h3><ul><li>for the C codegen runtimes, it determines the header namespace (as in #include &lt;namespace/file.h) that the headers will have to be referred when included from other sources.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--objc_c_include_path"></a>--objc_c_include_path<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--objc_c_include_path" title="Direct link to heading">#</a></h3><ul><li>for ObjC codegen runtimes that need to refer to the generated C code, this represents the header of the C generated code that will be used during inclusion from the ObjC file</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="result-types---rt-"></a>Result Types (--rt *)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#result-types---rt-" title="Direct link to heading">#</a></h3><p>These are the various outputs the compiler can produce.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-c"></a>--rt c<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-c" title="Direct link to heading">#</a></h4><ul><li>requires two output files (foo.h and foo.c)</li><li>this is the standard C compilation of the sql file</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-objc"></a>--rt objc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-objc" title="Direct link to heading">#</a></h4><ul><li>objective C wrappers for result sets produced by the stored procedures in the input</li><li>these depend on the output of a standard codegen run so this is additive</li><li>requires one output file (foo.h)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-java"></a>--rt java<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-java" title="Direct link to heading">#</a></h4><ul><li>java wrappers for result sets produced by the stored procedures in the input</li><li>these depend on the output of a standard codegen run so this is additive</li><li>requires one output file (foo.java)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-schema"></a>--rt schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-schema" title="Direct link to heading">#</a></h4><ul><li>produces the canonical schema for the given input files</li><li>stored procedures etc. are removed</li><li>whitespace etc. is removed</li><li>suitable for use to create the next or first &quot;previous&quot; schema for schema validation</li><li>requires one output file</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-schema_upgrade"></a>--rt schema_upgrade<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-schema_upgrade" title="Direct link to heading">#</a></h4><ul><li>produces a CQL schema upgrade script (one file) which can then be compiled with CQL itself</li><li>see the section on schema upgrade/migration</li><li>requires one output file (foo.sql)</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--include_regions-a-b-c"></a>--include_regions a b c<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--include_regions-a-b-c" title="Direct link to heading">#</a></h5><ul><li>the indicated regions will be declared</li><li>used with <code>--rt schema_upgrade</code> or <code>--rt schema</code></li><li>in the upgrade case excluded regions will not be themselves upgraded, but may be referred, to by things that are being upgraded</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--exclude_regions-x-y-z"></a>--exclude_regions x y z<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--exclude_regions-x-y-z" title="Direct link to heading">#</a></h5><ul><li>the indicated regions will still be declared but the upgrade code will be suppressed, the presumption being that a different script already upgrades x y z</li><li>used with <code>--rt schema_upgrade</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="--rt-json_schema"></a>--rt json_schema<a aria-hidden="true" tabindex="-1" class="hash-link" href="#--rt-json_schema" title="Direct link to heading">#</a></h4><ul><li>produces JSON output suitable for consumption by downstream codegen like the android mlite system</li><li>the JSON includes a definition of the various entities in the input</li><li>see the section on JSON output for details</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appendix-2-cql-grammar"></a>Appendix 2: CQL Grammar<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-2-cql-grammar" title="Direct link to heading">#</a></h2><p>What follows is taken from a grammar snapshot with the tree building rules removed.
It should give a fair sense of the syntax of CQL (but not semantic validation).</p><p>Snapshot as of Fri Oct  9 13:41:39 PDT 2020</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="operators-and-literals"></a>Operators and Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#operators-and-literals" title="Direct link to heading">#</a></h3><p>These are in order of priority lowest to highest</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">UNION_ALL UNION INTERSECT EXCEPT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ASSIGN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BETWEEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&lt;&gt;&#x27; &#x27;!=&#x27; &#x27;=&#x27; &#x27;==&#x27; LIKE NOT_LIKE GLOB MATCH REGEXP IN IS_NOT IS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&lt;&#x27; &#x27;&gt;&#x27; &#x27;&gt;=&#x27; &#x27;&lt;=&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&lt;&lt;&#x27; &#x27;&gt;&gt;&#x27; &#x27;&amp;&#x27; &#x27;|&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;+&#x27; &#x27;-&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;*&#x27; &#x27;/&#x27; &#x27;%&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UMINUS &#x27;~&#x27; COLLATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CONCAT</span></div></div></div></div></div><p>NOTE: The above varies considerably from the C binding order!!!</p><p>Literals:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ID  /* a name */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">STRLIT /* a string literal in SQL format e.g. &#x27;it&#x27;&#x27;s sql&#x27; */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CSTRLIT /* a string literal in C format e.g. &quot;hello, world\n&quot; */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BLOBLIT /* a blob literal in SQL format e.g. x&#x27;12ab&#x27; */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INTLIT /* integer literal */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LONGLIT /* long integer literal */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">REALLIT /* floating point literal */</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="statementtype-keywords"></a>Statement/Type Keywords<a aria-hidden="true" tabindex="-1" class="hash-link" href="#statementtype-keywords" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXCLUDE_GROUP EXCLUDE_CURRENT_ROW EXCLUDE_TIES EXCLUDE_NO_OTHERS CURRENT_ROW UNBOUNDED PRECEDING FOLLOWING</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE DROP TABLE WITHOUT ROWID PRIMARY KEY NULL_ DEFAULT AT_DUMMY_SEED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OBJECT TEXT BLOB LONG_ INT_ INTEGER LONG_INTEGER REAL ON UPDATE CASCADE ON_CONFLICT DO NOTHING</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DELETE INDEX FOREIGN REFERENCES CONSTRAINT UPSERT STATEMENT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INSERT INTO VALUES VIEW SELECT QUERY_PLAN EXPLAIN OVER WINDOW FILTER PARTITION RANGE ROWS GROUPS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AS CASE WHEN FROM THEN ELSE END LEFT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OUTER JOIN WHERE GROUP BY ORDER ASC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DESC INNER FCOUNT AUTOINCREMENT DISTINCT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LIMIT OFFSET TEMP TRIGGER IF ALL CROSS USING RIGHT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UNIQUE HAVING SET TO DISTINCTROW</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FUNC FUNCTION PROC PROCEDURE BEGIN_ OUT INOUT CURSOR CURSOR_FOR DECLARE FETCH LOOP LEAVE CONTINUE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OPEN CLOSE ELSE_IF WHILE CALL TRY CATCH THROW RETURN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SAVEPOINT ROLLBACK COMMIT TRANSACTION RELEASE ARGUMENTS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CAST WITH RECURSIVE REPLACE IGNORE ADD COLUMN RENAME ALTER</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AT_ECHO AT_CREATE AT_RECREATE AT_DELETE AT_SCHEMA_UPGRADE_VERSION AT_PREVIOUS_SCHEMA AT_SCHEMA_UPGRADE_SCRIPT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AT_FILE AT_ATTRIBUTE AT_SENSITIVE DEFERRED NOT_DEFERRABLE DEFERRABLE IMMEDIATE RESTRICT ACTION INITIALLY NO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEFORE AFTER INSTEAD OF FOR_EACH_ROW EXISTS RAISE FAIL ABORT AT_ENFORCE_STRICT AT_ENFORCE_NORMAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AT_BEGIN_SCHEMA_REGION AT_END_SCHEMA_REGION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AT_DECLARE_SCHEMA_REGION AT_DECLARE_DEPLOYABLE_REGION AT_SCHEMA_AD_HOC_MIGRATION PRIVATE</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rules"></a>Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rules" title="Direct link to heading">#</a></h3><p>Note that in many cases the grammar is more generous than the overall language and errors have to be checked on top of this, often this is done on purpose because even when it&#x27;s possible it might be very inconvenient to do checks with syntax.  For example the grammar cannot enforce non-duplicate ids in id lists, but it could enforce non-duplicate attributes in attribute lists.  It chooses to do neither as they are easily done with semantic validation.  Thus the grammar is not the final authority on what constitutes a valid program but it&#x27;s a good start.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">program: opt_stmt_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_stmt_list: /*nil*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | stmt_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stmt_list: stmt &#x27;;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | stmt &#x27;;&#x27; stmt_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stmt: misc_attrs any_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">any_stmt: select_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | explain_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_trigger_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_table_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_index_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_view_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | alter_table_add_column_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_table_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_view_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_index_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_trigger_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | call_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_cursor_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | upsert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_upsert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | set_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_proc_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_proc_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_func_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_values_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_call_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_cursor_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | while_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | loop_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | leave_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | return_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | continue_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | if_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | open_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | close_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | out_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | out_union_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | throw_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | trycatch_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_trans_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | rollback_trans_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | commit_trans_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | savepoint_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | release_savepoint_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | echo_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_upgrade_version_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_upgrade_script_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | previous_schema_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_strict_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_normal_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_schema_region_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_deployable_region_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_schema_region_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | end_schema_region_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_ad_hoc_migration_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">explain_stmt: &quot;EXPLAIN&quot; opt_query_plan explain_target</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_query_plan: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;QUERY PLAN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">explain_target: select_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | upsert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_table_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_view_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_index_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_trigger_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_trans_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | commit_trans_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">previous_schema_stmt: &quot;@PREVIOUS_SCHEMA&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">schema_upgrade_script_stmt: &quot;@SCHEMA_UPGRADE_SCRIPT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">schema_upgrade_version_stmt: &quot;@SCHEMA_UPGRADE_VERSION&quot; &#x27;(&#x27; &quot;integer-literal&quot; &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_stmt: &quot;SET&quot; name &quot;:=&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">version_attrs_opt_recreate: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@RECREATE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@RECREATE&quot; &#x27;(&#x27; name &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | version_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_version_attrs: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | version_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">version_attrs: &quot;@CREATE&quot; version_annotation opt_version_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation opt_version_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_delete_version_attr: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drop_table_stmt: &quot;DROP&quot; &quot;TABLE&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;TABLE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drop_view_stmt: &quot;DROP&quot; &quot;VIEW&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;VIEW&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drop_index_stmt: &quot;DROP&quot; &quot;INDEX&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;INDEX&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drop_trigger_stmt: &quot;DROP&quot; &quot;TRIGGER&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;TRIGGER&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create_table_stmt: &quot;CREATE&quot; opt_temp &quot;TABLE&quot; opt_if_not_exists name &#x27;(&#x27; col_key_list &#x27;)&#x27; opt_no_rowid version_attrs_opt_recreate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_temp: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEMP&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_if_not_exists: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_no_rowid: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITHOUT&quot; &quot;ROWID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_key_list: col_key_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | col_key_def &#x27;,&#x27; col_key_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_key_def: col_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | pk_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | unq_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_name: name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_key: name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;:&#x27; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_value_list: misc_attr_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | misc_attr_value &#x27;,&#x27; misc_attr_value_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_value: name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | any_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; misc_attr_value_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;-&#x27; num_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr:  &quot;@ATTRIBUTE&quot; &#x27;(&#x27; misc_attr_key &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@ATTRIBUTE&quot; &#x27;(&#x27; misc_attr_key &#x27;=&#x27; misc_attr_value &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attrs: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | misc_attr misc_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_def: misc_attrs col_name data_type col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pk_def: &quot;PRIMARY&quot; &quot;KEY&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_fk_options: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_options: fk_on_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_deferred_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_on_options fk_deferred_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_on_options:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ON&quot; &quot;DELETE&quot; fk_action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;UPDATE&quot; fk_action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;UPDATE&quot; fk_action &quot;ON&quot; &quot;DELETE&quot; fk_action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;DELETE&quot; fk_action &quot;ON&quot; &quot;UPDATE&quot; fk_action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_action:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;SET&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SET&quot; &quot;DEFAULT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASCADE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RESTRICT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NO&quot; &quot;ACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_deferred_options:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;DEFERRABLE&quot; fk_initial_state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT DEFERRABLE&quot; fk_initial_state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_initial_state: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INITIALLY&quot; &quot;DEFERRED&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INITIALLY&quot; &quot;IMMEDIATE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_def: &quot;FOREIGN&quot; &quot;KEY&quot; &#x27;(&#x27; name_list &#x27;)&#x27; fk_target_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fk_target_options : &quot;REFERENCES&quot; name &#x27;(&#x27; name_list &#x27;)&#x27; opt_fk_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">unq_def: &quot;CONSTRAINT&quot; name &quot;UNIQUE&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_unique: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">indexed_column: name opt_asc_desc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">indexed_columns: indexed_column</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | indexed_column &#x27;,&#x27; indexed_columns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create_index_stmt: &quot;CREATE&quot; opt_unique &quot;INDEX&quot; opt_if_not_exists name &quot;ON&quot; name &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_delete_version_attr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name: &quot;ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TRIGGER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROWID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name_list: name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |  name &#x27;,&#x27; name_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name_list: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_attrs: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT&quot; &quot;NULL&quot; col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIMARY&quot; &quot;KEY&quot; col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIMARY&quot; &quot;KEY&quot; &quot;AUTOINCREMENT&quot; col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; &#x27;-&#x27; num_literal col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; num_literal col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; str_literal col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot; col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@SENSITIVE&quot; col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@CREATE&quot; version_annotation col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_target_options col_attrs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">version_annotation: &#x27;(&#x27; &quot;integer-literal&quot; &#x27;,&#x27; name &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; &quot;integer-literal&quot; &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">object_type:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;OBJECT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OBJECT&quot; &#x27;&lt;&#x27; name &#x27;&gt;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_type:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;INT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INTEGER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;REAL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BOOL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot; &quot;INTEGER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot; &quot;INT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG_INT&quot; | &quot;LONG_INTEGER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BLOB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | object_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_type_opt_notnull: data_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type &quot;NOT&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type &quot;@SENSITIVE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type &quot;@SENSITIVE&quot; &quot;NOT&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type &quot;NOT&quot; &quot;NULL&quot; &quot;@SENSITIVE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">str_literal: &quot;sql-string-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;c-string-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">num_literal:  &quot;integer-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;long-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;real-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">any_literal: str_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | num_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@FILE&quot; &#x27;(&#x27; str_literal &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;sql-blob-literal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">raise_expr:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;RAISE&quot; &#x27;(&#x27; &quot;IGNORE&quot; &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;ROLLBACK&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;ABORT&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;FAIL&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name &#x27;(&#x27; arg_list &#x27;)&#x27; opt_filter_clause</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;(&#x27; &quot;DISTINCT&quot; arg_list &#x27;)&#x27; opt_filter_clause</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">basic_expr: name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;.&#x27; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | any_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; expr &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | call</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_func_inv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | raise_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXISTS&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">math_expr: basic_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;&amp;&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;|&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&lt;&lt;&quot; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&gt;&gt;&quot;  math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;+&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;-&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;*&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;/&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;%&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;-&#x27; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;||&quot; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">expr: basic_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;&amp;&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;|&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;&lt;&lt;&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;&gt;&gt;&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;+&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;-&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;*&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;/&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;%&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;-&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;~&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;COLLATE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;AND&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;OR&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;=&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;==&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;&lt;&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;&gt;&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;&lt;&gt;&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;!=&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;&gt;=&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;&lt;=&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;NOT&quot; &quot;IN&quot; &#x27;(&#x27; expr_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;NOT&quot; &quot;IN&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;IN&quot; &#x27;(&#x27; expr_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;IN&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;LIKE&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;NOT LIKE&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;MATCH&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;REGEXP&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;GLOB&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;NOT&quot; &quot;BETWEEN&quot; math_expr &quot;AND&quot; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;BETWEEN&quot; math_expr &quot;AND&quot; math_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;IS NOT&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;IS&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;||&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; expr case_list &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; expr case_list &quot;ELSE&quot; expr &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; case_list &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; case_list &quot;ELSE&quot; expr &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CAST&quot; &#x27;(&#x27; expr &quot;AS&quot; data_type &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">case_list: &quot;WHEN&quot; expr &quot;THEN&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHEN&quot; expr &quot;THEN&quot; expr case_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arg_expr: &#x27;*&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | cursor_arguments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | from_arguments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arg_list: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | arg_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | arg_expr &#x27;,&#x27; arg_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">expr_list: expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;,&#x27; expr_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cursor_arguments : &quot;FROM&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; name &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_expr: expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | cursor_arguments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | from_arguments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_expr_list: call_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | call_expr &#x27;,&#x27; call_expr_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cte_tables:  cte_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_table &#x27;,&#x27; cte_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cte_table: cte_decl &quot;AS&quot; &#x27;(&#x27; select_stmt_no_with &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cte_decl: name &#x27;(&#x27; name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_prefix: &quot;WITH&quot; cte_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITH&quot; &quot;RECURSIVE&quot; cte_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_select_stmt: with_prefix select_stmt_no_with</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_stmt: with_select_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_stmt_no_with</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_stmt_no_with: select_core_list opt_orderby opt_limit opt_offset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_core_list: select_core</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_core select_core_compound</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_core_compound: compound_operator select_core_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">values: &#x27;(&#x27; insert_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; insert_list &#x27;)&#x27; &#x27;,&#x27; values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_core: &quot;SELECT&quot; select_opts select_expr_list opt_from_query_parts opt_where opt_groupby opt_having opt_select_window</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;VALUES&quot; values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">compound_operator:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;UNION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNION ALL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INTERSECT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCEPT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_func_inv: name &#x27;(&#x27; arg_list &#x27;)&#x27; opt_filter_clause &quot;OVER&quot; window_name_or_defn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_filter_clause: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FILTER&quot; &#x27;(&#x27; opt_where &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_or_defn: window_defn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_defn: &#x27;(&#x27; opt_partition_by opt_orderby opt_frame_spec &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_frame_spec: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | frame_type frame_boundary_opts frame_exclude</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_type: &quot;RANGE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROWS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;GROUPS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_exclude: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE NO OTHERS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE CURRENT ROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE GROUP&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE TIES&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_opts: frame_boundary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BETWEEN&quot; frame_boundary_start &quot;AND&quot; frame_boundary_end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_start: &quot;UNBOUNDED&quot; &quot;PRECEDING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;PRECEDING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;FOLLOWING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_end: expr &quot;PRECEDING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;FOLLOWING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNBOUNDED&quot; &quot;FOLLOWING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary: &quot;UNBOUNDED&quot; &quot;PRECEDING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;PRECEDING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_partition_by: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PARTITION&quot; &quot;BY&quot; expr_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_select_window: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_clause</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_clause: &quot;WINDOW&quot; window_name_defn_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_defn_list: window_name_defn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_name_defn &#x27;,&#x27; window_name_defn_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_defn: name &quot;AS&quot; window_defn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">region_spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &quot;PRIVATE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">region_list :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    region_spec &#x27;,&#x27; region_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | region_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare_schema_region_stmt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@DECLARE_SCHEMA_REGION&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DECLARE_SCHEMA_REGION&quot; name &quot;USING&quot; region_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare_deployable_region_stmt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@DECLARE_DEPLOYABLE_REGION&quot;  name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DECLARE_DEPLOYABLE_REGION&quot; name &quot;USING&quot; region_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin_schema_region_stmt: &quot;@BEGIN_SCHEMA_REGION&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end_schema_region_stmt: &quot;@END_SCHEMA_REGION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">schema_ad_hoc_migration_stmt: &quot;@SCHEMA_AD_HOC_MIGRATION&quot; version_annotation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_from_query_parts: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; query_parts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_where: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHERE&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_groupby: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;GROUP&quot; &quot;BY&quot; groupby_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">groupby_list: groupby_item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | groupby_item &#x27;,&#x27; groupby_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">groupby_item: expr opt_asc_desc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_asc_desc: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ASC&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DESC&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_having: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;HAVING&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_orderby: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ORDER&quot; &quot;BY&quot; groupby_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_limit: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIMIT&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_offset: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OFFSET&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_opts: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ALL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DISTINCT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DISTINCTROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expr_list: select_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_expr &#x27;,&#x27; select_expr_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;*&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expr: expr opt_as_alias</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |  name &#x27;.&#x27; &#x27;*&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_as_alias: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;AS&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">query_parts: table_or_subquery_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_clause</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_or_subquery_list: table_or_subquery</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | table_or_subquery &#x27;,&#x27; table_or_subquery_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">join_clause: table_or_subquery join_target_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">join_target_list: join_target</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_target join_target_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_or_subquery: name opt_as_alias</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &#x27;)&#x27; opt_as_alias</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | table_function opt_as_alias</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; query_parts &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">join_target: opt_inner_cross &quot;JOIN&quot; table_or_subquery opt_join_cond</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | left_or_right opt_outer &quot;JOIN&quot; table_or_subquery opt_join_cond</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_inner_cross: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INNER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CROSS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_outer: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OUTER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">left_or_right: &quot;LEFT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RIGHT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_join_cond: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_cond</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">join_cond: &quot;ON&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;USING&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_function: name &#x27;(&#x27; arg_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create_view_stmt: &quot;CREATE&quot; opt_temp &quot;VIEW&quot; opt_if_not_exists name &quot;AS&quot; select_stmt opt_delete_version_attr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_delete_stmt: with_prefix delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">delete_stmt: &quot;DELETE&quot; &quot;FROM&quot; name opt_where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_insert_dummy_spec : /*nil*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_SEED&quot; &#x27;(&#x27; expr &#x27;)&#x27; dummy_modifier</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dummy_modifier: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_NULLABLES&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_DEFAULTS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_NULLABLES&quot; &quot;@DUMMY_DEFAULTS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_DEFAULTS&quot; &quot;@DUMMY_NULLABLES&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert_stmt_type : &quot;INSERT&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;REPLACE&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;IGNORE&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;ROLLBACK&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;ABORT&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;FAIL&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;REPLACE&quot; &quot;INTO&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_insert_stmt: with_prefix insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_column_spec: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; opt_name_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; &quot;LIKE&quot; name &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from_cursor:  &quot;FROM&quot; &quot;CURSOR&quot; name opt_column_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from_arguments: &quot;FROM&quot; &quot;ARGUMENTS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; &quot;ARGUMENTS&quot; &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert_stmt: insert_stmt_type name opt_column_spec select_stmt opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name opt_column_spec from_arguments opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name opt_column_spec from_cursor opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name &quot;DEFAULT&quot; &quot;VALUES&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert_list:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;,&#x27; insert_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">basic_update_stmt: &quot;UPDATE&quot; opt_name &quot;SET&quot; update_list opt_where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_update_stmt: with_prefix update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update_stmt: &quot;UPDATE&quot; name &quot;SET&quot; update_list opt_where opt_orderby opt_limit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update_entry: name &#x27;=&#x27; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update_list: update_entry</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_entry &#x27;,&#x27; update_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with_upsert_stmt: with_prefix upsert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">upsert_stmt: insert_stmt &quot;ON CONFLICT&quot; conflict_target &quot;DO&quot; &quot;NOTHING&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt &quot;ON CONFLICT&quot; conflict_target &quot;DO&quot; basic_update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update_cursor_stmt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;UPDATE&quot; &quot;CURSOR&quot; name opt_column_spec &quot;FROM&quot; &quot;VALUES&quot; &#x27;(&#x27; insert_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPDATE&quot; &quot;CURSOR&quot; name opt_column_spec from_cursor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">conflict_target:  /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">creation_type: object_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | object_type &quot;NOT&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot; &quot;NOT&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BLOB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BLOB&quot; &quot;NOT&quot; &quot;NULL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function: &quot;FUNC&quot; | &quot;FUNCTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare_func_stmt: &quot;DECLARE&quot; function name &#x27;(&#x27; params &#x27;)&#x27; data_type_opt_notnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; &quot;SELECT&quot; function name &#x27;(&#x27; params &#x27;)&#x27; data_type_opt_notnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; function name &#x27;(&#x27; params &#x27;)&#x27; &quot;CREATE&quot; creation_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; &quot;SELECT&quot; function name &#x27;(&#x27; params &#x27;)&#x27; &#x27;(&#x27; typed_names &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">procedure: &quot;PROC&quot; | &quot;PROCEDURE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare_proc_stmt: &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &#x27;(&#x27; typed_names &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &#x27;(&#x27; typed_names &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &quot;UNION&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &quot;UNION&quot; &#x27;(&#x27; typed_names &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create_proc_stmt: &quot;CREATE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_inout: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OUT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INOUT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">typed_name: name data_type_opt_notnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">typed_names: typed_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | typed_name &#x27;,&#x27; typed_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param: opt_inout name data_type_opt_notnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">params: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | param</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |  param &#x27;,&#x27; params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare_stmt: &quot;DECLARE&quot; name_list data_type_opt_notnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR FOR&quot; select_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR FOR&quot; explain_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR FOR&quot; call_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FETCH&quot; &quot;FROM&quot; call_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;LIKE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;LIKE&quot; select_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_stmt: &quot;CALL&quot; name &#x27;(&#x27; &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CALL&quot; name &#x27;(&#x27; call_expr_list &#x27;)&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">while_stmt: &quot;WHILE&quot; expr &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">loop_stmt: &quot;LOOP&quot; fetch_stmt &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">leave_stmt: &quot;LEAVE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return_stmt: &quot;RETURN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">throw_stmt: &quot;THROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trycatch_stmt: &quot;BEGIN&quot; &quot;TRY&quot; opt_stmt_list &quot;END&quot; &quot;TRY&quot; &#x27;;&#x27; &quot;BEGIN&quot; &quot;CATCH&quot; opt_stmt_list &quot;END&quot; &quot;CATCH&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">continue_stmt: &quot;CONTINUE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_stmt: &quot;FETCH&quot; name &quot;INTO&quot; name_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_values_stmt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;FETCH&quot; name opt_column_spec &quot;FROM&quot; &quot;VALUES&quot; &#x27;(&#x27; insert_list &#x27;)&#x27; opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name opt_column_spec from_arguments opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name opt_column_spec from_cursor opt_insert_dummy_spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_call_stmt: &quot;FETCH&quot; name opt_column_spec &quot;FROM&quot; call_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_cursor_stmt: &quot;FETCH&quot; name opt_column_spec &quot;FROM&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">open_stmt: &quot;OPEN&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">close_stmt: &quot;CLOSE&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">out_stmt: &quot;OUT&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">out_union_stmt: &quot;OUT&quot; &quot;UNION&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if_stmt: &quot;IF&quot; expr &quot;THEN&quot; opt_stmt_list opt_elseif_list opt_else &quot;END&quot; &quot;IF&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_else: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ELSE&quot; opt_stmt_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">elseif_item: &quot;ELSE IF&quot; expr &quot;THEN&quot; opt_stmt_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">elseif_list: elseif_item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | elseif_item elseif_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_elseif_list: /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | elseif_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin_trans_stmt: &quot;BEGIN&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rollback_trans_stmt: &quot;ROLLBACK&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TRANSACTION&quot; &quot;TO&quot; &quot;SAVEPOINT&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">commit_trans_stmt: &quot;COMMIT&quot; &quot;TRANSACTION&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">savepoint_stmt: &quot;SAVEPOINT&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">release_savepoint_stmt: &quot;RELEASE&quot; &quot;SAVEPOINT&quot; name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">echo_stmt: &quot;@ECHO&quot; name &#x27;,&#x27; str_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">alter_table_add_column_stmt: &quot;ALTER&quot; &quot;TABLE&quot; name &quot;ADD&quot; &quot;COLUMN&quot; col_def</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create_trigger_stmt:  &quot;CREATE&quot; opt_temp &quot;TRIGGER&quot; opt_if_not_exists trigger_def opt_delete_version_attr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_def: name trigger_condition trigger_operation &quot;ON&quot; name trigger_action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_condition:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> | &quot;BEFORE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> | &quot;AFTER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> | &quot;INSTEAD&quot; &quot;OF&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_operation:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;DELETE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPDATE&quot; opt_of</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OF&quot; name_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_action:  opt_foreachrow opt_when_expr &quot;BEGIN&quot; trigger_stmts &quot;END&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_foreachrow:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FOR EACH ROW&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_when_expr:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /* nil */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHEN&quot; expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_stmts:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    trigger_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_stmt  trigger_stmts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* These forms are slightly different than the normal statements, not all variations are allowed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * This section clearly states the mapping.  It could be done more tersely but this costs us nothing.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_stmt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    trigger_update_stmt &#x27;;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_insert_stmt &#x27;;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_delete_stmt &#x27;;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_select_stmt &#x27;;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_select_stmt : select_stmt_no_with</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_insert_stmt : insert_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_delete_stmt : delete_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_update_stmt : basic_update_stmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enforcement_options:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;FOREIGN&quot; &quot;KEY&quot; &quot;ON&quot; &quot;UPDATE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FOREIGN&quot; &quot;KEY&quot; &quot;ON&quot; &quot;DELETE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;JOIN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPSERT&quot; &quot;STATEMENT&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WINDOW&quot; function</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | procedure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITHOUT&quot; &quot;ROWID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_strict_stmt: &quot;@ENFORCE_STRICT&quot; enforcement_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_normal_stmt: &quot;@ENFORCE_NORMAL&quot; enforcement_options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appendix-3-control-directives"></a>Appendix 3: Control Directives<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-3-control-directives" title="Direct link to heading">#</a></h2><p>The control directives are those statements that begin with <code>@</code> and they are distinguished from other statements because they influence the compiler rather than the program logic.  Some of these are of great importance and discussed elsewhere.</p><p>The complete list (as of this writing) is:</p><p><code>@ENFORCE_STRICT</code>
<code>@ENFORCE_NORMAL</code></p><ul><li>These enable or disable more strict semanic checking the sub options are<ul><li><code>FOREIGN KEY ON UPDATE</code>: all FK&#x27;s must choose some <code>ON UPDATE</code> strategy</li><li><code>FOREIGN KEY ON DELETE</code>: all FK&#x27;s must choose some <code>ON DELETE</code> strategy</li><li><code>PROCEDURE</code>: all procedures must be declared before they are called (eliminating the vanilla <code>C</code> call option)</li><li><code>JOIN</code>: all joins must be ANSI style, the form <code>FROM A,B</code> is not allowed (replace with <code>A INNER JOIN B</code></li><li><code>WINDOW FUNC</code>: window functions are disallowed (useful if targetting old versions of SQLite)</li><li><code>UPSERT STATEMENT</code>: the upsert form is disallowed (useful if targetting old versions of SQLite)</li></ul></li></ul><p><code>@SENSITIVE</code></p><ul><li>marks a column or variable as &#x27;sensitive&#x27; for privacy purposes, this behaves somewhat like nullability (See Chapter 3) in that it is radioactive, contaminating anything it touches</li><li>the intent of this annotation is to make it clear where sensitive data is being returned or consumed in your procedures</li><li>this information appears in the JSON output for further codegen or for analysis (See Chapter 13)</li></ul><p><code>@DECLARE_SCHEMA_REGION</code>
<code>@DECLARE_DEPLOYABLE_REGION</code>
<code>@BEGIN_SCHEMA_REGION</code>
<code>@END_SCHEMA_REGION</code></p><ul><li>These directives controlt he declaration of schema regions and allow you to place things into those regions (See Chapter 10)</li></ul><p><code>@SCHEMA_AD_HOC_MIGRATION</code></p><ul><li>Allows for the creation of a ad hoc migration step at a given schema version, (See Chapter 10)</li></ul><p><code>@ECHO</code></p><ul><li>Emits text into the C output stream, useful for emiting things like function prototypes or preprocessor directives</li><li>e.g. `echo C, &#x27;#define foo bar&#x27;</li></ul><p><code>@RECREATE</code>
<code>@CREATE</code>
<code>@DELETE</code></p><ul><li>used to mark the schema version where an object is created or deleted, or alternatively indicate the the object is always dropped and recreated when it changes (See Chapter 10)</li></ul><p><code>@SCHEMA_UPGRADE_VERSION</code></p><ul><li>used to indicate that the code that follows is part of a migration script for the indicated schema version</li><li>this has the effect of making the schema appear to be how it existed at the indicated version</li><li>the idea here is that migration procedures operate on previous versions of the schema where (e.g.) some columns/tables hadn&#x27;t been deleted yet</li></ul><p><code>@PREVIOUS_SCHEMA</code></p><ul><li>indicates the start of the previous version of the schema for comparison (See Chapter 11)</li></ul><p><code>@SCHEMA_UPGRADE_SCRIPT</code></p><ul><li>CQL emits a schema upgrade script as part of its upgrade features, this script declares tables in their final form but also creates the same tables as they existed when they were first created</li><li>this directive instructs CQL to ignore the incompatible creations, the first declaration controls</li><li>the idea here is that the upgrade script is in the business of getting you to the finish line in an orderly fashion and some of the interim steps are just not all the way there yet</li><li>note that the upgrade script recapitulates the version history, it does not take you directly to the finish line, this is so that all instances get to the same place the same way (and this fleshes out any bugs in migration)</li></ul><p><code>@DUMMY_NULLABLES</code>
<code>@DUMMY_DEFAULTS</code>
<code>@DUMMY_SEED</code></p><ul><li>these control the creation of dummy data for <code>insert</code> and <code>fetch</code> statements (See Chapters 5 and 12)</li></ul><p><code>@FILE</code></p><ul><li>a string literal that corresponds to the current file name with a prefix stripped (to remove build lab junk in the path)</li></ul><p><code>@ATTRIBUTE</code></p><ul><li><p>the main purpose of <code>@attribute</code> is to appear in the JSON output so that it can control later codegen stages in whatever way you deem appropriate</p></li><li><p>the nested nature of attribute values is sufficiently flexible than you could encode an arbitary LISP program in an attribute, so really anything you might need to express is possible</p></li><li><p>there are a number of attributes known to the compiler which I list below (complete as of this writing)</p></li><li><p><code>cql:autodrop=(table1, table2, ...)</code> when present the indicated tables, which must be temp tables, are dropped when the results of the procedure have been fetched into a rowset</p></li><li><p><code>cql:indentity=(column1, column2, ...)</code> the indicated columns are used to create a row comparator for the rowset corresponding to the procedure, this appears in a C macro of the form <code>procedure_name_row_same(rowset1, row1, rowset2, row2)</code></p></li><li><p><code>cql:suppres_getters</code> the indicated procedure should not emit the column getter functions (useful if you only indend to call the procedure from CQL, or if you wish to restrict access in C)</p></li><li><p><code>cql:base_fragment=frag_name</code> for base fragments (See Chapter 14)</p></li><li><p><code>cql:extension_fragment=frag_name</code> for extension fragments (See Chapter 14)</p></li><li><p><code>cql:assembly_fragment=frag_name</code> for assembly fragments (See Chapter 14)</p></li><li><p><code>cql:no_table_scan</code> for query plan processing, indicates that the table in question should never be table scanned in any plan (for better diagnostics)</p></li><li><p><code>cql:autotest=([many forms])</code> declares various autotest features (See Chapter 12)</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="chapter-4-cql-error-codes"></a>Chapter 4: CQL Error Codes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#chapter-4-cql-error-codes" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0001-operands-must-be-an-integer-type-not-real"></a>CQL0001: operands must be an integer type, not real<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0001-operands-must-be-an-integer-type-not-real" title="Direct link to heading">#</a></h3><p>integer math operators like &lt;&lt; &gt;&gt; &amp; and | are not compatible with real-valued arguments</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0002-left-operand-cannot-be-an-object-in-operator"></a>CQL0002: left operand cannot be an object in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0002-left-operand-cannot-be-an-object-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on objects.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0003-left-operand-cannot-be-an-object-in-operator"></a>CQL0003: left operand cannot be an object in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0003-left-operand-cannot-be-an-object-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on objects.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0004-left-operand-cannot-be-a-blob-in-operator"></a>CQL0004: left operand cannot be a blob in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0004-left-operand-cannot-be-a-blob-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on blobs.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0005-right-operand-cannot-be-a-blob-in-operator"></a>CQL0005: right operand cannot be a blob in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0005-right-operand-cannot-be-a-blob-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on blobs.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0007-left-operand-cannot-be-a-string-in-operator"></a>CQL0007: left operand cannot be a string in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0007-left-operand-cannot-be-a-string-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on strings.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0008-right-operand-cannot-be-a-string-in-operator"></a>CQL0008: right operand cannot be a string in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0008-right-operand-cannot-be-a-string-in-operator" title="Direct link to heading">#</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on strings.  Basically comparison is all you can do.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0009-incompatible-types-in-expression-subject"></a>CQL0009: incompatible types in expression &#x27;subject&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0009-incompatible-types-in-expression-subject" title="Direct link to heading">#</a></h3><p>The expression type indicated by subject required a TEXT as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0010-incompatible-types-in-expression-subject"></a>CQL0010: incompatible types in expression &#x27;subject&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0010-incompatible-types-in-expression-subject" title="Direct link to heading">#</a></h3><p>The expression type indicated by subject required an OBJECT as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0011-incompatible-types-in-expression-subject"></a>CQL0011: incompatible types in expression &#x27;subject&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0011-incompatible-types-in-expression-subject" title="Direct link to heading">#</a></h3><p>The expression type indicated by subject required a BLOB as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0012-incompatible-types-in-expression-subject"></a>CQL0012: incompatible types in expression &#x27;subject&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0012-incompatible-types-in-expression-subject" title="Direct link to heading">#</a></h3><p>The expression type indicated by subject required a numeric as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target"></a>CQL0013: cannot assign/copy possibly null expression to not null target &#x27;target&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target" title="Direct link to heading">#</a></h3><p>Here assign/copy can be the simplest case of assigning to a local variable or an OUT parameter but this error also appears when calling functions.  You should think of the IN arguments as requiring that the actual argument be assignable to the formal variable and OUT arguments requiring that the formal be assignable to the actual argument variable.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target"></a>CQL0014: cannot assign/copy sensitive expression to not null target &#x27;target&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target" title="Direct link to heading">#</a></h3><p>Here assign/copy can be the simplest case of assigning to a local variable or an OUT parameter but this error also appears when calling functions.  You should think of the IN arguments as requiring that the actual argument be assignable to the formal variable and OUT arguments requiring that the formal be assignable to the actual argument variable.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0015-expected-numeric-expression-context"></a>CQL0015: expected numeric expression &#x27;context&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0015-expected-numeric-expression-context" title="Direct link to heading">#</a></h3><p>Many SQL clauses require a numeric expression such as WHERE/HAVING/LIMIT/OFFSET.  This expression indicates the expression in the given context is not a numeric.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0016-duplicate-table-name-in-join-table"></a>CQL0016: duplicate table name in join &#x27;table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0016-duplicate-table-name-in-join-table" title="Direct link to heading">#</a></h3><p>When this error is produced it means the result of the join would have the same table twice with no disambiguation between the two places.  The conflicting name is provided.  To fix this, make an alias both tables.
e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT T1.id AS parent_id, T2.id AS child_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FROM foo AS T1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INNER JOIN foo AS T2 ON T1.id = T2.parent_id;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index"></a>CQL0017: index was present but now it does not exist (use <code>@delete</code> instead) &#x27;index&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index" title="Direct link to heading">#</a></h3><p>The named index is in the previous schema bit it is not in the current schema.  All entities need some kind of tombstone in the  schema so that they can be correctly deleted if they are still present.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0018-duplicate-index-name-index"></a>CQL0018: duplicate index name &#x27;index&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0018-duplicate-index-name-index" title="Direct link to heading">#</a></h3><p>An index with the indicated name already exists.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0019-create-index-table-name-not-found-table_name"></a>CQL0019: create index table name not found &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0019-create-index-table-name-not-found-table_name" title="Direct link to heading">#</a></h3><p>The table part of a CREATE INDEX statement was not a valid table name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0020-duplicate-unique-key-in-table-key_name"></a>CQL0020: duplicate unique key in table &#x27;key_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0020-duplicate-unique-key-in-table-key_name" title="Direct link to heading">#</a></h3><p>A table contains two unique keys with the same name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0021-foreign-key-refers-to-non-existent-table-table_name"></a>CQL0021: foreign key refers to non-existent table &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0021-foreign-key-refers-to-non-existent-table-table_name" title="Direct link to heading">#</a></h3><p>The table in a foreign key REFERENCES clause is not a valid table.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0022-the-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name"></a>CQL0022: the exact type of both sides of a foreign key must match (expected expected_type; found actual_type) &#x27;key_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0022-the-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name" title="Direct link to heading">#</a></h3><p>The indicated foreign key has at least one column with a different type than corresponding column in the table it references.
This usually means that you have picked the wrong table or column in the foreign key declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0023-the-number-of-columns-on-both-sides-of-a-foreign-key-must-match"></a>CQL0023: The number of columns on both sides of a foreign key must match<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0023-the-number-of-columns-on-both-sides-of-a-foreign-key-must-match" title="Direct link to heading">#</a></h3><p>The number of column in the foreign key must be the same as the number of columns specified in the foreign table.
This usually means a column is missing in the REFERENCES part of the declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0024-table-does-not-have-pk-column-column"></a>CQL0024: table does not have pk column &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0024-table-does-not-have-pk-column-column" title="Direct link to heading">#</a></h3><p>In a primary key declaration, the indicated column, found in the primary is not actually a column of the table.
This usually means there is a typo in the primary key column declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0025-version-number-in-annotation-must-be-positive"></a>CQL0025: version number in annotation must be positive<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0025-version-number-in-annotation-must-be-positive" title="Direct link to heading">#</a></h3><p>In an <code>@create</code> or <code>@delete</code> annotation, the version number must be &gt; 0.
This error usually means there is a typo in the version number.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0026-duplicate-version-annotation"></a>CQL0026: duplicate version annotation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0026-duplicate-version-annotation" title="Direct link to heading">#</a></h3><p>There can only be one <code>@create</code>, <code>@delete</code>, or <code>@recreate</code> annotation for any given table/column.  More than one <code>@create</code> is redundant.
This error usually means the <code>@create</code> was cut/paste to make an <code>@delete</code> and then not edited or something like that.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name"></a>CQL0027: a procedure can appear in only one annotation &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name" title="Direct link to heading">#</a></h3><p>The indicated migration procedure e.g. the foo in <code>@create(5, foo)</code> appears in another annotation.  Migration steps should happen exactly once.
This probably means the annotation was cut/paste and the migration proc was not removed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0028-the-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name"></a>CQL0028: the FK reference must be exactly one column with the correct type &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0028-the-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name" title="Direct link to heading">#</a></h3><p>When a foreign key is specified in the column definition it is the entire foreign key.  That means the references part of the declaration can only be for that one column.
If you need more columns, you have to declare the foreign key independently.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name"></a>CQL0029: autoincrement column must be [LONG_]INTEGER PRIMARY KEY &#x27;column name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name" title="Direct link to heading">#</a></h3><p>SQLite is very fussy about autoincrement columns.  The column in question must be either a LONG INTEGER or an INTEGER and it must be PRIMARY KEY.
In fact, CQL will rewrite LONG INTEGER into INTEGER because only that exact form is supported, but SQLite INTEGERs can hold LONG values so that&#x27;s ok.
Any other autoincrement form results in this error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name"></a>CQL0030: a column attribute was specified twice on the same column &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name" title="Direct link to heading">#</a></h3><p>This error indicates a pattern like &quot;id text not null not null&quot; was found.
The same attribute shouldn&#x27;t appear twice.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0031-column-cant-be-primary-key-and-also-unique-key-column"></a>CQL0031: column can&#x27;t be primary key and also unique key &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0031-column-cant-be-primary-key-and-also-unique-key-column" title="Direct link to heading">#</a></h3><p>In a column definition, the column can only be marked with at most one of PRIMARY KEY or UNIQUE</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column"></a>CQL0032: created columns must be at the end and must be in version order&quot;, &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column" title="Direct link to heading">#</a></h3><p>The SQLite ALTER TABLE ADD COLUMN statement is used to add new columns to the schema.  This statement puts the columns at the end of the table.
In order to make the CQL schema align as closely as possible to the actual sqlite schema you will get you are required to add
columns where SQLite will put them.  This will help a lot if you ever connect to such a database and start doing <code>select * from &lt;somewhere with creates&gt;</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column"></a>CQL0033: columns in a table marked @recreate cannot have @create or <code>@delete</code>, &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column" title="Direct link to heading">#</a></h3><p>If the table is using the <code>@recreate</code> plan then you can add and remove columns (and other things freely)  you don&#x27;t need to mark columns with <code>@create</code> or <code>@delete</code> just add/remove them.
This error prevents the build up of useless annotations.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0035-column-delete-version-cant-be--column-create-version-column"></a>CQL0035: column delete version can&#x27;t be &lt;= column create version&quot;, &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0035-column-delete-version-cant-be--column-create-version-column" title="Direct link to heading">#</a></h3><p>You can&#x27;t <code>@delete</code> a column in a version before it was even created.  Probably there is a typo in one or both of the versions.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0036-column-delete-version-cant-be--the-table-create-version-column"></a>CQL0036: column delete version can&#x27;t be &lt;= the table create version &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0036-column-delete-version-cant-be--the-table-create-version-column" title="Direct link to heading">#</a></h3><p>The indicated column is being deleted in a version that is before the table it is found in was even created.  Probably there is a typo in the delete version.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0038-column-create-version-cant-be--the-table-create-version-column"></a>CQL0038: column create version can&#x27;t be <code>&lt;=</code> the table create version &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0038-column-create-version-cant-be--the-table-create-version-column" title="Direct link to heading">#</a></h3><p>The indicated column is being created in a version that is before the table it is found in was even created.  Probably there is a typo in the delete version.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0039-column-create-version-cant-be--the-table-delete-version-column"></a>CQL0039: column create version can&#x27;t be <code>&gt;=</code> the table delete version &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0039-column-create-version-cant-be--the-table-delete-version-column" title="Direct link to heading">#</a></h3><p>The indicated column is being created in a version that that is after it has already been supposedly deleted.  Probably there is a typo in one or both of the version numbers.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0040-table-can-only-have-one-autoinc-column-column"></a>CQL0040: table can only have one autoinc column &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0040-table-can-only-have-one-autoinc-column-column" title="Direct link to heading">#</a></h3><p>The indicated column is the second column to be marked with AUTOINCREMENT in its table.  There can only be one such column.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0041-tables-cannot-have-object-columns-column"></a>CQL0041: tables cannot have object columns &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0041-tables-cannot-have-object-columns-column" title="Direct link to heading">#</a></h3><p>The OBJECT data type is only for use in parameters and local variables.  SQLite has no storage for object references.
The valid data types include <code>INTEGER</code>, <code>LONG INTEGER</code>, <code>REAL</code>, <code>BOOL</code>, <code>TEXT</code>, <code>BLOB</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0042-left-operand-must-be-a-string-in-likematchglob"></a>CQL0042: left operand must be a string in &#x27;LIKE/MATCH/GLOB&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0042-left-operand-must-be-a-string-in-likematchglob" title="Direct link to heading">#</a></h3><p>The indicated operator can only be used to compare two strings.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0043-right-operand-must-be-a-string-in-likematchglob"></a>CQL0043: right operand must be a string in &#x27;LIKE/MATCH/GLOB&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0043-right-operand-must-be-a-string-in-likematchglob" title="Direct link to heading">#</a></h3><p>The indicated operator can only be used to compare two strings.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match"></a>CQL0044: operator may only appear in the context of a SQL statement &#x27;MATCH&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match" title="Direct link to heading">#</a></h3><p>The MATCH operator is a complex sqlite primitive.  It can only appear within SQL expressions.
See the CQL documentation about it being a two-headed-beast when it comes to expression evaluation.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0045-blob-operand-not-allowed-in-operator"></a>CQL0045: blob operand not allowed in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0045-blob-operand-not-allowed-in-operator" title="Direct link to heading">#</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow blobs as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0046-object-operand-not-allowed-in-operator"></a>CQL0046: object operand not allowed in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0046-object-operand-not-allowed-in-operator" title="Direct link to heading">#</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow objects as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0047-string-operand-not-allowed-in-operator"></a>CQL0047: string operand not allowed in &#x27;operator&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0047-string-operand-not-allowed-in-operator" title="Direct link to heading">#</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow strings as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0048-blob-operand-not-allowed-in-not"></a>CQL0048: blob operand not allowed in &#x27;NOT&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0048-blob-operand-not-allowed-in-not" title="Direct link to heading">#</a></h3><p>The logical not operator only works on numbers.  Blobs are not allow as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0049-object-operand-not-allowed-in-not"></a>CQL0049: object operand not allowed in &#x27;NOT&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0049-object-operand-not-allowed-in-not" title="Direct link to heading">#</a></h3><p>The logical not operator only works on numbers.  Objects are not allow as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0050-string-operand-not-allowed-in-not"></a>CQL0050: string operand not allowed in &#x27;NOT&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0050-string-operand-not-allowed-in-not" title="Direct link to heading">#</a></h3><p>The logical not operator only works on numbers.  Strings are not allow as an operand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0051-argument-can-only-be-used-in-count-"></a>CQL0051: argument can only be used in count(<em>) &#x27;</em>&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0051-argument-can-only-be-used-in-count-" title="Direct link to heading">#</a></h3><p>The &#x27;<em>&#x27; special operator can only appear in the COUNT function.
e.g. `select count(</em>) from some_table`
It is not a valid function argument in any other context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0052-select--cannot-be-used-with-no-from-clause"></a>CQL0052: select * cannot be used with no FROM clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0052-select--cannot-be-used-with-no-from-clause" title="Direct link to heading">#</a></h3><p>Select statements of the form <code>select 1, &#x27;foo&#x27;;</code> are <code>valid but select &#x27;*&#x27;;</code> is not.
The <code>*</code> shortcut for columns only makes sense if there is something to select from.
e.g. <code>select * from some_table;</code> is valid.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0053-select-table-cannot-be-used-with-no-from-clause"></a>CQL0053: select [table].* cannot be used with no FROM clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0053-select-table-cannot-be-used-with-no-from-clause" title="Direct link to heading">#</a></h3><p>Select statements of the form <code>select 1, &#x27;foo&#x27;;</code> are <code>valid but select &#x27;T.*&#x27;;</code> is not.
The <code>T.*</code> shortcut for all the columns from table T only makes sense if there is
something to select form.
e.g. <code>select T.* from some_table T;</code> is valid.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0054-table-not-found-table"></a>CQL0054: table not found &#x27;table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0054-table-not-found-table" title="Direct link to heading">#</a></h3><p>The indicated table was used in a select statement like <code>select T.* from ...</code> but no such table was present in the <code>FROM</code> clause.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0055-all-columns-in-the-select-must-have-a-name"></a>CQL0055: all columns in the select must have a name<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0055-all-columns-in-the-select-must-have-a-name" title="Direct link to heading">#</a></h3><p>Referring to the select statement on the failing line, that select statement was used in a context where all the columns must have a name.
Examples include defining a view, a cursor, or creating a result set from a procedure.  The failing code might look something like this.
<code>select 1, 2 B;</code>  it needs to look like this <code>select 1 A, 2 B</code>;</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0056-null-column-did-not-specify-a-type-column"></a>CQL0056: NULL column did not specify a type &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0056-null-column-did-not-specify-a-type-column" title="Direct link to heading">#</a></h3><p>In a select statement the NULL literal has no type.  If the type of the column cannot be inferred then it must be declared specifically.
You can fix this error by changing the <code>NULL</code> to something like <code>CAST(NULL as TEXT)</code>.
A common place this problem happens is in defining a view or returning a result set from a stored procedure.  In those cases
all the columns must have a name and a type.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0057-if-multiple-selects-all-must-have-the-same-column-count"></a>CQL0057: if multiple selects, all must have the same column count<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0057-if-multiple-selects-all-must-have-the-same-column-count" title="Direct link to heading">#</a></h3><p>If a stored procedure might return one of several result sets, each of the select statements it might return must have the same number of columns.
Likewise, if several select results are being combined with <code>UNION</code> or <code>UNION ALL</code> they must all have the same number of columns.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-column"></a>CQL0058: if multiple selects, all column names must be identical so they have unambiguous names &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-column" title="Direct link to heading">#</a></h3><p>If a stored procedure might return one of several result sets, each of the select statements must have the same column names for its result.
Likewise, if several select results are being combined with <code>UNION</code> or <code>UNION ALL</code> they must all have the same column names.</p><p>This is important so that there can be one unambiguous column name for every column for group of select statements.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select 1 A, 2 B</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">union</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select 3 A, 4 C;</span></div></div></div></div></div><p>Would provoke this error.  In this case &#x27;C&#x27; would be regarded as the offending column.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name"></a>CQL0059: a variable name might be ambiguous with a column name, this is an anti-pattern &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name" title="Direct link to heading">#</a></h3><p>The referenced name is the name of a local or a global in the same scope as the name of a column.  This can lead to surprising results as it is not clear which name takes priority (previously the variable did rather than the column, now it&#x27;s an error).</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is now an error, in all cases the argument would have been selected</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>To correct this, rename the local/global.  Or else pick a more distinctive column name, but usually the local is the problem.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0060-referenced-table-can-be-independently-be-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table"></a>CQL0060: referenced table can be independently be recreated so it cannot be used in a foreign key, &#x27;referenced_table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0060-referenced-table-can-be-independently-be-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table" title="Direct link to heading">#</a></h3><p>The referenced table is marked recreate so it must be in the same recreate
group as the current table because the referenced table might be recreated away leaving all the
foreign key references in current table as orphans.</p><p>So we check the following:
If the referenced table is marked recreate then any of the following result in CQL0060</p><ul><li>the referenced table is in no group, OR</li><li>the containing table is not recreate at all (non-recreate table can&#x27;t reference recreate tables at all), OR</li><li>the containing table is in no recreate group (it&#x27;s recreate but not in any group so they might not rev together), OR</li><li>the recreate groups of the two tables are different (it&#x27;s in a recreate group but not same one so they my not rev together)</li></ul><p>The referenced table is a recreate table and one of the 4 above conditions was not met.  Either don&#x27;t reference it or
else put the current table and the referenced table into the same recreate group.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column"></a>CQL0061: if multiple selects, all columns must be an exact type match (expected expected_type; found actual_type) &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column" title="Direct link to heading">#</a></h3><p>In a stored proc with multiple possible selects providing the result, all of the columns of all the selects must be an exact type match.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">if x then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select 1 A, 2 B</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select 3 A, 4.0 B;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span></div></div></div></div></div><p>Would provoke this error.  In this case &#x27;B&#x27; would be regarded as the offending column and the error is reported on the second B.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column"></a>CQL0062: if multiple selects, all columns must be an exact type match (including nullability) (expected expected_type; found actual_type) &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column" title="Direct link to heading">#</a></h3><p>In a stored proc with multiple possible selects providing the result, all of the columns of all the selects must be an exact type match.
This error indicates that the specified column differs by nullability.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name"></a>CQL0063: can&#x27;t mix and match out statement with select/call for return values &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name" title="Direct link to heading">#</a></h3><p>If the procedure is using SELECT to create a result set it cannot also use the OUT keyword
to create a one-row result set.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement"></a>CQL0064: object variables may not appear in the context of a SQL statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement" title="Direct link to heading">#</a></h3><p>SQLite doesn&#x27;t understand object references, so that means you cannot try to use a variable or parameter of type object inside of a SQL statement.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc foo(X object)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select X is null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><p>In this example X is an object parameter, but even to use X for an <code>is null</code> check in a select statement would require binding an object which is not possible.</p><p>On the other hand this compiles fine.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc foo(X object, out is_null bool not null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  set is_null := X is null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><p>This is another example of XQL being a two-headed beast.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0065-identifier-is-ambiguous-name"></a>CQL0065: identifier is ambiguous &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0065-identifier-is-ambiguous-name" title="Direct link to heading">#</a></h3><p>There is more than one variable/column with indicated name in equally near scopes.  The most common reason for this is that there are two column in a join with the same name and that name has not been qualified elsewhere.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FROM (SELECT 1 AS A, 2 AS B) AS T1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  INNER JOIN (SELECT 1 AS A, 2 AS B) AS T2;</span></div></div></div></div></div><p>There are two possible columns named <code>A</code>.  Fix this by using <code>T1.A</code> or <code>T2.A</code>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name"></a>CQL0066: if a table is marked <code>@recreate</code>, its indices must be in its schema region &#x27;index_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name" title="Direct link to heading">#</a></h3><p>If a table is marked <code>@recreate</code> that means that when it changes it is dropped and created during schema maintenance.  Of course when it is dropped its indices are also dropped.  So the indices must also be recreated when the table changes.  So with such a table it makes no sense to have indices that are in a different schema region.  This can only work if they are all always visible together.</p><p>Tables on the <code>@create</code> plan are not dropped so their indices can be maintained separately.  So they get a little extra flexibility.</p><p>To fix this error move the offending index into the same schema region as the table.  And probably put them physically close for maintenance sanity.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name"></a>CQL0067: cursor was not used with &#x27;fetch [cursor]&#x27;  &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name" title="Direct link to heading">#</a></h3><p>The code is trying to access fields in the named cursor but the automatic field generation form was not used so there are no such fields.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare a integer;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare b integer;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select 1 A, 2 B;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C into a, b; -- C.A and C.B not created (!)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (C.A) then -- error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span></div></div></div></div></div><p>Correct usage looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select 1 A, 2 B;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C;  -- automatically creates C.A and C.B</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (C.A) then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0068-field-not-found-in-cursor-field"></a>CQL0068: field not found in cursor &#x27;field&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0068-field-not-found-in-cursor-field" title="Direct link to heading">#</a></h3><p>The indicated field is not a valid field in a cursor expression.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select 1 A, 2 B;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C;  -- automatically creates C.A and C.B</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (C.X) then -- C has A and B, but no X</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0069-name-not-found-name"></a>CQL0069: name not found &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0069-name-not-found-name" title="Direct link to heading">#</a></h3><p>The indicated name could not be resolved in the scope in which it appears.
Probably there is a typo.  But maybe the name you need isn&#x27;t available in
the scope you are trying to use it in.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0071-first-operand-cannot-be-a-blob-in-betweennot-between"></a>CQL0071: first operand cannot be a blob in &#x27;BETWEEN/NOT BETWEEN&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0071-first-operand-cannot-be-a-blob-in-betweennot-between" title="Direct link to heading">#</a></h3><p>The BETWEEN operator works on numerics and strings only.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0072-first-operand-cannot-be-a-blob-in-betweennot-between"></a>CQL0072: first operand cannot be a blob in &#x27;BETWEEN/NOT BETWEEN&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0072-first-operand-cannot-be-a-blob-in-betweennot-between" title="Direct link to heading">#</a></h3><p>The BETWEEN operator works on numerics and strings only.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0073-cast-may-only-appear-in-the-context-of-sql-statement"></a>CQL0073: CAST may only appear in the context of SQL statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0073-cast-may-only-appear-in-the-context-of-sql-statement" title="Direct link to heading">#</a></h3><p>The CAST function does highly complex and subtle conversions, including date/time functions and other things.  It&#x27;s not possibly to emulate this accurately and there is no sqlite helper to do the job directly from a C call.  Consequently it&#x27;s only supported in the context of CQL statements.  It can be used in normal expressions by using the nested <code>SELECT</code> form <code>(select ...)</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0074-too-few-arguments-provided-coalesce"></a>CQL0074: Too few arguments provided &#x27;coalesce&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0074-too-few-arguments-provided-coalesce" title="Direct link to heading">#</a></h3><p>There must be at least two arguments in a call to <code>coalesce</code>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0075-incorrect-number-of-arguments-ifnull"></a>CQL0075: Incorrect number of arguments &#x27;ifnull&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0075-incorrect-number-of-arguments-ifnull" title="Direct link to heading">#</a></h3><p>The  <code>ifnull</code> function requires exactly two arguments.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0076-null-literal-is-useless-in-function-ifnullcoalesce"></a>CQL0076: Null literal is useless in function &#x27;ifnull/coalesce&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0076-null-literal-is-useless-in-function-ifnullcoalesce" title="Direct link to heading">#</a></h3><p>Adding a NULL literal to <code>IFNULL</code> or <code>COALESCE</code> is a no-op.  It&#x27;s most likely an error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless"></a>CQL0077: encountered arg known to be not null before the end of the list, rendering the rest useless.<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless" title="Direct link to heading">#</a></h3><p>In an <code>IFNULL</code> or <code>COALESCE</code> call, only the last argument should be known to be not null.  If the not null argument comes earlier in the list, then none of the others could ever be used.  That is almost certainly an error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses"></a>CQL0078: [not] in (select ...) is only allowed inside of select lists, where, on, and having clauses<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses" title="Direct link to heading">#</a></h3><p>The (select...) option for <code>IN</code> or <code>NOT IN</code> only makes sense in certain expression contexts.    Other uses are most likely errors.  It cannot appear in a loose expression because it fundamentally requires sqlite to process it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0079-function-got-incorrect-number-of-arguments-name"></a>CQL0079: function got incorrect number of arguments &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0079-function-got-incorrect-number-of-arguments-name" title="Direct link to heading">#</a></h3><p>The indicated function was called with the wrong number of arguments.  There are various functions supported each with different rules.  See the SQLite documentation for more information about the specified function.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0080-function-may-not-appear-in-this-context-name"></a>CQL0080: function may not appear in this context &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0080-function-may-not-appear-in-this-context-name" title="Direct link to heading">#</a></h3><p>Many functions can only appear in certain contexts.  For instance most aggregate functions are limited to the select list or the HAVING clause.  They cannot appear in, for instance, a WHERE, or ON clause.  The particulars vary by function.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name"></a>CQL0081: aggregates only make sense if there is a FROM clause &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name" title="Direct link to heading">#</a></h3><p>The indicated aggregate function was used in a select statement with no tables.  For instance</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select MAX(7);</span></div></div></div></div></div><p>Doesn&#x27;t make any sense.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0082-argument-must-be-numeric-average"></a>CQL0082: argument must be numeric &#x27;AVERAGE&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0082-argument-must-be-numeric-average" title="Direct link to heading">#</a></h3><p>The argument of AVERAGE must be numeric.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0083-argument-must-be-numeric-sum"></a>CQL0083: argument must be numeric &#x27;SUM&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0083-argument-must-be-numeric-sum" title="Direct link to heading">#</a></h3><p>The argument of SUM must be numeric.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0084-second-argument-must-be-a-string-in-function-group_concat"></a>CQL0084: second argument must be a string in function &#x27;group_concat&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0084-second-argument-must-be-a-string-in-function-group_concat" title="Direct link to heading">#</a></h3><p>The second argument of group_concat is the separator, it must be a string.  The first argument will be converted to a string.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0085-all-arguments-must-be-strings-strftime"></a>CQL0085: all arguments must be strings &#x27;strftime&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0085-all-arguments-must-be-strings-strftime" title="Direct link to heading">#</a></h3><p>The <code>strftime</code> function does complex data formatting.  All the arguments are strings.  See the sqlite documentation for more details on the options (there are many).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0086-first-argument-must-be-a-string-in-function-printf"></a>CQL0086: first argument must be a string in function &#x27;printf&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0086-first-argument-must-be-a-string-in-function-printf" title="Direct link to heading">#</a></h3><p>The first argument of <code>printf</code> is the formatting string.  The other arguments are variable and many complex conversions will apply.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0087-no-objectblob-types-are-allowed-in-arguments-for-function-printf"></a>CQL0087: no object/blob types are allowed in arguments for function &#x27;printf&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0087-no-objectblob-types-are-allowed-in-arguments-for-function-printf" title="Direct link to heading">#</a></h3><p>The <code>printf</code> has no meaningful conversions for blobs.  Object references are entirely unsupported.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name"></a>CQL0088: User function may not appear in the context of a SQL statement &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name" title="Direct link to heading">#</a></h3><p>External C functions declared with <code>declare function ...</code> are not for use in sqlite.  They may not appear inside statements.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name"></a>CQL0089: User function may only appear in the context of a SQL statement &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name" title="Direct link to heading">#</a></h3><p>SQLite user defined functions (or builtins) declared with  <code>declare select function</code> may only appear inside of sql statements.  In the case of user defined functions they must be added to sqlite by the appropriate C APIs before they can be used in CQL stored procs (or any other context really).   See the sqlite documentation on how to add user defined functions. <a href="http://www.sqlite.org/c3ref/create_function.html" target="_blank" rel="noopener noreferrer">Create Or Redefine SQL Functions</a></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0090-stored-proc-calls-may-not-appear-in-the-context-of-a-sql-statement-proc_name"></a>CQL0090: Stored proc calls may not appear in the context of a SQL statement &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0090-stored-proc-calls-may-not-appear-in-the-context-of-a-sql-statement-proc_name" title="Direct link to heading">#</a></h3><p>While it&#x27;s possible to call a CQL stored procedure as though it was a function (if it has an OUT argument as its last arg) you may not do this from inside of a SQL statement.  Just like external C functions SQLite cannot call stored procs.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name"></a>CQL0091: Stored procs that deal with result sets or cursors cannot be invoked as functions &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name" title="Direct link to heading">#</a></h3><p>The function syntax for procs cannot be used on procedures that return a result set.  Such procedures already have a result and it isn&#x27;t even a scalar result.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0092-raise-may-only-be-used-in-a-trigger-statement"></a>CQL0092: RAISE may only be used in a trigger statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0092-raise-may-only-be-used-in-a-trigger-statement" title="Direct link to heading">#</a></h3><p>SQLite only supports this kind of control flow in the context of triggers, certain trigger predicates might need to unconditionally fail and complex logic can be implemented in this way.  However this sort of thing is not really recommended.  In any case this is not a general purpose construct.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0093-raise-2nd-argument-must-be-a-string"></a>CQL0093: RAISE 2nd argument must be a string<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0093-raise-2nd-argument-must-be-a-string" title="Direct link to heading">#</a></h3><p>Only forms with a string as the second argument are supported by SQLite.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0094-function-not-yet-implemented-function"></a>CQL0094: function not yet implemented &#x27;function&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0094-function-not-yet-implemented-function" title="Direct link to heading">#</a></h3><p>The indicated function is not implemented in CQL.  Possibly you intended to declare it with <code>declare function</code> as an external function or <code>declare select function</code> as a sqlite builtin.  Note not all sqlite builtins are automatically declared.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0095-tableview-not-defined-name"></a>CQL0095: table/view not defined &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0095-tableview-not-defined-name" title="Direct link to heading">#</a></h3><p>The indicated name is neither a table nor a view.  It is possible that the table/view is now deprecated with <code>@delete</code> and therefore will appear to not exist in the current context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name"></a>CQL0096: join using column not found on the left side of the join &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name" title="Direct link to heading">#</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join.  Here the indicated name is not present on the left side of the join.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name"></a>CQL0097: join using column not found on the right side of the join &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name" title="Direct link to heading">#</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join.  Here the indicated name is not present on the right side of the join.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name"></a>CQL0098: left/right column types in join USING(...) do not match exactly &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name" title="Direct link to heading">#</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join and have the same data type.  Here the data types differ in the named column.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0099-having-clause-requires-group-by-clause"></a>CQL0099: HAVING clause requires GROUP BY clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0099-having-clause-requires-group-by-clause" title="Direct link to heading">#</a></h3><p>The <code>HAVING</code> clause makes no sense unless there is also a <code>GROUP BY</code> clause.  SQLite enforces this as does CQL.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0100-duplicate-common-table-name-name"></a>CQL0100: duplicate common table name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0100-duplicate-common-table-name-name" title="Direct link to heading">#</a></h3><p>In a <code>WITH</code> clause, the indicated common table name was defined more than once.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0101-too-few-column-names-specified-in-common-table-expression-name"></a>CQL0101: too few column names specified in common table expression &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0101-too-few-column-names-specified-in-common-table-expression-name" title="Direct link to heading">#</a></h3><p>In a <code>WITH</code> clause the indicated common table expression doesn&#x27;t include enough column names to capture the result of the <code>select</code> statement it is associated with.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">WITH foo(a) as (SELECT 1 A, 2 B) ...`</span></div></div></div></div></div><p>The select statement produces two columns the <code>foo</code> declaration specifies one.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0102-too-many-column-names-specified-in-common-table-expression-name"></a>CQL0102: too many column names specified in common table expression &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0102-too-many-column-names-specified-in-common-table-expression-name" title="Direct link to heading">#</a></h3><p>In a <code>WITH</code> clause the indicated common table expression has more  column names than the <code>select</code> expression it is associated with.</p><p>e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">WITH foo(a, b) as (SELECT 1) ... `</span></div></div></div></div></div><p>The select statement produces one column the <code>foo</code> declaration specifies two.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0103-duplicate-tableview-name-name"></a>CQL0103: duplicate table/view name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0103-duplicate-tableview-name-name" title="Direct link to heading">#</a></h3><p>The indicated table or view must be unique in its context.  The version at the indicated line number is a duplicate of a previous declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name"></a>CQL0104: view was present but now it does not exist (use <code>@delete</code> instead) &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name" title="Direct link to heading">#</a></h3><p>During schema validation, CQL found a view that used to exist but is now totally gone.  The correct procedure is to mark the view with <code>@delete</code> (you can also make it stub with the same name to save a little space).  This is necessary so that CQL can know what views should be deleted on client devices during an upgrade.  If the view is eradicated totally there would be no way to know that the view should be deleted if it exists.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0105-object-was-a-view-but-is-now-a-table-name"></a>CQL0105: object was a view but is now a table &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0105-object-was-a-view-but-is-now-a-table-name" title="Direct link to heading">#</a></h3><p>Converting a view into a table, or otherwise creating a table with the same name as a view is not legal.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name"></a>CQL0106: trigger was present but now it does not exist (use <code>@delete</code> instead) &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name" title="Direct link to heading">#</a></h3><p>During schema validation, CQL found a trigger that used to exist but is now totally gone.  The correct procedure is to mark the trigger with <code>@delete</code> (you can also make it stub with the same name to save a little space).  This is necessary so that CQL can know what triggers should be deleted on client devices during an upgrade.  If the trigger is eradicated totally there would be no way to know that the trigger should be deleted if it exists.  That would be bad.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0107-delete-version-cant-be--create-version-name"></a>CQL0107: delete version can&#x27;t be &lt;= create version &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0107-delete-version-cant-be--create-version-name" title="Direct link to heading">#</a></h3><p>Attempting to declare that an object has been deleted before it was created is an error.  Probably there is a typo in one or both of the version numbers of the named object.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0108-table-in-drop-statement-does-not-exist-table_name"></a>CQL0108: table in drop statement does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0108-table-in-drop-statement-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>The indicated table was not declared anywhere.  Note that CQL requires that you declare all tables you will work with, even if all you intend to do with the table is drop it.  When you put a <code>CREATE TABLE</code> statement in global scope this only declares a table, it doesn&#x27;t actually create the table. See the documentation on DDL for more information.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0109-cannot-drop-a-view-with-drop-table-view_name"></a>CQL0109: cannot drop a view with drop table &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0109-cannot-drop-a-view-with-drop-table-view_name" title="Direct link to heading">#</a></h3><p>The object named in a <code>DROP TABLE</code> statement must be a table, not a view.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0110-view-in-drop-statement-does-not-exist-view_name"></a>CQL0110: view in drop statement does not exist &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0110-view-in-drop-statement-does-not-exist-view_name" title="Direct link to heading">#</a></h3><p>The indicated view was not declared anywhere.  Note that CQL requires that you declare all views you will work with, even if all you intend to do with the view is drop it.  When you put a <code>CREATE VIEW</code> statement in global scope this only declares a view, it doesn&#x27;t actually create the view.  See the documentation on DDL for more information.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0111-cannot-drop-a-table-with-drop-view-name"></a>CQL0111: cannot drop a table with drop view &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0111-cannot-drop-a-table-with-drop-view-name" title="Direct link to heading">#</a></h3><p>The object named in a <code>DROP VIEW</code> statement must be a view, not a table.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0112-index-in-drop-statement-was-not-declared-index_name"></a>CQL0112: index in drop statement was not declared &#x27;index_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0112-index-in-drop-statement-was-not-declared-index_name" title="Direct link to heading">#</a></h3><p>The indicated index was not declared anywhere.  Note that CQL requires that you declare all indices you will work with, even if all you intend to do with the index is drop it.  When you put a <code>CREATE INDEX</code> statement in global scope this only declares an index, it doesn&#x27;t actually create the index.  See the documentation on DDL for more information.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0113-trigger-in-drop-statement-was-not-declared-name"></a>CQL0113: trigger in drop statement was not declared &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0113-trigger-in-drop-statement-was-not-declared-name" title="Direct link to heading">#</a></h3><p>The indicated trigger was not declared anywhere.  Note that CQL requires that you declare all triggers you will work with, even if all you intend to do with the trigger is drop it.  When you put a <code>CREATE TRIGGER</code> statement in global scope this only declares a trigger, it doesn&#x27;t actually create the trigger.  See the documentation on DDL for more information.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name"></a>CQL0114: current schema can&#x27;t go back to recreate semantics for &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name" title="Direct link to heading">#</a></h3><p>The indicated table was previously marked with <code>@create</code> indicating it has precious content and should be upgraded carefully.  The current schema marks the same table with <code>@recreate</code> meaning it has discardable content and should be upgraded by dropping it and recreating it.  This transition is not allowed.  If the table really is non-precious now you can mark it with <code>@delete</code> and then make a new similar table with <code>@recreate</code>.  This really shouldn&#x27;t happen very often if at all.  Probably the error is due to a typo or wishful thinking.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0115-current-create-version-not-equal-to-previous-create-version-for-table"></a>CQL0115: current create version not equal to previous create version for &#x27;table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0115-current-create-version-not-equal-to-previous-create-version-for-table" title="Direct link to heading">#</a></h3><p>The indicated table was previously marked with <code>@create</code> at some version (x) and now it is being created at some different version (y !=x ).  This not allowed (if it were then objects might be created in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table"></a>CQL0116: current delete version not equal to previous delete version for &#x27;table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table" title="Direct link to heading">#</a></h3><p>The indicated table was previously marked with <code>@delete</code> at some version (x) and now it is being deleted at some different version (y != x).  This not allowed (if it were then objects might be deleted in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0117-delete-procedure-changed-in-object-table_name"></a>CQL0117: <code>@delete</code> procedure changed in object &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0117-delete-procedure-changed-in-object-table_name" title="Direct link to heading">#</a></h3><p>The <code>@delete</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0118-create-procedure-changed-in-object-table_name"></a>CQL0118: <code>@create</code> procedure changed in object &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0118-create-procedure-changed-in-object-table_name" title="Direct link to heading">#</a></h3><p>The <code>@create</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0119-column-name-is-different-between-previous-and-current-schema-name"></a>CQL0119: column name is different between previous and current schema &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0119-column-name-is-different-between-previous-and-current-schema-name" title="Direct link to heading">#</a></h3><p>Since there is no sqlite operation that allows for columns to be renamed, attempting to rename a column is not allowed.</p><p>NOTE: you can also get this error if you remove a column entirely, or add a column in the middle of the list somewhere.</p><p>Since columns (also) cannot be reordered during upgrade, CQL expects to find all the columns in exactly the same order in the previous and new schema.  Any reordering, or deletion could easily look like an erroneous rename.  New columns must appear at the end of any existing columns.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0120-column-type-is-different-between-previous-and-current-schema-name"></a>CQL0120: column type is different between previous and current schema &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0120-column-type-is-different-between-previous-and-current-schema-name" title="Direct link to heading">#</a></h3><p>It is not possible to change the data type of a column during an upgrade, SQLite provides no such options.  Attempting to do so results in an error.  This includes nullability.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0121-column-current-create-version-not-equal-to-previous-create-version-name"></a>CQL0121: column current create version not equal to previous create version &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0121-column-current-create-version-not-equal-to-previous-create-version-name" title="Direct link to heading">#</a></h3><p>The indicated column was previously marked with <code>@create</code> at some version (x) and now it is being created at some different version (y !=x ).  This not allowed (if it were then objects might be created in the wrong/different order during upgrade which would cause all kinds of problems).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name"></a>CQL0122: column current delete version not equal to previous delete version &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name" title="Direct link to heading">#</a></h3><p>The indicated column was previously marked with <code>@delete</code> at some version (x) and now it is being deleted at some different version (y != x).  This not allowed (if it were then objects might be deleted in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0123-column-delete-procedure-changed-name"></a>CQL0123: column <code>@delete</code> procedure changed &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0123-column-delete-procedure-changed-name" title="Direct link to heading">#</a></h3><p>The <code>@delete</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0124-column-create-procedure-changed-name"></a>CQL0124: column <code>@create</code> procedure changed &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0124-column-create-procedure-changed-name" title="Direct link to heading">#</a></h3><p>The <code>@create</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0125-column-current-default-value-not-equal-to-previous-default-value-column"></a>CQL0125: column current default value not equal to previous default value &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0125-column-current-default-value-not-equal-to-previous-default-value-column" title="Direct link to heading">#</a></h3><p>The default value of a column may not be changed in later versions of the schema.  There is no SQLite operation that would allow this.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table"></a>CQL0126: table was present but now it does not exist (use <code>@delete</code> instead) &#x27;table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table" title="Direct link to heading">#</a></h3><p>During schema validation, CQL found a table that used to exist but is now totally gone.  The correct procedure is to mark the table with <code>@delete</code>.  This is necessary so that CQL can know what tables should be deleted on client devices during an upgrade.  If the table is eradicated totally there would be no way to know that the table should be deleted if it exists.  That would be bad.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0127-object-was-a-table-but-is-now-a-view-name"></a>CQL0127: object was a table but is now a view &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0127-object-was-a-table-but-is-now-a-view-name" title="Direct link to heading">#</a></h3><p>The indicated object was a table in the previous schema but is now a view in the current schema.  This transformation is not allowed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column"></a>CQL0128: table has a column that is different in the previous and current schema &#x27;column&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column" title="Direct link to heading">#</a></h3><p>The indicated column changed in one of its more exotic attributes, examples:</p><ul><li>its <code>FOREIGN KEY</code> rules changed in some way</li><li>its <code>PRIMARY KEY</code> status changed</li><li>its <code>UNIQUE</code> status changed</li></ul><p>Basically the long form description of the column is now different and it isn&#x27;t different in one of the usual way like type or default value.  This error is the catch all for all the other ways a column could change such as &quot;the FK rule for what happens when an update fk violation occurs is now different&quot; -- there are dozens of such errors and they aren&#x27;t very helpful anyway.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name"></a>CQL0129: a column was removed from the table rather than marked with <code>@delete</code> &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name" title="Direct link to heading">#</a></h3><p>During schema validation, CQL found a column that used to exist but is now totally gone.  The correct procedure is to mark the column with <code>@delete</code>.  This is necessary so that CQL can know what columns existed during any version of the schema, thereby allowing them to be used in migration scripts during an upgrade.  If the column is eradicated totally there would be no way to know that the exists, and should no longer be used.  That would be bad.</p><p>Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0130-table-has-columns-added-without-marking-them-create-column_name"></a>CQL0130: table has columns added without marking them <code>@create</code> &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0130-table-has-columns-added-without-marking-them-create-column_name" title="Direct link to heading">#</a></h3><p>The indicated column was added but it was not marked with <code>@create</code>.  The table in question is not on the <code>@recreate</code> plan so this is an error.  Add a suitable <code>@create</code> annotation to the column declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name"></a>CQL0131: table has newly added columns that are marked both <code>@create</code> and <code>@delete</code> &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name" title="Direct link to heading">#</a></h3><p>The indicated column was simultaneously marked <code>@create</code> and <code>@delete</code>.  That&#x27;s surely some kind of typo.  Creating a column and deleting it in the same version is weird.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name"></a>CQL0132: table has a facet that is different in the previous and current schema &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name" title="Direct link to heading">#</a></h3><p>The indicated table has changes in one of its non-column features.  These changes might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>None of these are allowed to change.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0133-non-column-facets-have-been-removed-from-the-table-name"></a>CQL0133: non-column facets have been removed from the table &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0133-non-column-facets-have-been-removed-from-the-table-name" title="Direct link to heading">#</a></h3><p>The error indicates that the table has had some stuff removed from it.  The &quot;stuff&quot; might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>Since there is no way to change any of the constraints after the fact, they may not be changed at all if the table is on the <code>@create</code> plan.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name"></a>CQL0134: table has a new non-column facet in the current schema &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name" title="Direct link to heading">#</a></h3><p>The error indicates that the table has had some stuff added to it.  The &quot;stuff&quot; might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>Since there is no way to change any of the constraints after the fact, they may not be changed at all if the table is on the <code>@create</code> plan.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0135-table-create-statement-attributes-different-than-previous-version-table_name"></a>CQL0135: table create statement attributes different than previous version &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0135-table-create-statement-attributes-different-than-previous-version-table_name" title="Direct link to heading">#</a></h3><p>The &#x27;flags&#x27; on the <code>CREATE TABLE</code> statement changed between versions.  These flags capture the options like the<code>TEMP</code> in <code>CREATE TEMP TABLE</code> and the <code>IF NOT EXISTS</code>.   Changing these is not allowed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0136-trigger-already-exists-trigger_name"></a>CQL0136: trigger already exists &#x27;trigger_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0136-trigger-already-exists-trigger_name" title="Direct link to heading">#</a></h3><p>Trigger names may not be duplicated.  Probably there is copy/pasta going on here.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0137-tableview-not-found-name"></a>CQL0137: table/view not found &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0137-tableview-not-found-name" title="Direct link to heading">#</a></h3><p>In a <code>CREATE TRIGGER</code> statement, the indicated name is neither a table or a view.  Either a table or
a view was expected in this context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name"></a>CQL0138: a trigger on a view must be the INSTEAD OF form &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name" title="Direct link to heading">#</a></h3><p>In a <code>CREATE TRIGGER</code> statement, the named target of the trigger was a view but the trigger type is not <code>INSTEAD OF</code>.  Only <code>INSTEAD OF</code> can be applied to views because views are not directly mutable so none of the other types make sense.  e.g. there can be no delete operations, on a view, so <code>BEFORE DELETE</code> or <code>AFTER DELETE</code> are not really a thing.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0139-temp-tables-may-not-have-versioning-annotations-table_name"></a>CQL0139: temp tables may not have versioning annotations &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0139-temp-tables-may-not-have-versioning-annotations-table_name" title="Direct link to heading">#</a></h3><p>The indicated table is a temporary table.  Since temp tables do not survive sessions it makes no sense to try to version them for schema upgrade.  They are always recreated on demand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name"></a>CQL0140: columns in a temp table may not have versioning attributes &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name" title="Direct link to heading">#</a></h3><p>The indicated column is part of a temporary table.  Since temp tables do not survive sessions it makes no sense to try to version their columns for schema upgrade.  They are always recreated on demand.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name"></a>CQL0141: table has an AUTOINCREMENT column; it cannot also be WITHOUT ROWID &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name" title="Direct link to heading">#</a></h3><p>SQLite uses its <code>ROWID</code> internally for <code>AUTOINCREMENT</code> columns.  Therefore <code>WITHOUT ROWID</code> is not a possibility if <code>AUTOINCREMENT</code> is in use.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0142-duplicate-column-name-column_name"></a>CQL0142: duplicate column name &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0142-duplicate-column-name-column_name" title="Direct link to heading">#</a></h3><p>In a <code>CREATE TABLE</code> statement, the indicated column was defined twice.  This is probably a copy/pasta issue.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0143-more-than-one-primary-key-in-table-table_name"></a>CQL0143: more than one primary key in table &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0143-more-than-one-primary-key-in-table-table_name" title="Direct link to heading">#</a></h3><p>The indicated table has more than one column with the <code>PRIMARY KEY</code> attribute or multiple <code>PRIMARY KEY</code> constraints, or a combination of these things.  You&#x27;ll have to decide which one is really intended to be primary.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0144-cannot-alter-a-view-view_name"></a>CQL0144: cannot alter a view &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0144-cannot-alter-a-view-view_name" title="Direct link to heading">#</a></h3><p>In an <code>ALTER TABLE</code> statement, the table to be altered is actually a view.  This is not allowed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0144-table-in-alter-statement-does-not-exist-table_name"></a>CQL0144: table in alter statement does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0144-table-in-alter-statement-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>In an <code>ALTER TABLE</code> statement, the table to be altered was not defined, or perhaps was marked with <code>@delete</code> and is no longer usable in the current schema version.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0145-version-annotations-not-valid-in-alter-statement-column_name"></a>CQL0145: version annotations not valid in alter statement &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0145-version-annotations-not-valid-in-alter-statement-column_name" title="Direct link to heading">#</a></h3><p>In an <code>ALTER TABLE</code> statement, the attributes on the column may not include <code>@create</code> or <code>@delete</code>.  Those annotations go on the columns declaration in the corresponding <code>CREATE TABLE</code> statement.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0146-adding-an-auto-increment-column-is-not-allowed-column_name"></a>CQL0146: adding an auto increment column is not allowed &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0146-adding-an-auto-increment-column-is-not-allowed-column_name" title="Direct link to heading">#</a></h3><p>In an <code>ALTER TABLE</code> statement, the attributes on the column may not include <code>AUTOINCREMENT</code>.  SQLite does not support the addition of new <code>AUTOINCREMENT</code> columns.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name"></a>CQL0147: adding a not nullable column with no default value is not allowed &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name" title="Direct link to heading">#</a></h3><p>In an <code>ALTER TABLE</code> statement the attributes on the named column must include a default value or else the column must be nullable.  This is so that SQLite knows what value to put on existing rows when the column is added and also so that any existing insert statements will not suddenly all become invalid.  If the column is nullable or has a default value then the existing insert statements that don&#x27;t specify the column will continue to work, using either NULL or the default.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name"></a>CQL0148: added column must already be reflected in declared schema, with <code>@create</code>, exact name match required &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name" title="Direct link to heading">#</a></h3><p>In CQL loose schema is a declaration, it does not actually create anything unless placed inside of a procedure.  A column that is added with <code>ALTER TABLE</code> is not actually declared as part of the schema by the <code>ALTER</code>.  Rather the schema declaration is expected to include any columns you plan to add.  Normally the way this all happens is that you put <code>@create</code> notations on a column in the schema and the automatic schema upgrader then creates suitable <code>ALTER TABLE</code> statements to arrange for that column to be added.  If you manually write an <code>ALTER TABLE</code> statement it isn&#x27;t allowed to add columns at whim; in some sense it must be creating the reality already described in the declaration.  This is exactly what the automated schema upgrader does -- it declares the end state and then alters the world to get to that state.</p><p>It&#x27;s important to remember that from CQL&#x27;s perspective the schema is fixed for any given compilation, so runtime alterations to it are not really part of the type system.  They can&#x27;t be.  Even <code>DROP TABLE</code> does not remove the table from type system -- it can&#x27;t -- the most likely situation is that you are about to recreate that same table again for another iteration with the proc that creates it.</p><p>This particular error is saying that the column you are trying to add does not exist in the declared schema.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name"></a>CQL0149: added column must be an exact match for the column type declared in the table &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name" title="Direct link to heading">#</a></h3><p>In CQL loose schema is a declaration, it does not actually create anything unless placed inside of a procedure.  A column that is added with <code>ALTER TABLE</code> is not actually declared as part of the schema by the <code>ALTER</code>.  Rather the schema declaration is expected to include any columns you plan to add.  Normally the way this all happens is that you put <code>@create</code> notations on a column in the schema and the automatic schema upgrader then creates suitable <code>ALTER TABLE</code> statements to arrange for that column to be added.  If you manually write an <code>ALTER TABLE</code> statement it isn&#x27;t allowed to add columns at whim; in some sense it must be creating the reality already described in the declaration.  This is exactly what the automated schema upgrader does -- it declares the end state and then alters the world to get to that state.</p><p>It&#x27;s important to remember that from CQL&#x27;s perspective the schema is fixed for any given compilation, so runtime alterations to it are not really part of the type system.  They can&#x27;t be.  Even <code>DROP TABLE</code> does not remove the table from type system -- it can&#x27;t -- the most likely situation is that you are about to recreate that same table again for another iteration with the proc that creates it.</p><p>This particular error is saying that the column you are trying to add exists in the declared schema, but its definition is different than you have specified in the <code>ALTER TABLE</code> statement.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0150-expected-numeric-expression-in-if-predicate"></a>CQL0150: expected numeric expression in IF predicate<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0150-expected-numeric-expression-in-if-predicate" title="Direct link to heading">#</a></h3><p>In an <code>IF</code> statement the condition (predicate) must be a numeric.  The body of the <code>IF</code> runs if the value is not null and not zero.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0151-table-in-delete-statement-does-not-exist-table_name"></a>CQL0151: table in delete statement does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0151-table-in-delete-statement-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>In a <code>DELETE</code> statement, the indicated table does not exist. Probably it&#x27;s a spelling mistake, or else the table has been marked with <code>@delete</code> and may no longer be used in <code>DELETE</code> statements.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0152-cannot-delete-from-a-view-view_name"></a>CQL0152: cannot delete from a view &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0152-cannot-delete-from-a-view-view_name" title="Direct link to heading">#</a></h3><p>In a <code>DELETE</code> statement, the target of the delete must be a table, but the indicated name is a view.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0153-duplicate-target-column-name-in-update-statement-column_name"></a>CQL0153: duplicate target column name in update statement &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0153-duplicate-target-column-name-in-update-statement-column_name" title="Direct link to heading">#</a></h3><p>In an <code>UPDATE</code> statement, you can only specify any particular column to update once.</p><p>e.g. <code>UPDATE coordinates set x = 1, x = 3;</code>  will produce this error. <code>UPDATE coordinates set x = 1, y = 3;</code> might be correct.</p><p>This error is most likely caused by a typo or a copy/pasta of the column names, especially if they were written one per line.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0154-table-in-update-statement-does-not-exist-table_name"></a>CQL0154: table in update statement does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0154-table-in-update-statement-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>In an <code>UPDATE</code> statement, the target table does not exist.  Probably it&#x27;s a spelling mistake, or else the table has been marked with <code>@delete</code> and may no longer be used in <code>UPDATE</code> statements.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0155-cannot-update-a-view-view_name"></a>CQL0155: cannot update a view &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0155-cannot-update-a-view-view_name" title="Direct link to heading">#</a></h3><p>In an <code>UPDATE</code> statement, the target of the update must be a table but the name of a view was provided.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0156-seed-expression-must-be-a-non-nullable-integer"></a>CQL0156: seed expression must be a non-nullable integer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0156-seed-expression-must-be-a-non-nullable-integer" title="Direct link to heading">#</a></h3><p>The <code>INSERT</code> statement statement supports the notion of synthetically generated values for dummy data purposes.  A &#x27;seed&#x27; integer is used to derive the values.  That seed (in the <code>@seed()</code> position) must be a non-null integer.</p><p>The most common reason for this error is that the seed is an input parameter and it was not declared <code>NOT NULL</code>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0157-count-of-columns-differs-from-count-of-values"></a>CQL0157: count of columns differs from count of values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0157-count-of-columns-differs-from-count-of-values" title="Direct link to heading">#</a></h3><p>In an <code>INSERT</code> statement of the form <code>INSERT INTO foo(a, b, c) VALUES(x, y, z)</code> the number of values (x, y, z) must
be the same as the number of columns (a, b, c).  Note that there are many reasons you might not have to specify all the columns of the table but whichever columns you do specify should have values.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0158-required-column-missing-in-insert-statement-column_name"></a>CQL0158: required column missing in INSERT statement &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0158-required-column-missing-in-insert-statement-column_name" title="Direct link to heading">#</a></h3><p>In an <code>INSERT</code> statement such as <code>INSERT INTO foo(a,b,c) VALUES(x,yz)</code> this error is indicating that there is a column in <code>foo</code> (the one indicated in the error) which was not in the list (i.e. not one of a, b, c) and that column is neither nullable, nor does it have a default value.  In order to insert a row a value must be provided.  To fix this include the indicated column in your insert statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0159-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now"></a>CQL0159: there&#x27;s no good way to generate dummy blobs; not supported for now<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0159-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now" title="Direct link to heading">#</a></h3><p>The dummy data feature does not support blobs.  You can make your own blob with the CAST operator and a numeric if need be.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0160-table-in-insert-statement-does-not-exist-table_name"></a>CQL0160: table in insert statement does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0160-table-in-insert-statement-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>In an <code>INSERT</code> statement attempting to insert into the indicated table name is not possible because there is no such table.
This error might happen because of a typo, or it might happen because the indicated table has been marked with <code>@delete</code> and is logically hidden.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0161-cannot-insert-into-a-view-view_name"></a>CQL0161: cannot insert into a view &#x27;view_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0161-cannot-insert-into-a-view-view_name" title="Direct link to heading">#</a></h3><p>In an <code>INSERT</code> statement attempting to insert into the indicated name is not possible because that name is a view not a table.  Inserting into views is not supported.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0162-from-arguments-is-redundant-if-insert-column-list-is-empty"></a>CQL0162: FROM ARGUMENTS is redundant if insert column list is empty<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0162-from-arguments-is-redundant-if-insert-column-list-is-empty" title="Direct link to heading">#</a></h3><p>The <code>INSERT</code> statement supports the sugar format  <code>INSERT INTO foo(a,b,c) FROM ARGUMENTS</code> which causes the arguments of the current procedure to be used as the values.  This error is complaining that no columns were specified, that is, you have written <code>INSERT INTO foo() FROM ARGUMENTS</code>.   With no specified columns the arguments would be redundant.  To fix this error there are two choices.   Perhaps the column names were omitted, in which case add <code>a,b,c</code> or something like that in the parenthesis.  Or else remove them entirely <code>INSERT INTO foo FROM ARGUMENTS</code> means insert ALL the columns of foo from the arguments.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0163-from-arguments-construct-is-only-valid-inside-a-procedure"></a>CQL0163: FROM ARGUMENTS construct is only valid inside a procedure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0163-from-arguments-construct-is-only-valid-inside-a-procedure" title="Direct link to heading">#</a></h3><p>The <code>INSERT</code> statement supports the sugar format  <code>INSERT INTO foo(a,b,c) FROM ARGUMENTS</code> which causes the arguments of the current procedure to be used as the values.  This error is complaining that you have used this form of insert but the statement does not occur inside of a procedure so there can be no arguments.  This form does not make sense outside of any procedure.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0164-too-few-arguments-available"></a>CQL0164: too few arguments available<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0164-too-few-arguments-available" title="Direct link to heading">#</a></h3><p>The <code>INSERT</code> statement supports the sugar format  <code>INSERT INTO foo(a,b,c) FROM ARGUMENTS</code> which causes the arguments of the current procedure to be used as the values.  This error is complaining that you have used this form of insert but you have specified more columns (a,b,c) than there are arguments.  Either add arguments or remove columns to fix this error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name"></a>CQL0165: fetch values is only for value cursors, not for sqlite cursors &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name" title="Direct link to heading">#</a></h3><p>Cursors come in two flavors.  There are &quot;statement cursors&quot; which are built from something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or --</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>That is, they come from a SQLite statement and you can fetch values from that statement.  The second type comes from procedural values like this.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In the second example <code>C</code>&#x27;s data type will be the same as the columns in <code>my_table</code> and we will fetch its values from <code>1,2,3</code> -- this version has no database backing at all, it&#x27;s just data.</p><p>This error says that you declared the cursor in the first form (with a SQL statement) but then you tried to fetch it using the second form, the one for data. These forms don&#x27;t mix.   If you need a value cursor for a row you can copy data from one cursor into another.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0166-count-of-columns-differs-from-count-of-values"></a>CQL0166: count of columns differs from count of values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0166-count-of-columns-differs-from-count-of-values" title="Direct link to heading">#</a></h3><p>In a value cursor, declared something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The type of the cursor ( in this case from <code>my_table</code>) requires a certain number of columns, but that doesn&#x27;t match the number that were provided in the values.</p><p>To fix this you&#x27;ll need to add/remove values so that the type match.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0167-required-column-missing-in-fetch-statement-column_name"></a>CQL0167: required column missing in FETCH statement &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0167-required-column-missing-in-fetch-statement-column_name" title="Direct link to heading">#</a></h3><p>In a value cursor, declared something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This error is saying that there is some other field in the table &#x27;d&#x27; and it was not specified in the values.  Nor was there a usable dummy data for that column that could be used.  You need to provide a value for the missing column.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0168-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now"></a>CQL0168: there&#x27;s no good way to generate dummy blobs; not supported for now<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0168-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now" title="Direct link to heading">#</a></h3><p>In a value cursor with dummy data specified, one of the columns in the cursor is of type blob.  There&#x27;s no good way to create dummy data for blobs so that isn&#x27;t supported.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0169-cannot-fetch-from-a-cursor-without-fields-cursor_name"></a>CQL0169: cannot fetch from a cursor without fields &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0169-cannot-fetch-from-a-cursor-without-fields-cursor_name" title="Direct link to heading">#</a></h3><p>This error corresponds to a pretty specific instance.  First there are two cursors and we&#x27;re processing a statement that looks something like this.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C from D;</span></div></div></div></div></div><p><code>C</code> and <code>D</code> are both cursor variables.  However, D does not have any storage associated with it so it isn&#x27;t a valid source.</p><p>How does that happen?  More specifically this situation has happened almost certainly.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare D cursor for select * from foo;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch D into a, b, c;</span></div></div></div></div></div><p>Here we did fetch from the cursor but we used local variables to hold the results, the cursor has no storage.</p><p>Had we done this instead:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch D;</span></div></div></div></div></div><p>then you use <code>D.a</code>, <code>D.b</code>, and <code>D.c</code> for the fetched values: the cursor has storage.  So if you use the second form (the easier one really) then the cursor can be used as a source of data.</p><p>If you have done the above and got this error you can always do something like this instead:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C from values(a,b,c);</span></div></div></div></div></div><p>Which is where the cursor was stored.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0170-cursor-must-be-a-value-cursor-not-a-statement-cursor-cursor_name"></a>CQL0170: cursor must be a value cursor, not a statement cursor &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0170-cursor-must-be-a-value-cursor-not-a-statement-cursor-cursor_name" title="Direct link to heading">#</a></h3><p>This error corresponds to a pretty specific instance.  First there are two cursors and we&#x27;re processing a statement that looks something like this.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C from D;</span></div></div></div></div></div><p><code>C</code> and <code>D</code> are both cursor variables.  However, <code>C</code> is a statement cursor, it was declared something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select * from foo;</span></div></div></div></div></div><p>This kind of cursor is associated with a SQLite statement for its values.  It should not be used like a value cursor (which has no statement).  You may need to declare a different cursor to hold the result of the copy.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0171-name-not-found-name"></a>CQL0171: name not found &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0171-name-not-found-name" title="Direct link to heading">#</a></h3><p>In a scoped name list, like the columns of a cursor (for a fetch), or the columns of a particular table (for an index) a name appeared that did not belong to the universe of legal names.  Trying to make a table index using a column that is not in the table would produce this error.  There are many instances where a list of names belongs to some limited scope.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0172-name-list-has-duplicate-name-name"></a>CQL0172: name list has duplicate name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0172-name-list-has-duplicate-name-name" title="Direct link to heading">#</a></h3><p>In a scoped name list, like the columns of a cursor (for a fetch), or the columns of a particular table (for an index) a name appeared twice in the list where the names must be unique.  Trying to make a table index using the same column twice would produce this error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0173-variable-not-found-variable_name"></a>CQL0173: variable not found &#x27;variable_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0173-variable-not-found-variable_name" title="Direct link to heading">#</a></h3><p>In a <code>SET</code> statement, the target of the assignment is not a valid variable name in that scope.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0174-cannot-set-a-cursor-cursor_name"></a>CQL0174: cannot set a cursor &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0174-cannot-set-a-cursor-cursor_name" title="Direct link to heading">#</a></h3><p>In a <code>SET</code> statement, the target of the assignment is a cursor variable, you cannot assign to a cursor variable.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0175-duplicate-parameter-name-parameter_name"></a>CQL0175: duplicate parameter name &#x27;parameter_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0175-duplicate-parameter-name-parameter_name" title="Direct link to heading">#</a></h3><p>In a parameter list for a function or a procedure, the named parameter appears more than once.  The formal names for function arguments must be unique.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0176-proc-has-no-result-proc_name"></a>CQL0176: proc has no result &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0176-proc-has-no-result-proc_name" title="Direct link to heading">#</a></h3><p>In a table definition, the <code>LIKE</code> construct was used to create columns that are the same as the return type of the named procedure.  However the named procedure does not produce a result set and therefore has no columns to mimic.  Probably the name is wrong.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0177-tableviewproc-not-found-name"></a>CQL0177: table/view/proc not found &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0177-tableviewproc-not-found-name" title="Direct link to heading">#</a></h3><p>In a table definition, the <code>LIKE</code> construct was used to create columns that are the same shape as the named object.  However the indicated name is not the name of a table, view, or stored procedure at all.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0178-proc-has-no-result-like_name"></a>CQL0178: proc has no result &#x27;like_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0178-proc-has-no-result-like_name" title="Direct link to heading">#</a></h3><p>In an argument list, the <code>LIKE</code> construct was used to create arguments that are the same as the return type of the named procedure.  However the named procedure does not produce a result set and therefore has no columns to mimic.  Probably the name is wrong.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0179-tableviewproc-not-found-like_name"></a>CQL0179: table/view/proc not found &#x27;like_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0179-tableviewproc-not-found-like_name" title="Direct link to heading">#</a></h3><p>In an argument list the <code>LIKE</code> construct was used to create arguments that are the same shape as the named object.  However the indicated name is not the name of a table, view, or stored procedure at all.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0180-duplicate-column-name-in-result-not-allowed-column_name"></a>CQL0180: duplicate column name in result not allowed &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0180-duplicate-column-name-in-result-not-allowed-column_name" title="Direct link to heading">#</a></h3><p>In a procedure that returns a result either with a loose <code>SELECT</code> statement or in a place where the result of a <code>SELECT</code> is captured with a <code>FETCH</code> statement the named column appears twice in the projection of the <code>SELECT</code> in question.  The column names must be unique in order to have consistent cursor field names or consistent access functions for the result set of the procedure.  One instance of the named column must be renamed with something like <code>select T1.foo first_foo, T2.foo second_foo</code>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0181-autodrop-temp-table-does-not-exist-name"></a>CQL0181: autodrop temp table does not exist &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0181-autodrop-temp-table-does-not-exist-name" title="Direct link to heading">#</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is unknown entirely.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0182-autodrop-target-is-not-a-table-name"></a>CQL0182: autodrop target is not a table &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0182-autodrop-target-is-not-a-table-name" title="Direct link to heading">#</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is not a table (it&#x27;s probably a view).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0183-autodrop-target-must-be-a-temporary-table-name"></a>CQL0183: autodrop target must be a temporary table &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0183-autodrop-target-must-be-a-temporary-table-name" title="Direct link to heading">#</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is a table but it is not a temp table.  The annotation is only valid on temp tables, it&#x27;s not for &quot;durable&quot; tables.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0184-stored-procedures-cannot-be-nested-name"></a>CQL0184: stored procedures cannot be nested &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0184-stored-procedures-cannot-be-nested-name" title="Direct link to heading">#</a></h3><p>The <code>CREATE PROCEDURE</code> statement may not appear inside of another stored procedure.  The named procedure appears in a nested context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0185-proc-name-conflicts-with-func-name-name"></a>CQL0185: proc name conflicts with func name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0185-proc-name-conflicts-with-func-name-name" title="Direct link to heading">#</a></h3><p>In a <code>CREATE PROCEDURE</code> statement, the given name conflicts with an already declared function (<code>DECLARE FUNCTION</code> or <code>DECLARE SELECT FUNCTION</code>).  You&#x27;ll have to choose a different name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0186-duplicate-stored-proc-name-name"></a>CQL0186: duplicate stored proc name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0186-duplicate-stored-proc-name-name" title="Direct link to heading">#</a></h3><p>In a <code>CREATE PROCEDURE</code> statement, the indicated name already corresponds to a created (not just declared) stored procedure.  You&#x27;ll have to choose a different name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name"></a>CQL0187: @schema_upgrade_version not declared or doesn&#x27;t match upgrade version <code>N</code> for proc &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name" title="Direct link to heading">#</a></h3><p>The named procedure was declared as a schema migration procedure in an <code>@create</code> or <code>@delete</code> annotation for schema version <code>N</code>.  In order to correctly type check such a procedure it must be compiled in the context of schema version <code>N</code>.  This restriction is required so that the tables and columns the procedure sees are the ones that existed in version <code>N</code> not the ones that exist in the most recent version as usual.</p><p>To create this condition, the procedure must appear in a file that begins with the line:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@schema_upgrade_version &lt;N&gt;;</span></div></div></div></div></div><p>And this declaration must come before any <code>CREATE TABLE</code> statements.  If there is no such declaration, or if it is for the wrong version, then this error will be generated.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name"></a>CQL0188: procedure is supposed to do schema migration but it doesn&#x27;t have any DML &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name" title="Direct link to heading">#</a></h3><p>The named procedure was declared as a schema migration procedure in an <code>@create</code> or <code>@delete</code> annotation, however the procedure does not have any DML in it.  That can&#x27;t be right.  Some kind of data reading and writing is necessary.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0189-procedure-declarationsdefinitions-do-not-match-name"></a>CQL0189: procedure declarations/definitions do not match &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0189-procedure-declarationsdefinitions-do-not-match-name" title="Direct link to heading">#</a></h3><p>The named procedure was previously declared with a <code>DECLARE PROCEDURE</code> statement but when the <code>CREATE PROCEDURE</code> was encountered, it did not match the previous declaration.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0190-duplicate-column-name-name"></a>CQL0190: duplicate column name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0190-duplicate-column-name-name" title="Direct link to heading">#</a></h3><p>In a context with a typed name list (e.g. <code>id integer, t text</code>) the named column occurs twice.  Typed name lists happen in many contexts, but a common one is the type of the result in a declared procedure statement or declared function statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0191-declared-functions-must-be-top-level-function_name"></a>CQL0191: declared functions must be top level &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0191-declared-functions-must-be-top-level-function_name" title="Direct link to heading">#</a></h3><p>A <code>DECLARE FUNCTION</code> statement for the named function is happening inside of a procedure.  This is not legal.  To correct this move the declaration outside of the procedure.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0192-func-name-conflicts-with-proc-name-name"></a>CQL0192: func name conflicts with proc name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0192-func-name-conflicts-with-proc-name-name" title="Direct link to heading">#</a></h3><p>The named function in a <code>DECLARE FUNCTION</code> statement conflicts with an existing declared or created procedure.  One or the other must be renamed to resolve this issue.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0193-duplicate-function-name-name"></a>CQL0193: duplicate function name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0193-duplicate-function-name-name" title="Direct link to heading">#</a></h3><p>The named function in a <code>DECLARE FUNCTION</code> statement conflicts with an existing declared function, or it was declared twice.  One or the other declaration must be renamed or removed to resolve this issue.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0194-declared-procedures-must-be-top-level-name"></a>CQL0194: declared procedures must be top level &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0194-declared-procedures-must-be-top-level-name" title="Direct link to heading">#</a></h3><p>A <code>DECLARE PROCEDURE</code> statement for the named procedure is itself happening inside of a procedure.  This is not legal.  To correct this move the declaration outside of the procedure.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0195-proc-name-conflicts-with-func-name-name"></a>CQL0195: proc name conflicts with func name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0195-proc-name-conflicts-with-func-name-name" title="Direct link to heading">#</a></h3><p>The named procedure in a <code>DECLARE PROCEDURE</code> statement conflicts with an existing declared function.  One or the other declaration must be renamed or removed to resolve this issue.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0196-procedure-declarationsdefinitions-do-not-match-name"></a>CQL0196: procedure declarations/definitions do not match &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0196-procedure-declarationsdefinitions-do-not-match-name" title="Direct link to heading">#</a></h3><p>The named procedure was previously declared with a <code>DECLARE PROCEDURE</code> statement.  Now there is another declaration and it does not match the previous declaration</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0197-duplicate-variable-name-in-the-same-scope-name"></a>CQL0197: duplicate variable name in the same scope &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0197-duplicate-variable-name-in-the-same-scope-name" title="Direct link to heading">#</a></h3><p>In a <code>DECLARE</code> statement, a variable of the same name already exists in that scope.  Note that CQL does not have block level scope, all variables are procedure level, so they are in scope until the end of the procedure.  To resolve this problem, either re-use the old variable if appropriate or rename the new variable.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0198-global-variable-hides-tableview-name-name"></a>CQL0198: global variable hides table/view name &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0198-global-variable-hides-tableview-name-name" title="Direct link to heading">#</a></h3><p>In a <code>DECLARE</code> statement, the named variable is a global (declared outside of any procedure) and has the same name as a table or view.  This creates a lot of confusion and is therefore disallowed.  To correct the problem, rename the variable.  Global variables generally are problematic, but sometimes necessary.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-proc_name"></a>CQL0199: cursor requires a procedure that returns a result set via select &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-proc_name" title="Direct link to heading">#</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR FOR CALL</code> the procedure that is being called does not produce a result set with the <code>SELECT</code> statement.  As it has no row results it is meaningless to try to put a cursor on it.  Probably the error is due to a copy/pasta of the procedure name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0200-variable-is-not-a-cursor-another_cursor"></a>CQL0200: variable is not a cursor &#x27;another_cursor&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0200-variable-is-not-a-cursor-another_cursor" title="Direct link to heading">#</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR LIKE</code> another cursor, the indicated name is a variable but it is not a cursor, so we cannot make another cursor like it.  Probably the error is due to a typo in the &#x27;like_name&#x27;.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg"></a>CQL0201: expanding FROM ARGUMENTS, there is no argument matching &#x27;required_arg&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg" title="Direct link to heading">#</a></h3><p>In an <code>insert</code> or <code>fetch</code> statment using the form <code>from arguments like [name]</code> the named entity
had columns that did not appear in as arguments to the current procedure.  Maybe arguments
are missing or maybe the name in the <code>like</code> part is the wrong name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0202-must-be-a-cursor-proc-table-or-view-like_name"></a>CQL0202: must be a cursor, proc, table, or view &#x27;like_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0202-must-be-a-cursor-proc-table-or-view-like_name" title="Direct link to heading">#</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR LIKE</code> some other name, the indicated name is not the name of any of the things that might have a valid shape to copy, like other cursors, procedures, tables, or views.  Probably there is a typo in the name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name"></a>CQL0203: cursor requires a procedure that returns a cursor with OUT &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name" title="Direct link to heading">#</a></h3><p>In the <code>DECLARE [cursor_name] CURSOR FETCH FROM CALL &lt;something&gt;</code> form, the code is trying to create the named cursor by calling a procedure that doesn&#x27;t actually produce a single row result set with the <code>OUT</code> statement.  The procedure is valid (that would be a different error) so it&#x27;s likely that the wrong procedure is being called rather than being an outright typo.  Or perhaps the procedure was changed such that it no longer produces a single row result set.</p><p>This form is equivalent to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">cursor_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">cursor_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>It&#x27;s the declaration that&#x27;s failing here, not the call.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0204-cursor-not-found-name"></a>CQL0204: cursor not found &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0204-cursor-not-found-name" title="Direct link to heading">#</a></h3><p>The indicated name appeared in a context where a cursor name was expected, but that name does not correspond to any variable at all.  Probably there is a typo here.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0205-variable-is-not-a-cursor-name"></a>CQL0205: variable is not a cursor &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0205-variable-is-not-a-cursor-name" title="Direct link to heading">#</a></h3><p>The indicated name appeared in a context where a cursor name was expected. There is a variable of that name but it is not a cursor.  Probably there is a copy/pasta type error here.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0206-duplicate-name-in-list-name"></a>CQL0206: duplicate name in list &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0206-duplicate-name-in-list-name" title="Direct link to heading">#</a></h3><p>There are many contexts where a list of names appears in the CQL grammar and the list must not contain duplicate names.  Some examples are:</p><ul><li>the column names in a <code>JOIN ... USING(x,y,z,...)</code> clause</li><li>the fetched variables in a <code>FETCH [cursor] INTO x,y,z...</code> statement</li><li>the column names listed in a common table expression <code>CTE(x,y,z,...) as (SELECT ...)</code></li><li>the antecedent schema region names in <code>@declare_schema_region &lt;name&gt; USING x,y,z,...</code></li></ul><p>The indicated name was duplicated in such a context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0207-proc-out-parameter-formal-cannot-be-fulfilled-by-non-variable-param_name"></a>CQL0207: proc out parameter: formal cannot be fulfilled by non-variable &#x27;param_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0207-proc-out-parameter-formal-cannot-be-fulfilled-by-non-variable-param_name" title="Direct link to heading">#</a></h3><p>In a procedure call, the indicated parameter of the procedure is an OUT or INOUT parameter but the call site doesn&#x27;t have a variable in that position in the argument list.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the constant 1 cannot be used in the out position when calling foo</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> &#x27;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0208-proc-out-parameter-formal-cannot-be-fulfilled-by-in-only-variable-variable_name"></a>CQL0208: proc out parameter: formal cannot be fulfilled by in-only variable &#x27;variable_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0208-proc-out-parameter-formal-cannot-be-fulfilled-by-in-only-variable-variable_name" title="Direct link to heading">#</a></h3><p>In a procedure call, the indicated parameter of the procedure is an OUT or INOUT parameter but the call site has an &#x27;in&#x27; argument in that position.  While this is doable it&#x27;s probably a mistake.</p><p>Example</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note &#x27;in&#x27; is the default</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- clobbering our &#x27;in&#x27; variable</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You should use a scratch local to capture the result.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name"></a>CQL0209: proc out parameter: arg must be an exact type match (expected expected_type; found actual_type) &#x27;param_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name" title="Direct link to heading">#</a></h3><p>In a procedure call, the indicated parameter is in an &#x27;out&#x27; position, it is a viable local variable but it is not an exact type match for the parameter.  The type of variable used to capture out parameters must be an exact match.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y is a real variable, not an integer.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The above produces:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL0209: proc out parameter: arg must be an exact type match</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(expected integer; found real) &#x27;y&#x27;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability"></a>CQL0210: proc out parameter: arg must be an exact type match (even nullability)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability" title="Direct link to heading">#</a></h3><p>(expected expected_type; found actual_type) &#x27;variable_name&#x27;</p><p>In a procedure call, the indicated parameter is in an &#x27;out&#x27; position, it is a viable local variable of the correct type but the nullability does not match.  The type of variable used to capture out parameters must be an exact match.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y is nullable but foo is expecting not null.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The above produces:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CQL0210: proc out parameter: arg must be an exact type match (even nullability)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(expected integer notnull; found integer) &#x27;y&#x27;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0211-last-formal-arg-of-procedure-is-not-an-out-arg-cannot-use-proc-as-a-function-name"></a>CQL0211: last formal arg of procedure is not an out arg, cannot use proc as a function &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0211-last-formal-arg-of-procedure-is-not-an-out-arg-cannot-use-proc-as-a-function-name" title="Direct link to heading">#</a></h3><p>In a function call, the target of the function call was a procedure, procedures can be used like functions but their last parameter must be marked <code>out</code>. That will be the return value.  In this case the last argument was not marked as <code>out</code> and so the call is invalid.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare proc foo(x integer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc bar(out y integer)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  set y := foo(); -- foo does not have an out argument at the end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0212-too-few-arguments-provided-to-procedure-name"></a>CQL0212: too few arguments provided to procedure &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0212-too-few-arguments-provided-to-procedure-name" title="Direct link to heading">#</a></h3><p>In a procedure call to the named procedure, not enough arguments were provided to make the call.  One or more arguments may have been omitted or perhaps the called procedure has changed such that it now requires more arguments.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0213-procedure-had-errors-cant-call-proc_name"></a>CQL0213: procedure had errors, can&#x27;t call. &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0213-procedure-had-errors-cant-call-proc_name" title="Direct link to heading">#</a></h3><p>In a procedure call to the named procedure, the target of the call had compilation errors.  As a consequence this call cannot be checked and therefore must be marked in error, too.  Fix the errors in the named procedure.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name"></a>CQL0214: procedures with results can only be called using a cursor in global context &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name" title="Direct link to heading">#</a></h3><p>The named procedure results a result set, either with the <code>SELECT</code> statement or the <code>OUT</code> statement.  However it is being called from outside of any procedure.  Because of this, its result cannot then be returned anywhere.  As a result, at the global level the result must be capture with a cursor.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is not valid</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- C captures the result of foo, this is ok.</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name"></a>CQL0215: value cursors are not used with FETCH C, or FETCH C INTO &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name" title="Direct link to heading">#</a></h3><p>In a <code>FETCH</code> statement of the form <code>FETCH [cursor]</code> or <code>FETCH [cursor] INTO</code> the named cursor
is a value cursor.  These forms of the <code>FETCH</code> statement apply only to statement cursors.</p><p>Example:good</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- value cursor shaped like a table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--ok, C is fetched from the select results</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Example: bad</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- value cursor shaped like a table</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- invalid, there is no source for fetching a value cursor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok assuming bar is made up of 3 integers</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><ul><li>statement cursors come from SQL statements and can be fetched</li><li>value cursors are of a prescribed shape and can only be loaded from value sources</li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0216-fetch-variable-not-found-cursor_name"></a>CQL0216: FETCH variable not found &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0216-fetch-variable-not-found-cursor_name" title="Direct link to heading">#</a></h3><p>In a <code>FETCH</code> statement,  the indicated name, which is supposed to be a cursor, is not in fact a valid name at all.</p><p>Probably there is a typo in the name.  Or else the declaration is entirely missing.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name"></a>CQL0217: number of variables did not match count of columns in cursor &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name" title="Direct link to heading">#</a></h3><p>In a <code>FETCH [cursor] INTO [variables]</code> the number of variables specified did not match the number of columns in the named cursor.  Perhaps the source of the cursor (a select statement or some such) has changed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0218-continue-must-be-inside-of-a-loop-or-while-statement"></a>CQL0218: continue must be inside of a &#x27;loop&#x27; or &#x27;while&#x27; statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0218-continue-must-be-inside-of-a-loop-or-while-statement" title="Direct link to heading">#</a></h3><p>The <code>CONTINUE</code> statement may only appear inside of looping constructs.  CQL only has two <code>loop fetch ...</code> and <code>while</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0219-leave-must-be-inside-of-a-loop-or-while-statement"></a>CQL0219: leave must be inside of a &#x27;loop&#x27; or &#x27;while&#x27; statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0219-leave-must-be-inside-of-a-loop-or-while-statement" title="Direct link to heading">#</a></h3><p>The <code>LEAVE</code> statement may only appear inside of looping constructs.  CQL only has two <code>loop fetch ...</code> and <code>while</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name"></a>CQL0220: savepoint has not been mentioned yet, probably wrong &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name" title="Direct link to heading">#</a></h3><p>In a <code>ROLLBACK</code> statement that is rolling back to a named savepoint, the indicated savepoint was never mentioned before.  It should have appeared previously in a <code>SAVEPOINT</code> statement.  This probably means there is a typo in the name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name"></a>CQL0221: savepoint has not been mentioned yet, probably wrong &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name" title="Direct link to heading">#</a></h3><p>In a <code>RELEASE SAVEPOINT</code> statement that is rolling back to a named savepoint, the indicated savepoint was never mentioned before.  It should have appeared previously in a <code>SAVEPOINT</code> statement.  This probably means there is a typo in the name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0222-the-out-cursor-statement-only-makes-sense-inside-of-a-procedure"></a>CQL0222: the out cursor statement only makes sense inside of a procedure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0222-the-out-cursor-statement-only-makes-sense-inside-of-a-procedure" title="Direct link to heading">#</a></h3><p>The statement form <code>OUT [cursor_name]</code> makes a procedure that returns a single row result set.  It doesn&#x27;t make any
sense to do this outside of any procedure because there is no procedure to return that result.  Perhaps the <code>OUT</code> statement was mis-placed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0223-the-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name"></a>CQL0223: the cursor was not fetched with the auto-fetch syntax &#x27;fetch [cursor]&#x27; &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0223-the-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name" title="Direct link to heading">#</a></h3><p>The statement form <code>OUT [cursor_name]</code> makes a procedure that returns a single row result set that corresponds to the current value of the cursor.  If the cursor never held values directly then there is nothing to return.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select * from bar;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">out C;  -- error C was never fetched</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select * from bar;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C into x, y, z;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- error C was used to load x, y, z so it&#x27;s not holding any data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">out C;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for select * from bar;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- create storage in C to hold bar columns (e.g. C.x, C,y, C.z)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- ok, C holds data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">out C;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0224-literal-output-can-only-appear-outside-of-procedures"></a>CQL0224: literal output can only appear outside of procedures<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0224-literal-output-can-only-appear-outside-of-procedures" title="Direct link to heading">#</a></h3><p>The <code>@echo</code> construct cannot appear inside of procedures, this would be far to fragile.  It&#x27;s indented to let you insert C style declarations into the output stream if necessary.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc"></a>CQL0225: switching to previous schema validation mode must be outside of any proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc" title="Direct link to heading">#</a></h3><p>The <code>@previous_schema</code> directive says that any schema that follows should be compared against what was declared before this point.  This gives CQL the opportunity to detect changes in schema that are not supportable.</p><p>The previous schema directive must be outside of any stored procedure.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token variable" style="color:rgb(191, 199, 213)">@previous</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nope</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc"></a>CQL0226: schema upgrade declaration must be outside of any proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc" title="Direct link to heading">#</a></h3><p>The <code>@schema_upgrade_script</code> directive tells CQL that the code that follows is intended to upgrade schema from one version to another.  This kind of script is normally generated by the <code>--rt schema_upgrade</code> option discussed elsewhere.  When processing such a script, a different set of rules are used for DDL analysis.  In particular, it&#x27;s normal to declare the final versions of tables but have DDL that creates the original version and more DDL to upgrade them from wherever they are to the final version (as declared).  Ordinarily these duplicate definitions would produce errors.  This directive allows those duplications.</p><p>This error is reporting that the directive happened inside of a stored procedure, this is not allowed.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@schema_upgrade_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token variable" style="color:rgb(191, 199, 213)">@schema_upgrade_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nope</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared"></a>CQL0227: schema upgrade declaration must come before any tables are declared<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared" title="Direct link to heading">#</a></h3><p>The <code>@schema_upgrade_script</code> directive tells CQL that the code that follows is intended to upgrade schema from one version to another.  This kind of script is normally generated by the <code>--rt schema_upgrade</code> option discussed elsewhere.  When processing such a script, a different set of rules are used for DDL analysis.  In particular, it&#x27;s normal to declare the final versions of tables but have DDL that creates the original version and more DDL to upgrade them from wherever they are to the final version (as declared).  Ordinarily these duplicate definitions would produce errors.  This directive allows those duplications.</p><p>In order to do its job properly the directive must come before any tables are created with DDL.  This error tells you that the directive came too late in the stream. Or perhaps there were two such directives and one is late in the stream.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0228-schema-upgrade-version-must-be-a-positive-integer"></a>CQL0228: schema upgrade version must be a positive integer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0228-schema-upgrade-version-must-be-a-positive-integer" title="Direct link to heading">#</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest. There can only be one such directive.</p><p>This error says that the version you are trying to view is not a positive integer version (e.g version -2)</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0229-schema-upgrade-version-declaration-may-only-appear-once"></a>CQL0229: schema upgrade version declaration may only appear once<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0229-schema-upgrade-version-declaration-may-only-appear-once" title="Direct link to heading">#</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that a second <code>@schema_upgrade_version</code> directive has been found.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc"></a>CQL0230: schema upgrade version declaration must be outside of any proc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc" title="Direct link to heading">#</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that the <code>@schema_upgrade_version</code> directive was found inside of a stored procedure.  This is not allowed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared"></a>CQL0231: schema upgrade version declaration must come before any tables are declared<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared" title="Direct link to heading">#</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that the <code>@schema_upgrade_version</code> directive came after tables were already declared.  This is not allowed, the directive must come before any DDL.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0232-nested-select-expression-must-return-exactly-one-column"></a>CQL0232: nested select expression must return exactly one column<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0232-nested-select-expression-must-return-exactly-one-column" title="Direct link to heading">#</a></h3><p>In a <code>SELECT</code> expression like <code>set x := (select id from bar)</code> the select statement must return exactly one column as in the example provided.  Note that a runtime error will ensue if the statement returns zero rows, or more than one row,  so this form is very limited.  To fix this error change your select statement to return exactly one column.  Consider how many rows you will get very carefully also, that cannot be checked at compile time.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-proc_name"></a>CQL0233: procedure previously declared as schema upgrade proc, it can have no args &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-proc_name" title="Direct link to heading">#</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive that procedure will be called during schema migration with no context available.  Therefore, the schema migration proc is not allowed to have any arguments.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name"></a>CQL0234: autodrop annotation can only go on a procedure that returns a result set &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name" title="Direct link to heading">#</a></h3><p>The named procedure has the <code>autodrop</code> annotation (to automatically drop a temporary table) but the procedure in question doesn&#x27;t return a result set so it has no need of the autodrop feature.  The purpose that that feature is to drop the indicated temporary tables once all the select results have been fetched.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0235-too-many-arguments-provided-to-procedure-proc_name"></a>CQL0235: too many arguments provided to procedure &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0235-too-many-arguments-provided-to-procedure-proc_name" title="Direct link to heading">#</a></h3><p>In a <code>CALL</code> statement, or a function call, the named procedure takes fewer arguments than were provided. This error might be due to some copy/pasta going on or perhaps the argument list of the procedure/function changed to fewer items.
To fix this, consult the argument list and adjust the call accordingly.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name"></a>CQL0236: autodrop annotation can only go on a procedure that uses the database &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name" title="Direct link to heading">#</a></h3><p>The named procedure has the <code>autodrop</code> annotation (to automatically drop a temporary table) but the procedure in question doesn&#x27;t even use the database at all, much less the named table.  This annotation is therefore redundant.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key"></a>CQL0237: strict FK validation requires that some ON UPDATE option be selected for every foreign key<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key" title="Direct link to heading">#</a></h3><p><code>@enforce_strict</code> has been use to enable strict foreign key enforcement.  When enabled every foreign key must have an action for the <code>ON UPDATE</code> rule.  You can specify <code>NO ACTION</code> but you can&#x27;t simply leave the action blank.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key"></a>CQL0238: strict FK validation requires that some ON DELETE option be selected for every foreign key<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key" title="Direct link to heading">#</a></h3><p><code>@enforce_strict</code> has been use to enable strict foreign key enforcement.  When enabled every foreign key must have an action for the <code>ON DELETE</code> rule.  You can specify <code>NO ACTION</code> but you can&#x27;t simply leave the action blank.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0239-procedure-identity-column-does-not-exist-in-result-set-column_name"></a>CQL0239: procedure identity column does not exist in result set &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0239-procedure-identity-column-does-not-exist-in-result-set-column_name" title="Direct link to heading">#</a></h3><p>The <code>@attribute(cql:identity=(col1, col2,...))</code> form has been used to list the identity columns of a stored procedures result set.  These columns must exist in the result set and they must be unique.  The indicated column name is not part of the result of the procedure that is being annotated.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name"></a>CQL0240: identity annotation can only go on a procedure that returns a result set &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name" title="Direct link to heading">#</a></h3><p>The <code>@attribute(cql:identity=(col1, col2,...))</code> form has been used to list the identity columns of a stored procedures result set.  These columns must exist in the result set and they must be unique.  In this case, the named procedure doesn&#x27;t even return a result set.  Probably there is a copy/pasta going on.  The identity attribute can likely be removed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0241-concat-may-only-appear-in-the-context-of-sql-statement"></a>CQL0241: CONCAT may only appear in the context of SQL statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0241-concat-may-only-appear-in-the-context-of-sql-statement" title="Direct link to heading">#</a></h3><p>The SQLite <code>||</code> operator has complex string conversion rules making it impossible to faithfully emulate.  Since there is no helper function for doing concatenations, CQL choses to support this operator only in contexts where it will be evaluated by SQLite.  That is, inside of some SQL statement.</p><p>Examples:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare X text;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set X := &#x27;foo&#x27; || &#x27;bar&#x27;;   -- error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set X := (select &#x27;foo&#x27; || &#x27;bar&#x27;);  -- ok</span></div></div></div></div></div><p>If concatenation is required in some non-sql context, use the <code>(select ..)</code> expression form to let SQLite do the evaluation.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0242"></a>CQL0242<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0242" title="Direct link to heading">#</a></h3><p>available for re-use</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0243-blob-operand-must-be-converted-to-string-first-in-"></a>CQL0243: blob operand must be converted to string first in &#x27;||&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0243-blob-operand-must-be-converted-to-string-first-in-" title="Direct link to heading">#</a></h3><p>We explicitly do not wish to support string concatenation for blobs that holds non-string data. If the blob contains string data, make your intent clear by converting it to string first using <code>CAST</code> before doing the concatenation.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0244-unknown-schema-region-region"></a>CQL0244: unknown schema region &#x27;region&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0244-unknown-schema-region-region" title="Direct link to heading">#</a></h3><p>In a <code>@declare_schema_region</code> statement one of the USING regions is not a valid region name.  Or in <code>@begin_schema_region</code> the region name is not valid.  This probably means there is a typo in your code.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0245-schema-region-already-defined-region"></a>CQL0245: schema region already defined &#x27;region&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0245-schema-region-already-defined-region" title="Direct link to heading">#</a></h3><p>The indicated region was previously defined, it cannot be redefined.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one"></a>CQL0246: schema regions do not nest; end the current region before starting a new one<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one" title="Direct link to heading">#</a></h3><p>Another <code>@begin_schema_region</code> directive was encountered before the previous <code>@end_schema_region</code> was found.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0247-you-must-begin-a-schema-region-before-you-can-end-one"></a>CQL0247: you must begin a schema region before you can end one<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0247-you-must-begin-a-schema-region-before-you-can-end-one" title="Direct link to heading">#</a></h3><p>An <code>@end_schema_region</code> directive was encountered but there was no corresponding <code>@begin_schema_region</code> directive.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure"></a>CQL0248: schema region directives may not appear inside of a procedure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure" title="Direct link to heading">#</a></h3><p>All of the <code>*_schema_region</code> directives must be used at the top level of your program, where tables are typically declared.  They do not belong inside of procedures.  If you get this error, move the directive out of the procedure near the DDL that it affects.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0249-function-is-not-a-table-valued-function-function_name"></a>CQL0249: function is not a table-valued-function &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0249-function-is-not-a-table-valued-function-function_name" title="Direct link to heading">#</a></h3><p>The indicated identifier appears in the context of a table, it is a function, but it is not a table-valued function.  Either the declaration is wrong (use  something like <code>declare select function foo(arg text) (id integer, t text)</code>) or the name is wrong.  Or both.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0250-table-valued-function-not-declared-function_name"></a>CQL0250: table-valued function not declared &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0250-table-valued-function-not-declared-function_name" title="Direct link to heading">#</a></h3><p>In a select statement, there is a reference to the indicated table-valued-function.  For instance:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- the above error happens if my_function has not been declared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- as a table valued function</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from my_function(1,2,3);</span></div></div></div></div></div><p>However , <code>my_function</code> has not been declared as a function at all.  A correct declaration might look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare select function my_function(a int, b int, c int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   (x int, y text);</span></div></div></div></div></div><p>Either there is a typo in the name or the declaration is missing, or both...</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0251-fragment-must-end-with-exactly-select--from-cte"></a>CQL0251: fragment must end with exactly &#x27;SELECT * FROM CTE&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0251-fragment-must-end-with-exactly-select--from-cte" title="Direct link to heading">#</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes <code>select * from CTE</code> as the final query where CTE is the common table expression that they define.  This the error message includes the specific name that is required in this context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0252-proc-literal-can-only-appear-inside-of-procedures"></a>CQL0252: @PROC literal can only appear inside of procedures<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0252-proc-literal-can-only-appear-inside-of-procedures" title="Direct link to heading">#</a></h3><p>An @PROC literal was used outside of any procedure.  It cannot be resolved if it isn&#x27;t inside a procedure.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0253-base-fragment-must-include-a-single-cte-named-same-as-the-fragment-name"></a>CQL0253: base fragment must include a single CTE named same as the fragment &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0253-base-fragment-must-include-a-single-cte-named-same-as-the-fragment-name" title="Direct link to heading">#</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes  <code>select * from CTE</code> where CTE is the common table expression that is the name of the base query.  This error says that the final select came from something other than the single CTE that is the base name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used"></a>CQL0254: switching to previous schema validation mode not allowed if <code>@schema_upgrade_version</code> was used<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used" title="Direct link to heading">#</a></h3><p>When authoring a schema migration script (a stored proc named in an <code>@create</code> or <code>@delete</code> annotation) you must create that procedure in a file that is marked with <code>@schema_upgrade_verison</code> specifying the schema version it is upgrading.  If you do this, then the proc (correctly) only sees the schema as it existed at that version.  However that makes the schema unsuitable for analysis using <code>@previous_schema</code> because it could be arbitrarily far in the past.  This error prevents you from combining those features.  Previous schema validation should only happen against the current schema.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name"></a>CQL0255: fragment name is not a previously declared base fragment &#x27;bad_fragment_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name" title="Direct link to heading">#</a></h3><p>In an extension or assembly fragment declaration, the specified base fragment name has not been previously defined and that is not allowed.</p><p>Probably there is a typo, or the declarations are in the wrong order. The base fragment has to come first.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0256-fragment-name-conflicts-with-existing-base-fragment-name"></a>CQL0256: fragment name conflicts with existing base fragment &#x27;NAME&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0256-fragment-name-conflicts-with-existing-base-fragment-name" title="Direct link to heading">#</a></h3><p>Extension query fragment can only be created with a custom procedure name different from all existing base fragment names otherwise we throw this error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0257-argument-must-be-a-string-or-numeric-in-function"></a>CQL0257: argument must be a string or numeric in &#x27;function&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0257-argument-must-be-a-string-or-numeric-in-function" title="Direct link to heading">#</a></h3><p>The indicated function (usually min or max) only works on strings and numerics.  <code>NULL</code> literals, blobs, or objects
are not allowed in this context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name"></a>CQL0258: extension fragment must add exactly one CTE; found extra named &#x27;name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name" title="Direct link to heading">#</a></h3><p>The extension fragment includes more than one additional CTE, it must have exactly one.</p><p>In the following example, <code>ext2</code> is not valid,  you have to stop at <code>ext1</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- example bad extension fragment</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> test_bad_extension_fragment_three</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ext2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ext2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0259-extension-fragment-cte-must-select-t-from-base-cte"></a>CQL0259: extension fragment CTE must select T.* from base CTE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0259-extension-fragment-cte-must-select-t-from-base-cte" title="Direct link to heading">#</a></h3><p>For the select expression in extension fragment, it must include all columns from the base table. This error indicates the select expression doesn&#x27;t select from the base table. It should look like this</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select core.*, ... from core</span></div></div></div></div></div><p>Here core is the name of its base table.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name"></a>CQL0260: extension fragment CTE must be a simple left outer join from &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name" title="Direct link to heading">#</a></h3><p>Extension fragments may add columns to the result, to do this without lose any rows you must always left outer join to the new data that you with to include.  There is a specific prescription for this.  It has
to look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> an_extension</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra_column </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Here extension <code>ext1</code> is adding <code>extra_column</code> which came from <code>extra_stuff</code>.  There could have
been any desired join condition or indeed any join expression at all but it has to begin with <code>from core left outer join</code> so that all the core columns will be present and now rows can be removed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0261-available-for-re-use"></a>CQL0261: available for re-use<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0261-available-for-re-use" title="Direct link to heading">#</a></h3><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0262-available-for-re-use"></a>CQL0262: available for re-use<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0262-available-for-re-use" title="Direct link to heading">#</a></h3><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled"></a>CQL0263: non-ANSI joins are forbidden if strict join mode is enabled.<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled" title="Direct link to heading">#</a></h3><p>You can enable strict enforcement of joins to avoid the form</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from A, B;</span></div></div></div></div></div><p>which sometimes confuses people (the above is exactly the same as</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from A inner join B on 1;</span></div></div></div></div></div><p>Usually there are constraints on the join also in the WHERE clause but there don&#x27;t have to be.</p><p><code>@enforce_strict join</code> turns on this mode.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0264-duplicate-assembly-fragments-of-base-fragment"></a>CQL0264: duplicate assembly fragments of base fragment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0264-duplicate-assembly-fragments-of-base-fragment" title="Direct link to heading">#</a></h3><p>For each base fragment, it only allows to exist one assembly fragment of that base fragment.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0265-assembly-fragment-can-only-have-one-cte"></a>CQL0265: assembly fragment can only have one CTE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0265-assembly-fragment-can-only-have-one-cte" title="Direct link to heading">#</a></h3><p>Assembly fragment can only have one base table CTE.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0266-extension-fragment-name-conflicts-with-existing-fragment"></a>CQL0266: extension fragment name conflicts with existing fragment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0266-extension-fragment-name-conflicts-with-existing-fragment" title="Direct link to heading">#</a></h3><p>Two or more extension fragments share the same name.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column"></a>CQL0267: extension fragments of same base fragment share the same cte column<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column" title="Direct link to heading">#</a></h3><p>Two or more extension fragments which have the same base fragments share the same name for one of their unique columns. E.g. the base table is <code>core(x,y)</code> and one extension table is <code>plugin_one(x,y,z)</code> and antoher is <code>plugin_two(x,y,z)</code>.
Here, z in both extension fragments share the same name but may refer to different values.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment"></a>CQL0268: extension/assembly fragment must have the CTE columns same as the base fragment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment" title="Direct link to heading">#</a></h3><p> Extension and assembly fragments have an exact prescription for their shape. For each extension and assembly fragment, the first CTE must be a stub for their base table. This error means this stub in extension/assembly fragment differs from the definition of the base table.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys"></a>CQL0269: at least part of this unique key is redundant with previous unique keys<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys" title="Direct link to heading">#</a></h3><p>The new unique key must have at least one column that is not in a previous key AND it must not have all the columns from any previous key.</p><p>e.g:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1 (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  a int,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b long,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  c text,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  d real,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (a, b),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (a, b, c), -- INVALID  (a, b) is already unique key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (b, a), -- INVALID (b, a) is the same as (a, b)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (c, d, b, a), -- INVALID subset (b, a) is already unique key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (a), -- INVALID a is part of (a, b) key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (a, c), -- VALID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (d), -- VALID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNIQUE (b, d) -- VALID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor"></a>CQL0270: use FETCH FROM for procedures that returns a cursor with OUT &#x27;cursor&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor" title="Direct link to heading">#</a></h3><p>If you are calling a procedure that returns a value cursor (using <code>OUT</code>) then you accept that cursor using the pattern</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE C CURSOR FETCH FROM CALL foo(...);</span></div></div></div></div></div><p>The pattern</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE C CURSOR FOR CALL foo(...);</span></div></div></div></div></div><p>Is used for procedures that provide a full <code>select</code> statement.</p><p>Note that in the former cause you don&#x27;t then use <code>fetch</code> on the cursor.  There is at most one row anyway and it&#x27;s fetched for you so a fetch would be useless.  In the second case you fetch as many rows as there are and/or you want.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0271-the-offset-clause-may-only-be-used-if-limit-is-also-present"></a>CQL0271: the OFFSET clause may only be used if LIMIT is also present<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0271-the-offset-clause-may-only-be-used-if-limit-is-also-present" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from foo offset 1;</span></div></div></div></div></div><p>Is not supported by SQLite.  <code>OFFSET</code> may only be used if <code>LIMIT</code> is also present.  Also, both should be small because offset is not cheap.  There is no way to do offset other than to read and ignore the indicated number of rows.  So something like <code>offset 1000</code> is always horrible.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0272-the-set-of-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table"></a>CQL0272: THE SET OF COLUMNS REFERENCED IN THE FOREIGN KEY STATEMENT SHOULD MATCH EXACTLY A UNIQUE KEY IN PARENT TABLE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0272-the-set-of-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table" title="Direct link to heading">#</a></h3><p>If you&#x27;re creating a table t2 with foreign keys on table t1, then the set of t1&#x27;s columns reference in the foreign key statement for table t2 should be:</p><ul><li>A primary key in <code>t1</code></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1(a text primary key);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t2(a text primary key, foreign key(a) references t1(a));</span></div></div></div></div></div><ul><li>A unique key in <code>t1</code></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1(a text unique);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t2(a text primary key, foreign key(a) references t1(a));</span></div></div></div></div></div><ul><li>A group of unique key in <code>t1</code></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1(a text, b int, unique(a, b));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t2(a text, b int, foreign key(a, b) references t1(a, b));</span></div></div></div></div></div><ul><li>A group of primary key in <code>t1</code></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1(a text, b int, primary key(a, b));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t2(a text, b int, foreign key(a, b) references t1(a, b));</span></div></div></div></div></div><ul><li>A unique index in <code>t1</code></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t1(a text, b int);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create unique index unq on t1(a, b);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table t2(a text, b int, foreign key(a, b) references t1(a, b));</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0273-autotest-attribute-has-incorrect-format--in-dummy_test"></a>CQL0273: autotest attribute has incorrect format (...) in &#x27;dummy_test&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0273-autotest-attribute-has-incorrect-format--in-dummy_test" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the given <strong>dummy_test</strong> info (table name, column name, column value) has incorrect format.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0274-autotest-attribute-dummy_test-has-non-existent-table"></a>CQL0274: autotest attribute &#x27;dummy_test&#x27; has non existent table<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0274-autotest-attribute-dummy_test-has-non-existent-table" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the given table name for <strong>dummy_test</strong> attribute does not exist.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0275-autotest-attribute-dummy_test-has-non-existent-column"></a>CQL0275: autotest attribute &#x27;dummy_test&#x27; has non existent column<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0275-autotest-attribute-dummy_test-has-non-existent-column" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the given column name for <strong>dummy_test</strong> attribute does not exist.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in"></a>CQL0276: autotest attribute &#x27;dummy_test&#x27; has invalid value type in<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the given column value&#x27;s type for <strong>dummy_test</strong> attribute does not match the column type.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0277-autotest-has-incorrect-format"></a>CQL0277: autotest has incorrect format<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0277-autotest-has-incorrect-format" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the format is incorrect.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0278-autotest-attribute-name-is-not-valid"></a>CQL0278: autotest attribute name is not valid<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0278-autotest-attribute-name-is-not-valid" title="Direct link to heading">#</a></h3><p>In a <code>cql:autotest</code> annotation, the given attribute name is not valid.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0279-the-set-of-columns-referenced-in-the-conflict-target-should-match-exactly-a-unique-key-in-table-we-apply-upsert"></a>CQL0279: the set of columns referenced in the conflict target should match exactly a unique key in table we apply upsert<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0279-the-set-of-columns-referenced-in-the-conflict-target-should-match-exactly-a-unique-key-in-table-we-apply-upsert" title="Direct link to heading">#</a></h3><p>If you&#x27;re doing an UPSERT on table t1, the columns listed in the conflict target should be:</p><ul><li>A primary key in <code>t1</code></li><li>A unique key in <code>t1</code></li><li>A group of unique key in <code>t1</code></li><li>A group of primary key in <code>t1</code></li><li>A unique index in <code>t1</code></li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select"></a>CQL0280: upsert statement requires a where clause if the insert clause uses select<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select" title="Direct link to heading">#</a></h3><p>When the <code>INSERT</code> statement to which the UPSERT is attached takes its values from a <code>SELECT</code> statement, there is a potential parsing ambiguity. The SQLite parser might not be able to tell if the <code>ON</code> keyword is introducing the UPSERT or if it is the <code>ON</code> clause of a join. To work around this, the <code>SELECT</code> statement should always include a <code>WHERE</code> clause, even if that <code>WHERE</code> clause is just <code>WHERE 1</code> (always true).   Note: The CQL parser doesn&#x27;t have this ambiguity because it treats &quot;ON CONFLICT&quot; as a single token so this is CQL reporting that SQLite might have trouble with the query as written.</p><p>e.g:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo select id from bar where 1 on conflict(id) do nothing;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement"></a>CQL0281: upsert statement does not include table name in the update statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement" title="Direct link to heading">#</a></h3><p>The UPDATE statement of and UPSERT should not include the table name because the name is already known from the INSERT statement part of the UPSERT
e.g:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo select id from bar where 1 on conflict(id) do update set id=10;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0282-update-statement-require-table-name"></a>CQL0282: update statement require table name<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0282-update-statement-require-table-name" title="Direct link to heading">#</a></h3><p>The UPDATE statement should always include a table name except if the UPDATE statement is part of an UPSERT statement.</p><p>e.g:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">update foo set id=10;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo(id) values(1) do update set id=10;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0283-upsert-syntax-only-support-insert-into"></a>CQL0283: upsert syntax only support INSERT INTO<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0283-upsert-syntax-only-support-insert-into" title="Direct link to heading">#</a></h3><p>The INSERT statement part of an UPSERT statement can only uses INSERT INTO ...</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">e.g:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo(id) values(1) on conflict do nothing;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo(id) values(1) on conflict do update set id=10;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run"></a>CQL0284: ad hoc schema migration directive must provide a procedure to run<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run" title="Direct link to heading">#</a></h3><p><code>@schema_ad_hoc_migration</code> must provide both a version number and a migrate procedure name.
This is unlike the other version directives like <code>@create</code> where the version number is optional.  This
is because the whole point of this migrator is to invoke a procedure of your choice.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0285-ad-hoc-schema-migration-directive-version-number-changed-proc_name"></a>CQL0285: ad hoc schema migration directive version number changed &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0285-ad-hoc-schema-migration-directive-version-number-changed-proc_name" title="Direct link to heading">#</a></h3><p>In <code>@schema_ad_hoc_migration</code> you cannot change the version number of the directive once
it has been added to the schema because this could cause inconsistencies when upgrading.</p><p>You can change the body of the method if you need to but this is also not recommended because
again there could be inconsistencies.  However careful replacement and compensation is possible.  This is like
going to 110% on the reactor... possible, but not recommended.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-proc_name"></a>CQL0286: ad hoc schema migration directive was removed; this is not allowed &#x27;proc_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-proc_name" title="Direct link to heading">#</a></h3><p>An <code>@schema_ad_hoc_migration</code> cannot be removed because it could cause inconsistencies on upgrade.</p><p>You can change the body of the method if you need to but this is also not recommended because
again there could be inconsistencies.  However careful replacement and compensation is possible.  This is like
going to 110% on the reactor... possible, but not recommended.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0287-extensionassembly-fragment-must-add-stub-"></a>CQL0287: extension/assembly fragment must add stub &quot;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0287-extensionassembly-fragment-must-add-stub-" title="Direct link to heading">#</a></h3><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-"></a>CQL0288: extension/assembly fragment stub for base CTE column must be &quot;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-" title="Direct link to heading">#</a></h3><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled"></a>CQL0289: upsert statement are forbidden if strict upsert statement mode is enabled<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled" title="Direct link to heading">#</a></h3><p><code>@enforce_strict</code> has been use to enable strict upsert statement enforcement.  When enabled all sql statement should not use the upsert statement. This is because sqlite version running in some iOS and Android version is old. Upsert statement was added to sqlite in the version <strong>3.24.0 (2018-06-04)</strong>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect"></a>CQL0290: fragments can only have one statement in the statement list and it must be a WITH..SELECT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect" title="Direct link to heading">#</a></h3><p>All of the query fragment types consist of a procedure with exactly one statement and that statement is a WITH...SELECT statement.  If you have more than one statement or some other type of statement you&#x27;ll get this error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region"></a>CQL0291: region links into the middle of a deployable region; you must point to the root of <code>&lt;deployable_region&gt;</code> not into the middle: <code>&lt;error_region&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region" title="Direct link to heading">#</a></h3><p>Deployable regions have an &quot;inside&quot; that is in some sense &quot;private&quot;.  In order to keep the consistent (and independently deployable) you can&#x27;t peek into the middle of such
a region, you have to depend on the root (i.e. <code>&lt;deployable_region&gt;</code> itself).  This allows the region to remain independently deployable and for its internal logical regions to be reorganized in whatever manner makes sense.</p><p>To fix this error probably you should change <code>error_region</code> so that it depends directly on <code>deployable_region</code></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions"></a>CQL0292: Explain statement is only available in dev mode because its result set may vary between sqlite versions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions" title="Direct link to heading">#</a></h3><p>The EXPLAIN statement is intended for interactive debugging only. It helps engineer understand how Sqlite will execute their query and the cost attached to it. This is why this grammar is only available in dev mode in CQL and should never be used in production.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0293-only-explain-query-plan--statement-is-supported"></a>CQL0293: Only [EXPLAIN QUERY PLAN ...] statement is supported<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0293-only-explain-query-plan--statement-is-supported" title="Direct link to heading">#</a></h3><p>CQL only support [EXPLAIN QUERY PLAN stmt] sql statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement"></a>CQL0294: Window function invocations can only appear in the select list of a select statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement" title="Direct link to heading">#</a></h3><p>Not all SQLite builtin function can be used as a window function.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0295-window-name-is-not-defined"></a>CQL0295: Window name is not defined<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0295-window-name-is-not-defined" title="Direct link to heading">#</a></h3><p>Window name referenced in the select list should be defined in the Window clause of the same select statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0296-window-name-definition-is-not-used"></a>CQL0296: Window name definition is not used<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0296-window-name-definition-is-not-used" title="Direct link to heading">#</a></h3><p>Window name defined in the window clause of a select statement should always be used within that statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0297-from-cursor-is-redundant-if-column-list-is-empty"></a>CQL0297: FROM CURSOR is redundant if column list is empty<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0297-from-cursor-is-redundant-if-column-list-is-empty" title="Direct link to heading">#</a></h3><p>This form:</p><p><code>insert into YourTable() FROM CURSOR your_cursor;</code></p><p>The <code>()</code> means no columns are being specified, the cursor will never be used.  The only source of columns is maybe dummy data (if it was specified) or the default values or null.  In no case will the cursor be used.  If you really want this use <code>FROM VALUES()</code> and don&#x27;t implicate a cursor.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0298-cannot-insert-from-a-cursor-without-fields-cursor_name"></a>CQL0298: cannot insert from a cursor without fields &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0298-cannot-insert-from-a-cursor-without-fields-cursor_name" title="Direct link to heading">#</a></h3><p>The cursor in question has no storage associated with it.  It was loaded with something like:</p><p><code>fetch C into x, y, z;</code></p><p>You can only use a cursor as a source of data if it was fetched with its own storage like</p><p><code>fetch C</code></p><p>This results in a structure for the cursor.  This gives you C.x, C.y, C.z etc.</p><p>If you fetched the cursor into variables then you have to use the variables for any inserting.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0299-cursor-has-too-few-fields-for-this-insert-cursor_name"></a>CQL0299: cursor has too few fields for this insert, &#x27;cursor_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0299-cursor-has-too-few-fields-for-this-insert-cursor_name" title="Direct link to heading">#</a></h3><p>The cursor was used in a fetch statement but the number of columns fetched is smaller than the number required by the insert statement we are processing.</p><p>If you need to use the cursor plus some other data then you can&#x27;t use this form, you&#x27;ll have to use each field individually like <code>from values(C.x, C.y, C.z, other_stuff)</code>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name"></a>CQL0300: Argument must be an integer (between 1 and max integer) in function &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" title="Direct link to heading">#</a></h3><p>The argument of the function should be an integer.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0301-the-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name"></a>CQL0301: The second argument must be an integer (between 0 and max integer) in function &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0301-the-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name" title="Direct link to heading">#</a></h3><p>The second argument of the function should be an integer between 0 and INTEGER_MAX.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0302-the-first-and-third-arguments-must-be-of-the-same-type-in-function-function_name"></a>CQL0302: The first and third arguments must be of the same type in function &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0302-the-first-and-third-arguments-must-be-of-the-same-type-in-function-function_name" title="Direct link to heading">#</a></h3><p>The first and third arguments of the function have to be of the same type because the third argument provide a default value in cause the first argument is NULL.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0303-the-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name"></a>CQL0303: The second argument must be an integer between 1 and max integer in function &#x27;function_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0303-the-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" title="Direct link to heading">#</a></h3><p>The second argument of the function must be and integer between 1 and INTEGER_MAX.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function"></a>CQL0304: DISTINCT may only be used with one explicit argument in an aggregate function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function" title="Direct link to heading">#</a></h3><p>The keyword DISTINCT can only be used with one argument in an aggregate function.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined"></a>CQL0305: DISTINCT may only be used in function that are aggregated or user defined<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined" title="Direct link to heading">#</a></h3><p>Only aggregated functions and user defined functions can use the keyword DISTINCT. Others type of functions are not allowed to use it.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined"></a>CQL0306: FILTER clause may only be used in function that are aggregated or user defined<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined" title="Direct link to heading">#</a></h3><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level"></a>CQL0307: return statement should be in a procedure and not at the top level<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level" title="Direct link to heading">#</a></h3><p>There are basically two checks here both of which have to do with the &quot;nesting level&quot; at which the <code>return</code> occurs.</p><p>A loose <code>return</code> statement (not in a procedure) is meaningless so that produce an error.  There is nothing to return from.</p><p>If the return statement is not inside of an &quot;if&quot; or something like that then it will run unconditionally.  Nothing should follow the return (see CQL0308) so if we didn&#x27;t fall afoul of CQL0308 and we&#x27;re at the top level then the return is the last thing in the proc, in which case it is totally redundant.</p><p>Both these situations produce an error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0308-statement-should-be-the-last-thing-in-a-statement-list"></a>CQL0308: statement should be the last thing in a statement list<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0308-statement-should-be-the-last-thing-in-a-statement-list" title="Direct link to heading">#</a></h3><p>Control flow will exit the containing procedure after a <code>return</code> statement, so any statements that follow in its statement list will certainly not run.  So the return statement must be the last statement, otherwise there are dead/unreachable statements which is most likely done by accident.</p><p>To fix this probably the things that came after the return should be deleted.  Or alternately there was a condition on the return that should have been added but wasn&#x27;t, so the return should have been inside a nested statement list (like the body of an <code>if</code> maybe).</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0309-new-table-must-be-added-with-createnumber-or-later-table_name"></a>CQL0309: new table must be added with @create([number]) or later &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0309-new-table-must-be-added-with-createnumber-or-later-table_name" title="Direct link to heading">#</a></h3><p>The indicated table was newly added -- it is not present in the previous schema.  However the version number it was added at is in the past.  The new table must appear at the current schema version or later.  That version is provided in the error message.</p><p>To fix this, change the <code>@create</code> annotation on the table to be at the indicated version or later.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0310-new-column-must-be-added-with-createnumber-or-later-column_name"></a>CQL0310: new column must be added with @create([number]) or later&quot; &#x27;column_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0310-new-column-must-be-added-with-createnumber-or-later-column_name" title="Direct link to heading">#</a></h3><p>The indicated column was newly added -- it is not present in the previous schema.  However the version number it was added at is in the past.  The new column must appear at the current schema version or later.  That version is provided in the error message.</p><p>To fix this, change the <code>@create</code> annotation on the table to be at the indicated version or later.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0311-cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name"></a>CQL0311: CQL0311: object&#x27;s deployment region changed from &#x27;&lt;previous_region&gt;&#x27; to &#x27;&lt;current_region&gt;&#x27; &#x27;object_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0311-cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name" title="Direct link to heading">#</a></h3><p>An object may not move between deployment regions, because users of the schema will depend on its contents.  New objects can be added to a deployment region but nothing can move from one region to another.  The indicated object appears to be moving.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled"></a>CQL0312: window function invocation are forbidden if strict window function mode is enabled<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled" title="Direct link to heading">#</a></h3><p><code>@enforce_strict</code> has been use to enable strict window function enforcement.  When enabled all sql statement should not invoke window function. This is because sqlite version running in some iOS version is old. Window function was added to SQLite in the version <strong>3.25.0 (2018-09-15)</strong>.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement"></a>CQL0313: blob literals may only appear in the context of a SQL statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement" title="Direct link to heading">#</a></h3><p>CQL (currently)  limits use of blob literals to inside of SQL fragments.  There&#x27;s no easy way to get a blob
constant variable into the data section so any implementation would be poor.  These don&#x27;t come up very often
in any case so this is a punt basically.  You can fake it with (select x&#x27;1234&#x27;) which makes it clear that
you are doing something expensive.  This is not recommended.  Better to pass the blob you need into CQL
rather than cons it from a literal.  Within SQL it&#x27;s just text and SQLite does the work as usual so that poses no
problems.  And of course non-literal blobs (as args) work find and are bound as usual.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in"></a>CQL0314: select function does not require a declaration, it is a CQL built-in<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in" title="Direct link to heading">#</a></h3><p>CQL built-in function does not require a select function declaration. You can used it directly in your SQL statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement"></a>CQL0315: mandatory column with no default value in INSERT INTO name DEFAULT VALUES statement.<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement" title="Direct link to heading">#</a></h3><p>Columns on a table must have default value or be nullable in order to use INSERT INTO <code>&lt;table&gt;</code> DEFAULT VALUES statement.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0316-the-upsert-clause-is-not-compatible-with-default-values"></a>CQL0316: the upsert-clause is not compatible with DEFAULT VALUES<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0316-the-upsert-clause-is-not-compatible-with-default-values" title="Direct link to heading">#</a></h3><p>INSERT statement with DEFAULT VALUES can not be used in a upsert statement.  This form is not supported by SQLite.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0317-char-function-arguments-must-be-integer"></a>CQL0317: char function arguments must be integer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0317-char-function-arguments-must-be-integer" title="Direct link to heading">#</a></h3><p>All parameters of the built-In scalar CQL functions <code>char(...)</code> must be of type integer.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name"></a>CQL0318: more than one fragment annotation on procedure &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name" title="Direct link to heading">#</a></h3><p>The indicated procedure has several cql:*_fragment annotations such as cql:base_fragment and cql:extension_fragment.  You can have at most one of these.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:base_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">goo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> mixed_frag_types3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0319-the-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name"></a>CQL0319: the name of the assembly procedure must match the name of the base fragment &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0319-the-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name" title="Direct link to heading">#</a></h3><p>The name of the procedure that carries the assembly attribute (cql:assembly_fragment) has to match the name of the base fragment.  This is because the code that is generated for the extension fragments refers to some shared code that is generated in the assembly fragment.  If the assembly fragment were allowed to have a distinct name the linkage could never work.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- correct example</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note: &#x27;foo&#x27; must be a valid base fragment, declared elsewhere</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- incorrect example</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name"></a>CQL0320: extension fragment CTE must have a FROM clause and no other top level clauses &#x27;frag_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name" title="Direct link to heading">#</a></h3><p>In the extension fragment form that uses <code>LEFT OUTER JOIN</code> to add columns you cannot include top level restrictions/changes like <code>WHERE</code>, <code>ORDER BY</code>, <code>LIMIT</code> and so forth.  Any of these would remove or reorder the rows from the core fragment and that is not allowed, you can only add columns.  Hence you must have a <code>FROM</code> clause and you can have no other top level clauses.  You can use any clauses you like in a nested select to get your additional columns.</p><p>Note: you could potentially add rows with a <code>LEFT OUTER JOIN</code> and a generous <code>ON</code> clause. That&#x27;s allowed but not recommended. The <code>ON</code> clause can&#x27;t be forbidden because it&#x27;s essentail in the normal case.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0321-migration-proc-not-allowed-on-object-object_name"></a>CQL0321: migration proc not allowed on object &#x27;object_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0321-migration-proc-not-allowed-on-object-object_name" title="Direct link to heading">#</a></h3><p>The indicated name is an index or a trigger. These objects may not have a migration script associated with them when they are deleted.</p><p>The reason for this is that both these types of objects are attached to a table and the table itself might be deleted.  If the table is deleted it becomes impossible to express even a tombstone for the deleted trigger or index without getting errors.  As a conseqence the index/trigger must be completely removed.  But if there had been a migration procedure on it then some upgrade sequences would have run it, but others would not (anyone who upgraded after the table was deleted would not get the migration procedure).  To avoid this problem, migration procedures are not allowed on indices and triggers.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name"></a>CQL0322: fragment parameters must be exactly &#x27;[arguments]&#x27; &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name" title="Direct link to heading">#</a></h3><p>The named procedure is an extension fragment or an assembly fragment. It must have exactly the same arguments as the base fragment.  These arguments are provided.</p><p>Recall that the code for the procedure that does the select comes from the assembly fragment, so its arguments are in some sense the only ones that matter.  But the extension fragments are also allowed to use the arguments.  Of course we must ensure that the extension fragments do not use any arguments that aren&#x27;t in the assembly, and so the only choice we have is to make sure the extensions conform to the base.  And so for that to work the assembly also has to conform to the base.  So the base fragment must define the args for all the other fragments.</p><p>You could imagine a scheme where the extension fragments are allowed to use a subset of the parameters defined in the base but if that were the case you might have names that mean different things in different fragments and then you could get errors or different semantics when the fragments were assembled. To avoid all of these problems, and for simplicity, we demand that the arguments of all fragments match exactly.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0323-calls-to-undeclared-procedures-are-forbidden-if-strict-procedure-mode-is-enabled-procedure_name"></a>CQL0323: calls to undeclared procedures are forbidden if strict procedure mode is enabled &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0323-calls-to-undeclared-procedures-are-forbidden-if-strict-procedure-mode-is-enabled-procedure_name" title="Direct link to heading">#</a></h3><p><code>@enforce_strict PROCEDURE</code> has been enabled.   In this mode you may only call procedures that have a declaration.
In <code>@enforce_normal PROCEDURE</code> mode, a call to an unknown proc is interpreted as a simple C call.  This lets you call
functions like <code>printf</code> in normal mode, even if they have a strange calling convention.  Strict mode limits you to declared procedures
and is generally safer.</p><p>If you get this error the most likely reason is that there is a typo in the name of the procedure you are trying to call.  If you really
need to call a c runtime function then you must temporarily switch back to <code>@enforce_normal</code> for procedures.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table"></a>CQL0324: referenced table was created in a later version so it cannot be used in a foreign key &#x27;referenced_table&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table" title="Direct link to heading">#</a></h3><p>In a foreign key, we enforce the following rules:</p><ul><li><code>@recreate</code> tables can see any version they like, if the name is in scope that&#x27;s good enough</li><li>other tables may only &quot;see&quot; the same version or an earlier version.</li></ul><p>Normal processing can&#x27;t actually get into this state because if you tried to create the referencing
table with the smaller version number first you would get errors because the name of the referenced
table doesn&#x27;t yet exist.  But if you created them at the same time and you made a typo in the version
number of the referenced table such that it was accidentally bigger you&#x27;d create a weirdness.
So we check for that situation here and reject it to prevent that sort of typo.</p><p>If you see this error there is almost certainly a typo in the version number of the referenced table; it should be fixed.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0325-ok_table_scan-attribute-must-be-a-name"></a>CQL0325: ok_table_scan attribute must be a name<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0325-ok_table_scan-attribute-must-be-a-name" title="Direct link to heading">#</a></h3><p>The values for the attribute <code>ok_table_scan</code> can only be names.</p><p>CQL attributes can have a variety of values but in this case the attribute refers to the names
of tables so no other type of attribute is reasonable.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0326-the-table-name-in-ok_table_scan-does-not-exist-table_name"></a>CQL0326: the table name in ok_table_scan does not exist &#x27;table_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0326-the-table-name-in-ok_table_scan-does-not-exist-table_name" title="Direct link to heading">#</a></h3><p>The names provided to <code>ok_table_scan</code> attribute should be names of existing tables.</p><p>The attribute indicates tables that are ok to scan in this procedure even though they
are typically not ok to scan due to &#x27;no_table_scan&#x27;.  Therefore the attribute must
refer to an existing table.  There is likely a typo in the the table name that needs
to be corrected.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0327-a-value-should-not-be-assigned-to-no_table_scan-attribute"></a>CQL0327: a value should not be assigned to no_table_scan attribute<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0327-a-value-should-not-be-assigned-to-no_table_scan-attribute" title="Direct link to heading">#</a></h3><p>The attribute <code>no_table_scan</code> doesn&#x27;t take a value.</p><p>When marking a table with <code>@attribute(cql:no_table_scan)</code> there is no need
for an attribute value.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0328-no_table_scan-attribute-may-only-be-added-to-a-create-table-statement"></a>CQL0328: no_table_scan attribute may only be added to a create table statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0328-no_table_scan-attribute-may-only-be-added-to-a-create-table-statement" title="Direct link to heading">#</a></h3><p>The <code>no_table_scan</code> attrubute can only be assigned to a create table statement.</p><p>The marking <code>@attribute(cql:no_table_scan)</code> only makes sense on tables.  It&#x27;s likely
been put somewhere strange, If it isn&#x27;t obviously on the wrong thing, look into
possibly how the source is after macro expansion.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement"></a>CQL0329: ok_table_scan attribute can only be used in a create procedure statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement" title="Direct link to heading">#</a></h3><p>The <code>ok_table_scan</code> can only be placed on a create procedure statement.</p><p>The marking <code>@attribute(cql:ok_table_scan=...)</code> indicates that the procedure may scan
the indicated tables. This marking doesn&#x27;t make sense on other kinds of statements.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0330-fragment-must-start-with-exactly-select--from-cte"></a>CQL0330: fragment must start with exactly &#x27;SELECT * FROM CTE&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0330-fragment-must-start-with-exactly-select--from-cte" title="Direct link to heading">#</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes <code>select * from CTE</code> in the
first branch of the UNION ALL operator when using that form.  Here CTE
is the common table expression that they define.  This the error message includes the
specific name that is required in this context.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name"></a>CQL0331: extension fragment CTE must have not have ORDER BY or LIMIT clauses &#x27;frag_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name" title="Direct link to heading">#</a></h3><p>In the extension fragment form that uses <code>UNION ALL</code> to add rows you cannot include the top level operators <code>ORDER BY</code>, or <code>LIMIT</code>  Any of these would remove or reorder the rows from the core fragment and that is not allowed, you can only add new rows.
You can use any clauses you like in a nested selects as they will not remove rows from the base query.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name"></a>CQL0332: all extension fragments that use UNION ALL must come before those that use LEFT OUTER JOIN &#x27;frag_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name" title="Direct link to heading">#</a></h3><p>Query fragments that add rows using the UNION ALL form have no way to refer columns that may have been added before
them in the part of the query that adds rows (the second and subsequent branches of UNION ALL).  As a result,
in order to get a assembled query that makes sense the row-adding form must always come before any columns
were added.  Hence all of these fragments must come before any of the LEFT OUTER JOIN form.</p><p>If you get this error, you should re-order your fragments such that the UNION ALL form comes before any
LEFT OUTER JOIN fragments.  The offendeding fragment is named in the error.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0333-all-the-compound-operators-in-this-cte-must-be-union-all"></a>CQL0333: all the compound operators in this CTE must be UNION ALL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0333-all-the-compound-operators-in-this-cte-must-be-union-all" title="Direct link to heading">#</a></h3><p>The compound operators in CTE must and always be an UNION ALL.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row"></a>CQL0334: @dummy_seed @dummy_nullables @dummy_defaults many only be used with a single VALUES row<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row" title="Direct link to heading">#</a></h3><p>Dummy insert feature makes only sense when it&#x27;s used in a VALUES clause that is not part of a compound select statement.</p><hr><p>CQL0335</p><p>Available for re-use</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values"></a>CQL0336: select statement with VALUES clause requires a non empty list of values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values" title="Direct link to heading">#</a></h3><p>VALUES clause requires at least a value for each of the values list. Empty values list are not supported.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0337-the-number-of-columns-values-for-each-row-should-be-identical-in-values-clause"></a>CQL0337: the number of columns values for each row should be identical in VALUES clause<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0337-the-number-of-columns-values-for-each-row-should-be-identical-in-values-clause" title="Direct link to heading">#</a></h3><p>The number of values for each values list in VALUES clause should always be the same.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0338-the-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name"></a>CQL0338: the name of a migration procedure may not end in &#x27;_crc&#x27; &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0338-the-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name" title="Direct link to heading">#</a></h3><p>To avoid name conflicts in the upgrade script, migration procedures are not allowed to end in &#x27;_crc&#x27;
this suffix is reserved for internal use.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled"></a>CQL0339: WITHOUT ROWID tables are forbidden if strict without rowid mode is enabled<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled" title="Direct link to heading">#</a></h3><p><code>@enforce_strict</code> has been used to enable strict <code>WITHOUT ROWID</code> enforcement. When enabled no CREATE TABLE statement can have WITHOUT ROWID clause.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name"></a>CQL0340: FROM ARGUMENTS used in a procedure with no arguments &#x27;procedure_name&#x27;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name" title="Direct link to heading">#</a></h3><p>The named procedure has a call that uses the FROM ARGUMENTS pattern but it doesn&#x27;t have any arguments.
This is almost certainly a cut/paste from a different location that needs to be adjusted.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appendix-5-json-schema-grammar"></a>Appendix 5: JSON Schema Grammar<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-5-json-schema-grammar" title="Direct link to heading">#</a></h2><p>What follows is taken from the JSON validation grammar with the tree building rules removed.</p><p>Snapshot as of Tue Sep  8 13:06:45 PDT 2020</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rules-1"></a>Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rules-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">json_schema: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;tables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_tables &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;views&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_views &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;indices&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_indices &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;triggers&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_triggers &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;attributes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_attribute_list &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;queries&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_queries &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;inserts&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_inserts &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;updates&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_updates &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;deletes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_deletes &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;general&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_generals &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;regions&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_regions &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;adHocMigrationProcs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_ad_hoc_migrations &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BOOL_LITERAL: &#x27;0&#x27; | &#x27;1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_tables: | tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tables: table | table &#x27;,&#x27; tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;withoutRowid&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isAdded&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_added_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_deleted_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isRecreated&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_recreate_group_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_table_indices</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; columns &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;primaryKey&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_column_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;foreignKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_foreign_keys &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;uniqueKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_unique_keys &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_added_version: | &#x27;&quot;addedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27; opt_added_migration_proc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_added_migration_proc: | &#x27;&quot;addedMigrationProc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deleted_version: | &#x27;&quot;deletedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27; opt_deleted_migration_proc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deleted_migration_proc: | &#x27;&quot;deletedMigrationProc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_recreate_group_name: | &#x27;&quot;recreateGroupName&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_index_names: | index_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">index_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; index_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_arg_names: | arg_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arg_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; arg_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_column_names: | column_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">column_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; column_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_table_names: | table_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; table_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_procedure_names: | procedure_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">procedure_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; procedure_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sort_order_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; sort_order_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">columns: column | column &#x27;,&#x27; columns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">column: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_is_sensitive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isAdded&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_added_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_deleted_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isPrimaryKey&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isUniqueKey&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isAutoIncrement&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_default_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_default_value: | &#x27;,&#x27; &#x27;&quot;defaultValue&quot;&#x27; &#x27;:&#x27; any_literal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_foreign_keys : | foreign_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_is_sensitive: | &#x27;&quot;isSensitive&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foreign_keys :  foreign_key | foreign_key &#x27;,&#x27; foreign_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foreign_key : &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;referenceTable&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;referenceColumns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;onUpdate&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;onDelete&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;isDeferred&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_unique_keys :  | unique_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">unique_keys : unique_key | unique_key &#x27;,&#x27; unique_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">unique_key:  &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name: | &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_table_indices: | table_indices</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_indices: &#x27;&quot;indices&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_index_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attributes:  | attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attributes: &#x27;&quot;attributes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; attribute_list &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attribute_list: | attribute_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_list: attribute | attribute &#x27;,&#x27; attribute_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attribute:  &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; attribute_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_array: &#x27;[&#x27; opt_attribute_value_list &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attribute_value_list: | attribute_value_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_value_list: attribute_value | attribute_value &#x27;,&#x27; attribute_value_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_value: any_literal | attribute_array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">any_integer: BOOL_LITERAL | INT_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">any_literal:  BOOL_LITERAL |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              INT_LITERAL | &#x27;-&#x27; INT_LITERAL |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              LONG_LITERAL | &#x27;-&#x27; LONG_LITERAL |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              REAL_LITERAL | &#x27;-&#x27; REAL_LITERAL |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              STRING_LITERAL | NULL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_views: | views</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">views: view | view &#x27;,&#x27; views</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">view:  &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_deleted_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       projection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;select&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;selectArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_region_info: | &#x27;&quot;region&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; |  &#x27;&quot;region&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; &#x27;&quot;deployedInRegion&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_projection: | projection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">projection: &#x27;&quot;projection&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; projected_columns &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">projected_columns: projected_column | projected_column &#x27;,&#x27; projected_columns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">projected_column: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   opt_is_sensitive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_indices:  | indices</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">indices: index  | index &#x27;,&#x27; indices</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">index: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isUnique&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_deleted_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;sortOrders&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; sort_order_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_triggers: | triggers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">triggers: trigger | trigger &#x27;,&#x27; triggers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trigger: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;target&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_deleted_version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          before_after_instead &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          delete_insert_update &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_for_each_row</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_when_expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          dependencies</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">before_after_instead: &#x27;&quot;isBeforeTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isAfterTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;  | &#x27;&quot;isInsteadOfTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">delete_insert_update: &#x27;&quot;isDeleteTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isInsertTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isUpdateTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_for_each_row: | &#x27;&quot;forEachRow&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_when_expr: | &#x27;&quot;whenExpr&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; &#x27;&quot;whenExprArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies: opt_insert_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_update_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_delete_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_from_tables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_uses_procedures</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;&quot;usesTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_insert_tables: | &#x27;&quot;insertTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_update_tables: | &#x27;&quot;updateTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_delete_tables: | &#x27;&quot;deleteTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_from_tables: | &#x27;&quot;fromTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_uses_procedures : | &#x27;&quot;usesProcedures&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_procedure_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_queries: | queries ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">queries: query | query &#x27;,&#x27; queries ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">query: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       dependencies &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       projection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_args: | args</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">args: arg | arg &#x27;,&#x27; args</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arg: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      opt_is_sensitive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_inserts: | inserts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">inserts: insert | insert &#x27;,&#x27; inserts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert : &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementType&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;values&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_values &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_values: | values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">values: value | value &#x27;,&#x27; values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">value:  &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;valueArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_updates: | updates</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">updates: update | update &#x27;,&#x27; updates</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update : &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deletes: | deletes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">deletes: delete | delete &#x27;,&#x27; deletes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">delete : &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_generals: | generals</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">generals: general | general &#x27;,&#x27; generals</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">general: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_complex_args &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          dependencies &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_regions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_attributes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;hasStructResult&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;hasRowsetResult&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_projection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_result_contract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;usesDatabase&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_result_contract: | &#x27;&quot;hasSelectResult&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27; | &#x27;&quot;hasOutResult&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27; | &#x27;&quot;hasOutUnionResult&quot;&#x27; &#x27;:&#x27;&#x27;1&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_complex_args: | complex_args</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">complex_args: complex_arg | complex_arg &#x27;,&#x27; complex_args</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">complex_arg: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_binding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_is_sensitive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_binding: | &#x27;&quot;binding&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_regions: | regions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">regions: region | region &#x27;,&#x27; regions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">region:  &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isDeployableRoot&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;deployedInRegion&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;using&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_region_names &#x27;]&#x27; &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;usingPrivately&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_bool_list &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_region_names: | region_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">region_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; region_names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_bool_list: | bool_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bool_list: BOOL_LITERAL | BOOL_LITERAL &#x27;,&#x27; bool_list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opt_ad_hoc_migrations: | ad_hoc_migrations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ad_hoc_migrations: ad_hoc_migration | ad_hoc_migrations &#x27;,&#x27; ad_hoc_migrations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ad_hoc_migration: &#x27;{&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;version&quot;&#x27; &#x27;:&#x27; any_integer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-10-23T20:13:13.000Z" class="docLastUpdatedAt_217_">10/23/2020</time> by <strong>Dmitry Vinnik</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chapter-1-introduction" class="table-of-contents__link">Chapter 1: Introduction</a><ul><li><a href="#getting-started" class="table-of-contents__link">Getting Started</a></li><li><a href="#why-did-this-work" class="table-of-contents__link">Why did this work?</a></li><li><a href="#variables-and-arithmetic" class="table-of-contents__link">Variables and Arithmetic</a></li><li><a href="#basic-conversion-rules" class="table-of-contents__link">Basic Conversion Rules</a></li><li><a href="#preprocessing-features" class="table-of-contents__link">Preprocessing Features</a></li></ul></li><li><a href="#chapter-2-using-data" class="table-of-contents__link">Chapter 2: Using Data</a><ul><li><a href="#a-sample-program" class="table-of-contents__link">A Sample Program</a></li><li><a href="#providing-a-suitable-database" class="table-of-contents__link">Providing a Suitable Database</a></li><li><a href="#declaring-schema" class="table-of-contents__link">Declaring Schema</a></li><li><a href="#explaining-the-new-hello-world" class="table-of-contents__link">Explaining The New Hello World</a></li><li><a href="#introducing-cursors" class="table-of-contents__link">Introducing Cursors</a></li><li><a href="#going-crazy" class="table-of-contents__link">Going Crazy</a></li></ul></li><li><a href="#chapter-3-expressions-literals-nullability-sensitivity" class="table-of-contents__link">Chapter 3: Expressions, Literals, Nullability, Sensitivity</a><ul><li><a href="#expression-examples" class="table-of-contents__link">Expression Examples</a></li><li><a href="#order-of-evaluation" class="table-of-contents__link">Order of Evaluation</a></li><li><a href="#nullability" class="table-of-contents__link">Nullability</a></li><li><a href="#types-of-literals" class="table-of-contents__link">Types of Literals</a></li><li><a href="#nullability-rules" class="table-of-contents__link">Nullability Rules</a></li><li><a href="#expression-types" class="table-of-contents__link">Expression Types</a></li><li><a href="#case-expressions" class="table-of-contents__link">CASE Expressions</a></li><li><a href="#marking-data-as-sensitive" class="table-of-contents__link">Marking Data as Sensitive</a></li><li><a href="#reference-semantics" class="table-of-contents__link">Reference Semantics</a></li><li><a href="#function-return-values" class="table-of-contents__link">Function Return Values</a></li><li><a href="#comparison" class="table-of-contents__link">Comparison</a></li><li><a href="#blob-and-object" class="table-of-contents__link"><code>BLOB</code> and <code>OBJECT</code></a></li><li><a href="#text" class="table-of-contents__link"><code>TEXT</code></a></li><li><a href="#sample-code" class="table-of-contents__link">Sample Code</a></li></ul></li><li><a href="#chapter-4-procedures-functions-and-control-flow" class="table-of-contents__link">Chapter 4: Procedures, Functions, and Control Flow</a><ul><li><a href="#out-parameters" class="table-of-contents__link">Out Parameters</a></li><li><a href="#procedure-calls" class="table-of-contents__link">Procedure Calls</a></li><li><a href="#the-if-statement" class="table-of-contents__link">The IF statement</a></li><li><a href="#the-while-statement" class="table-of-contents__link">The WHILE statement</a></li><li><a href="#the-try-catch-and-throw-statements" class="table-of-contents__link">The TRY, CATCH, and THROW Statements</a></li><li><a href="#procedures-as-functions-motivation-and-example" class="table-of-contents__link">Procedures as Functions: Motivation and Example</a></li></ul></li><li><a href="#chapter-5-types-of-cursors-out-and-out-union-and-fetch-flavors" class="table-of-contents__link">Chapter 5: Types of Cursors, OUT and OUT UNION, and FETCH flavors</a><ul><li><a href="#statement-cursors" class="table-of-contents__link">Statement Cursors</a></li><li><a href="#value-cursors" class="table-of-contents__link">Value Cursors</a></li><li><a href="#out-statement" class="table-of-contents__link">OUT Statement</a></li><li><a href="#out-union-statement" class="table-of-contents__link">OUT UNION Statement</a></li><li><a href="#result-set-cursors" class="table-of-contents__link">Result Set Cursors</a></li><li><a href="#reshaping-data-cursor-like-forms" class="table-of-contents__link">Reshaping Data, Cursor <code>LIKE</code> forms</a></li><li><a href="#fetch-statement-specifics" class="table-of-contents__link">Fetch Statement Specifics</a></li><li><a href="#calling-procedures-with-bulk-arguments" class="table-of-contents__link">Calling Procedures with Bulk Arguments</a></li><li><a href="#missing-data-columns-nulls-and-dummy-data" class="table-of-contents__link">Missing Data Columns, Nulls and Dummy Data</a></li></ul></li><li><a href="#chapter-6-calling-procedures-defined-elsewhere" class="table-of-contents__link">Chapter 6: Calling Procedures Defined Elsewhere</a><ul><li><a href="#declaring-procedures-defined-elsewhere" class="table-of-contents__link">Declaring Procedures Defined Elsewhere</a></li><li><a href="#simple-procedures-database-free" class="table-of-contents__link">Simple Procedures (database free):</a></li><li><a href="#procedures-that-use-the-database" class="table-of-contents__link">Procedures that use the database</a></li><li><a href="#procedures-that-create-a-result-set" class="table-of-contents__link">Procedures that create a result set</a></li><li><a href="#procedures-that-return-a-single-row-with-a-value-cursor" class="table-of-contents__link">Procedures that return a single row with a value cursor</a></li><li><a href="#procedures-that-return-a-full-result-set" class="table-of-contents__link">Procedures that return a full result set</a></li><li><a href="#exporting-declared-symbols-automatically" class="table-of-contents__link">Exporting Declared Symbols Automatically</a></li><li><a href="#declaration-examples" class="table-of-contents__link">Declaration Examples</a></li></ul></li><li><a href="#chapter-7-cql-result-sets" class="table-of-contents__link">Chapter 7: CQL Result Sets</a><ul><li><a href="#results-sets-from-out-union" class="table-of-contents__link">Results Sets From <code>OUT UNION</code></a></li></ul></li><li><a href="#chapter-8-functions" class="table-of-contents__link">Chapter 8: Functions</a><ul><li><a href="#notes-on-builtin-functions" class="table-of-contents__link">Notes on Builtin Functions</a></li></ul></li><li><a href="#chapter-9-statements-summary-and-error-checking" class="table-of-contents__link">Chapter 9: Statements Summary and Error Checking</a><ul><li><a href="#the-primary-sql-statements" class="table-of-contents__link">The Primary SQL Statements</a></li><li><a href="#the-primary-procedure-statements" class="table-of-contents__link">The Primary Procedure Statements</a></li><li><a href="#the-meta-statements" class="table-of-contents__link">The &quot;Meta&quot; Statements</a></li><li><a href="#important-program-fragments" class="table-of-contents__link">Important Program Fragments</a></li><li><a href="#special-note-on-the-joinusing-form" class="table-of-contents__link">Special Note on the JOIN...USING form</a></li></ul></li><li><a href="#chapter-10-schema-management-features" class="table-of-contents__link">Chapter 10: Schema Management Features</a><ul><li><a href="#annotations" class="table-of-contents__link">Annotations</a></li><li><a href="#semantics" class="table-of-contents__link">Semantics</a></li><li><a href="#allowable-changes" class="table-of-contents__link">Allowable changes</a></li><li><a href="#prosecution" class="table-of-contents__link">Prosecution</a></li><li><a href="#example-migration" class="table-of-contents__link">Example Migration</a></li><li><a href="#sample-upgrade-script" class="table-of-contents__link">Sample Upgrade Script</a></li><li><a href="#schema-regions" class="table-of-contents__link">Schema Regions</a></li></ul></li><li><a href="#chapter-11-previous-schema-validation" class="table-of-contents__link">Chapter 11: Previous Schema Validation</a><ul><li><a href="#basic-usage" class="table-of-contents__link">Basic Usage</a></li></ul></li><li><a href="#chapter-12-testability-features" class="table-of-contents__link">Chapter 12: Testability Features</a><ul><li><a href="#dummy-data" class="table-of-contents__link">Dummy Data</a></li><li><a href="#autotest-attributes" class="table-of-contents__link">Autotest Attributes</a></li></ul></li><li><a href="#chapter-13-json-output" class="table-of-contents__link">Chapter 13: JSON Output</a></li><li><a href="#chapter-14-cql-query-fragments" class="table-of-contents__link">Chapter 14: CQL Query Fragments</a><ul><li><a href="#base-query-fragments" class="table-of-contents__link">Base Query Fragments</a></li><li><a href="#extension-query-fragments" class="table-of-contents__link">Extension Query Fragments</a></li></ul></li><li><a href="#appendix-1-command-line-options" class="table-of-contents__link">Appendix 1: Command Line Options</a><ul><li><a href="#with-no-options" class="table-of-contents__link">With No Options</a></li><li><a href="#--in-file" class="table-of-contents__link">--in file</a></li><li><a href="#--sem" class="table-of-contents__link">--sem</a></li><li><a href="#--print" class="table-of-contents__link">--print</a></li><li><a href="#--dot" class="table-of-contents__link">--dot</a></li><li><a href="#--cg-output1-output2-" class="table-of-contents__link">--cg output1 output2 ...</a></li><li><a href="#--global_proc-name" class="table-of-contents__link">--global_proc name</a></li><li><a href="#--compress" class="table-of-contents__link">--compress</a></li><li><a href="#--test" class="table-of-contents__link">--test</a></li><li><a href="#--java_package_name" class="table-of-contents__link">--java_package_name</a></li><li><a href="#--c_include_namespace" class="table-of-contents__link">--c_include_namespace</a></li><li><a href="#--objc_c_include_path" class="table-of-contents__link">--objc_c_include_path</a></li><li><a href="#result-types---rt-" class="table-of-contents__link">Result Types (--rt *)</a></li></ul></li><li><a href="#appendix-2-cql-grammar" class="table-of-contents__link">Appendix 2: CQL Grammar</a><ul><li><a href="#operators-and-literals" class="table-of-contents__link">Operators and Literals</a></li><li><a href="#statementtype-keywords" class="table-of-contents__link">Statement/Type Keywords</a></li><li><a href="#rules" class="table-of-contents__link">Rules</a></li></ul></li><li><a href="#appendix-3-control-directives" class="table-of-contents__link">Appendix 3: Control Directives</a></li><li><a href="#chapter-4-cql-error-codes" class="table-of-contents__link">Chapter 4: CQL Error Codes</a><ul><li><a href="#cql0001-operands-must-be-an-integer-type-not-real" class="table-of-contents__link">CQL0001: operands must be an integer type, not real</a></li><li><a href="#cql0002-left-operand-cannot-be-an-object-in-operator" class="table-of-contents__link">CQL0002: left operand cannot be an object in &#39;operator&#39;</a></li><li><a href="#cql0003-left-operand-cannot-be-an-object-in-operator" class="table-of-contents__link">CQL0003: left operand cannot be an object in &#39;operator&#39;</a></li><li><a href="#cql0004-left-operand-cannot-be-a-blob-in-operator" class="table-of-contents__link">CQL0004: left operand cannot be a blob in &#39;operator&#39;</a></li><li><a href="#cql0005-right-operand-cannot-be-a-blob-in-operator" class="table-of-contents__link">CQL0005: right operand cannot be a blob in &#39;operator&#39;</a></li><li><a href="#cql0007-left-operand-cannot-be-a-string-in-operator" class="table-of-contents__link">CQL0007: left operand cannot be a string in &#39;operator&#39;</a></li><li><a href="#cql0008-right-operand-cannot-be-a-string-in-operator" class="table-of-contents__link">CQL0008: right operand cannot be a string in &#39;operator&#39;</a></li><li><a href="#cql0009-incompatible-types-in-expression-subject" class="table-of-contents__link">CQL0009: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0010-incompatible-types-in-expression-subject" class="table-of-contents__link">CQL0010: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0011-incompatible-types-in-expression-subject" class="table-of-contents__link">CQL0011: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0012-incompatible-types-in-expression-subject" class="table-of-contents__link">CQL0012: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target" class="table-of-contents__link">CQL0013: cannot assign/copy possibly null expression to not null target &#39;target&#39;</a></li><li><a href="#cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target" class="table-of-contents__link">CQL0014: cannot assign/copy sensitive expression to not null target &#39;target&#39;</a></li><li><a href="#cql0015-expected-numeric-expression-context" class="table-of-contents__link">CQL0015: expected numeric expression &#39;context&#39;</a></li><li><a href="#cql0016-duplicate-table-name-in-join-table" class="table-of-contents__link">CQL0016: duplicate table name in join &#39;table&#39;</a></li><li><a href="#cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index" class="table-of-contents__link">CQL0017: index was present but now it does not exist (use <code>@delete</code> instead) &#39;index&#39;</a></li><li><a href="#cql0018-duplicate-index-name-index" class="table-of-contents__link">CQL0018: duplicate index name &#39;index&#39;</a></li><li><a href="#cql0019-create-index-table-name-not-found-table_name" class="table-of-contents__link">CQL0019: create index table name not found &#39;table_name&#39;</a></li><li><a href="#cql0020-duplicate-unique-key-in-table-key_name" class="table-of-contents__link">CQL0020: duplicate unique key in table &#39;key_name&#39;</a></li><li><a href="#cql0021-foreign-key-refers-to-non-existent-table-table_name" class="table-of-contents__link">CQL0021: foreign key refers to non-existent table &#39;table_name&#39;</a></li><li><a href="#cql0022-the-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name" class="table-of-contents__link">CQL0022: the exact type of both sides of a foreign key must match (expected expected_type; found actual_type) &#39;key_name&#39;</a></li><li><a href="#cql0023-the-number-of-columns-on-both-sides-of-a-foreign-key-must-match" class="table-of-contents__link">CQL0023: The number of columns on both sides of a foreign key must match</a></li><li><a href="#cql0024-table-does-not-have-pk-column-column" class="table-of-contents__link">CQL0024: table does not have pk column &#39;column&#39;</a></li><li><a href="#cql0025-version-number-in-annotation-must-be-positive" class="table-of-contents__link">CQL0025: version number in annotation must be positive</a></li><li><a href="#cql0026-duplicate-version-annotation" class="table-of-contents__link">CQL0026: duplicate version annotation</a></li><li><a href="#cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name" class="table-of-contents__link">CQL0027: a procedure can appear in only one annotation &#39;procedure_name&#39;</a></li><li><a href="#cql0028-the-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name" class="table-of-contents__link">CQL0028: the FK reference must be exactly one column with the correct type &#39;column_name&#39;</a></li><li><a href="#cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name" class="table-of-contents__link">CQL0029: autoincrement column must be LONG_INTEGER PRIMARY KEY &#39;column name&#39;</a></li><li><a href="#cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name" class="table-of-contents__link">CQL0030: a column attribute was specified twice on the same column &#39;column_name&#39;</a></li><li><a href="#cql0031-column-cant-be-primary-key-and-also-unique-key-column" class="table-of-contents__link">CQL0031: column can&#39;t be primary key and also unique key &#39;column&#39;</a></li><li><a href="#cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column" class="table-of-contents__link">CQL0032: created columns must be at the end and must be in version order&quot;, &#39;column&#39;</a></li><li><a href="#cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column" class="table-of-contents__link">CQL0033: columns in a table marked @recreate cannot have @create or <code>@delete</code>, &#39;column&#39;</a></li><li><a href="#cql0035-column-delete-version-cant-be--column-create-version-column" class="table-of-contents__link">CQL0035: column delete version can&#39;t be &lt;= column create version&quot;, &#39;column&#39;</a></li><li><a href="#cql0036-column-delete-version-cant-be--the-table-create-version-column" class="table-of-contents__link">CQL0036: column delete version can&#39;t be &lt;= the table create version &#39;column&#39;</a></li><li><a href="#cql0038-column-create-version-cant-be--the-table-create-version-column" class="table-of-contents__link">CQL0038: column create version can&#39;t be <code>&lt;=</code> the table create version &#39;column&#39;</a></li><li><a href="#cql0039-column-create-version-cant-be--the-table-delete-version-column" class="table-of-contents__link">CQL0039: column create version can&#39;t be <code>&gt;=</code> the table delete version &#39;column&#39;</a></li><li><a href="#cql0040-table-can-only-have-one-autoinc-column-column" class="table-of-contents__link">CQL0040: table can only have one autoinc column &#39;column&#39;</a></li><li><a href="#cql0041-tables-cannot-have-object-columns-column" class="table-of-contents__link">CQL0041: tables cannot have object columns &#39;column&#39;</a></li><li><a href="#cql0042-left-operand-must-be-a-string-in-likematchglob" class="table-of-contents__link">CQL0042: left operand must be a string in &#39;LIKE/MATCH/GLOB&#39;</a></li><li><a href="#cql0043-right-operand-must-be-a-string-in-likematchglob" class="table-of-contents__link">CQL0043: right operand must be a string in &#39;LIKE/MATCH/GLOB&#39;</a></li><li><a href="#cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match" class="table-of-contents__link">CQL0044: operator may only appear in the context of a SQL statement &#39;MATCH&#39;</a></li><li><a href="#cql0045-blob-operand-not-allowed-in-operator" class="table-of-contents__link">CQL0045: blob operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0046-object-operand-not-allowed-in-operator" class="table-of-contents__link">CQL0046: object operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0047-string-operand-not-allowed-in-operator" class="table-of-contents__link">CQL0047: string operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0048-blob-operand-not-allowed-in-not" class="table-of-contents__link">CQL0048: blob operand not allowed in &#39;NOT&#39;</a></li><li><a href="#cql0049-object-operand-not-allowed-in-not" class="table-of-contents__link">CQL0049: object operand not allowed in &#39;NOT&#39;</a></li><li><a href="#cql0050-string-operand-not-allowed-in-not" class="table-of-contents__link">CQL0050: string operand not allowed in &#39;NOT&#39;</a></li><li><a href="#cql0051-argument-can-only-be-used-in-count-" class="table-of-contents__link">CQL0051: argument can only be used in count(<em>) &#39;</em>&#39;</a></li><li><a href="#cql0052-select--cannot-be-used-with-no-from-clause" class="table-of-contents__link">CQL0052: select * cannot be used with no FROM clause</a></li><li><a href="#cql0053-select-table-cannot-be-used-with-no-from-clause" class="table-of-contents__link">CQL0053: select table.* cannot be used with no FROM clause</a></li><li><a href="#cql0054-table-not-found-table" class="table-of-contents__link">CQL0054: table not found &#39;table&#39;</a></li><li><a href="#cql0055-all-columns-in-the-select-must-have-a-name" class="table-of-contents__link">CQL0055: all columns in the select must have a name</a></li><li><a href="#cql0056-null-column-did-not-specify-a-type-column" class="table-of-contents__link">CQL0056: NULL column did not specify a type &#39;column&#39;</a></li><li><a href="#cql0057-if-multiple-selects-all-must-have-the-same-column-count" class="table-of-contents__link">CQL0057: if multiple selects, all must have the same column count</a></li><li><a href="#cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-column" class="table-of-contents__link">CQL0058: if multiple selects, all column names must be identical so they have unambiguous names &#39;column&#39;</a></li><li><a href="#cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name" class="table-of-contents__link">CQL0059: a variable name might be ambiguous with a column name, this is an anti-pattern &#39;name&#39;</a></li><li><a href="#cql0060-referenced-table-can-be-independently-be-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table" class="table-of-contents__link">CQL0060: referenced table can be independently be recreated so it cannot be used in a foreign key, &#39;referenced_table&#39;</a></li><li><a href="#cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column" class="table-of-contents__link">CQL0061: if multiple selects, all columns must be an exact type match (expected expected_type; found actual_type) &#39;column&#39;</a></li><li><a href="#cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column" class="table-of-contents__link">CQL0062: if multiple selects, all columns must be an exact type match (including nullability) (expected expected_type; found actual_type) &#39;column&#39;</a></li><li><a href="#cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name" class="table-of-contents__link">CQL0063: can&#39;t mix and match out statement with select/call for return values &#39;procedure_name&#39;</a></li><li><a href="#cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement" class="table-of-contents__link">CQL0064: object variables may not appear in the context of a SQL statement</a></li><li><a href="#cql0065-identifier-is-ambiguous-name" class="table-of-contents__link">CQL0065: identifier is ambiguous &#39;name&#39;</a></li><li><a href="#cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name" class="table-of-contents__link">CQL0066: if a table is marked <code>@recreate</code>, its indices must be in its schema region &#39;index_name&#39;</a></li><li><a href="#cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name" class="table-of-contents__link">CQL0067: cursor was not used with &#39;fetch cursor&#39;  &#39;cursor_name&#39;</a></li><li><a href="#cql0068-field-not-found-in-cursor-field" class="table-of-contents__link">CQL0068: field not found in cursor &#39;field&#39;</a></li><li><a href="#cql0069-name-not-found-name" class="table-of-contents__link">CQL0069: name not found &#39;name&#39;</a></li><li><a href="#cql0071-first-operand-cannot-be-a-blob-in-betweennot-between" class="table-of-contents__link">CQL0071: first operand cannot be a blob in &#39;BETWEEN/NOT BETWEEN&#39;</a></li><li><a href="#cql0072-first-operand-cannot-be-a-blob-in-betweennot-between" class="table-of-contents__link">CQL0072: first operand cannot be a blob in &#39;BETWEEN/NOT BETWEEN&#39;</a></li><li><a href="#cql0073-cast-may-only-appear-in-the-context-of-sql-statement" class="table-of-contents__link">CQL0073: CAST may only appear in the context of SQL statement</a></li><li><a href="#cql0074-too-few-arguments-provided-coalesce" class="table-of-contents__link">CQL0074: Too few arguments provided &#39;coalesce&#39;</a></li><li><a href="#cql0075-incorrect-number-of-arguments-ifnull" class="table-of-contents__link">CQL0075: Incorrect number of arguments &#39;ifnull&#39;</a></li><li><a href="#cql0076-null-literal-is-useless-in-function-ifnullcoalesce" class="table-of-contents__link">CQL0076: Null literal is useless in function &#39;ifnull/coalesce&#39;</a></li><li><a href="#cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless" class="table-of-contents__link">CQL0077: encountered arg known to be not null before the end of the list, rendering the rest useless.</a></li><li><a href="#cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses" class="table-of-contents__link">CQL0078: not in (select ...) is only allowed inside of select lists, where, on, and having clauses</a></li><li><a href="#cql0079-function-got-incorrect-number-of-arguments-name" class="table-of-contents__link">CQL0079: function got incorrect number of arguments &#39;name&#39;</a></li><li><a href="#cql0080-function-may-not-appear-in-this-context-name" class="table-of-contents__link">CQL0080: function may not appear in this context &#39;name&#39;</a></li><li><a href="#cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name" class="table-of-contents__link">CQL0081: aggregates only make sense if there is a FROM clause &#39;name&#39;</a></li><li><a href="#cql0082-argument-must-be-numeric-average" class="table-of-contents__link">CQL0082: argument must be numeric &#39;AVERAGE&#39;</a></li><li><a href="#cql0083-argument-must-be-numeric-sum" class="table-of-contents__link">CQL0083: argument must be numeric &#39;SUM&#39;</a></li><li><a href="#cql0084-second-argument-must-be-a-string-in-function-group_concat" class="table-of-contents__link">CQL0084: second argument must be a string in function &#39;group_concat&#39;</a></li><li><a href="#cql0085-all-arguments-must-be-strings-strftime" class="table-of-contents__link">CQL0085: all arguments must be strings &#39;strftime&#39;</a></li><li><a href="#cql0086-first-argument-must-be-a-string-in-function-printf" class="table-of-contents__link">CQL0086: first argument must be a string in function &#39;printf&#39;</a></li><li><a href="#cql0087-no-objectblob-types-are-allowed-in-arguments-for-function-printf" class="table-of-contents__link">CQL0087: no object/blob types are allowed in arguments for function &#39;printf&#39;</a></li><li><a href="#cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name" class="table-of-contents__link">CQL0088: User function may not appear in the context of a SQL statement &#39;function_name&#39;</a></li><li><a href="#cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name" class="table-of-contents__link">CQL0089: User function may only appear in the context of a SQL statement &#39;function_name&#39;</a></li><li><a href="#cql0090-stored-proc-calls-may-not-appear-in-the-context-of-a-sql-statement-proc_name" class="table-of-contents__link">CQL0090: Stored proc calls may not appear in the context of a SQL statement &#39;proc_name&#39;</a></li><li><a href="#cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name" class="table-of-contents__link">CQL0091: Stored procs that deal with result sets or cursors cannot be invoked as functions &#39;name&#39;</a></li><li><a href="#cql0092-raise-may-only-be-used-in-a-trigger-statement" class="table-of-contents__link">CQL0092: RAISE may only be used in a trigger statement</a></li><li><a href="#cql0093-raise-2nd-argument-must-be-a-string" class="table-of-contents__link">CQL0093: RAISE 2nd argument must be a string</a></li><li><a href="#cql0094-function-not-yet-implemented-function" class="table-of-contents__link">CQL0094: function not yet implemented &#39;function&#39;</a></li><li><a href="#cql0095-tableview-not-defined-name" class="table-of-contents__link">CQL0095: table/view not defined &#39;name&#39;</a></li><li><a href="#cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name" class="table-of-contents__link">CQL0096: join using column not found on the left side of the join &#39;column_name&#39;</a></li><li><a href="#cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name" class="table-of-contents__link">CQL0097: join using column not found on the right side of the join &#39;column_name&#39;</a></li><li><a href="#cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name" class="table-of-contents__link">CQL0098: left/right column types in join USING(...) do not match exactly &#39;column_name&#39;</a></li><li><a href="#cql0099-having-clause-requires-group-by-clause" class="table-of-contents__link">CQL0099: HAVING clause requires GROUP BY clause</a></li><li><a href="#cql0100-duplicate-common-table-name-name" class="table-of-contents__link">CQL0100: duplicate common table name &#39;name&#39;</a></li><li><a href="#cql0101-too-few-column-names-specified-in-common-table-expression-name" class="table-of-contents__link">CQL0101: too few column names specified in common table expression &#39;name&#39;</a></li><li><a href="#cql0102-too-many-column-names-specified-in-common-table-expression-name" class="table-of-contents__link">CQL0102: too many column names specified in common table expression &#39;name&#39;</a></li><li><a href="#cql0103-duplicate-tableview-name-name" class="table-of-contents__link">CQL0103: duplicate table/view name &#39;name&#39;</a></li><li><a href="#cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name" class="table-of-contents__link">CQL0104: view was present but now it does not exist (use <code>@delete</code> instead) &#39;name&#39;</a></li><li><a href="#cql0105-object-was-a-view-but-is-now-a-table-name" class="table-of-contents__link">CQL0105: object was a view but is now a table &#39;name&#39;</a></li><li><a href="#cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name" class="table-of-contents__link">CQL0106: trigger was present but now it does not exist (use <code>@delete</code> instead) &#39;name&#39;</a></li><li><a href="#cql0107-delete-version-cant-be--create-version-name" class="table-of-contents__link">CQL0107: delete version can&#39;t be &lt;= create version &#39;name&#39;</a></li><li><a href="#cql0108-table-in-drop-statement-does-not-exist-table_name" class="table-of-contents__link">CQL0108: table in drop statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0109-cannot-drop-a-view-with-drop-table-view_name" class="table-of-contents__link">CQL0109: cannot drop a view with drop table &#39;view_name&#39;</a></li><li><a href="#cql0110-view-in-drop-statement-does-not-exist-view_name" class="table-of-contents__link">CQL0110: view in drop statement does not exist &#39;view_name&#39;</a></li><li><a href="#cql0111-cannot-drop-a-table-with-drop-view-name" class="table-of-contents__link">CQL0111: cannot drop a table with drop view &#39;name&#39;</a></li><li><a href="#cql0112-index-in-drop-statement-was-not-declared-index_name" class="table-of-contents__link">CQL0112: index in drop statement was not declared &#39;index_name&#39;</a></li><li><a href="#cql0113-trigger-in-drop-statement-was-not-declared-name" class="table-of-contents__link">CQL0113: trigger in drop statement was not declared &#39;name&#39;</a></li><li><a href="#cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name" class="table-of-contents__link">CQL0114: current schema can&#39;t go back to recreate semantics for &#39;table_name&#39;</a></li><li><a href="#cql0115-current-create-version-not-equal-to-previous-create-version-for-table" class="table-of-contents__link">CQL0115: current create version not equal to previous create version for &#39;table&#39;</a></li><li><a href="#cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table" class="table-of-contents__link">CQL0116: current delete version not equal to previous delete version for &#39;table&#39;</a></li><li><a href="#cql0117-delete-procedure-changed-in-object-table_name" class="table-of-contents__link">CQL0117: <code>@delete</code> procedure changed in object &#39;table_name&#39;</a></li><li><a href="#cql0118-create-procedure-changed-in-object-table_name" class="table-of-contents__link">CQL0118: <code>@create</code> procedure changed in object &#39;table_name&#39;</a></li><li><a href="#cql0119-column-name-is-different-between-previous-and-current-schema-name" class="table-of-contents__link">CQL0119: column name is different between previous and current schema &#39;name&#39;</a></li><li><a href="#cql0120-column-type-is-different-between-previous-and-current-schema-name" class="table-of-contents__link">CQL0120: column type is different between previous and current schema &#39;name&#39;</a></li><li><a href="#cql0121-column-current-create-version-not-equal-to-previous-create-version-name" class="table-of-contents__link">CQL0121: column current create version not equal to previous create version &#39;name&#39;</a></li><li><a href="#cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name" class="table-of-contents__link">CQL0122: column current delete version not equal to previous delete version &#39;name&#39;</a></li><li><a href="#cql0123-column-delete-procedure-changed-name" class="table-of-contents__link">CQL0123: column <code>@delete</code> procedure changed &#39;name&#39;</a></li><li><a href="#cql0124-column-create-procedure-changed-name" class="table-of-contents__link">CQL0124: column <code>@create</code> procedure changed &#39;name&#39;</a></li><li><a href="#cql0125-column-current-default-value-not-equal-to-previous-default-value-column" class="table-of-contents__link">CQL0125: column current default value not equal to previous default value &#39;column&#39;</a></li><li><a href="#cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table" class="table-of-contents__link">CQL0126: table was present but now it does not exist (use <code>@delete</code> instead) &#39;table&#39;</a></li><li><a href="#cql0127-object-was-a-table-but-is-now-a-view-name" class="table-of-contents__link">CQL0127: object was a table but is now a view &#39;name&#39;</a></li><li><a href="#cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column" class="table-of-contents__link">CQL0128: table has a column that is different in the previous and current schema &#39;column&#39;</a></li><li><a href="#cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name" class="table-of-contents__link">CQL0129: a column was removed from the table rather than marked with <code>@delete</code> &#39;column_name&#39;</a></li><li><a href="#cql0130-table-has-columns-added-without-marking-them-create-column_name" class="table-of-contents__link">CQL0130: table has columns added without marking them <code>@create</code> &#39;column_name&#39;</a></li><li><a href="#cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name" class="table-of-contents__link">CQL0131: table has newly added columns that are marked both <code>@create</code> and <code>@delete</code> &#39;column_name&#39;</a></li><li><a href="#cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name" class="table-of-contents__link">CQL0132: table has a facet that is different in the previous and current schema &#39;table_name&#39;</a></li><li><a href="#cql0133-non-column-facets-have-been-removed-from-the-table-name" class="table-of-contents__link">CQL0133: non-column facets have been removed from the table &#39;name&#39;</a></li><li><a href="#cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name" class="table-of-contents__link">CQL0134: table has a new non-column facet in the current schema &#39;table_name&#39;</a></li><li><a href="#cql0135-table-create-statement-attributes-different-than-previous-version-table_name" class="table-of-contents__link">CQL0135: table create statement attributes different than previous version &#39;table_name&#39;</a></li><li><a href="#cql0136-trigger-already-exists-trigger_name" class="table-of-contents__link">CQL0136: trigger already exists &#39;trigger_name&#39;</a></li><li><a href="#cql0137-tableview-not-found-name" class="table-of-contents__link">CQL0137: table/view not found &#39;name&#39;</a></li><li><a href="#cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name" class="table-of-contents__link">CQL0138: a trigger on a view must be the INSTEAD OF form &#39;name&#39;</a></li><li><a href="#cql0139-temp-tables-may-not-have-versioning-annotations-table_name" class="table-of-contents__link">CQL0139: temp tables may not have versioning annotations &#39;table_name&#39;</a></li><li><a href="#cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name" class="table-of-contents__link">CQL0140: columns in a temp table may not have versioning attributes &#39;column_name&#39;</a></li><li><a href="#cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name" class="table-of-contents__link">CQL0141: table has an AUTOINCREMENT column; it cannot also be WITHOUT ROWID &#39;table_name&#39;</a></li><li><a href="#cql0142-duplicate-column-name-column_name" class="table-of-contents__link">CQL0142: duplicate column name &#39;column_name&#39;</a></li><li><a href="#cql0143-more-than-one-primary-key-in-table-table_name" class="table-of-contents__link">CQL0143: more than one primary key in table &#39;table_name&#39;</a></li><li><a href="#cql0144-cannot-alter-a-view-view_name" class="table-of-contents__link">CQL0144: cannot alter a view &#39;view_name&#39;</a></li><li><a href="#cql0144-table-in-alter-statement-does-not-exist-table_name" class="table-of-contents__link">CQL0144: table in alter statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0145-version-annotations-not-valid-in-alter-statement-column_name" class="table-of-contents__link">CQL0145: version annotations not valid in alter statement &#39;column_name&#39;</a></li><li><a href="#cql0146-adding-an-auto-increment-column-is-not-allowed-column_name" class="table-of-contents__link">CQL0146: adding an auto increment column is not allowed &#39;column_name&#39;</a></li><li><a href="#cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name" class="table-of-contents__link">CQL0147: adding a not nullable column with no default value is not allowed &#39;column_name&#39;</a></li><li><a href="#cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name" class="table-of-contents__link">CQL0148: added column must already be reflected in declared schema, with <code>@create</code>, exact name match required &#39;column_name&#39;</a></li><li><a href="#cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name" class="table-of-contents__link">CQL0149: added column must be an exact match for the column type declared in the table &#39;column_name&#39;</a></li><li><a href="#cql0150-expected-numeric-expression-in-if-predicate" class="table-of-contents__link">CQL0150: expected numeric expression in IF predicate</a></li><li><a href="#cql0151-table-in-delete-statement-does-not-exist-table_name" class="table-of-contents__link">CQL0151: table in delete statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0152-cannot-delete-from-a-view-view_name" class="table-of-contents__link">CQL0152: cannot delete from a view &#39;view_name&#39;</a></li><li><a href="#cql0153-duplicate-target-column-name-in-update-statement-column_name" class="table-of-contents__link">CQL0153: duplicate target column name in update statement &#39;column_name&#39;</a></li><li><a href="#cql0154-table-in-update-statement-does-not-exist-table_name" class="table-of-contents__link">CQL0154: table in update statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0155-cannot-update-a-view-view_name" class="table-of-contents__link">CQL0155: cannot update a view &#39;view_name&#39;</a></li><li><a href="#cql0156-seed-expression-must-be-a-non-nullable-integer" class="table-of-contents__link">CQL0156: seed expression must be a non-nullable integer</a></li><li><a href="#cql0157-count-of-columns-differs-from-count-of-values" class="table-of-contents__link">CQL0157: count of columns differs from count of values</a></li><li><a href="#cql0158-required-column-missing-in-insert-statement-column_name" class="table-of-contents__link">CQL0158: required column missing in INSERT statement &#39;column_name&#39;</a></li><li><a href="#cql0159-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now" class="table-of-contents__link">CQL0159: there&#39;s no good way to generate dummy blobs; not supported for now</a></li><li><a href="#cql0160-table-in-insert-statement-does-not-exist-table_name" class="table-of-contents__link">CQL0160: table in insert statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0161-cannot-insert-into-a-view-view_name" class="table-of-contents__link">CQL0161: cannot insert into a view &#39;view_name&#39;</a></li><li><a href="#cql0162-from-arguments-is-redundant-if-insert-column-list-is-empty" class="table-of-contents__link">CQL0162: FROM ARGUMENTS is redundant if insert column list is empty</a></li><li><a href="#cql0163-from-arguments-construct-is-only-valid-inside-a-procedure" class="table-of-contents__link">CQL0163: FROM ARGUMENTS construct is only valid inside a procedure</a></li><li><a href="#cql0164-too-few-arguments-available" class="table-of-contents__link">CQL0164: too few arguments available</a></li><li><a href="#cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name" class="table-of-contents__link">CQL0165: fetch values is only for value cursors, not for sqlite cursors &#39;cursor_name&#39;</a></li><li><a href="#cql0166-count-of-columns-differs-from-count-of-values" class="table-of-contents__link">CQL0166: count of columns differs from count of values</a></li><li><a href="#cql0167-required-column-missing-in-fetch-statement-column_name" class="table-of-contents__link">CQL0167: required column missing in FETCH statement &#39;column_name&#39;</a></li><li><a href="#cql0168-theres-no-good-way-to-generate-dummy-blobs-not-supported-for-now" class="table-of-contents__link">CQL0168: there&#39;s no good way to generate dummy blobs; not supported for now</a></li><li><a href="#cql0169-cannot-fetch-from-a-cursor-without-fields-cursor_name" class="table-of-contents__link">CQL0169: cannot fetch from a cursor without fields &#39;cursor_name&#39;</a></li><li><a href="#cql0170-cursor-must-be-a-value-cursor-not-a-statement-cursor-cursor_name" class="table-of-contents__link">CQL0170: cursor must be a value cursor, not a statement cursor &#39;cursor_name&#39;</a></li><li><a href="#cql0171-name-not-found-name" class="table-of-contents__link">CQL0171: name not found &#39;name&#39;</a></li><li><a href="#cql0172-name-list-has-duplicate-name-name" class="table-of-contents__link">CQL0172: name list has duplicate name &#39;name&#39;</a></li><li><a href="#cql0173-variable-not-found-variable_name" class="table-of-contents__link">CQL0173: variable not found &#39;variable_name&#39;</a></li><li><a href="#cql0174-cannot-set-a-cursor-cursor_name" class="table-of-contents__link">CQL0174: cannot set a cursor &#39;cursor_name&#39;</a></li><li><a href="#cql0175-duplicate-parameter-name-parameter_name" class="table-of-contents__link">CQL0175: duplicate parameter name &#39;parameter_name&#39;</a></li><li><a href="#cql0176-proc-has-no-result-proc_name" class="table-of-contents__link">CQL0176: proc has no result &#39;proc_name&#39;</a></li><li><a href="#cql0177-tableviewproc-not-found-name" class="table-of-contents__link">CQL0177: table/view/proc not found &#39;name&#39;</a></li><li><a href="#cql0178-proc-has-no-result-like_name" class="table-of-contents__link">CQL0178: proc has no result &#39;like_name&#39;</a></li><li><a href="#cql0179-tableviewproc-not-found-like_name" class="table-of-contents__link">CQL0179: table/view/proc not found &#39;like_name&#39;</a></li><li><a href="#cql0180-duplicate-column-name-in-result-not-allowed-column_name" class="table-of-contents__link">CQL0180: duplicate column name in result not allowed &#39;column_name&#39;</a></li><li><a href="#cql0181-autodrop-temp-table-does-not-exist-name" class="table-of-contents__link">CQL0181: autodrop temp table does not exist &#39;name&#39;</a></li><li><a href="#cql0182-autodrop-target-is-not-a-table-name" class="table-of-contents__link">CQL0182: autodrop target is not a table &#39;name&#39;</a></li><li><a href="#cql0183-autodrop-target-must-be-a-temporary-table-name" class="table-of-contents__link">CQL0183: autodrop target must be a temporary table &#39;name&#39;</a></li><li><a href="#cql0184-stored-procedures-cannot-be-nested-name" class="table-of-contents__link">CQL0184: stored procedures cannot be nested &#39;name&#39;</a></li><li><a href="#cql0185-proc-name-conflicts-with-func-name-name" class="table-of-contents__link">CQL0185: proc name conflicts with func name &#39;name&#39;</a></li><li><a href="#cql0186-duplicate-stored-proc-name-name" class="table-of-contents__link">CQL0186: duplicate stored proc name &#39;name&#39;</a></li><li><a href="#cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name" class="table-of-contents__link">CQL0187: @schema_upgrade_version not declared or doesn&#39;t match upgrade version <code>N</code> for proc &#39;name&#39;</a></li><li><a href="#cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name" class="table-of-contents__link">CQL0188: procedure is supposed to do schema migration but it doesn&#39;t have any DML &#39;name&#39;</a></li><li><a href="#cql0189-procedure-declarationsdefinitions-do-not-match-name" class="table-of-contents__link">CQL0189: procedure declarations/definitions do not match &#39;name&#39;</a></li><li><a href="#cql0190-duplicate-column-name-name" class="table-of-contents__link">CQL0190: duplicate column name &#39;name&#39;</a></li><li><a href="#cql0191-declared-functions-must-be-top-level-function_name" class="table-of-contents__link">CQL0191: declared functions must be top level &#39;function_name&#39;</a></li><li><a href="#cql0192-func-name-conflicts-with-proc-name-name" class="table-of-contents__link">CQL0192: func name conflicts with proc name &#39;name&#39;</a></li><li><a href="#cql0193-duplicate-function-name-name" class="table-of-contents__link">CQL0193: duplicate function name &#39;name&#39;</a></li><li><a href="#cql0194-declared-procedures-must-be-top-level-name" class="table-of-contents__link">CQL0194: declared procedures must be top level &#39;name&#39;</a></li><li><a href="#cql0195-proc-name-conflicts-with-func-name-name" class="table-of-contents__link">CQL0195: proc name conflicts with func name &#39;name&#39;</a></li><li><a href="#cql0196-procedure-declarationsdefinitions-do-not-match-name" class="table-of-contents__link">CQL0196: procedure declarations/definitions do not match &#39;name&#39;</a></li><li><a href="#cql0197-duplicate-variable-name-in-the-same-scope-name" class="table-of-contents__link">CQL0197: duplicate variable name in the same scope &#39;name&#39;</a></li><li><a href="#cql0198-global-variable-hides-tableview-name-name" class="table-of-contents__link">CQL0198: global variable hides table/view name &#39;name&#39;</a></li><li><a href="#cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-proc_name" class="table-of-contents__link">CQL0199: cursor requires a procedure that returns a result set via select &#39;proc_name&#39;</a></li><li><a href="#cql0200-variable-is-not-a-cursor-another_cursor" class="table-of-contents__link">CQL0200: variable is not a cursor &#39;another_cursor&#39;</a></li><li><a href="#cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg" class="table-of-contents__link">CQL0201: expanding FROM ARGUMENTS, there is no argument matching &#39;required_arg&#39;</a></li><li><a href="#cql0202-must-be-a-cursor-proc-table-or-view-like_name" class="table-of-contents__link">CQL0202: must be a cursor, proc, table, or view &#39;like_name&#39;</a></li><li><a href="#cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name" class="table-of-contents__link">CQL0203: cursor requires a procedure that returns a cursor with OUT &#39;cursor_name&#39;</a></li><li><a href="#cql0204-cursor-not-found-name" class="table-of-contents__link">CQL0204: cursor not found &#39;name&#39;</a></li><li><a href="#cql0205-variable-is-not-a-cursor-name" class="table-of-contents__link">CQL0205: variable is not a cursor &#39;name&#39;</a></li><li><a href="#cql0206-duplicate-name-in-list-name" class="table-of-contents__link">CQL0206: duplicate name in list &#39;name&#39;</a></li><li><a href="#cql0207-proc-out-parameter-formal-cannot-be-fulfilled-by-non-variable-param_name" class="table-of-contents__link">CQL0207: proc out parameter: formal cannot be fulfilled by non-variable &#39;param_name&#39;</a></li><li><a href="#cql0208-proc-out-parameter-formal-cannot-be-fulfilled-by-in-only-variable-variable_name" class="table-of-contents__link">CQL0208: proc out parameter: formal cannot be fulfilled by in-only variable &#39;variable_name&#39;</a></li><li><a href="#cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name" class="table-of-contents__link">CQL0209: proc out parameter: arg must be an exact type match (expected expected_type; found actual_type) &#39;param_name&#39;</a></li><li><a href="#cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability" class="table-of-contents__link">CQL0210: proc out parameter: arg must be an exact type match (even nullability)</a></li><li><a href="#cql0211-last-formal-arg-of-procedure-is-not-an-out-arg-cannot-use-proc-as-a-function-name" class="table-of-contents__link">CQL0211: last formal arg of procedure is not an out arg, cannot use proc as a function &#39;name&#39;</a></li><li><a href="#cql0212-too-few-arguments-provided-to-procedure-name" class="table-of-contents__link">CQL0212: too few arguments provided to procedure &#39;name&#39;</a></li><li><a href="#cql0213-procedure-had-errors-cant-call-proc_name" class="table-of-contents__link">CQL0213: procedure had errors, can&#39;t call. &#39;proc_name&#39;</a></li><li><a href="#cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name" class="table-of-contents__link">CQL0214: procedures with results can only be called using a cursor in global context &#39;name&#39;</a></li><li><a href="#cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name" class="table-of-contents__link">CQL0215: value cursors are not used with FETCH C, or FETCH C INTO &#39;cursor_name&#39;</a></li><li><a href="#cql0216-fetch-variable-not-found-cursor_name" class="table-of-contents__link">CQL0216: FETCH variable not found &#39;cursor_name&#39;</a></li><li><a href="#cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name" class="table-of-contents__link">CQL0217: number of variables did not match count of columns in cursor &#39;cursor_name&#39;</a></li><li><a href="#cql0218-continue-must-be-inside-of-a-loop-or-while-statement" class="table-of-contents__link">CQL0218: continue must be inside of a &#39;loop&#39; or &#39;while&#39; statement</a></li><li><a href="#cql0219-leave-must-be-inside-of-a-loop-or-while-statement" class="table-of-contents__link">CQL0219: leave must be inside of a &#39;loop&#39; or &#39;while&#39; statement</a></li><li><a href="#cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name" class="table-of-contents__link">CQL0220: savepoint has not been mentioned yet, probably wrong &#39;name&#39;</a></li><li><a href="#cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name" class="table-of-contents__link">CQL0221: savepoint has not been mentioned yet, probably wrong &#39;name&#39;</a></li><li><a href="#cql0222-the-out-cursor-statement-only-makes-sense-inside-of-a-procedure" class="table-of-contents__link">CQL0222: the out cursor statement only makes sense inside of a procedure</a></li><li><a href="#cql0223-the-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name" class="table-of-contents__link">CQL0223: the cursor was not fetched with the auto-fetch syntax &#39;fetch cursor&#39; &#39;cursor_name&#39;</a></li><li><a href="#cql0224-literal-output-can-only-appear-outside-of-procedures" class="table-of-contents__link">CQL0224: literal output can only appear outside of procedures</a></li><li><a href="#cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc" class="table-of-contents__link">CQL0225: switching to previous schema validation mode must be outside of any proc</a></li><li><a href="#cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc" class="table-of-contents__link">CQL0226: schema upgrade declaration must be outside of any proc</a></li><li><a href="#cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared" class="table-of-contents__link">CQL0227: schema upgrade declaration must come before any tables are declared</a></li><li><a href="#cql0228-schema-upgrade-version-must-be-a-positive-integer" class="table-of-contents__link">CQL0228: schema upgrade version must be a positive integer</a></li><li><a href="#cql0229-schema-upgrade-version-declaration-may-only-appear-once" class="table-of-contents__link">CQL0229: schema upgrade version declaration may only appear once</a></li><li><a href="#cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc" class="table-of-contents__link">CQL0230: schema upgrade version declaration must be outside of any proc</a></li><li><a href="#cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared" class="table-of-contents__link">CQL0231: schema upgrade version declaration must come before any tables are declared</a></li><li><a href="#cql0232-nested-select-expression-must-return-exactly-one-column" class="table-of-contents__link">CQL0232: nested select expression must return exactly one column</a></li><li><a href="#cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-proc_name" class="table-of-contents__link">CQL0233: procedure previously declared as schema upgrade proc, it can have no args &#39;proc_name&#39;</a></li><li><a href="#cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name" class="table-of-contents__link">CQL0234: autodrop annotation can only go on a procedure that returns a result set &#39;proc_name&#39;</a></li><li><a href="#cql0235-too-many-arguments-provided-to-procedure-proc_name" class="table-of-contents__link">CQL0235: too many arguments provided to procedure &#39;proc_name&#39;</a></li><li><a href="#cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name" class="table-of-contents__link">CQL0236: autodrop annotation can only go on a procedure that uses the database &#39;name&#39;</a></li><li><a href="#cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key" class="table-of-contents__link">CQL0237: strict FK validation requires that some ON UPDATE option be selected for every foreign key</a></li><li><a href="#cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key" class="table-of-contents__link">CQL0238: strict FK validation requires that some ON DELETE option be selected for every foreign key</a></li><li><a href="#cql0239-procedure-identity-column-does-not-exist-in-result-set-column_name" class="table-of-contents__link">CQL0239: procedure identity column does not exist in result set &#39;column_name&#39;</a></li><li><a href="#cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-proc_name" class="table-of-contents__link">CQL0240: identity annotation can only go on a procedure that returns a result set &#39;proc_name&#39;</a></li><li><a href="#cql0241-concat-may-only-appear-in-the-context-of-sql-statement" class="table-of-contents__link">CQL0241: CONCAT may only appear in the context of SQL statement</a></li><li><a href="#cql0242" class="table-of-contents__link">CQL0242</a></li><li><a href="#cql0243-blob-operand-must-be-converted-to-string-first-in-" class="table-of-contents__link">CQL0243: blob operand must be converted to string first in &#39;||&#39;</a></li><li><a href="#cql0244-unknown-schema-region-region" class="table-of-contents__link">CQL0244: unknown schema region &#39;region&#39;</a></li><li><a href="#cql0245-schema-region-already-defined-region" class="table-of-contents__link">CQL0245: schema region already defined &#39;region&#39;</a></li><li><a href="#cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one" class="table-of-contents__link">CQL0246: schema regions do not nest; end the current region before starting a new one</a></li><li><a href="#cql0247-you-must-begin-a-schema-region-before-you-can-end-one" class="table-of-contents__link">CQL0247: you must begin a schema region before you can end one</a></li><li><a href="#cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure" class="table-of-contents__link">CQL0248: schema region directives may not appear inside of a procedure</a></li><li><a href="#cql0249-function-is-not-a-table-valued-function-function_name" class="table-of-contents__link">CQL0249: function is not a table-valued-function &#39;function_name&#39;</a></li><li><a href="#cql0250-table-valued-function-not-declared-function_name" class="table-of-contents__link">CQL0250: table-valued function not declared &#39;function_name&#39;</a></li><li><a href="#cql0251-fragment-must-end-with-exactly-select--from-cte" class="table-of-contents__link">CQL0251: fragment must end with exactly &#39;SELECT * FROM CTE&#39;</a></li><li><a href="#cql0252-proc-literal-can-only-appear-inside-of-procedures" class="table-of-contents__link">CQL0252: @PROC literal can only appear inside of procedures</a></li><li><a href="#cql0253-base-fragment-must-include-a-single-cte-named-same-as-the-fragment-name" class="table-of-contents__link">CQL0253: base fragment must include a single CTE named same as the fragment &#39;name&#39;</a></li><li><a href="#cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used" class="table-of-contents__link">CQL0254: switching to previous schema validation mode not allowed if <code>@schema_upgrade_version</code> was used</a></li><li><a href="#cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name" class="table-of-contents__link">CQL0255: fragment name is not a previously declared base fragment &#39;bad_fragment_name&#39;</a></li><li><a href="#cql0256-fragment-name-conflicts-with-existing-base-fragment-name" class="table-of-contents__link">CQL0256: fragment name conflicts with existing base fragment &#39;NAME&#39;</a></li><li><a href="#cql0257-argument-must-be-a-string-or-numeric-in-function" class="table-of-contents__link">CQL0257: argument must be a string or numeric in &#39;function&#39;</a></li><li><a href="#cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name" class="table-of-contents__link">CQL0258: extension fragment must add exactly one CTE; found extra named &#39;name&#39;</a></li><li><a href="#cql0259-extension-fragment-cte-must-select-t-from-base-cte" class="table-of-contents__link">CQL0259: extension fragment CTE must select T.* from base CTE</a></li><li><a href="#cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name" class="table-of-contents__link">CQL0260: extension fragment CTE must be a simple left outer join from &#39;table_name&#39;</a></li><li><a href="#cql0261-available-for-re-use" class="table-of-contents__link">CQL0261: available for re-use</a></li><li><a href="#cql0262-available-for-re-use" class="table-of-contents__link">CQL0262: available for re-use</a></li><li><a href="#cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled" class="table-of-contents__link">CQL0263: non-ANSI joins are forbidden if strict join mode is enabled.</a></li><li><a href="#cql0264-duplicate-assembly-fragments-of-base-fragment" class="table-of-contents__link">CQL0264: duplicate assembly fragments of base fragment</a></li><li><a href="#cql0265-assembly-fragment-can-only-have-one-cte" class="table-of-contents__link">CQL0265: assembly fragment can only have one CTE</a></li><li><a href="#cql0266-extension-fragment-name-conflicts-with-existing-fragment" class="table-of-contents__link">CQL0266: extension fragment name conflicts with existing fragment</a></li><li><a href="#cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column" class="table-of-contents__link">CQL0267: extension fragments of same base fragment share the same cte column</a></li><li><a href="#cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment" class="table-of-contents__link">CQL0268: extension/assembly fragment must have the CTE columns same as the base fragment</a></li><li><a href="#cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys" class="table-of-contents__link">CQL0269: at least part of this unique key is redundant with previous unique keys</a></li><li><a href="#cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor" class="table-of-contents__link">CQL0270: use FETCH FROM for procedures that returns a cursor with OUT &#39;cursor&#39;</a></li><li><a href="#cql0271-the-offset-clause-may-only-be-used-if-limit-is-also-present" class="table-of-contents__link">CQL0271: the OFFSET clause may only be used if LIMIT is also present</a></li><li><a href="#cql0272-the-set-of-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table" class="table-of-contents__link">CQL0272: THE SET OF COLUMNS REFERENCED IN THE FOREIGN KEY STATEMENT SHOULD MATCH EXACTLY A UNIQUE KEY IN PARENT TABLE</a></li><li><a href="#cql0273-autotest-attribute-has-incorrect-format--in-dummy_test" class="table-of-contents__link">CQL0273: autotest attribute has incorrect format (...) in &#39;dummy_test&#39;</a></li><li><a href="#cql0274-autotest-attribute-dummy_test-has-non-existent-table" class="table-of-contents__link">CQL0274: autotest attribute &#39;dummy_test&#39; has non existent table</a></li><li><a href="#cql0275-autotest-attribute-dummy_test-has-non-existent-column" class="table-of-contents__link">CQL0275: autotest attribute &#39;dummy_test&#39; has non existent column</a></li><li><a href="#cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in" class="table-of-contents__link">CQL0276: autotest attribute &#39;dummy_test&#39; has invalid value type in</a></li><li><a href="#cql0277-autotest-has-incorrect-format" class="table-of-contents__link">CQL0277: autotest has incorrect format</a></li><li><a href="#cql0278-autotest-attribute-name-is-not-valid" class="table-of-contents__link">CQL0278: autotest attribute name is not valid</a></li><li><a href="#cql0279-the-set-of-columns-referenced-in-the-conflict-target-should-match-exactly-a-unique-key-in-table-we-apply-upsert" class="table-of-contents__link">CQL0279: the set of columns referenced in the conflict target should match exactly a unique key in table we apply upsert</a></li><li><a href="#cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select" class="table-of-contents__link">CQL0280: upsert statement requires a where clause if the insert clause uses select</a></li><li><a href="#cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement" class="table-of-contents__link">CQL0281: upsert statement does not include table name in the update statement</a></li><li><a href="#cql0282-update-statement-require-table-name" class="table-of-contents__link">CQL0282: update statement require table name</a></li><li><a href="#cql0283-upsert-syntax-only-support-insert-into" class="table-of-contents__link">CQL0283: upsert syntax only support INSERT INTO</a></li><li><a href="#cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run" class="table-of-contents__link">CQL0284: ad hoc schema migration directive must provide a procedure to run</a></li><li><a href="#cql0285-ad-hoc-schema-migration-directive-version-number-changed-proc_name" class="table-of-contents__link">CQL0285: ad hoc schema migration directive version number changed &#39;proc_name&#39;</a></li><li><a href="#cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-proc_name" class="table-of-contents__link">CQL0286: ad hoc schema migration directive was removed; this is not allowed &#39;proc_name&#39;</a></li><li><a href="#cql0287-extensionassembly-fragment-must-add-stub-" class="table-of-contents__link">CQL0287: extension/assembly fragment must add stub &quot;</a></li><li><a href="#cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-" class="table-of-contents__link">CQL0288: extension/assembly fragment stub for base CTE column must be &quot;</a></li><li><a href="#cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled" class="table-of-contents__link">CQL0289: upsert statement are forbidden if strict upsert statement mode is enabled</a></li><li><a href="#cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect" class="table-of-contents__link">CQL0290: fragments can only have one statement in the statement list and it must be a WITH..SELECT</a></li><li><a href="#cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region" class="table-of-contents__link">CQL0291: region links into the middle of a deployable region; you must point to the root of <code>&lt;deployable_region&gt;</code> not into the middle: <code>&lt;error_region&gt;</code></a></li><li><a href="#cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions" class="table-of-contents__link">CQL0292: Explain statement is only available in dev mode because its result set may vary between sqlite versions</a></li><li><a href="#cql0293-only-explain-query-plan--statement-is-supported" class="table-of-contents__link">CQL0293: Only EXPLAIN QUERY PLAN ... statement is supported</a></li><li><a href="#cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement" class="table-of-contents__link">CQL0294: Window function invocations can only appear in the select list of a select statement</a></li><li><a href="#cql0295-window-name-is-not-defined" class="table-of-contents__link">CQL0295: Window name is not defined</a></li><li><a href="#cql0296-window-name-definition-is-not-used" class="table-of-contents__link">CQL0296: Window name definition is not used</a></li><li><a href="#cql0297-from-cursor-is-redundant-if-column-list-is-empty" class="table-of-contents__link">CQL0297: FROM CURSOR is redundant if column list is empty</a></li><li><a href="#cql0298-cannot-insert-from-a-cursor-without-fields-cursor_name" class="table-of-contents__link">CQL0298: cannot insert from a cursor without fields &#39;cursor_name&#39;</a></li><li><a href="#cql0299-cursor-has-too-few-fields-for-this-insert-cursor_name" class="table-of-contents__link">CQL0299: cursor has too few fields for this insert, &#39;cursor_name&#39;</a></li><li><a href="#cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" class="table-of-contents__link">CQL0300: Argument must be an integer (between 1 and max integer) in function &#39;function_name&#39;</a></li><li><a href="#cql0301-the-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name" class="table-of-contents__link">CQL0301: The second argument must be an integer (between 0 and max integer) in function &#39;function_name&#39;</a></li><li><a href="#cql0302-the-first-and-third-arguments-must-be-of-the-same-type-in-function-function_name" class="table-of-contents__link">CQL0302: The first and third arguments must be of the same type in function &#39;function_name&#39;</a></li><li><a href="#cql0303-the-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" class="table-of-contents__link">CQL0303: The second argument must be an integer between 1 and max integer in function &#39;function_name&#39;</a></li><li><a href="#cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function" class="table-of-contents__link">CQL0304: DISTINCT may only be used with one explicit argument in an aggregate function</a></li><li><a href="#cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined" class="table-of-contents__link">CQL0305: DISTINCT may only be used in function that are aggregated or user defined</a></li><li><a href="#cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined" class="table-of-contents__link">CQL0306: FILTER clause may only be used in function that are aggregated or user defined</a></li><li><a href="#cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level" class="table-of-contents__link">CQL0307: return statement should be in a procedure and not at the top level</a></li><li><a href="#cql0308-statement-should-be-the-last-thing-in-a-statement-list" class="table-of-contents__link">CQL0308: statement should be the last thing in a statement list</a></li><li><a href="#cql0309-new-table-must-be-added-with-createnumber-or-later-table_name" class="table-of-contents__link">CQL0309: new table must be added with @create(number) or later &#39;table_name&#39;</a></li><li><a href="#cql0310-new-column-must-be-added-with-createnumber-or-later-column_name" class="table-of-contents__link">CQL0310: new column must be added with @create(number) or later&quot; &#39;column_name&#39;</a></li><li><a href="#cql0311-cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name" class="table-of-contents__link">CQL0311: CQL0311: object&#39;s deployment region changed from &#39;&lt;previous_region&gt;&#39; to &#39;&lt;current_region&gt;&#39; &#39;object_name&#39;</a></li><li><a href="#cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled" class="table-of-contents__link">CQL0312: window function invocation are forbidden if strict window function mode is enabled</a></li><li><a href="#cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement" class="table-of-contents__link">CQL0313: blob literals may only appear in the context of a SQL statement</a></li><li><a href="#cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in" class="table-of-contents__link">CQL0314: select function does not require a declaration, it is a CQL built-in</a></li><li><a href="#cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement" class="table-of-contents__link">CQL0315: mandatory column with no default value in INSERT INTO name DEFAULT VALUES statement.</a></li><li><a href="#cql0316-the-upsert-clause-is-not-compatible-with-default-values" class="table-of-contents__link">CQL0316: the upsert-clause is not compatible with DEFAULT VALUES</a></li><li><a href="#cql0317-char-function-arguments-must-be-integer" class="table-of-contents__link">CQL0317: char function arguments must be integer</a></li><li><a href="#cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name" class="table-of-contents__link">CQL0318: more than one fragment annotation on procedure &#39;procedure_name&#39;</a></li><li><a href="#cql0319-the-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name" class="table-of-contents__link">CQL0319: the name of the assembly procedure must match the name of the base fragment &#39;procedure_name&#39;</a></li><li><a href="#cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name" class="table-of-contents__link">CQL0320: extension fragment CTE must have a FROM clause and no other top level clauses &#39;frag_name&#39;</a></li><li><a href="#cql0321-migration-proc-not-allowed-on-object-object_name" class="table-of-contents__link">CQL0321: migration proc not allowed on object &#39;object_name&#39;</a></li><li><a href="#cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name" class="table-of-contents__link">CQL0322: fragment parameters must be exactly &#39;arguments&#39; &#39;procedure_name&#39;</a></li><li><a href="#cql0323-calls-to-undeclared-procedures-are-forbidden-if-strict-procedure-mode-is-enabled-procedure_name" class="table-of-contents__link">CQL0323: calls to undeclared procedures are forbidden if strict procedure mode is enabled &#39;procedure_name&#39;</a></li><li><a href="#cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table" class="table-of-contents__link">CQL0324: referenced table was created in a later version so it cannot be used in a foreign key &#39;referenced_table&#39;</a></li><li><a href="#cql0325-ok_table_scan-attribute-must-be-a-name" class="table-of-contents__link">CQL0325: ok_table_scan attribute must be a name</a></li><li><a href="#cql0326-the-table-name-in-ok_table_scan-does-not-exist-table_name" class="table-of-contents__link">CQL0326: the table name in ok_table_scan does not exist &#39;table_name&#39;</a></li><li><a href="#cql0327-a-value-should-not-be-assigned-to-no_table_scan-attribute" class="table-of-contents__link">CQL0327: a value should not be assigned to no_table_scan attribute</a></li><li><a href="#cql0328-no_table_scan-attribute-may-only-be-added-to-a-create-table-statement" class="table-of-contents__link">CQL0328: no_table_scan attribute may only be added to a create table statement</a></li><li><a href="#cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement" class="table-of-contents__link">CQL0329: ok_table_scan attribute can only be used in a create procedure statement</a></li><li><a href="#cql0330-fragment-must-start-with-exactly-select--from-cte" class="table-of-contents__link">CQL0330: fragment must start with exactly &#39;SELECT * FROM CTE&#39;</a></li><li><a href="#cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name" class="table-of-contents__link">CQL0331: extension fragment CTE must have not have ORDER BY or LIMIT clauses &#39;frag_name&#39;</a></li><li><a href="#cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name" class="table-of-contents__link">CQL0332: all extension fragments that use UNION ALL must come before those that use LEFT OUTER JOIN &#39;frag_name&#39;</a></li><li><a href="#cql0333-all-the-compound-operators-in-this-cte-must-be-union-all" class="table-of-contents__link">CQL0333: all the compound operators in this CTE must be UNION ALL</a></li><li><a href="#cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row" class="table-of-contents__link">CQL0334: @dummy_seed @dummy_nullables @dummy_defaults many only be used with a single VALUES row</a></li><li><a href="#cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values" class="table-of-contents__link">CQL0336: select statement with VALUES clause requires a non empty list of values</a></li><li><a href="#cql0337-the-number-of-columns-values-for-each-row-should-be-identical-in-values-clause" class="table-of-contents__link">CQL0337: the number of columns values for each row should be identical in VALUES clause</a></li><li><a href="#cql0338-the-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name" class="table-of-contents__link">CQL0338: the name of a migration procedure may not end in &#39;_crc&#39; &#39;procedure_name&#39;</a></li><li><a href="#cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled" class="table-of-contents__link">CQL0339: WITHOUT ROWID tables are forbidden if strict without rowid mode is enabled</a></li><li><a href="#cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name" class="table-of-contents__link">CQL0340: FROM ARGUMENTS used in a procedure with no arguments &#39;procedure_name&#39;</a></li></ul></li><li><a href="#appendix-5-json-schema-grammar" class="table-of-contents__link">Appendix 5: JSON Schema Grammar</a><ul><li><a href="#rules-1" class="table-of-contents__link">Rules</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/CG-SQL/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/CG-SQL/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Facebook Open Source Logo" src="/CG-SQL/img/oss_logo.png"></a></div><div>Copyright © 2020 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/CG-SQL/styles.0609face.js"></script>
<script src="/CG-SQL/runtime~main.a7b2fbca.js"></script>
<script src="/CG-SQL/main.7fbcc296.js"></script>
<script src="/CG-SQL/1.5652f5db.js"></script>
<script src="/CG-SQL/2.26ec7d90.js"></script>
<script src="/CG-SQL/3.ef8f5048.js"></script>
<script src="/CG-SQL/1be78505.ea7a68b3.js"></script>
<script src="/CG-SQL/46.b422d852.js"></script>
<script src="/CG-SQL/5456faf3.d182cbac.js"></script>
<script src="/CG-SQL/17896441.9a4ae369.js"></script>
<script src="/CG-SQL/d6e99f23.3ae457e1.js"></script>
</body>
</html>